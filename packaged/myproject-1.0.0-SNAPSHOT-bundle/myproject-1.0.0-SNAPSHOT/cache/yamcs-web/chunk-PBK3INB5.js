import{a as lt,b as pt}from"./chunk-L67MW52F.js";import{$e as G,Cb as A,Dg as ot,Ea as c,Fh as w,Gh as ct,Hh as rt,Ia as I,Ja as E,Jb as j,Jf as R,Ka as $,Kf as k,Lf as et,Ra as s,Ta as r,V as m,We as g,Xe as B,Y as p,Ye as O,Ze as Y,_ as D,_a as N,_e as W,af as Q,bb as S,bf as U,bh as mt,cb as T,cf as V,da as d,db as F,df as q,dh as st,ef as L,f as x,ff as z,gf as J,hf as K,if as X,jf as Z,ka as y,kf as tt,kg as at,ma as v,mg as it,pg as nt,qa as f,ra as i,sa as n,sb as H,ta as l,xa as C,ya as u}from"./chunk-OXOWQRWE.js";var ut=(t,a)=>({c:t,name:a});function St(t,a){t&1&&(i(0,"th",17),s(1,"Packet"),n())}function Tt(t,a){if(t&1&&(i(0,"a",19),s(1),n()),t&2){let e=c().$implicit,o=c(2);f("queryParams",N(2,ut,o.yamcs.context,e.packetName)),m(),r(" ",e.packetName," ")}}function ht(t,a){if(t&1&&s(0),t&2){let e=c().$implicit;r(" ",e.packetName," ")}}function bt(t,a){if(t&1&&(i(0,"td",18),y(1,Tt,2,5,"a",19)(2,ht,1,1),n()),t&2){let e=c(2);m(),v(e.config.tmArchive?1:2)}}function xt(t,a){t&1&&l(0,"td",20)}function yt(t,a){t&1&&(i(0,"th",21),s(1,"Received"),n())}function vt(t,a){if(t&1&&(i(0,"td",22),s(1),S(2,"deltaWith"),n()),t&2){let e=a.$implicit;m(),r(" ",F(2,1,e.lastReceived,e.lastPacketTime)||"-"," ")}}function Dt(t,a){t&1&&l(0,"td",20)}function gt(t,a){t&1&&(i(0,"th",17),s(1,"Packet time"),n())}function Rt(t,a){if(t&1&&(i(0,"td",18),s(1),S(2,"datetime"),n()),t&2){let e=a.$implicit;m(),r(" ",T(2,1,e.lastPacketTime)||"-"," ")}}function kt(t,a){t&1&&l(0,"td",20)}function wt(t,a){t&1&&(i(0,"th",17),s(1,"Packet rate"),n())}function Pt(t,a){if(t&1&&(i(0,"td",22),s(1),n()),t&2){let e=a.$implicit;m(),r(" ",e.packetRate," p/s ")}}function Mt(t,a){if(t&1&&(i(0,"td",23),s(1),S(2,"async"),n()),t&2){let e=c(2);m(),r(" ",T(2,1,e.totalPacketRate$)," p/s ")}}function It(t,a){t&1&&(i(0,"th",17),s(1,"Data rate"),n())}function Et(t,a){if(t&1&&(i(0,"td",22),s(1),S(2,"dataRate"),n()),t&2){let e=a.$implicit;m(),r(" ",T(2,1,e.dataRate)," ")}}function $t(t,a){if(t&1&&(i(0,"td",23),s(1),S(2,"async"),S(3,"dataRate"),n()),t&2){let e=c(2);m(),r(" ",T(3,3,T(2,1,e.totalDataRate$))," ")}}function Nt(t,a){t&1&&l(0,"th",24)}function Ft(t,a){t&1&&l(0,"td",18)}function Ht(t,a){t&1&&l(0,"td",20)}function At(t,a){t&1&&l(0,"tr",25)}function jt(t,a){t&1&&l(0,"tr",26)}function Bt(t,a){t&1&&l(0,"tr",27)}function Ot(t,a){if(t&1&&(i(0,"table",0),C(1,1),d(2,St,2,0,"th",2)(3,bt,3,1,"td",3)(4,xt,1,0,"td",4),u(),C(5,5),d(6,yt,2,0,"th",6)(7,vt,3,4,"td",7)(8,Dt,1,0,"td",4),u(),C(9,8),d(10,gt,2,0,"th",2)(11,Rt,3,3,"td",3)(12,kt,1,0,"td",4),u(),C(13,9),d(14,wt,2,0,"th",2)(15,Pt,2,1,"td",7)(16,Mt,3,3,"td",10),u(),C(17,11),d(18,It,2,0,"th",2)(19,Et,3,3,"td",7)(20,$t,4,5,"td",10),u(),C(21,12),d(22,Nt,1,0,"th",13)(23,Ft,1,0,"td",3)(24,Ht,1,0,"td",4),u(),d(25,At,1,0,"tr",14)(26,jt,1,0,"tr",15)(27,Bt,1,0,"tr",16),n()),t&2){let e=c();f("dataSource",e.dataSource),m(25),f("matHeaderRowDef",e.displayedColumns),m(),f("matRowDefColumns",e.displayedColumns),m(),f("matFooterRowDef",e.displayedColumns)}}var h=class h{constructor(a,e){this.yamcs=a;this.statsByName={};this.dataSource=new tt;this.totalPacketRate$=new x(0);this.totalDataRate$=new x(0);this.displayedColumns=["packetName","lastPacketTime","lastReceived","packetRate","dataRate","actions"];this.config=e.getConfig()}ngAfterViewInit(){this.dataSource.sort=this.sort,this.tmstats$&&!this.tmstatsSubscription&&this.yamcs.yamcsClient.getPacketNames(this.yamcs.instance).then(a=>{for(let e of a.packets||[])this.statsByName[e]={packetName:e,packetRate:0,dataRate:0};this.updateData(),this.tmstatsSubscription=this.tmstats$.subscribe(e=>{for(let o of e||[])this.statsByName[o.packetName]=o;this.updateData()})})}updateData(){let a=Object.values(this.statsByName),e=0,o=0;for(let _ of a)e+=Number(_.packetRate),o+=Number(_.dataRate);this.totalPacketRate$.next(e),this.totalDataRate$.next(o),this.dataSource.data=a}ngOnDestroy(){this.tmstatsSubscription?.unsubscribe()}};h.\u0275fac=function(e){return new(e||h)(p(k),p(R))},h.\u0275cmp=D({type:h,selectors:[["app-tmstats-table"]],viewQuery:function(e,o){if(e&1&&I(g,5),e&2){let _;E(_=$())&&(o.sort=_.first)}},inputs:{tmstats$:"tmstats$"},decls:1,vars:1,consts:[["mat-table","","matSort","","matSortActive","packetName","matSortDirection","asc","matSortDisableClear","",1,"ya-data-table","expand",3,"dataSource"],["matColumnDef","packetName"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-footer-cell","",4,"matFooterCellDef"],["matColumnDef","lastReceived"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","","style","text-align: right",4,"matCellDef"],["matColumnDef","lastPacketTime"],["matColumnDef","packetRate"],["mat-footer-cell","","style","text-align: right",4,"matFooterCellDef"],["matColumnDef","dataRate"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-footer-row","",4,"matFooterRowDef"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["routerLink","/telemetry/packets",3,"queryParams"],["mat-footer-cell",""],["mat-header-cell",""],["mat-cell","",2,"text-align","right"],["mat-footer-cell","",2,"text-align","right"],["mat-header-cell","",1,"expand"],["mat-header-row",""],["mat-row",""],["mat-footer-row",""]],template:function(e,o){e&1&&y(0,Ot,28,4,"table",0),e&2&&v(o.dataSource?0:-1)},dependencies:[w,j,g,B,O,W,L,Q,Y,J,G,z,U,q,V,K,Z,X,H,mt,it,st],encapsulation:2,changeDetection:0});var P=h;function Yt(t,a){if(t&1&&l(0,"app-tmstats-table",1),t&2){let e=c();f("tmstats$",e.tmstats$)}}var b=class b{constructor(a,e,o,_){this.yamcs=a;this.authService=e;this.tmstats$=new x([]);this.config=_.getConfig(),this.user=e.getUser(),o.setTitle(this.yamcs.instance),this.yamcs.processor&&(this.tmstatsSubscription=a.yamcsClient.createTMStatisticsSubscription({instance:this.yamcs.instance,processor:this.yamcs.processor},dt=>this.tmstats$.next(dt.tmstats||[])))}showPackets(){return this.user.hasAnyObjectPrivilegeOfType("ReadPacket")}ngOnDestroy(){this.tmstatsSubscription?.cancel()}};b.\u0275fac=function(e){return new(e||b)(p(k),p(et),p(A),p(R))},b.\u0275cmp=D({type:b,selectors:[["ng-component"]],decls:4,vars:1,consts:[["label","Home"],[3,"tmstats$"]],template:function(e,o){e&1&&(i(0,"ya-instance-page"),l(1,"ya-instance-toolbar",0),i(2,"ya-panel"),y(3,Yt,1,1,"app-tmstats-table",1),n()()),e&2&&(m(3),v(o.showPackets()?3:-1))},dependencies:[w,at,nt,ot,P],encapsulation:2,changeDetection:0});var M=b;var he=[{path:"",canActivate:[ct,lt],canActivateChild:[rt],runGuardsAndResolvers:"always",component:pt,children:[{path:"",pathMatch:"full",component:M}]}];export{he as ROUTES};
