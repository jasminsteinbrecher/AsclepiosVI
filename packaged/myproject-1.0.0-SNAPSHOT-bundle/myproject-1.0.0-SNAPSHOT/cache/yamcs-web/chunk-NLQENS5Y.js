import{b as ka,d as ba,e as xa,f as wa,g as Ea,h as ki,i as Da,j as Fa,k as Ma}from"./chunk-TUNGK4K7.js";import{a as bi}from"./chunk-VXDZPIOB.js";import"./chunk-6X2UVTWO.js";import{a as ya}from"./chunk-N6L73CWM.js";import{a as ga,b as Ca}from"./chunk-7SRE5ACE.js";import{a as va}from"./chunk-CS6YXD3A.js";import{a as Sa}from"./chunk-E6DCO4NE.js";import{f as lt}from"./chunk-LWQLZ5XB.js";import{a as Xi,b as ha}from"./chunk-L67MW52F.js";import{Aa as E,Ag as aa,Bc as Vn,Bf as T,Bg as nt,C as Ee,Ca as f,Cb as ze,Cc as U,Cf as Ze,Cg as oa,D as un,Db as xn,Dc as Nn,Dg as ra,Ea as d,Eb as wn,Ec as Zt,F as C,Fa as _n,Fb as En,Fc as q,Fe as Gn,Ff as _i,Fg as ca,Fh as w,G as y,Ga as gn,Gb as Dn,Gc as On,Ge as Un,Gf as Xn,Gh as Ji,Hb as Fn,Hc as An,He as qn,Hg as at,Hh as Zi,Ia as ae,Ib as Xt,Ic as In,Ie as Hn,If as le,Ja as oe,Jb as ve,Je as ri,Jf as ye,K as Le,Ka as re,Kb as Mn,Kc as $n,Ke as ci,Kf as P,La as Cn,Lc as Rn,Lf as $e,Lg as la,Ma as yn,Mc as ei,Me as li,Mg as sa,Na as X,Ne as Wn,Ng as ma,Pa as te,Pc as pe,Pe as Qn,R as zi,Ra as s,Rc as Ce,Rf as gi,Rg as vi,Sa as _e,Se as si,T as $t,Ta as D,Tc as Fe,Ua as Ki,Uc as Ke,Uf as Jn,V as c,Vg as ot,Wc as ti,Wg as rt,Xa as hn,Xc as ii,Xg as pa,Y as _,Ya as Qe,Ye as Te,Yf as Ci,Za as ce,Ze as Pe,_ as x,_e as mi,_f as yi,_g as da,a as K,af as Ve,ag as Zn,ah as ct,ba as fn,bb as g,bf as pi,bg as ee,cb as k,cd as jn,cg as ea,d as Qi,da as F,db as Ye,dd as ni,df as Ne,ef as zn,eg as et,f as N,fg as ta,fh as ua,gb as Qt,gf as Xe,gg as tt,gh as Si,h as rn,hb as zt,hf as di,i as cn,ib as Q,id as Rt,ie as Bn,ig as ia,j as ln,jb as vn,jf as Oe,k as sn,ka as h,kb as Kt,kf as Je,kg as Se,la as Wt,lf as Ae,lg as it,m as qt,ma as v,mc as Tn,mg as hi,na as R,ne as H,oa as j,oc as ge,oe as ie,og as Re,p as mn,pa as B,pe as Me,pf as Kn,pg as ke,qa as p,qc as L,qe as W,qf as Ie,r as pn,ra as o,re as ne,sa as r,sb as se,sc as I,se as J,ta as u,tb as Sn,tc as Y,te as Z,th as fa,uc as Ge,ue as ai,ve as oi,vh as _a,wc as me,xa as O,xb as kn,xc as Pn,y as dn,ya as A,yc as G,ye as Ln,yf as ui,yg as na,z as Ht,zb as bn,zc as Jt,ze as Yn,zf as fi}from"./chunk-OXOWQRWE.js";var st=class st{constructor(t,e){this.dialogRef=t;this.form=e.group({executionTime:["",[L.required]],tags:[[],[]]})}schedule(){this.dialogRef.close(this.form.value)}};st.\u0275fac=function(e){return new(e||st)(_(H),_(pe))},st.\u0275cmp=x({type:st,selectors:[["app-schedule-script-dialog"]],decls:19,vars:4,consts:[["mat-dialog-title",""],[1,"hint"],[1,"ya-form",3,"formGroup"],["label","Execution time"],["formControlName","executionTime",3,"showMillis","showNow"],["label","Timeline tags","hint","(optional)"],["dialogTitle","Timeline Tags"],["formControlName","tags"],["align","end"],[2,"flex","1 1 auto"],["mat-dialog-close",""],["appearance","primary",3,"click","disabled"]],template:function(e,i){e&1&&(o(0,"h2",0),s(1,"Run later"),r(),o(2,"mat-dialog-content")(3,"div",1)(4,"p"),s(5,"This script will be submitted to the Yamcs Timeline, for execution at a later time."),r()(),o(6,"form",2)(7,"ya-field",3),u(8,"ya-date-time-input",4),r(),o(9,"ya-field",5)(10,"ya-help",6),s(11," Tags allow to categorise items per band. Bands only show items for which one of the tags is matching. "),r(),u(12,"ya-tag-select",7),r()()(),o(13,"mat-dialog-actions",8),u(14,"div",9),o(15,"ya-button",10),s(16,"CANCEL"),r(),o(17,"ya-button",11),f("click",function(){return i.schedule()}),s(18,"SCHEDULE"),r()()),e&2&&(c(6),p("formGroup",i.form),c(2),p("showMillis",!0)("showNow",!0),c(9),p("disabled",!i.form.valid))},dependencies:[w,G,I,Y,U,q,W,ne,Z,J,T,gi,ee,tt,vi],encapsulation:2,changeDetection:0});var xi=st;function $a(n,t){if(n&1){let e=E();s(0," \xA0 "),u(1,"ya-icon-action",10),o(2,"mat-menu",11,0)(4,"button",12),f("click",function(){C(e);let a=d();return y(a.runScript())}),s(5,"Run now"),r(),o(6,"button",12),f("click",function(){C(e);let a=d();return y(a.openScheduleScriptDialog())}),s(7,"Run later..."),r()()}if(n&2){let e=X(3),i=d();c(),p("matMenuTriggerFor",i.form.valid?e:null)("padding",!1)("disabled",!i.form.valid),c(),p("overlapTrigger",!1)}}var mt=class mt{constructor(t,e,i,a,l,m,S){this.yamcs=i;this.messageService=a;this.authService=l;this.router=m;this.dialog=S;this.scriptOptions$=new N([]);t.setTitle("Run a script"),this.form=e.group({script:["",[L.required]],args:[""]}),i.yamcsClient.getActivityScripts(this.yamcs.instance).then(b=>{for(let z of b.scripts||[])this.scriptOptions$.next([...this.scriptOptions$.value,{id:z,label:z}])}).catch(b=>a.showError(b))}runScript(){let t=this.createActivityDefinition();this.yamcs.yamcsClient.startActivity(this.yamcs.instance,t).then(e=>{this.authService.getUser().hasSystemPrivilege("ReadActivities")?this.router.navigateByUrl(`/activities/${e.id}?c=${this.yamcs.context}`):this.dialog.open(ta,{width:"500px",data:{icon:"done",closeText:"OK",content:`
                <p>The procedure has started executing.</p>
                <p>
                  Note that you do not have sufficient privileges
                  to follow up on submitted procedures.
                </p>
              `}}).afterClosed().subscribe(()=>this.form.reset())}).catch(e=>this.messageService.showError(e))}showSchedule(){let t=this.yamcs.connectionInfo$.value?.instance?.capabilities||[];return t.indexOf("timeline")!==-1&&t.indexOf("activities")!==-1&&this.authService.getUser().hasSystemPrivilege("ControlTimeline")}openScheduleScriptDialog(){this.dialog.open(xi,{width:"600px"}).afterClosed().subscribe(t=>{let e=this.form.value;if(t){let i={type:"ACTIVITY",duration:"0s",name:e.script,start:t.executionTime,tags:t.tags,activityDefinition:this.createActivityDefinition()};this.yamcs.yamcsClient.createTimelineItem(this.yamcs.instance,i).then(()=>{this.messageService.showInfo("Script scheduled"),this.router.navigateByUrl(`/activities?c=${this.yamcs.context}`)}).catch(a=>this.messageService.showError(a))}})}createActivityDefinition(){let t=this.form.value,e={type:"SCRIPT",args:{processor:this.yamcs.processor||null,script:t.script}};return t.args&&(e.args.args=t.args),e}};mt.\u0275fac=function(e){return new(e||mt)(_(ze),_(pe),_(P),_(Ae),_($e),_(Xt),_(Me))},mt.\u0275cmp=x({type:mt,selectors:[["ng-component"]],decls:16,vars:6,consts:[["sendMenu","matMenu"],["label","Run a script"],[1,"form-content","ya-form"],["novalidate","","autocomplete","off",3,"formGroup"],["label","Script","hint","(required)"],["formControlName","script",3,"options"],["label","Script arguments"],["type","text","formControlName","args"],[2,"flex","1 1 auto"],["appearance","primary",3,"click","disabled"],["icon","arrow_drop_down",2,"line-height","12px",3,"matMenuTriggerFor","padding","disabled"],[1,"ya-menu",3,"overlapTrigger"],["mat-menu-item","",3,"click"]],template:function(e,i){e&1&&(o(0,"ya-instance-page"),u(1,"ya-instance-toolbar",1),o(2,"div",2)(3,"form",3)(4,"ya-field",4),u(5,"ya-select",5),g(6,"async"),r(),o(7,"ya-field",6),u(8,"input",7),r()(),o(9,"p"),s(10,"\xA0"),r(),o(11,"mat-toolbar"),u(12,"span",8),o(13,"ya-button",9),f("click",function(){return i.runScript()}),s(14,"Run"),r(),h(15,$a,8,4),r()()()),e&2&&(c(3),p("formGroup",i.form),c(2),p("options",k(6,4,i.scriptOptions$)),c(8),p("disabled",!i.form.valid),c(2),v(i.showSchedule()?15:-1))},dependencies:[w,G,ge,I,Y,U,q,ti,Ke,ii,ni,T,ee,Ze,Se,ke,at,se],encapsulation:2,changeDetection:0});var wi=mt;var pt=class pt{constructor(t,e){this.dialogRef=t;this.data=e}confirmDiscard(){let{stackFileService:t}=this.data;t.dirty$.next(!1),this.dialogRef.close(!0)}};pt.\u0275fac=function(e){return new(e||pt)(_(H),_(ie))},pt.\u0275cmp=x({type:pt,selectors:[["app-stack-file-page-dirty-dialog"]],decls:10,vars:0,consts:[["align","end"],["mat-dialog-close",""],["appearance","primary",3,"click"]],template:function(e,i){e&1&&(o(0,"mat-dialog-content")(1,"h3"),s(2,"Close without saving?"),r(),o(3,"p"),s(4,"You have unsaved changes, close without saving?"),r()(),o(5,"mat-dialog-actions",0)(6,"ya-button",1),s(7,"CANCEL"),r(),o(8,"ya-button",2),f("click",function(){return i.confirmDiscard()}),s(9,"OK"),r()())},dependencies:[w,W,Z,J,T],encapsulation:2});var Ei=pt;var dt=class{constructor(t){this.executing=!1;this.model=t}get comment(){return this.model.comment}clearOutputs(){this.executionNumber=void 0,this.err=void 0}hasOutputs(){return!!this.err}},ue=class n extends dt{constructor(e){super(e);this.type="command"}get name(){return this.model.name}get namespace(){return this.model.namespace}get args(){return this.model.args}get extra(){return this.model.extra}get stream(){return this.model.stream}get advancement(){return this.model.advancement}clearOutputs(){super.clearOutputs(),this.id=void 0,this.record=void 0}hasOutputs(){return super.hasOutputs()||!!this.record}copy(){let e=new n({type:"command",name:this.name,namespace:this.namespace,args:K({},this.args),comment:this.comment,stream:this.stream});return e.command=this.command,this.extra&&(e.model.extra=K({},this.extra)),this.advancement&&(e.model.advancement=K({},this.advancement)),e}toString(){let e=this.name;if(this.args){e+=" [";let i=!0;for(let a in this.args)i?i=!1:e+=", ",e+=`${a}=${this.args[a]}`;e+="]"}return e}},xe=class n extends dt{constructor(e){super(e);this.type="verify"}get condition(){return this.model.condition}get delay(){return this.model.delay}get timeout(){return this.model.timeout}clearOutputs(){super.clearOutputs(),this.pvals=void 0}hasOutputs(){return super.hasOutputs()||!!this.pvals}copy(){return new n({type:"verify",condition:this.condition.map(e=>K({},e)),comment:this.comment})}toString(){let e="",i=!0;for(let a of this.condition||[]){switch(i?i=!1:e+=" AND ",e+=a.parameter,a.operator){case"eq":e+=" = ";break;case"neq":e+=" != ";break;case"lt":e+=" < ";break;case"lte":e+=" <= ";break;case"gt":e+=" > ";break;case"gte":e+=" >= ";break}e+=a.value}return e}test(e){let i=[];for(let l of this.condition){let m=e;i.push({parameter:l.parameter,pval:m[l.parameter]||null,status:Le(null)})}this.pvals=i;let a=!0;for(let l=0;l<this.condition.length;l++){let m=i[l];if(m===null||!m.pval?.engValue){a=!1;continue}else if(m.pval?.engValue){let S=xa(m.pval.engValue),b=String(this.condition[l].value);switch(this.condition[l].operator){case"eq":S===b?m.status.set("ok"):(a=!1,m.status.set("pending"));break;case"neq":S!==b?m.status.set("ok"):(a=!1,m.status.set("pending"));break;case"lt":isNaN(S)||isNaN(b)?(a=!1,m.status.set("pending")):Number(S)<Number(b)?m.status.set("ok"):(a=!1,m.status.set("pending"));break;case"lte":isNaN(S)||isNaN(b)?(a=!1,m.status.set("pending")):Number(S)<=Number(b)?m.status.set("ok"):(a=!1,m.status.set("pending"));break;case"gt":isNaN(S)||isNaN(b)?(a=!1,m.status.set("pending")):Number(S)>Number(b)?m.status.set("ok"):(a=!1,m.status.set("pending"));break;case"gte":isNaN(S)||isNaN(b)?(a=!1,m.status.set("pending")):Number(S)>=Number(b)?m.status.set("ok"):(a=!1,m.status.set("pending"));break}}else{a=!1,m.status.set("pending");continue}}return a}},De=class n extends dt{constructor(e){super(e);this.type="check"}get parameters(){return this.model.parameters}clearOutputs(){super.clearOutputs(),this.pvals=void 0}hasOutputs(){return super.hasOutputs()||!!this.pvals}copy(){return new n({type:"check",parameters:this.parameters.map(e=>K({},e)),comment:this.comment})}},we=class n extends dt{constructor(e){super(e);this.type="text";this.renderedText=Le("")}get text(){return this.model.text}copy(){return new n({type:"text",text:this.text})}};function Va(n,t){let i=new DOMParser().parseFromString(n,"text/xml");return Ra(i.documentElement,t)}function Ra(n,t){let e=[];for(let i=0;i<n.childNodes.length;i++){let a=n.childNodes[i];if(a.nodeType!==3&&a.nodeName==="command"){let l=ja(a,t);e.push(l)}}return e}function ja(n,t){let e={},i={};for(let l=0;l<n.childNodes.length;l++){let m=n.childNodes[l];if(m.nodeName==="commandArgument"){let S=ut(m,"argumentName");e[S]=ut(m,"argumentValue"),e[S]==="true"?e[S]=!0:e[S]==="false"&&(e[S]=!1)}else if(m.nodeName==="extraOptions")for(let S=0;S<m.childNodes.length;S++){let b=m.childNodes[S];if(b.nodeName==="extraOption"){let z=ut(b,"id"),he=ut(b,"value"),It=Ba(z,he,t);It&&(i[z]=It)}}}let a={type:"command",name:ut(n,"qualifiedName"),args:e,extra:i};return n.hasAttribute("comment")&&(a.comment=ut(n,"comment")),a}function ut(n,t){let e=n.attributes.getNamedItem(t);if(e===null)throw new Error(`No attribute named ${t}`);return e.textContent||""}function Ba(n,t,e){for(let i of e)if(i.id===n)switch(i.type){case"BOOLEAN":return{type:"BOOLEAN",booleanValue:t==="true"};case"NUMBER":return{type:"SINT32",sint32Value:Number(t)};default:return{type:"STRING",stringValue:t}}return null}function Oa(n,t){let e=[],i=JSON.parse(n);if(i.steps)for(let l of i.steps)l.type==="check"?e.push(l):l.type==="command"?e.push(Na(l,t)):l.type==="text"?e.push(La(l)):l.type==="verify"?e.push(l):console.warn(`Unexpected entry of type '${l.type}'`);else if(i.commands)for(let l of i.commands)e.push(Na(l,t));let a={acknowledgment:i.advancement?.acknowledgment||"Acknowledge_Queued",wait:i.advancement?.wait!=null?i.advancement?.wait:0};return[e,a]}function Na(n,t){return K(K(K(K(K({type:"command",name:n.name,namespace:n.namespace},n.comment&&{comment:n.comment}),n.stream&&{stream:n.stream}),n.arguments&&{args:Ya(n.arguments)}),n.extraOptions&&{extra:Ga(n.extraOptions,t)}),n.advancement&&{advancement:n.advancement})}function La(n){return{type:"text",text:n.text}}function Ya(n){let t={};for(let e of n)t[e.name]=e.value;return t}function Ga(n,t){let e={};for(let i of n){let a=new String(i.value).toString(),l=Ua(i.id,a,t);l&&(e[i.id]=l)}return e}function Ua(n,t,e){for(let i of e)if(i.id===n)switch(i.type){case"BOOLEAN":return{type:"BOOLEAN",booleanValue:t==="true"};case"NUMBER":return{type:"SINT32",sint32Value:Number(t)};default:return{type:"STRING",stringValue:t}}return null}var qe=class qe{constructor(t,e,i){this.configService=t;this.yamcs=e;this.messageService=i;this.entries=[];this.advancement={acknowledgment:"Acknowledge_Queued",wait:0};this.dirty$=new N(!1);this.entries$=new N([]);this.hasState$=this.entries$.pipe(sn(t=>{for(let e of t)if(e.hasOutputs()||e.executionNumber!==void 0)return!0;return!1}));this.logs$=new N([]);this.bucket=t.getStackBucket(),this.storageClient=e.createStorageClient()}markDirty(){this.dirty$.next(!0)}addLogEntry(t,e){this.logs$.next([...this.logs$.value,{executionNumber:t,text:e,time:this.yamcs.getMissionTime().toISOString()}])}async canActivate(t,e){this.entries=[],this.objectName=t.params.objectName;let i=le.getExtension(le.getFilename(this.objectName))?.toLowerCase();try{let a=await this.storageClient.getObject(this.bucket,this.objectName);if(a.ok){let l=await a.text();if(i==="xml"||i==="ycs")await this.processStack(l,i);else return!1}}catch(a){return this.messageService.showError(a),!1}return!0}async processStack(t,e){switch(this.entries=[],e){case"ycs":let m;[m,this.advancement]=Oa(t,this.configService.getCommandOptions());for(let b of m)b.type==="check"?this.entries.push(new De(b)):b.type==="command"?this.entries.push(new ue(b)):b.type==="text"?this.entries.push(new we(b)):b.type==="verify"?this.entries.push(new xe(b)):console.error("Unexpected step",b);break;case"xml":let S=Va(t,this.configService.getCommandOptions());for(let b of S)this.entries.push(new ue(b));break}let i=this.entries.filter(m=>m instanceof ue),a=[],l=this.yamcs.instance;for(let m of i){let S=m.namespace??null,b=m.name;a.push(this.yamcs.yamcsClient.getCommandForNamespace(l,S,b).then(z=>{m.command=z}))}for(let m of a)try{await m}catch{}for(let m of i)if(m.command)for(let S in m.args){let b=this.getArgument(S,m.command);if(b?.type.engType==="enumeration"){let z=!1;for(let he of b.type.enumValue||[])if(he.label===m.args[S]){z=!0;break}if(!z){for(let he of b.type.enumValue||[])if(String(he.value)===String(m.args[S])){m.args[S]=he.label,z=!0;break}}}}if(e==="xml"){for(let m of i)if(m.command)for(let S in m.args)this.isComplex(S,m.command)&&(m.args[S]=JSON.parse(m.args[S]))}}getArgument(t,e){for(let i of e.argument||[])if(i.name===t)return i;return e.baseCommand?this.getArgument(t,e.baseCommand):null}isComplex(t,e){for(let i of e.argument||[])if(i.name===t)return i.type.engType==="aggregate"||i.type.engType.endsWith("[]");return e.baseCommand?this.isComplex(t,e.baseCommand):!1}updateEntries(t){this.renumberHeadings(t),this.entries$.next(t)}renumberHeadings(t){let e=[0,0,0,0,0,0];for(let i of t)if(i instanceof we){let a=[];for(let l of i.text.split(`
`))if(l.startsWith("# ")){e[0]++,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0;let m=`# ${e[0]}.&nbsp;&nbsp;`+l.slice(2);a.push(m)}else if(l.startsWith("## ")){e[1]++,e[2]=0,e[3]=0,e[4]=0,e[5]=0;let m=`## ${e[0]}.${e[1]}.&nbsp;&nbsp;`+l.slice(3);a.push(m)}else if(l.startsWith("### ")){e[2]++,e[3]=0,e[4]=0,e[5]=0;let m=`### ${e[0]}.${e[1]}.${e[2]}.&nbsp;&nbsp;`+l.slice(4);a.push(m)}else if(l.startsWith("#### ")){e[3]++,e[4]=0,e[5]=0;let m=`#### ${e[0]}.${e[1]}.${e[2]}.${e[3]}.&nbsp;&nbsp;`+l.slice(5);a.push(m)}else if(l.startsWith("##### ")){e[4]++,e[5]=0;let m=`##### ${e[0]}.${e[1]}.${e[2]}.${e[3]}.${e[4]}.&nbsp;&nbsp;`+l.slice(6);a.push(m)}else if(l.startsWith("###### ")){e[5]++;let m=`###### ${e[0]}.${e[1]}.${e[2]}.${e[3]}.${e[4]}.${e[5]}.&nbsp;&nbsp;`+l.slice(7);a.push(m)}else a.push(l);i.renderedText.set(a.join(`
`))}}saveStack(){let t=le.getExtension(le.getFilename(this.objectName))?.toLowerCase(),e=this.entries$.value.map(m=>m.model),i;switch(t){case"ycs":i=new Ie(e,{advancement:this.advancement}).toJSON();break;case"xml":i=new Ie(e,{advancement:this.advancement}).toXML();break;default:console.error("Unexpected format");return}let a=t==="xml"?"application/xml":"application/json",l=new Blob([i],{type:a});return this.storageClient.uploadObject(this.bucket,this.objectName,l).then(()=>{this.dirty$.next(!1)})}};qe.\u0275fac=function(e){return new(e||qe)(Ee(ye),Ee(P),Ee(Ae))},qe.\u0275prov=Ht({token:qe,factory:qe.\u0275fac});var fe=qe;var Aa=n=>un(Bt).canDeactivate(n),He=class He{constructor(t,e,i,a){this.dialog=t;this.authService=e;this.stackFileService=a;this.dialogOpen$=new N(!1);this.bucket=i.getStackBucket()}canDeactivate(t){return this.dialogOpen$.value?new Qi(e=>{this.dialogRef.afterClosed().subscribe({next:i=>{e.next(i===!0),e.complete()},error:()=>{e.next(!1),e.complete()}})}):this.stackFileService.dirty$.value&&this.mayManageStacks()?new Qi(e=>{this.dialogOpen$.next(!0),this.dialogRef=this.dialog.open(Ei,{width:"400px",data:{stackFileService:this.stackFileService}}),this.dialogRef.afterClosed().subscribe({next:i=>{this.dialogOpen$.next(!1),e.next(i===!0),e.complete()},error:()=>{this.dialogOpen$.next(!1),e.next(!1),e.complete()}})}):rn(!0)}mayManageStacks(){let t=this.authService.getUser();return t.hasObjectPrivilege("ManageBucket",this.bucket)||t.hasSystemPrivilege("ManageAnyBucket")}};He.\u0275fac=function(e){return new(e||He)(Ee(Me),Ee($e),Ee(ye),Ee(fe))},He.\u0275prov=Ht({token:He,factory:He.\u0275fac});var Bt=He;var qa=["*"],Ha=()=>({exact:!0}),en=n=>({c:n}),ft=class ft{constructor(t){this.yamcs=t;this.objectName=Q.required()}};ft.\u0275fac=function(e){return new(e||ft)(_(P))},ft.\u0275cmp=x({type:ft,selectors:[["app-stack-file-page-tabs"]],inputs:{objectName:[1,"objectName"]},ngContentSelectors:qa,decls:12,vars:20,consts:[["rla","routerLinkActive"],["rlb","routerLinkActive"],["rlc","routerLinkActive"],["routerLinkActive","",3,"routerLink","routerLinkActiveOptions","queryParams"],["routerLinkActive","",3,"routerLink","queryParams"],["actions",""]],template:function(e,i){if(e&1&&(_n(),o(0,"ya-page-tabs")(1,"a",3,0),s(3," Steps "),r(),o(4,"a",4,1),s(6," Log "),r(),o(7,"a",4,2),s(9," Settings "),r(),O(10,5),gn(11),A(),r()),e&2){let a=X(2),l=X(5),m=X(8);c(),te("active",a.isActive),p("routerLink","/procedures/stacks/files/"+i.objectName())("routerLinkActiveOptions",Qe(13,Ha))("queryParams",ce(14,en,i.yamcs.context)),c(3),te("active",l.isActive),p("routerLink","/procedures/stacks/files/"+i.objectName()+"/-/log")("queryParams",ce(16,en,i.yamcs.context)),c(3),te("active",m.isActive),p("routerLink","/procedures/stacks/files/"+i.objectName()+"/-/settings")("queryParams",ce(18,en,i.yamcs.context))}},dependencies:[w,ve,Mn,oa],styles:[".mat-mdc-tab-link[_ngcontent-%COMP%]{height:36px;min-width:0;font-size:13px}"],changeDetection:0});var je=ft;var Wa=n=>({c:n});function Qa(n,t){if(n&1&&(u(0,"ya-page-icon-button",6),s(1),g(2,"basename")),n&2){let e=d();p("routerLink",e.folderLink())("queryParams",ce(5,Wa,e.yamcs.context)),c(),D(" ",k(2,3,e.objectName())," ")}}function za(n,t){if(n&1&&(o(0,"tr")(1,"td",7),s(2),r(),o(3,"td",8),s(4),g(5,"datetime"),r(),o(6,"td",9),s(7),r()()),n&2){let e=t.$implicit;c(2),D("[",e.executionNumber,"]"),c(2),D(" [",Ye(5,3,e.time,!1),"] "),c(3),_e(e.text)}}var _t=class _t{constructor(t,e){this.yamcs=t;this.stackFileService=e;this.objectName=Q.required();this.folderLink=Qt(()=>{let t=this.objectName(),e=t.lastIndexOf("/");return e===-1?"/procedures/stacks/browse/":"/procedures/stacks/browse/"+t.substring(0,e)})}};_t.\u0275fac=function(e){return new(e||_t)(_(P),_(fe))},_t.\u0275cmp=x({type:_t,selectors:[["app-stack-file-log"]],inputs:{objectName:[1,"objectName"]},decls:13,vars:6,consts:[["ya-instance-toolbar-label",""],["matTooltip","Save stack","icon","save",3,"clicked","disabled"],[1,"main-pane"],[3,"objectName"],[1,"tab-content"],[1,"mono",2,"width","100%"],["icon","arrow_back",3,"routerLink","queryParams"],["width","1",2,"text-align","right"],["width","1",1,"time",2,"white-space","nowrap"],[1,"message"]],template:function(e,i){e&1&&(o(0,"ya-instance-page")(1,"ya-instance-toolbar"),F(2,Qa,3,7,"ng-template",0),o(3,"ya-page-button",1),g(4,"async"),f("clicked",function(){return i.stackFileService.saveStack()}),s(5," Save "),r()(),o(6,"div",2),u(7,"app-stack-file-page-tabs",3),o(8,"div",4)(9,"table",5),j(10,za,8,6,"tr",null,R),g(12,"async"),r()()()()),e&2&&(c(3),p("disabled",!k(4,2,i.stackFileService.dirty$)),c(4),p("objectName",i.objectName()),c(3),B(k(12,4,i.stackFileService.logs$)))},dependencies:[je,w,ve,Fe,Se,ke,it,Re,nt,se,ct,hi],styles:[".main-pane[_ngcontent-%COMP%]{position:absolute;inset:0;padding:24px}.tab-content[_ngcontent-%COMP%]{position:absolute;inset:60px 0 0;overflow:auto;padding:24px}table[_ngcontent-%COMP%]{line-height:12px}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-size:12px;color:#000000a7;vertical-align:top}table[_ngcontent-%COMP%]   td.time[_ngcontent-%COMP%]{opacity:.8}table[_ngcontent-%COMP%]   td.message[_ngcontent-%COMP%]{white-space:pre-wrap}"],changeDetection:0});var Fi=_t;var Ka=n=>({c:n});function Xa(n,t){if(n&1&&(u(0,"ya-page-icon-button",14),s(1),g(2,"basename")),n&2){let e=d();p("routerLink",e.folderLink())("queryParams",ce(5,Ka,e.yamcs.context)),c(),D(" ",k(2,3,e.objectName())," ")}}function Ja(n,t){if(n&1&&(s(0," Advance when "),u(1,"app-advance-ack-help",15)),n&2){let e=d();c(),p("extra",e.extraAcknowledgments)}}function Za(n,t){n&1&&u(0,"input",10)}var gt=class gt{constructor(t,e){this.yamcs=t;this.stackFileService=e;this.objectName=Q.required();this.folderLink=Qt(()=>{let t=this.objectName(),e=t.lastIndexOf("/");return e===-1?"/procedures/stacks/browse/":"/procedures/stacks/browse/"+t.substring(0,e)});this.ackOptions=[{id:"Acknowledge_Queued",label:"Queued"},{id:"Acknowledge_Released",label:"Released"},{id:"Acknowledge_Sent",label:"Sent"},{id:"CommandComplete",label:"Completed"}];this.stackOptionsForm=new Ge({advancementAckDropDown:new me("",[]),advancementAckCustom:new me("",[]),advancementWait:new me("",[])}),this.extraAcknowledgments=t.getProcessor()?.acknowledgments??[];let i=!0;for(let S of this.extraAcknowledgments)this.ackOptions.push({id:S.name,label:S.name.replace("Acknowledge_",""),group:i}),i=!1;this.ackOptions.push({id:"custom",label:"Custom",group:!0});let{advancement:a}=this.stackFileService,l=this.ackOptions.find(S=>S.id===a.acknowledgment),m=l?l.id:"custom";this.stackOptionsForm.setValue({advancementAckDropDown:m,advancementAckCustom:m==="custom"?a.acknowledgment:"",advancementWait:a.wait}),this.stackOptionsForm.valueChanges.subscribe(S=>{this.stackFileService.advancement={acknowledgment:S.advancementAckDropDown!=="custom"?S.advancementAckDropDown:S.advancementAckCustom,wait:S.advancementWait??0},S.advancementAckDropDown!=="custom"&&this.stackOptionsForm.patchValue({advancementAckCustom:void 0},{emitEvent:!1}),this.stackFileService.markDirty()})}};gt.\u0275fac=function(e){return new(e||gt)(_(P),_(fe))},gt.\u0275cmp=x({type:gt,selectors:[["app-stack-file-settings"]],inputs:{objectName:[1,"objectName"]},decls:25,vars:7,consts:[["ackSelect",""],["ya-instance-toolbar-label",""],["matTooltip","Save stack","icon","save",3,"clicked","disabled"],[1,"main-pane"],[3,"objectName"],[1,"tab-content"],[1,"ya-form",3,"formGroup"],["ya-field-label",""],[2,"display","flex","align-items","flex-start"],["icon","check_circle_outline","formControlName","advancementAckDropDown",3,"options"],["type","text","formControlName","advancementAckCustom",2,"width","200px","margin-left","-1px"],["label","Wait (ms)"],["dialogTitle","Wait time"],["type","number","formControlName","advancementWait","placeholder","0","step","1000","min","0",2,"width","120px"],["icon","arrow_back",3,"routerLink","queryParams"],[3,"extra"]],template:function(e,i){if(e&1){let a=E();o(0,"ya-instance-page")(1,"ya-instance-toolbar"),F(2,Xa,3,7,"ng-template",1),o(3,"ya-page-button",2),g(4,"async"),f("clicked",function(){return C(a),y(i.stackFileService.saveStack())}),s(5," Save "),r()(),o(6,"div",3),u(7,"app-stack-file-page-tabs",4),o(8,"div",5)(9,"form",6)(10,"h3"),s(11,"Commanding"),r(),o(12,"ya-field"),F(13,Ja,2,1,"ng-template",7),o(14,"div",8),u(15,"ya-select",9,0),h(17,Za,1,0,"input",10),r()(),o(18,"ya-field",11)(19,"ya-help",12)(20,"p"),s(21,"Wait time before advancing to the next command in the stack."),r(),o(22,"p"),s(23,"This triggers after successful acknowledgment."),r()(),u(24,"input",13),r()()()()()}if(e&2){let a;c(3),p("disabled",!k(4,5,i.stackFileService.dirty$)),c(4),p("objectName",i.objectName()),c(2),p("formGroup",i.stackOptionsForm),c(6),p("options",i.ackOptions),c(2),v(((a=i.stackOptionsForm.get("advancementAckDropDown"))==null?null:a.value)==="custom"?17:-1)}},dependencies:[wa,je,w,G,ge,Jt,I,Y,$n,U,q,ve,Zn,Fe,ee,tt,Se,ke,it,Re,nt,at,se,ct],styles:[".main-pane[_ngcontent-%COMP%]{position:absolute;inset:0;padding:24px}.tab-content[_ngcontent-%COMP%]{position:absolute;inset:60px 0 0;overflow:auto;padding:24px}"],changeDetection:0});var Mi=gt;function eo(n,t){if(n&1){let e=E();o(0,"tr")(1,"td",12),u(2,"app-parameter-input",13),r(),o(3,"td",14)(4,"ya-icon-action",15),f("click",function(){let a=C(e).$index,l=d();return y(l.moveParameterControlDown(a))}),r(),o(5,"ya-icon-action",16),f("click",function(){let a=C(e).$index,l=d();return y(l.moveParameterControlUp(a))}),r(),o(6,"ya-text-action",17),f("click",function(){let a=C(e).$index,l=d();return y(l.removeParameterControl(a))}),s(7," DELETE "),r()()()}if(n&2){let e=t.$index,i=t.$count;c(2),p("formControlName",e),c(2),p("disabled",e===i-1),c(),p("disabled",e===0)}}var Ct=class Ct{constructor(t,e){this.dialogRef=t;this.data=e;if(this.form=new Ge({parameters:new ei([]),comment:new me("")}),e.entry){let i=(e.entry.parameters||[]).map(a=>a.parameter);for(let a of i)this.addParameterControl();this.form.setValue({parameters:i||[],comment:e.entry.comment||""})}this.parameterFormArray.length||this.addParameterControl()}get parameterFormArray(){return this.form.controls.parameters}get parameterControls(){return this.parameterFormArray.controls}addParameterControl(){this.parameterFormArray.push(new me(""))}removeParameterControl(t){this.parameterFormArray.removeAt(t)}moveParameterControlDown(t){let e=this.parameterFormArray.controls[t];this.parameterFormArray.removeAt(t),this.parameterFormArray.insert(t+1,e)}moveParameterControlUp(t){let e=this.parameterFormArray.controls[t];this.parameterFormArray.removeAt(t),this.parameterFormArray.insert(t-1,e)}save(){let{value:t}=this.form,e={comment:t.comment,parameters:t.parameters.map(i=>({parameter:i}))};this.dialogRef.close(e)}};Ct.\u0275fac=function(e){return new(e||Ct)(_(H),_(ie))},Ct.\u0275cmp=x({type:Ct,selectors:[["app-edit-check-entry-dialog"]],decls:20,vars:2,consts:[["mat-dialog-title",""],[1,"ya-form",3,"formGroup"],["label","Parameters"],["formArrayName","parameters",1,"parameter-table",2,"width","100%"],["colspan","1"],["icon","add_circle",3,"click"],["label","Comment"],["formControlName","comment"],["align","end"],[2,"flex","1 1 auto"],["mat-dialog-close",""],["appearance","primary",3,"click"],[2,"width","100%"],[3,"formControlName"],[2,"white-space","nowrap"],["icon","keyboard_arrow_down",3,"click","disabled"],["icon","keyboard_arrow_up",3,"click","disabled"],["icon","delete",3,"click"]],template:function(e,i){e&1&&(o(0,"h2",0),s(1,"Step: List parameters"),r(),o(2,"mat-dialog-content")(3,"form",1)(4,"ya-field",2)(5,"table",3),j(6,eo,8,3,"tr",null,R),o(8,"tr")(9,"td",4)(10,"ya-button",5),f("click",function(){return i.addParameterControl()}),s(11,"Add"),r()()()()(),o(12,"ya-field",6),u(13,"app-markdown-input",7),r()()(),o(14,"mat-dialog-actions",8),u(15,"div",9),o(16,"ya-button",10),s(17,"CANCEL"),r(),o(18,"ya-button",11),f("click",function(){return i.save()}),s(19),r()()),e&2&&(c(3),p("formGroup",i.form),c(3),B(i.parameterControls),c(13),D(" ",i.data.edit?"UPDATE":"ADD TO STACK"," "))},dependencies:[ki,bi,w,G,I,Y,U,q,Zt,W,ne,Z,J,T,ee,Ze,et],styles:[".parameter-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:first-child{margin-left:0;padding-left:0}[_nghost-%COMP%]     .parameter-table input{margin:0!important}"],changeDetection:0});var Lt=Ct;var io=["top"],no=["searchFilter"];function ao(n,t){if(n&1){let e=E();o(0,"ya-breadcrumb",9),f("click",function(){let a=C(e).$implicit,l=d(3);return y(l.changeSystem(a.system))}),r()}if(n&2){let e=t.$implicit;p("action",!0)("label",e.name)}}function oo(n,t){if(n&1){let e=E();o(0,"ya-filter-bar")(1,"ya-breadcrumb-trail")(2,"ya-breadcrumb",7),f("click",function(){C(e);let a=d(2);return y(a.changeSystem(""))}),r(),j(3,ao,1,2,"ya-breadcrumb",8,R),r()()}if(n&2){let e=d();c(2),p("action",!0),c(),B(e)}}function ro(n,t){n&1&&h(0,oo,5,1,"ya-filter-bar"),n&2&&v(t.length?0:-1)}function co(n,t){n&1&&(o(0,"th",23),s(1,"Name"),r())}function lo(n,t){if(n&1){let e=E();o(0,"mat-icon",25),s(1,"folder"),r(),o(2,"a",26),f("click",function(){C(e);let a=d().$implicit,l=d(2);return y(l.selectRow(a))}),s(3),g(4,"filename"),r()}if(n&2){let e=d().$implicit;c(3),D("",k(4,1,e.name),"/")}}function so(n,t){if(n&1&&(u(0,"ya-highlight",27),g(1,"slice")),n&2){let e=d(2).$implicit,i=d(2);p("text",Ye(1,2,e.command.qualifiedName,i.system.length+1))("term",i.filterControl.value)}}function mo(n,t){if(n&1&&u(0,"ya-highlight",27),n&2){let e=d(2).$implicit,i=d(2);p("text",e.command.qualifiedName)("term",i.filterControl.value)}}function po(n,t){if(n&1){let e=E();o(0,"mat-icon",25),s(1,"rss_feed"),r(),o(2,"a",26),f("click",function(){C(e);let a=d().$implicit,l=d(2);return y(l.selectRow(a))}),h(3,so,2,5,"ya-highlight",27)(4,mo,1,2,"ya-highlight",27),r()}if(n&2){let e=d(3);c(3),v(e.system?3:4)}}function uo(n,t){if(n&1&&(o(0,"td",24),h(1,lo,5,3),h(2,po,5,1),r()),n&2){let e=t.$implicit;c(),v(e.system?1:-1),c(),v(e.command?2:-1)}}function fo(n,t){n&1&&(o(0,"th",23),s(1,"Description"),r())}function _o(n,t){if(n&1&&s(0),n&2){let e=d().$implicit;D(" ",e.system.shortDescription||"-"," ")}}function go(n,t){if(n&1&&u(0,"ya-highlight",27),n&2){let e=d(4);p("text",t)("term",e.filterControl.value)}}function Co(n,t){n&1&&s(0," - ")}function yo(n,t){if(n&1&&h(0,go,1,2,"ya-highlight",27)(1,Co,1,0),n&2){let e,i=d().$implicit;v((e=i.command.shortDescription)?0:1,e)}}function ho(n,t){if(n&1&&(o(0,"td",28),h(1,_o,1,1),h(2,yo,2,1),r()),n&2){let e=t.$implicit;c(),v(e.system?1:-1),c(),v(e.command?2:-1)}}function vo(n,t){n&1&&(o(0,"th",23),s(1,"Significance"),r())}function So(n,t){n&1&&u(0,"app-significance-level",30),n&2&&p("level",t.consequenceLevel)}function ko(n,t){n&1&&s(0," - ")}function bo(n,t){if(n&1&&(o(0,"td",29),h(1,So,1,1,"app-significance-level",30)(2,ko,1,0),r()),n&2){let e,i=t.$implicit;c(),v((e=i.command==null?null:i.command.effectiveSignificance)?1:2,e)}}function xo(n,t){if(n&1&&(o(0,"th",23),s(1),r()),n&2){let e=d().$implicit;c(),D(" ",e.label," ")}}function wo(n,t){if(n&1&&u(0,"ya-highlight",27),n&2){let e=d(4);p("text",t)("term",e.filterControl.value)}}function Eo(n,t){n&1&&s(0," - ")}function Do(n,t){if(n&1&&(o(0,"td",29),h(1,wo,1,2,"ya-highlight",27),g(2,"alias"),Wt(3,Eo,1,0),r()),n&2){let e,i=t.$implicit,a=d().$implicit;c(),v((e=Ye(2,1,i.command,a.id))?1:3,e)}}function Fo(n,t){if(n&1&&(O(0,17),F(1,xo,2,1,"th",31)(2,Do,4,4,"td",20),A()),n&2){let e=t.$implicit;p("matColumnDef",e.id)}}function Mo(n,t){n&1&&u(0,"th",32)}function To(n,t){n&1&&u(0,"td",29)}function Po(n,t){n&1&&u(0,"tr",33)}function Vo(n,t){if(n&1&&u(0,"tr",34),n&2){let e=t.$implicit,i=d(2);te("selected",i.selection.isSelected(e))}}function No(n,t){if(n&1&&(o(0,"table",5),O(1,10),F(2,co,2,0,"th",11)(3,uo,3,2,"td",12),A(),O(4,13),F(5,fo,2,0,"th",11)(6,ho,3,2,"td",14),A(),O(7,15),F(8,vo,2,0,"th",11)(9,bo,3,1,"td",16),A(),j(10,Fo,3,1,"ng-container",17,R),g(12,"async"),O(13,18),F(14,Mo,1,0,"th",19)(15,To,1,0,"td",20),A(),F(16,Po,1,0,"tr",21),g(17,"async"),F(18,Vo,1,2,"tr",22),g(19,"async"),r()),n&2){let e=d(),i=X(8);p("dataSource",e.dataSource),c(10),B(k(12,3,e.aliasColumns$)),c(6),p("matHeaderRowDef",k(17,5,i.displayedColumns$)),c(2),p("matRowDefColumns",k(19,7,i.displayedColumns$))}}var We=class We{constructor(t,e){this.yamcs=t;this.changeDetection=e;this.pageSize=100;this.system=null;this.breadcrumb$=new N([]);this.filterControl=new Pn;this.columns=[{id:"name",label:"Name",alwaysVisible:!0},{id:"significance",label:"Significance",visible:!0},{id:"shortDescription",label:"Description"},{id:"actions",label:"",alwaysVisible:!0}];this.aliasColumns$=new N([]);this.selection=new oi(!1);this.selectedCommand$=new N(null);this.onChange=t=>{};this.onTouched=()=>{};this.dataSource=new Ma(t),this.selectedCommand$.subscribe(async i=>{if(i&&i.command){let a=await this.yamcs.yamcsClient.getCommand(this.yamcs.instance,i.command.qualifiedName);return this.onChange(a)}else return this.onChange(null)})}ngAfterViewInit(){this.changeSystem(""),this.searchFilter.filter.nativeElement.focus(),this.filterControl.valueChanges.subscribe(()=>{this.paginator.pageIndex=0,this.updateDataSource()}),this.paginator.page.subscribe(()=>{this.updateDataSource(),this.top.nativeElement.scrollIntoView()})}changeSystem(t,e=0){this.system=t,this.updateBrowsePath(),this.paginator.pageIndex=e,this.updateDataSource()}updateDataSource(){let t={system:this.system||"/",noAbstract:!0,details:!0,pos:this.paginator.pageIndex*this.pageSize,limit:this.pageSize,fields:["name","qualifiedName","alias","effectiveSignificance","shortDescription"]},e=this.filterControl.value;e&&(t.q=e.toLowerCase()),this.dataSource.loadCommands(t).then(()=>{this.selection.clear(),this.updateBrowsePath();for(let a of this.aliasColumns$.value){let l=this.columns.indexOf(a);l!==-1&&this.columns.splice(l,1)}let i=[];for(let a of this.dataSource.getAliasNamespaces()){let l={id:a,label:a,alwaysVisible:!0};i.push(l)}this.columns.splice(1,0,...i),this.aliasColumns$.next(i),this.columnChooser.recalculate(this.columns)})}selectRow(t){return t.system?(this.selectedCommand$.next(null),this.changeSystem(t.name)):this.selectedCommand$.next(t),!1}updateBrowsePath(){let t=[],e="";if(this.system)for(let i of this.system.slice(1).split("/"))e+="/"+i,t.push({name:i,system:e});this.breadcrumb$.next(t)}selectNext(){let t=this.dataSource.items$.value,e=0;if(this.selection.hasValue()){let i=this.selection.selected[0];t.indexOf(i)!==-1&&(e=Math.min(t.indexOf(i)+1,t.length-1))}this.selection.select(t[e])}selectPrevious(){let t=this.dataSource.items$.value,e=0;if(this.selection.hasValue()){let i=this.selection.selected[0];t.indexOf(i)!==-1&&(e=Math.max(t.indexOf(i)-1,0))}this.selection.select(t[e])}applySelection(){if(this.selection.hasValue()){let t=this.selection.selected[0],e=this.dataSource.items$.value;t.command&&e.indexOf(t)!==-1&&this.selectRow(t)}}writeValue(t){this.path=t}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}};We.\u0275fac=function(e){return new(e||We)(_(P),_(Kt))},We.\u0275cmp=x({type:We,selectors:[["app-command-selector"]],viewQuery:function(e,i){if(e&1&&(ae(io,7),ae(si,5),ae(_i,5),ae(no,5)),e&2){let a;oe(a=re())&&(i.top=a.first),oe(a=re())&&(i.paginator=a.first),oe(a=re())&&(i.columnChooser=a.first),oe(a=re())&&(i.searchFilter=a.first)}},inputs:{path:"path"},features:[hn([{provide:Tn,useExisting:dn(()=>We),multi:!0}])],decls:12,vars:12,consts:[["top",""],["searchFilter",""],["columnChooser",""],["placeholder","Search by name","icon","search",3,"onArrowDown","onArrowUp","onEnter","formControl"],["preferenceKey","sendCommand",3,"columns"],["mat-table","",1,"ya-data-table","expand",3,"dataSource"],[3,"pageSize","hidePageSize","showFirstLastButtons","length"],["icon","account_tree",3,"click","action"],[3,"action","label"],[3,"click","action","label"],["cdkColumnDef","name"],["mat-header-cell","",4,"cdkHeaderCellDef"],["mat-cell","","class","primary-td",4,"cdkCellDef"],["cdkColumnDef","shortDescription"],["mat-cell","","class","wrap200",4,"cdkCellDef"],["cdkColumnDef","significance"],["mat-cell","",4,"cdkCellDef"],[3,"matColumnDef"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"selected",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell","",1,"primary-td"],[1,"icon12",2,"vertical-align","middle"],["href","",3,"click"],[3,"text","term"],["mat-cell","",1,"wrap200"],["mat-cell",""],[3,"level"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-cell","",1,"expand"],["mat-header-row",""],["mat-row",""]],template:function(e,i){if(e&1){let a=E();u(0,"span",null,0),h(2,ro,1,1),g(3,"async"),o(4,"ya-filter-bar")(5,"ya-search-filter",3,1),f("onArrowDown",function(){return C(a),y(i.selectNext())})("onArrowUp",function(){return C(a),y(i.selectPrevious())})("onEnter",function(){return C(a),y(i.applySelection())}),r(),u(7,"ya-column-chooser",4,2),r(),h(9,No,20,9,"table",5),u(10,"mat-paginator",6),g(11,"async")}if(e&2){let a;c(2),v((a=k(3,8,i.breadcrumb$))?2:-1,a),c(3),p("formControl",i.filterControl),c(2),p("columns",i.columns),c(2),v(i.dataSource?9:-1),c(),p("pageSize",i.pageSize)("hidePageSize",!0)("showFirstLastButtons",!0)("length",k(11,10,i.dataSource.totalSize$))}},dependencies:[ya,w,I,Vn,ri,ci,li,Ce,si,Te,mi,zn,Ve,Pe,Xe,pi,Ne,di,Oe,fi,ui,_i,ea,ia,ca,se,bn,da,Si],styles:[".pullRight[_ngcontent-%COMP%]{float:right}.primary-td[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{margin-right:7px}"],changeDetection:0});var Ti=We;var Vi=class{constructor(t){this.step=t}getAssignment(t){for(let e in this.step.args)if(e===t){let i=this.step.args[e];return le.toValue(i)}}getOption(t,e){for(let i in this.step.extra||{})if(i===t){let a=this.step.extra[i];switch(e){case"BOOLEAN":return this.getBooleanOption(a);case"NUMBER":return this.getNumberOption(a);case"STRING":return this.getStringOption(a);case"TIMESTAMP":return this.getStringOption(a)}}}getBooleanOption(t){if(t.type==="BOOLEAN")return t}getNumberOption(t){switch(t.type){case"SINT32":case"UINT32":case"SINT64":case"UINT64":return t}}getStringOption(t){if(t.type==="STRING")return t}getComment(){return this.step.comment}getStream(){return this.step.stream}getAdvancementParams(){return this.step.advancement}};var Oo=["commandSelector"],Ao=["commandForm"],Io=()=>[];function $o(n,t){if(n&1&&(o(0,"div",2)(1,"form",3)(2,"h2"),s(3,"Select command"),r(),o(4,"div",4),u(5,"app-command-selector",5,0),r()()(),o(7,"div",6)(8,"mat-toolbar")(9,"mat-toolbar-row")(10,"ya-button",7),s(11,"CANCEL"),r()()()()),n&2){let e=d();c(),p("formGroup",e.selectCommandForm)}}function Ro(n,t){if(n&1){let e=E();o(0,"ya-text-action",13),f("click",function(){let a=C(e),l=d(2);return y(l.returnToList(a))}),s(1),r()}n&2&&(p("padding",!1),c(),D(" ",t," "))}function jo(n,t){if(n&1&&(o(0,"div"),s(1),u(2,"br"),o(3,"h2"),s(4),r()()),n&2){let e=t.$implicit;c(),D(" ",e.namespace," "),c(3),_e(e.name)}}function Bo(n,t){if(n&1){let e=E();o(0,"div",2)(1,"div",8)(2,"div",9)(3,"div"),h(4,Ro,2,2,"ya-text-action",10),g(5,"spaceSystemName"),o(6,"h2"),s(7),r()(),j(8,jo,5,2,"div",null,R),r(),u(10,"app-command-form",11,1),r()(),o(12,"div",6)(13,"mat-toolbar")(14,"mat-toolbar-row")(15,"ya-button",7),s(16,"CANCEL"),r(),s(17," \xA0\xA0 "),o(18,"ya-button",12),f("click",function(){C(e);let a=d();return y(a.handleOK())}),s(19),r()()()()}if(n&2){let e,i=t,a=X(11),l=d();c(4),v((e=k(5,7,i.qualifiedName))?4:-1,e),c(3),_e(i.name),c(),B(i.alias||Qe(9,Io)),c(2),p("command",i)("templateProvider",l.templateProvider)("stackMode",!0),c(8),p("disabled",!a.form.valid),c(),D(" ",l.okLabel," ")}}var yt=class yt{constructor(t,e,i,a,l){this.dialogRef=t;this.yamcs=e;this.changeDetection=a;this.data=l;this.okLabel="OK";this.commandFormValid$=new N(!1);this.selectedCommand$=new N(null);if(l?.entry){let m=l.entry;this.templateProvider=new Vi(m.model),this.selectedCommand$.next(m.command??null)}l?.okLabel&&(this.okLabel=l?.okLabel),this.selectCommandForm=i.group({command:["",L.required]}),this.selectCommandForm.valueChanges.subscribe(()=>{let m=this.selectCommandForm.value.command;this.selectedCommand$.next(m||null)})}handleOK(){let t=this.commandForm.getResult(),e={command:this.selectedCommand$.value,args:t.args,extra:t.extra,comment:t.comment,stream:t.stream,advancement:t.advancement};this.dialogRef.close(e)}returnToList(t){this.templateProvider=null,this.selectedCommand$.next(null),this.changeDetection.detectChanges(),this.selectCommandForm.reset(),this.commandSelector.changeSystem(t==="/"?"":t)}};yt.\u0275fac=function(e){return new(e||yt)(_(H),_(P),_(pe),_(Kt),_(ie))},yt.\u0275cmp=x({type:yt,selectors:[["ng-component"]],viewQuery:function(e,i){if(e&1&&(ae(Oo,5),ae(Ao,5)),e&2){let a;oe(a=re())&&(i.commandSelector=a.first),oe(a=re())&&(i.commandForm=a.first)}},decls:4,vars:6,consts:[["commandSelector",""],["commandForm",""],[1,"wrapper"],[1,"ya-form",3,"formGroup"],[1,"command-table-wrapper"],["formControlName","command"],[1,"footer"],["mat-dialog-close",""],[1,"command-detail"],[1,"names",2,"margin-bottom","0.5em"],[3,"padding"],[3,"command","templateProvider","stackMode"],["appearance","primary",3,"click","disabled"],[3,"click","padding"]],template:function(e,i){if(e&1&&(h(0,$o,12,1),g(1,"async"),h(2,Bo,20,10),g(3,"async")),e&2){let a;v(k(1,2,i.selectedCommand$)?-1:0),c(2),v((a=k(3,4,i.selectedCommand$))?2:-1,a)}},dependencies:[Da,Ti,w,G,I,Y,U,q,W,ni,jn,T,et,se,fa],styles:[".mat-mdc-dialog-container{border-radius:0;position:relative}.wrapper[_ngcontent-%COMP%]{position:relative;height:calc(100% - 48px);overflow:auto;font:400 12px/20px Roboto,sans-serif}.command-table-wrapper[_ngcontent-%COMP%]{position:absolute;overflow:auto;inset:56px 0 1em}.command-detail[_ngcontent-%COMP%]{max-width:600px}.footer[_ngcontent-%COMP%]{position:absolute;bottom:0;height:64px;left:0;right:0;border-top:1px solid #d3d3d3}.disabled[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{opacity:.6}div.names[_ngcontent-%COMP%]{display:flex}div.names[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{padding-right:25px}div.names[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:not(:first-child){padding-left:25px;border-left:1px solid rgba(0,0,0,.1)}div.names[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0}div.names[_ngcontent-%COMP%]     .text-action{line-height:0}"]});var Yt=yt;var Lo=["textContainer"],ht=class ht{constructor(t,e){this.dialogRef=t;this.data=e;this.textContainerRef=vn.required("textContainer");this.text=Le("")}ngAfterViewInit(){this.text.set(this.data.entry?.text||"");let t=[Bn,Rt.lineWrapping,Ea(),Rt.updateListener.of(i=>{if(i.docChanged){let a=i.state.doc.toString();this.text.set(a)}})],e=Rt.theme({"&":{height:"100%",fontSize:"12px"},".cm-scroller":{overflow:"auto",fontFamily:"'Roboto Mono', monospace"},"&.cm-focused":{outline:"none"}},{dark:!1});t.push(e),this.editorView=new Rt({doc:this.text(),extensions:t,parent:this.textContainerRef().nativeElement}),this.editorView.focus()}save(){let t=this.editorView?.state.doc.toString()||"";this.dialogRef.close(t)}gotoMarkdownDocs(){window.open("https://www.markdownguide.org/basic-syntax/","_blank","noreferrer")}ngOnDestroy(){this.editorView?.destroy()}};ht.\u0275fac=function(e){return new(e||ht)(_(H),_(ie))},ht.\u0275cmp=x({type:ht,selectors:[["app-edit-text-entry-dialog"]],viewQuery:function(e,i){e&1&&Cn(i.textContainerRef,Lo,5),e&2&&yn()},decls:18,vars:3,consts:[["textContainer",""],["mat-dialog-title",""],["animationDuration","0ms",1,"small-tabs",3,"mat-stretch-tabs"],["label","Write"],[1,"text-container"],["label","Preview"],[1,"preview-container"],[3,"text"],["align","end"],["appearance","text","icon","open_in_new",3,"click"],[2,"flex","1 1 auto"],["mat-dialog-close",""],["appearance","primary",3,"click"]],template:function(e,i){if(e&1){let a=E();o(0,"h2",1),s(1,"Step: Display text"),r(),o(2,"mat-dialog-content")(3,"mat-tab-group",2)(4,"mat-tab",3),u(5,"div",4,0),r(),o(7,"mat-tab",5)(8,"div",6),u(9,"app-markdown",7),r()()()(),o(10,"mat-dialog-actions",8)(11,"ya-button",9),f("click",function(){return C(a),y(i.gotoMarkdownDocs())}),s(12," Markdown syntax "),r(),u(13,"div",10),o(14,"ya-button",11),s(15,"CANCEL"),r(),o(16,"ya-button",12),f("click",function(){return C(a),y(i.save())}),s(17),r()()}e&2&&(c(3),p("mat-stretch-tabs",!1),c(6),p("text",i.text()),c(8),D(" ",i.data.edit?"UPDATE":"ADD TO STACK"," "))},dependencies:[lt,w,W,ne,Z,J,Ln,Yn,T],styles:[".text-container[_ngcontent-%COMP%]{border:1px solid rgba(0,0,0,.1);margin-top:12px;height:300px}.preview-container[_ngcontent-%COMP%]{border:1px solid rgba(0,0,0,.1);background-color:#fafafa;margin-top:12px;height:300px}"]});var Gt=ht;function Yo(n,t){if(n&1){let e=E();o(0,"tr",4)(1,"td",19),u(2,"app-parameter-input",20),r(),o(3,"td",21)(4,"ya-select",22),u(5,"ya-option",23)(6,"ya-option",24)(7,"ya-option",25)(8,"ya-option",26)(9,"ya-option",27)(10,"ya-option",28),r()(),o(11,"td",29),u(12,"input",30),r(),o(13,"td",21)(14,"ya-icon-action",31),f("click",function(){let a=C(e).$index,l=d();return y(l.moveComparisonGroupDown(a))}),r(),o(15,"ya-icon-action",32),f("click",function(){let a=C(e).$index,l=d();return y(l.moveComparisonGroupUp(a))}),r(),o(16,"ya-text-action",33),f("click",function(){let a=C(e).$index,l=d();return y(l.removeComparisonGroup(a))}),s(17," DELETE "),r()()()}if(n&2){let e=t.$index,i=t.$count;p("formGroupName",e),c(14),p("disabled",e===i-1),c(),p("disabled",e===0)}}var vt=class vt{constructor(t,e){this.dialogRef=t;this.data=e;if(this.form=new Ge({condition:new ei([]),delay:new me(0,[L.required]),timeout:new me(""),comment:new me("")}),e.entry){let i=e.entry.condition||[];for(let a of i)this.addComparisonGroup();this.form.setValue({condition:i,delay:e.entry.delay??0,timeout:e.entry.timeout||"",comment:e.entry.comment||""})}this.conditionFormArray.length||this.addComparisonGroup()}get conditionFormArray(){return this.form.controls.condition}get comparisonGroups(){return this.conditionFormArray.controls}addComparisonGroup(){this.conditionFormArray.push(new Ge({parameter:new me("",[L.required]),operator:new me("eq",[L.required]),value:new me("",[L.required])}))}removeComparisonGroup(t){this.conditionFormArray.removeAt(t)}moveComparisonGroupDown(t){let e=this.conditionFormArray.controls[t];this.conditionFormArray.removeAt(t),this.conditionFormArray.insert(t+1,e)}moveComparisonGroupUp(t){let e=this.conditionFormArray.controls[t];this.conditionFormArray.removeAt(t),this.conditionFormArray.insert(t-1,e)}save(){let{value:t}=this.form,e={condition:t.condition,delay:Math.max(t.delay,0),comment:t.comment};t.timeout!==""&&t.timeout!==null&&(e.timeout=Math.max(t.timeout,0)),this.dialogRef.close(e)}};vt.\u0275fac=function(e){return new(e||vt)(_(H),_(ie))},vt.\u0275cmp=x({type:vt,selectors:[["app-edit-verify-entry-dialog"]],decls:30,vars:4,consts:[["mat-dialog-title",""],[1,"ya-form",3,"formGroup"],["label","Parameters",3,"expanded"],["formArrayName","condition",1,"condition-table"],[3,"formGroupName"],["colspan","1"],["icon","add_circle",3,"click"],["label","Timing"],["label","Delay (milliseconds)"],["type","number","formControlName","delay"],[1,"hint"],["label","Timeout (milliseconds)"],["type","number","formControlName","timeout"],["label","Comment"],["formControlName","comment"],["align","end"],[2,"flex","1 1 auto"],["mat-dialog-close",""],["appearance","primary",3,"click","disabled"],[2,"width","70%"],["formControlName","parameter"],[2,"white-space","nowrap"],["formControlName","operator",1,"operator"],["id","eq","label","="],["id","neq","label","!="],["id","lt","label","<"],["id","lte","label","<="],["id","gt","label",">"],["id","gte","label",">="],[2,"width","30%"],["type","text","formControlName","value"],["icon","keyboard_arrow_down",3,"click","disabled"],["icon","keyboard_arrow_up",3,"click","disabled"],["icon","delete",3,"click"]],template:function(e,i){e&1&&(o(0,"h2",0),s(1,"Step: Verify parameters"),r(),o(2,"mat-dialog-content")(3,"form",1)(4,"ya-stepper")(5,"ya-stepper-step",2)(6,"table",3),j(7,Yo,18,3,"tr",4,R),o(9,"tr")(10,"td",5)(11,"ya-button",6),f("click",function(){return i.addComparisonGroup()}),s(12,"Add"),r()()()()(),o(13,"ya-stepper-step",7)(14,"ya-field",8),u(15,"input",9),o(16,"span",10),s(17,"Initial delay before verifying the condition"),r()(),o(18,"ya-field",11),u(19,"input",12),o(20,"span",10),s(21,"Maximum wait time before aborting the verification"),r()()(),o(22,"ya-stepper-step",13),u(23,"app-markdown-input",14),r()()()(),o(24,"mat-dialog-actions",15),u(25,"div",16),o(26,"ya-button",17),s(27,"CANCEL"),r(),o(28,"ya-button",18),f("click",function(){return i.save()}),s(29),r()()),e&2&&(c(3),p("formGroup",i.form),c(2),p("expanded",!0),c(2),B(i.comparisonGroups),c(21),p("disabled",!i.form.valid),c(),D(" ",i.data.edit?"UPDATE":"ADD TO STACK"," "))},dependencies:[ki,bi,sa,la,w,G,ge,Jt,I,Y,U,q,Nn,Zt,W,ne,Z,J,T,ee,Ze,aa,at,et],styles:[".condition-table[_ngcontent-%COMP%]{width:100%}.condition-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:first-child{margin-left:0;padding-left:0}[_nghost-%COMP%]     .condition-table input{margin:0!important;width:100%}[_nghost-%COMP%]     ya-select.operator ya-button{margin-top:0;width:100%}"],changeDetection:0});var Ut=vt;var St=class St{constructor(t,e){this.dialogRef=t;this.form=e.group({executionTime:["",[L.required]],tags:[[],[]]})}schedule(){this.dialogRef.close(this.form.value)}};St.\u0275fac=function(e){return new(e||St)(_(H),_(pe))},St.\u0275cmp=x({type:St,selectors:[["app-schedule-stack-dialog"]],decls:19,vars:4,consts:[["mat-dialog-title",""],[1,"hint"],[1,"ya-form",3,"formGroup"],["label","Execution time"],["formControlName","executionTime",3,"showMillis","showNow"],["label","Timeline tags","hint","(optional)"],["dialogTitle","Timeline Tags"],["formControlName","tags"],["align","end"],[2,"flex","1 1 auto"],["mat-dialog-close",""],["appearance","primary",3,"click","disabled"]],template:function(e,i){e&1&&(o(0,"h2",0),s(1,"Run later"),r(),o(2,"mat-dialog-content")(3,"div",1)(4,"p"),s(5,"This stack will be submitted to the Yamcs Timeline, for execution at a later time."),r()(),o(6,"form",2)(7,"ya-field",3),u(8,"ya-date-time-input",4),r(),o(9,"ya-field",5)(10,"ya-help",6),s(11," Tags allow to categorise items per band. Bands only show items for which one of the tags is matching. "),r(),u(12,"ya-tag-select",7),r()()(),o(13,"mat-dialog-actions",8),u(14,"div",9),o(15,"ya-button",10),s(16,"CANCEL"),r(),o(17,"ya-button",11),f("click",function(){return i.schedule()}),s(18,"SCHEDULE"),r()()),e&2&&(c(6),p("formGroup",i.form),c(2),p("showMillis",!0)("showNow",!0),c(9),p("disabled",!i.form.valid))},dependencies:[w,G,I,Y,U,q,W,ne,Z,J,T,gi,ee,tt,vi],encapsulation:2,changeDetection:0});var Ni=St;var kt=class kt{constructor(){this.icon=Q.required();this.text=Q.required()}};kt.\u0275fac=function(e){return new(e||kt)},kt.\u0275cmp=x({type:kt,selectors:[["app-entry-label"]],inputs:{icon:[1,"icon"],text:[1,"text"]},decls:4,vars:2,consts:[[1,"icon12"]],template:function(e,i){e&1&&(o(0,"mat-icon",0),s(1),r(),o(2,"span"),s(3),r()),e&2&&(c(),_e(i.icon()),c(2),_e(i.text()))},dependencies:[Ce],styles:["[_nghost-%COMP%]{display:flex;align-items:center;background-color:inherit;font-size:12px;font-weight:400;font-family:Roboto Mono,monospace;line-height:12px;letter-spacing:.02em;color:#000000a7;padding:2px;margin-bottom:5px}span[_ngcontent-%COMP%]{margin-left:5px}"],changeDetection:0});var Be=kt;function Go(n,t){if(n&1&&(o(0,"td",9),s(1),r()),n&2){let e=t.$implicit;c(),D(" ",e.parameter," ")}}function Uo(n,t){if(n&1&&u(0,"app-alarm-level",11),n&2){let e=d().$implicit;p("level",e.pval.monitoringResult)}}function qo(n,t){if(n&1&&(o(0,"td",10),h(1,Uo,1,1,"app-alarm-level",11),r()),n&2){let e,i=t.$implicit;c(),v((e=i.pval==null?null:i.pval.engValue)?1:-1,e)}}function Ho(n,t){n&1&&(o(0,"span"),s(1,"\u2193"),r())}function Wo(n,t){n&1&&(o(0,"span"),s(1,"\u2191"),r())}function Qo(n,t){if(n&1&&(o(0,"ya-expirable",13),u(1,"ya-value",14),h(2,Ho,2,0,"span"),h(3,Wo,2,0,"span"),r()),n&2){let e=d().$implicit;p("pval",e.pval),c(),p("value",e.pval.engValue)("alwaysExpand",!0),c(),v(e.pval.rangeCondition==="LOW"?2:-1),c(),v(e.pval.rangeCondition==="HIGH"?3:-1)}}function zo(n,t){n&1&&s(0," - ")}function Ko(n,t){if(n&1&&(o(0,"td",12),h(1,Qo,4,5,"ya-expirable",13)(2,zo,1,0),r()),n&2){let e,i=t.$implicit;c(),v((e=i.pval==null?null:i.pval.engValue)?1:2,e)}}function Xo(n,t){n&1&&u(0,"tr",15)}function Jo(n,t){if(n&1&&(o(0,"table",1),O(1,2),F(2,Go,2,1,"td",3),A(),O(3,4),F(4,qo,2,1,"td",5),A(),O(5,6),F(6,Ko,3,1,"td",7),A(),F(7,Xo,1,0,"tr",8),r()),n&2){let e=d();p("dataSource",e.dataSource),c(7),p("matRowDefColumns",e.displayedColumns)}}var bt=class bt{constructor(){this.entry=Q.required();this.pvals=Q.required();this.dataSource=new Je;this.displayedColumns=["parameter","level","value"];zt(()=>{let t=this.pvals(),e=[];for(let i of this.entry().parameters){let a={parameter:i.parameter,pval:t[i.parameter]};e.push(a)}this.dataSource.data=e})}};bt.\u0275fac=function(e){return new(e||bt)},bt.\u0275cmp=x({type:bt,selectors:[["app-stacked-check-entry"]],inputs:{entry:[1,"entry"],pvals:[1,"pvals"]},decls:2,vars:1,consts:[["icon","toll","text","Parameters:"],["mat-table","",1,"ya-data-table","no-frame",3,"dataSource"],["matColumnDef","parameter"],["mat-cell","","style","width: 400px",4,"matCellDef"],["matColumnDef","level"],["mat-cell","","style","width: 80px",4,"matCellDef"],["matColumnDef","value"],["mat-cell","",4,"matCellDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-cell","",2,"width","400px"],["mat-cell","",2,"width","80px"],[3,"level"],["mat-cell",""],[3,"pval"],[3,"value","alwaysExpand"],["mat-row",""]],template:function(e,i){if(e&1&&(u(0,"app-entry-label",0),h(1,Jo,8,2,"table",1)),e&2){let a;c(),v((a=i.entry())?1:-1,a)}},dependencies:[Sa,Be,w,Te,Ve,Pe,Xe,Ne,Oe,yi,rt],styles:["[_nghost-%COMP%]{display:block;position:relative}table[_ngcontent-%COMP%]{padding-left:18px;padding-right:18px;background-color:#fafafa}[_nghost-%COMP%]     tr.mat-mdc-row{background:#fafafa}[_nghost-%COMP%]     td:first-child{padding-left:0!important}"],changeDetection:0});var Oi=bt;var xt=class xt{transform(t){return t?t==="CommandComplete"?"Completed":t.replace("Acknowledge_",""):null}};xt.\u0275fac=function(e){return new(e||xt)},xt.\u0275pipe=fn({name:"acknowledgmentName",type:xt,pure:!0});var Ai=xt;function Zo(n,t){if(n&1&&(o(0,"span"),s(1),g(2,"value"),r()),n&2){let e=t.$implicit;c(),Ki("[",e.key,": ",k(2,2,e.value),"]")}}function er(n,t){if(n&1&&(o(0,"tr")(1,"td",3),s(2),r(),o(3,"td",4),u(4,"ya-value",5),g(5,"tovalue"),r()()),n&2){let e=t.$implicit;c(2),D(" ",e.key," "),c(2),p("value",k(5,2,e.value))}}function tr(n,t){if(n&1&&(o(0,"span"),s(1),g(2,"acknowledgmentName"),r()),n&2){let e=d(2);c(),Ki(" Advance when ",k(2,2,e.advancement.acknowledgment)," ",e.advancement.wait!=null?"+ "+e.advancement.wait+" ms":null," ")}}function ir(n,t){if(n&1&&(o(0,"span"),s(1),r()),n&2){let e=d(2);c(),D("Advance after ",e.advancement.wait," ms")}}function nr(n,t){if(n&1&&(o(0,"div",2)(1,"mat-icon"),s(2,"reply"),r(),h(3,tr,3,4,"span")(4,ir,2,1,"span"),r()),n&2){let e=d();c(3),v(e.advancement.acknowledgment?3:e.advancement.wait!=null?4:-1)}}function ar(n,t){if(n&1&&(u(0,"app-entry-label",0),j(1,Zo,3,4,"span",null,R),g(3,"keyvalue"),o(4,"table",1),j(5,er,6,4,"tr",null,R),g(7,"keyvalue"),r(),h(8,nr,5,1,"div",2)),n&2){let e=t,i=d();p("text","Command: "+e.name),c(),B(k(3,2,e.extra)),c(4),B(Ye(7,4,e.args,i.insertionOrder)),c(3),v(e.advancement?8:-1)}}var wt=class wt{constructor(){this.entry=Q.required();this.insertionOrder=(t,e)=>0}};wt.\u0275fac=function(e){return new(e||wt)},wt.\u0275cmp=x({type:wt,selectors:[["app-stacked-command-entry"]],inputs:{entry:[1,"entry"]},decls:1,vars:1,consts:[["icon","rss_feed",3,"text"],[1,"args"],[1,"advance-on"],["width","1",1,"key"],[1,"value"],[3,"value"]],template:function(e,i){if(e&1&&h(0,ar,9,7),e&2){let a;v((a=i.entry())?0:-1,a)}},dependencies:[Be,w,Ce,rt,Ai,kn,_a,ot],styles:["[_nghost-%COMP%]{display:block;position:relative}.advance-on[_ngcontent-%COMP%]{color:#000000a7;font-size:12px}.advance-on[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{vertical-align:middle}.advance-on[_ngcontent-%COMP%] > mat-icon[_ngcontent-%COMP%]{transform:rotate(180deg);font-size:12px;height:12px;width:12px}table.args[_ngcontent-%COMP%]{margin:0 0 0 18px;font-size:10px}table.args[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:0;border:0}table.args[_ngcontent-%COMP%]   td.key[_ngcontent-%COMP%]{min-width:120px;white-space:nowrap}table.args[_ngcontent-%COMP%]   td.value[_ngcontent-%COMP%]{color:gray;padding-left:10px}"],changeDetection:0});var Ii=wt;function or(n,t){n&1&&u(0,"app-markdown",0),n&2&&p("text",t.renderedText())}var Et=class Et{constructor(){this.entry=Q.required()}};Et.\u0275fac=function(e){return new(e||Et)},Et.\u0275cmp=x({type:Et,selectors:[["app-stacked-text-entry"]],inputs:{entry:[1,"entry"]},decls:1,vars:1,consts:[[3,"text"]],template:function(e,i){if(e&1&&h(0,or,1,1,"app-markdown",0),e&2){let a;v((a=i.entry())?0:-1,a)}},dependencies:[lt,w],styles:["[_nghost-%COMP%]{display:block;position:relative}"],changeDetection:0});var $i=Et;function rr(n,t){n&1&&s(0," = ")}function cr(n,t){n&1&&s(0," != ")}function lr(n,t){n&1&&s(0," < ")}function sr(n,t){n&1&&s(0," <= ")}function mr(n,t){n&1&&s(0," > ")}function pr(n,t){n&1&&s(0," >= ")}function dr(n,t){if(n&1&&(o(0,"td",10),s(1),h(2,rr,1,0)(3,cr,1,0)(4,lr,1,0)(5,sr,1,0)(6,mr,1,0)(7,pr,1,0),s(8),r()),n&2){let e,i=t.$implicit;c(),D(" ",i.parameter," "),c(),v((e=i.operator)==="eq"?2:e==="neq"?3:e==="lt"?4:e==="lte"?5:e==="gt"?6:e==="gte"?7:-1),c(6),D(" ",i.value," ")}}function ur(n,t){n&1&&(o(0,"span",12),s(1,"satisfied"),r())}function fr(n,t){n&1&&(o(0,"span",13),s(1,"not satisfied"),r())}function _r(n,t){if(n&1&&(o(0,"td",11),h(1,ur,2,0,"span",12)(2,fr,2,0,"span",13),u(3,"app-live-expression",14,0),r()),n&2){let e=t.$implicit,i=X(4);c(),v(i.result()===!0?1:2),c(2),p("expression",e.expression)}}function gr(n,t){n&1&&(o(0,"span"),s(1,"\u2193"),r())}function Cr(n,t){n&1&&(o(0,"span"),s(1,"\u2191"),r())}function yr(n,t){if(n&1&&(o(0,"ya-expirable",16),s(1),g(2,"value"),h(3,gr,2,0,"span"),h(4,Cr,2,0,"span"),r()),n&2){let e=d().$implicit;p("pval",e.pval),c(),D(" ",k(2,4,e.pval.engValue)," "),c(2),v(e.pval.rangeCondition==="LOW"?3:-1),c(),v(e.pval.rangeCondition==="HIGH"?4:-1)}}function hr(n,t){n&1&&s(0," - ")}function vr(n,t){if(n&1&&(o(0,"td",15),h(1,yr,5,6,"ya-expirable",16)(2,hr,1,0),r()),n&2){let e,i=t.$implicit;c(),v((e=i.pval==null?null:i.pval.engValue)?1:2,e)}}function Sr(n,t){n&1&&u(0,"tr",17)}function kr(n,t){if(n&1&&(o(0,"table",2),O(1,3),F(2,dr,9,3,"td",4),A(),O(3,5),F(4,_r,5,2,"td",6),A(),O(5,7),F(6,vr,3,1,"td",8),A(),F(7,Sr,1,0,"tr",9),r()),n&2){let e=d();p("dataSource",e.dataSource)("trackBy",e.tableTrackerFn),c(7),p("matRowDefColumns",e.displayedColumns)}}var Dt=class Dt{constructor(){this.entry=Q.required();this.pvals=Q.required();this.dataSource=new Je;this.displayedColumns=["expression","evaluation","value"];this.tableTrackerFn=(t,e)=>t;zt(()=>{let t=this.pvals(),e=[];for(let i of this.entry().condition){let a=`'${i.parameter}'`;switch(i.operator){case"eq":a+=" == ";break;case"neq":a+=" != ";break;case"lt":a+=" < ";break;case"lte":a+=" <= ";break;case"gt":a+=" > ";break;case"gte":a+=" >= ";break}typeof i.value=="string"?i.value==="true"?a+="true":i.value==="false"?a+="false":isNaN(i.value)?a+=`"${i.value}"`:a+=i.value:a+=`${i.value}`;let l={parameter:i.parameter,operator:i.operator,value:i.value,expression:a,pval:t[i.parameter]};e.push(l)}this.dataSource.data=e})}};Dt.\u0275fac=function(e){return new(e||Dt)},Dt.\u0275cmp=x({type:Dt,selectors:[["app-stacked-verify-entry"]],inputs:{entry:[1,"entry"],pvals:[1,"pvals"]},decls:2,vars:1,consts:[["expr",""],["icon","checklist_rtl","text","Verify:"],["mat-table","",1,"ya-data-table","no-frame",3,"dataSource","trackBy"],["matColumnDef","expression"],["mat-cell","","style","width: 400px",4,"matCellDef"],["matColumnDef","evaluation"],["mat-cell","","style","width: 80px",4,"matCellDef"],["matColumnDef","value"],["mat-cell","",4,"matCellDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-cell","",2,"width","400px"],["mat-cell","",2,"width","80px"],[1,"evaluation","valid"],[1,"evaluation","invalid"],[2,"display","none",3,"expression"],["mat-cell",""],[3,"pval"],["mat-row",""]],template:function(e,i){if(e&1&&(u(0,"app-entry-label",1),h(1,kr,8,3,"table",2)),e&2){let a;c(),v((a=i.entry())?1:-1,a)}},dependencies:[Be,Fa,w,Te,Ve,Pe,Xe,Ne,Oe,yi,ot],styles:["[_nghost-%COMP%]{display:block;position:relative}table[_ngcontent-%COMP%]{padding-left:18px;padding-right:18px;background-color:#fafafa}[_nghost-%COMP%]     tr.mat-mdc-row{background:#fafafa}[_nghost-%COMP%]     td:first-child{padding-left:0!important}.evaluation[_ngcontent-%COMP%]{font-family:Roboto Mono,monospace;background-color:#ffeef0;color:red;padding-left:2px;padding-right:2px}.evaluation.valid[_ngcontent-%COMP%]{background-color:#e6ffed;color:#00c752}"],changeDetection:0});var Ri=Dt;function br(n,t){n&1&&(o(0,"mat-icon",1),s(1,"check_circle_outline"),r())}function xr(n,t){n&1&&(o(0,"mat-icon",2),s(1,"sync"),r())}function wr(n,t){n&1&&(o(0,"mat-icon",3),s(1,"highlight_off"),r())}function Er(n,t){n&1&&(o(0,"mat-icon",4),s(1,"block"),r())}function Dr(n,t){if(n&1&&h(0,br,2,0,"mat-icon",1)(1,xr,2,0,"mat-icon",2)(2,wr,2,0,"mat-icon",3)(3,Er,2,0,"mat-icon",4),n&2){let e,i=d();v((e=i.comparison.status())==="ok"?0:e==="pending"?1:e==="nok"?2:e==="cancelled"?3:-1)}}function Fr(n,t){n&1&&(o(0,"mat-icon",0),s(1,"lens"),r())}var Ft=class Ft{};Ft.\u0275fac=function(e){return new(e||Ft)},Ft.\u0275cmp=x({type:Ft,selectors:[["app-verify-icon"]],inputs:{comparison:"comparison"},decls:2,vars:1,consts:[["matTooltip","Unknown",1,"icon16","nvl"],["matTooltip","Condition satisfied",1,"icon16","ok"],["matTooltip","Verifying condition",1,"icon16","pending"],["matTooltip","Condition not satisfied",1,"icon16","failed"],["matTooltip","Verification cancelled",1,"icon16","cancelled"]],template:function(e,i){e&1&&h(0,Dr,4,1)(1,Fr,2,0,"mat-icon",0),e&2&&v(i.comparison.status?0:1)},dependencies:[w,Ce,Fe],styles:["[_nghost-%COMP%]{line-height:0;font-size:0}.ok[_ngcontent-%COMP%]{color:#00c752}.pending[_ngcontent-%COMP%]{color:gray;animation:_ngcontent-%COMP%_yspin 2s infinite linear}.cancelled[_ngcontent-%COMP%]{color:gray}.failed[_ngcontent-%COMP%]{color:var(--y-error-color)}.nvl[_ngcontent-%COMP%]{color:gray}@keyframes _ngcontent-%COMP%_yspin{0%{-webkit-transform:rotate(0deg) scaleX(-1);transform:rotate(0) scaleX(-1)}to{-webkit-transform:rotate(359deg) scaleX(-1);transform:rotate(359deg) scaleX(-1)}}"],changeDetection:0});var ji=Ft;function Mr(n,t){if(n&1&&(o(0,"tr")(1,"td",0)(2,"div",1),u(3,"app-verify-icon",2),r()(),o(4,"td",3),s(5),r(),o(6,"td"),s(7),g(8,"value"),r()()),n&2){let e=t.$implicit;c(3),p("comparison",e),c(2),D(" ",e.parameter," "),c(2),_e(k(8,3,e.pval==null?null:e.pval.engValue)??"-")}}var Mt=class Mt{};Mt.\u0275fac=function(e){return new(e||Mt)},Mt.\u0275cmp=x({type:Mt,selectors:[["app-verify-table"]],inputs:{entry:"entry"},decls:3,vars:0,consts:[[2,"width","16px"],[2,"display","flex","align-items","center"],[3,"comparison"],[2,"padding-right","20px"]],template:function(e,i){e&1&&(o(0,"table"),j(1,Mr,9,5,"tr",null,R),r()),e&2&&(c(),B(i.entry.pvals))},dependencies:[ji,w,ot],styles:["table[_ngcontent-%COMP%]{width:auto}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:none;padding:0}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:not(:first-child){padding-left:10px}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-size:12px;line-height:16px}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{color:#000000a7}"]});var Bi=Mt;var Pr=["entryParent"],Vr=n=>({c:n}),Nr=()=>[];function Or(n,t){if(n&1&&(u(0,"ya-page-icon-button",26),s(1),g(2,"basename")),n&2){let e=d();p("routerLink",e.folderLink)("queryParams",ce(5,Vr,e.yamcs.context)),c(),D(" ",k(2,3,e.filename)," ")}}function Ar(n,t){if(n&1){let e=E();o(0,"ya-page-button",27),f("clicked",function(){C(e);let a=d();return y(a.openScheduleStackDialog())}),s(1," Schedule "),r()}if(n&2){let e=d();p("disabled",!e.loaded||e.format!=="ycs"||!e.entries$.value.length)}}function Ir(n,t){n&1&&u(0,"ya-dots")}function $r(n,t){n&1&&(o(0,"ya-empty-message")(1,"mat-icon",28),s(2,"link_off"),r(),s(3," Unsupported stack format "),r())}function Rr(n,t){n&1&&(o(0,"ya-empty-message"),s(1," Empty stack "),u(2,"br"),s(3," Click "),o(4,"mat-icon",29),s(5,"add_box"),r(),s(6," to start adding steps "),r())}function jr(n,t){n&1&&s(0," [*]: ")}function Br(n,t){if(n&1&&s(0),n&2){let e=d().$implicit;D(" [",e.executionNumber,"]: ")}}function Lr(n,t){n&1&&s(0," [ ]: ")}function Yr(n,t){if(n&1&&(u(0,"app-stacked-check-entry",34),g(1,"async")),n&2){let e=d().$implicit,i=d();p("entry",e)("pvals",k(1,2,i.pvals$))}}function Gr(n,t){if(n&1&&u(0,"app-stacked-command-entry",35),n&2){let e=d().$implicit;p("entry",e)}}function Ur(n,t){if(n&1&&u(0,"app-stacked-text-entry",35),n&2){let e=d().$implicit;p("entry",e)}}function qr(n,t){if(n&1&&(u(0,"app-stacked-verify-entry",34),g(1,"async")),n&2){let e=d().$implicit,i=d();p("entry",e)("pvals",k(1,2,i.pvals$))}}function Hr(n,t){if(n&1&&(o(0,"div",36)(1,"div",38)(2,"mat-icon",39),s(3,"info"),r(),o(4,"span",40),s(5,"Info"),r()(),u(6,"app-markdown",41),r()),n&2){let e=d().$implicit;c(6),p("text",e.comment)}}function Wr(n,t){if(n&1&&s(0),n&2){let e=d(2).$implicit;D(" ",e.err," ")}}function Qr(n,t){if(n&1&&(o(0,"div",44),u(1,"app-extra-acknowledgments-table",43),r()),n&2){let e=d(3).$implicit;c(),p("command",e.record)("inline",!0)}}function zr(n,t){if(n&1&&(u(0,"app-yamcs-acknowledgments-table",43),h(1,Qr,2,2,"div",44)),n&2){let e=d(2).$implicit;p("command",e.record)("inline",!0),c(),v(((e.record==null?null:e.record.extra)||Qe(3,Nr)).length?1:-1)}}function Kr(n,t){n&1&&u(0,"ya-value",46),n&2&&p("value",t)}function Xr(n,t){n&1&&s(0," - ")}function Jr(n,t){if(n&1&&(o(0,"tr")(1,"td",45),s(2),r(),o(3,"td"),h(4,Kr,1,1,"ya-value",46)(5,Xr,1,0),r()()),n&2){let e,i=t.$implicit;c(2),_e(i.parameter),c(2),v((e=i.pval==null?null:i.pval.engValue)?4:5,e)}}function Zr(n,t){if(n&1&&(o(0,"table"),j(1,Jr,6,2,"tr",null,R),r()),n&2){let e=d(2).$implicit;c(),B(e.pvals)}}function ec(n,t){if(n&1&&u(0,"app-verify-table",35),n&2){let e=d(2).$implicit;p("entry",e)}}function tc(n,t){if(n&1){let e=E();o(0,"div",37)(1,"div",42),f("click",function(){C(e);let a=d().$implicit,l=d();return y(l.selectEntry(a))}),r(),o(2,"div",33),h(3,Wr,1,1)(4,zr,2,4)(5,Zr,3,0,"table")(6,ec,1,1,"app-verify-table",35),r()()}if(n&2){let e=d().$implicit;c(2),te("err",e.err),c(),v(e.err?3:e.type==="command"?4:e.type==="check"?5:e.type==="verify"?6:-1)}}function ic(n,t){if(n&1){let e=E();o(0,"div",30),g(1,"async"),f("click",function(){let a=C(e).$implicit,l=d();return y(l.selectEntry(a))})("dblclick",function(){let a=C(e).$implicit,l=d();return y(l.editEntry(a))}),o(2,"div",31)(3,"div",32),h(4,jr,1,0)(5,Br,1,1)(6,Lr,1,0),r(),o(7,"div",33),h(8,Yr,2,4,"app-stacked-check-entry",34)(9,Gr,1,1,"app-stacked-command-entry",35)(10,Ur,1,1,"app-stacked-text-entry",35)(11,qr,2,4,"app-stacked-verify-entry",34),h(12,Hr,7,1,"div",36),r()(),h(13,tc,7,3,"div",37),r()}if(n&2){let e=t.$implicit,i=d();te("display-text",e.type==="text")("selected",e===k(1,8,i.selectedEntry$)),c(4),v(e.executing?4:e.executionNumber===0||e.executionNumber?5:e.executionNumber!==0&&!e.executionNumber?6:-1),c(4),v(e.type==="check"?8:e.type==="command"?9:e.type==="text"?10:e.type==="verify"?11:-1),c(4),v(e.comment?12:-1),c(),v(e.hasOutputs()?13:-1)}}var Tt=class Tt{constructor(t,e,i,a,l,m,S,b,z){this.dialog=t;this.yamcs=e;this.title=i;this.authService=a;this.configService=l;this.messageService=m;this.sanitizer=S;this.appearanceService=b;this.stackFileService=z;this.running$=new N(!1);this.runningStack=!1;this.stepScopedSubscriptions=[];this.selectedEntry$=new N(null);this.clipboardEntry$=new N(null);this.commandHistoryRecords=new Map;this.executionCounter=0;this.loaded=!1;this.nextEntryScheduled=!1;this.idMapping={};this.pvals$=new N({});this.bucket=l.getStackBucket(),this.entries$=z.entries$,this.hasState$=z.hasState$,this.parameterSubscription=e.yamcsClient.createParameterSubscription({instance:e.instance,processor:e.processor,action:"REPLACE",abortOnInvalid:!1,sendFromCache:!0,updateOnExpiration:!0,id:[]},he=>{if(he.mapping&&(this.idMapping=he.mapping),he.values){let It=K({},this.pvals$.value);for(let an of he.values){let on=this.idMapping[an.numericId];on&&(It[on.name]=an)}this.pvals$.next(It)}})}ngOnInit(){let t=this.objectName.lastIndexOf("/");if(t===-1)this.folderLink="/procedures/stacks/browse/",this.filename=this.objectName;else{let a=this.objectName.substring(0,t);this.folderLink="/procedures/stacks/browse/"+a,this.filename=this.objectName.substring(t+1)}this.title.setTitle(this.filename);let e=le.getExtension(le.getFilename(this.objectName))?.toLowerCase();if(e==="ycs"||e==="xml")this.format=e;else{this.loaded=!0;return}let i=this.stackFileService.entries;this.stackFileService.updateEntries(i),this.selectedEntry$.next(i.length?i[0]:null),this.updateParameterSubscription(),this.loaded=!0,this.commandSubscription=this.yamcs.yamcsClient.createCommandSubscription({instance:this.yamcs.instance,processor:this.yamcs.processor,ignorePastCommands:!0},a=>{let l=a.id,m=this.commandHistoryRecords.get(l);m?m=m.mergeEntry(a):m=new Kn(a),this.commandHistoryRecords.set(l,m);for(let b of this.stackFileService.entries$.value)if(b instanceof ue&&b.id===l){b.record=m;break}let S=this.selectedEntry$.value;S&&S instanceof ue&&this.checkAckContinueRunning(S,m)})}handleDrop(t){t.previousIndex!==t.currentIndex&&(Gn(this.entries$.value,t.previousIndex,t.currentIndex),this.stackFileService.updateEntries([...this.entries$.value]),this.stackFileService.markDirty())}updateParameterSubscription(){let t=new Set;for(let i of this.stackFileService.entries$.value)if(i.type==="check")for(let a of i.parameters)t.add(a.parameter);else if(i.type==="verify")for(let a of i.condition)t.add(a.parameter);let e=[];t.forEach(i=>e.push({name:i})),this.parameterSubscription.addReplyListener(()=>{this.parameterSubscription.sendMessage({action:"REPLACE",instance:this.yamcs.instance,processor:this.yamcs.processor,abortOnInvalid:!1,sendFromCache:!0,updateOnExpiration:!0,id:e})})}selectEntry(t){this.selectedEntry$.next(t)}deleteSelectedCommands(){let t=this.selectedEntry$.value;if(t){let e=this.entries$.value.indexOf(t);e!==-1&&(this.entries$.value.splice(e,1),this.selectedEntry$.next(null),this.stackFileService.updateEntries([...this.entries$.value]),this.stackFileService.markDirty())}}clearOutputs(){for(let t of this.entries$.value)t.clearOutputs();this.executionCounter=0,this.stackFileService.logs$.next([]),this.stackFileService.updateEntries([...this.entries$.value]),this.entries$.value.length&&this.selectEntry(this.entries$.value[0])}async runSelection(){let t=this.selectedEntry$.value;t&&(this.running$.next(!0),this.runEntry(t))}async runEntry(t){let e=++this.executionCounter,{instance:i,processor:a}=this.yamcs;if(t.clearOutputs(),t instanceof ue){let l=t.namespace??null;return this.yamcs.yamcsClient.issueCommandForNamespace(i,a,l,t.name,{sequenceNumber:e,args:t.args,stream:t.stream,extra:t.extra}).then(m=>{t.executionNumber=e,t.executing=!0,t.id=m.id;let S=`Sending command ${t}`;this.stackFileService.addLogEntry(e,S);let b=this.commandHistoryRecords.get(t.id);b&&(t.record=b,this.checkAckContinueRunning(t,b))}).catch(m=>{t.executionNumber=e,t.executing=!1,t.err=m.message||m,this.stopRun()}).finally(()=>{this.stackFileService.updateEntries([...this.entries$.value])})}else if(t instanceof xe)t.executionNumber=e,t.executing=!0,await this.runVerifyEntry(t);else if(t instanceof De){let l=[];for(let m of t.parameters){let S=this.pvals$.value;l.push({parameter:m.parameter,pval:S[m.parameter]||null})}t.pvals=l,t.executionNumber=e,this.stackFileService.updateEntries([...this.entries$.value]),this.continueRunning(t)}else t instanceof we&&(t.executionNumber=e,this.stackFileService.updateEntries([...this.entries$.value]),this.continueRunning(t))}async runVerifyEntry(t){let e=`Verifying ${t}`;this.stackFileService.addLogEntry(t.executionNumber,e);let i=this.pvals$.pipe();if(t.delay&&t.delay>0&&(i=i.pipe(mn(t.delay))),i=i.pipe(qt(l=>this.testVerifyEntry(t)),pn()),t.timeout&&t.timeout>0){let l=Math.max(0,t.delay||0);i=i.pipe(ln(l+t.timeout))}let a=i.subscribe({next:()=>this.continueRunning(t),error:l=>{l instanceof cn&&(t.executing=!1,t.err=l.message||String(l),this.stopRun())}});this.stepScopedSubscriptions.push(a)}testVerifyEntry(t){let e=t.test(this.pvals$.value);return this.stackFileService.updateEntries([...this.entries$.value]),e}runFromSelection(){let t=this.selectedEntry$.value;if(!t){this.stopRun();return}this.running$.next(!0),this.runningStack=!0,this.nextEntryScheduled=!1,this.runEntry(t)}checkAckContinueRunning(t,e){if(!this.running$.value||this.nextEntryScheduled)return;let{advancement:i}=this.stackFileService,a=t.advancement?.acknowledgment||i.acknowledgment,l=t.advancement?.wait??i.wait;if(t.id===e.id){let m=e.acksByName[a];m&&m.status&&(m.status==="OK"||m.status==="DISABLED"?this.continueRunning(t,l):(m.status==="NOK"||m.status==="CANCELLED")&&(t.executing=!1,this.stopRun()))}}continueRunning(t,e=0){this.nextEntryScheduled=this.runningStack,this.nextCommandDelayTimeout=window.setTimeout(()=>{t.executing=!1,this.running$.value&&(this.advanceSelection(t),this.runningStack?this.runFromSelection():this.stopRun())},Math.max(e,0))}stopRun(){this.clearStepScopedSubscriptions(),this.running$.next(!1),this.runningStack=!1;for(let t of this.stackFileService.entries$.value)if(t.executing=!1,t instanceof xe)for(let e of t.pvals||[])e?.status&&e.status()==="pending"&&e.status.set("cancelled");window.clearTimeout(this.nextCommandDelayTimeout),this.nextEntryScheduled=!1}clearStepScopedSubscriptions(){this.stepScopedSubscriptions.forEach(t=>t.unsubscribe()),this.stepScopedSubscriptions.length=0}advanceSelection(t){let e=this.stackFileService.entries$.value,i=e.indexOf(t);if(i<e.length-1){let a=e[i+1];this.selectEntry(a);let m=this.entryParent.nativeElement.getElementsByClassName("entry")[i+1];this.isVisible(m)||m.scrollIntoView()}else this.selectedEntry$.next(null)}isVisible(t){let e=t.getBoundingClientRect(),i=Math.max(document.documentElement.clientHeight,window.innerHeight);return!(e.bottom<0||e.top-i>=0)}addCheckEntry(){this.dialog.open(Lt,{autoFocus:!1,width:"800px",data:{edit:!1}}).afterClosed().subscribe(t=>{if(t){let e=new De(K({type:"check"},t)),i=this.selectedEntry$.value;if(i){let a=this.entries$.value,l=a.indexOf(i);a.splice(l+1,0,e),this.stackFileService.updateEntries([...this.entries$.value])}else this.stackFileService.updateEntries([...this.entries$.value,e]);this.selectEntry(e),this.stackFileService.markDirty(),this.updateParameterSubscription()}})}addVerifyEntry(){this.dialog.open(Ut,{autoFocus:!1,width:"800px",data:{edit:!1}}).afterClosed().subscribe(t=>{if(t){let e=new xe(K({type:"verify"},t)),i=this.selectedEntry$.value;if(i){let a=this.entries$.value,l=a.indexOf(i);a.splice(l+1,0,e),this.stackFileService.updateEntries([...this.entries$.value])}else this.stackFileService.updateEntries([...this.entries$.value,e]);this.selectEntry(e),this.stackFileService.markDirty(),this.updateParameterSubscription()}})}addCommandEntry(){this.dialog.open(Yt,{width:"70%",height:"100%",autoFocus:!1,position:{right:"0"},panelClass:"dialog-full-size",data:{okLabel:"ADD TO STACK"}}).afterClosed().subscribe(e=>{if(e){let i={type:"command",name:e.command.qualifiedName,args:e.args,comment:e.comment,stream:e.stream,extra:e.extra};e.advancement&&(i.advancement=e.advancement);let a=this.configService.getConfig();if(a.preferredNamespace){for(let S of e.command.alias||[])if(S.namespace===a.preferredNamespace){i.name=S.name,i.namespace=S.namespace;break}}let l=new ue(i);l.command=e.command;let m=this.selectedEntry$.value;if(m){let S=this.entries$.value,b=S.indexOf(m);S.splice(b+1,0,l),this.stackFileService.updateEntries([...this.entries$.value])}else this.stackFileService.updateEntries([...this.entries$.value,l]);this.selectEntry(l),this.stackFileService.markDirty()}})}addTextEntry(){this.dialog.open(Gt,{autoFocus:!1,width:"800px",data:{edit:!1}}).afterClosed().subscribe(t=>{if(t){let e=new we({type:"text",text:t}),i=this.selectedEntry$.value;if(i){let a=this.entries$.value,l=a.indexOf(i);a.splice(l+1,0,e),this.stackFileService.updateEntries([...this.entries$.value])}else this.stackFileService.updateEntries([...this.entries$.value,e]);this.selectEntry(e),this.stackFileService.markDirty()}})}editSelectedEntry(){let t=this.selectedEntry$.value;this.editEntry(t)}editEntry(t){return this.selectEntry(t),t instanceof ue?this.dialog.open(Yt,{width:"70%",height:"100%",autoFocus:!1,position:{right:"0"},panelClass:"dialog-full-size",data:{okLabel:"UPDATE",entry:t}}).afterClosed().subscribe(e=>{if(e){let i={type:"command",name:e.command.qualifiedName,args:e.args,comment:e.comment,stream:e.stream,extra:e.extra,advancement:e.advancement},a=this.configService.getConfig();if(a.preferredNamespace){for(let b of e.command.alias||[])if(b.namespace===a.preferredNamespace){i.name=b.name,i.namespace=b.namespace;break}}let l=new ue(i);l.command=e.command;let m=this.entries$.value,S=m.indexOf(t);m.splice(S,1,l),this.stackFileService.updateEntries([...this.entries$.value]),this.selectEntry(l),this.stackFileService.markDirty()}}):t instanceof De?this.dialog.open(Lt,{autoFocus:!1,width:"800px",data:{edit:!0,entry:t}}).afterClosed().subscribe(e=>{if(e){let i=new De(K({type:"check"},e)),a=this.entries$.value,l=a.indexOf(t);a.splice(l,1,i),this.stackFileService.updateEntries([...this.entries$.value]),this.selectEntry(i),this.stackFileService.markDirty(),this.updateParameterSubscription()}}):t instanceof we?this.dialog.open(Gt,{autoFocus:!1,width:"800px",data:{edit:!0,entry:t}}).afterClosed().subscribe(e=>{if(e){let i=new we({type:"text",text:e}),a=this.entries$.value,l=a.indexOf(t);a.splice(l,1,i),this.stackFileService.updateEntries([...this.entries$.value]),this.selectEntry(i),this.stackFileService.markDirty()}}):t instanceof xe&&this.dialog.open(Ut,{autoFocus:!1,width:"800px",data:{edit:!0,entry:t}}).afterClosed().subscribe(e=>{if(e){let i=new xe(K({type:"verify"},e)),a=this.entries$.value,l=a.indexOf(t);a.splice(l,1,i),this.stackFileService.updateEntries([...this.entries$.value]),this.selectEntry(i),this.stackFileService.markDirty(),this.updateParameterSubscription()}}),!1}cutSelectedEntry(){let t=this.selectedEntry$.value;this.advanceSelection(t),this.clipboardEntry$.next(t);let e=this.entries$.value,i=e.indexOf(t);e.splice(i,1),this.stackFileService.updateEntries([...this.entries$.value]),this.stackFileService.markDirty()}copySelectedEntry(){let t=this.selectedEntry$.value;this.clipboardEntry$.next(t)}pasteEntry(){let t=this.clipboardEntry$.value;if(t){let e=t.copy(),i=this.selectedEntry$.value;if(i){let a=this.entries$.value,l=a.indexOf(i);a.splice(l+1,0,e),this.stackFileService.updateEntries([...this.entries$.value])}else this.stackFileService.updateEntries([...this.entries$.value,e]);this.selectEntry(e),this.stackFileService.markDirty()}}showSchedule(){let t=this.yamcs.connectionInfo$.value?.instance?.capabilities||[];return t.indexOf("timeline")!==-1&&t.indexOf("activities")!==-1&&this.authService.getUser().hasSystemPrivilege("ControlTimeline")}openScheduleStackDialog(){this.dialog.open(Ni,{width:"600px"}).afterClosed().subscribe(t=>{if(t){let e={type:"ACTIVITY",duration:"0s",name:this.filename,start:t.executionTime,tags:t.tags,activityDefinition:{type:"COMMAND_STACK",args:{processor:this.yamcs.processor,bucket:this.bucket,stack:this.filename}}};this.yamcs.yamcsClient.createTimelineItem(this.yamcs.instance,e).then(()=>{this.messageService.showInfo("Stack scheduled")}).catch(i=>this.messageService.showError(i))}})}setExportURLs(){let t=this.entries$.value.map(l=>l.model),e=new Ie(t,{advancement:this.stackFileService.advancement}),i=new Blob([e.toJSON()],{type:"application/json"});this.jsonBlobUrl=this.sanitizer.sanitize(zi.URL,URL.createObjectURL(i));let a=new Blob([e.toXML()],{type:"application/xml"});this.xmlBlobUrl=this.sanitizer.sanitize(zi.URL,URL.createObjectURL(a))}ngOnDestroy(){this.clearStepScopedSubscriptions(),this.parameterSubscription?.cancel(),this.commandSubscription?.cancel()}};Tt.\u0275fac=function(e){return new(e||Tt)(_(Me),_(P),_(ze),_($e),_(ye),_(Ae),_(xn),_(Xn),_(fe))},Tt.\u0275cmp=x({type:Tt,selectors:[["ng-component"]],viewQuery:function(e,i){if(e&1&&ae(Pr,5),e&2){let a;oe(a=re())&&(i.entryParent=a.first)}},inputs:{objectName:"objectName"},decls:86,vars:64,consts:[["addEntryMenu","matMenu"],["exportMenu","matMenu"],["entryParent",""],["ya-instance-toolbar-label",""],["matTooltip","Save stack","icon","save",3,"clicked","disabled"],["matTooltip","Add a step below","icon","add_box","dropdown","true",3,"disabled","matMenuTriggerFor"],[1,"ya-menu"],["mat-menu-item","",3,"click"],["matTooltip","Edit the selected step","icon","edit",3,"clicked","disabled"],["matTooltip","Cut the selected step","icon","content_cut",3,"clicked","disabled"],["matTooltip","Copy the selected step","icon","content_copy",3,"clicked","disabled"],["matTooltip","Paste entry from the clipboard","icon","content_paste",3,"clicked","disabled"],["matTooltip","Run the selected step","icon","play_arrow",3,"clicked","disabled"],["matTooltip","Stop current execution","icon","stop",3,"clicked","disabled"],["matTooltip","Clear all outputs","icon","refresh",3,"clicked","disabled"],["matTooltip","Run all from selected step","icon","playlist_play",3,"clicked","disabled"],["matTooltip","Run stack at a later time","icon","schedule",3,"disabled"],["matTooltip","Export stack","icon","open_in_new",3,"clicked","matMenuTriggerFor","disabled"],["mat-menu-item","",3,"href","download"],[2,"vertical-align","middle"],[2,"color","#cc0000"],[1,"main-pane"],[3,"objectName"],["cdkDropList","",1,"tab-content",3,"cdkDropListDropped"],["id","drag-boundary"],["cdkDrag","","cdkDragBoundary","#drag-boundary",1,"entry",3,"display-text","selected"],["icon","arrow_back",3,"routerLink","queryParams"],["matTooltip","Run stack at a later time","icon","schedule",3,"clicked","disabled"],[2,"vertical-align","bottom","margin-right","10px"],["inline","",2,"vertical-align","bottom"],["cdkDrag","","cdkDragBoundary","#drag-boundary",1,"entry",3,"click","dblclick"],[1,"in"],["cdkDragHandle","",1,"seq"],[1,"body"],[3,"entry","pvals"],[3,"entry"],[1,"comment"],[1,"out"],[1,"title"],[1,"icon14"],[1,"text"],[3,"text"],[1,"seq",3,"click"],[3,"command","inline"],[1,"block"],[2,"padding-right","20px"],[3,"value"]],template:function(e,i){if(e&1){let a=E();o(0,"ya-instance-page")(1,"ya-instance-toolbar"),F(2,Or,3,7,"ng-template",3),o(3,"ya-page-button",4),g(4,"async"),f("clicked",function(){return C(a),y(i.stackFileService.saveStack())}),s(5," Save "),r(),u(6,"ya-vertical-divider"),o(7,"ya-page-button",5),g(8,"async"),s(9," Add step "),r(),o(10,"mat-menu",6,0)(12,"a",7),f("click",function(){return C(a),y(i.addTextEntry())}),o(13,"mat-icon"),s(14,"notes"),r(),s(15," Display text "),r(),u(16,"mat-divider"),o(17,"a",7),f("click",function(){return C(a),y(i.addCheckEntry())}),o(18,"mat-icon"),s(19,"toll"),r(),s(20," List parameters "),r(),o(21,"a",7),f("click",function(){return C(a),y(i.addVerifyEntry())}),o(22,"mat-icon"),s(23,"checklist_rtl"),r(),s(24," Verify parameters "),r(),u(25,"mat-divider"),o(26,"a",7),f("click",function(){return C(a),y(i.addCommandEntry())}),o(27,"mat-icon"),s(28,"rss_feed"),r(),s(29," Send command "),r()(),o(30,"ya-page-icon-button",8),g(31,"async"),g(32,"async"),f("clicked",function(){return C(a),y(i.editSelectedEntry())}),r(),o(33,"ya-page-icon-button",9),g(34,"async"),g(35,"async"),f("clicked",function(){return C(a),y(i.cutSelectedEntry())}),r(),o(36,"ya-page-icon-button",10),g(37,"async"),g(38,"async"),f("clicked",function(){return C(a),y(i.copySelectedEntry())}),r(),o(39,"ya-page-icon-button",11),g(40,"async"),g(41,"async"),f("clicked",function(){return C(a),y(i.pasteEntry())}),r(),u(42,"ya-vertical-divider"),o(43,"ya-page-icon-button",12),g(44,"async"),g(45,"async"),f("clicked",function(){return C(a),y(i.runSelection())}),r(),o(46,"ya-page-icon-button",13),g(47,"async"),f("clicked",function(){return C(a),y(i.stopRun())}),r(),o(48,"ya-page-icon-button",14),g(49,"async"),g(50,"async"),f("clicked",function(){return C(a),y(i.clearOutputs())}),r(),o(51,"ya-page-icon-button",15),g(52,"async"),g(53,"async"),f("clicked",function(){return C(a),y(i.runFromSelection())}),r(),u(54,"ya-vertical-divider"),h(55,Ar,2,1,"ya-page-button",16),u(56,"ya-vertical-divider"),o(57,"ya-page-button",17),f("clicked",function(){return C(a),y(i.setExportURLs())}),s(58," Export "),r(),o(59,"mat-menu",6,1)(61,"a",18),g(62,"basename"),o(63,"mat-icon"),s(64,"data_object"),r(),s(65," YCS FILE "),r(),o(66,"a",18),g(67,"basename"),o(68,"mat-icon"),s(69,"code"),r(),o(70,"span",19),s(71," XML FILE "),o(72,"span",20),s(73,"(legacy)"),r()()()()(),o(74,"div",21)(75,"app-stack-file-page-tabs",22),h(76,Ir,1,0,"ya-dots"),g(77,"async"),r(),h(78,$r,4,0,"ya-empty-message"),h(79,Rr,7,0,"ya-empty-message"),o(80,"div",23,2),f("cdkDropListDropped",function(m){return C(a),y(i.handleDrop(m))}),o(82,"div",24),j(83,ic,14,10,"div",25,R),g(85,"async"),r()()()()}if(e&2){let a=X(11),l=X(60);c(3),p("disabled",!k(4,22,i.stackFileService.dirty$)),c(4),p("disabled",!i.format||k(8,24,i.running$))("matMenuTriggerFor",a),c(23),p("disabled",!i.format||k(31,26,i.running$)||!k(32,28,i.selectedEntry$)),c(3),p("disabled",!i.format||k(34,30,i.running$)||!k(35,32,i.selectedEntry$)),c(3),p("disabled",!i.format||k(37,34,i.running$)||!k(38,36,i.selectedEntry$)),c(3),p("disabled",!i.format||k(40,38,i.running$)||!k(41,40,i.clipboardEntry$)),c(4),p("disabled",!i.format||k(44,42,i.running$)||!k(45,44,i.selectedEntry$)),c(3),p("disabled",!i.format||!k(47,46,i.running$)),c(2),p("disabled",!i.format||k(49,48,i.running$)||!k(50,50,i.hasState$)),c(3),p("disabled",!i.format||k(52,52,i.running$)||!k(53,54,i.selectedEntry$)),c(4),v(i.showSchedule()?55:-1),c(2),p("matMenuTriggerFor",l)("disabled",!i.format),c(4),p("href",i.jsonBlobUrl,$t)("download",k(62,56,i.filename)+".ycs"),c(5),p("href",i.xmlBlobUrl,$t)("download",k(67,58,i.filename)+".xml"),c(9),p("objectName",i.objectName),c(),v(k(77,60,i.running$)?76:-1),c(2),v(i.loaded&&!i.format?78:-1),c(),v(i.loaded&&i.format&&!i.entries$.value.length?79:-1),c(4),B(k(85,62,i.entries$))}},dependencies:[ka,lt,Oi,Ii,$i,Ri,je,Bi,w,ve,Hn,qn,Un,Ce,ai,ti,Ke,ii,Fe,Jn,Ci,Se,ke,it,Re,nt,rt,pa,ba,se,ct],styles:["[_nghost-%COMP%]     h1, [_nghost-%COMP%]     h2, [_nghost-%COMP%]     h3, [_nghost-%COMP%]     h4, [_nghost-%COMP%]     h5, [_nghost-%COMP%]     h6{margin-top:0;line-height:1em}.main-pane[_ngcontent-%COMP%]{position:absolute;inset:0;padding:24px}.tab-content[_ngcontent-%COMP%]{position:absolute;inset:60px 0 0;overflow:auto;padding:24px}.ya-data-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:top}div.entry[_ngcontent-%COMP%]{font-size:12px;line-height:17px;color:#000000a7}div.entry[_ngcontent-%COMP%]   div.in[_ngcontent-%COMP%], div.entry[_ngcontent-%COMP%]   div.out[_ngcontent-%COMP%]{display:flex;border-left:8px solid transparent;margin-bottom:10px}div.entry.selected[_ngcontent-%COMP%]   div.in[_ngcontent-%COMP%], div.entry.selected[_ngcontent-%COMP%]   div.out[_ngcontent-%COMP%]{border-color:var(--y-accent)}div.entry[_ngcontent-%COMP%]   .seq[_ngcontent-%COMP%]{width:64px;text-align:right;padding-top:0;padding-right:10px;user-select:none;-webkit-user-select:none;font-family:Roboto Mono,monospace;color:#bdbdbd}div.entry[_ngcontent-%COMP%]   div.in[_ngcontent-%COMP%]   .seq[_ngcontent-%COMP%]{cursor:move}div.entry.selected[_ngcontent-%COMP%]   .seq[_ngcontent-%COMP%]{color:var(--y-accent)}div.entry[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]{flex-grow:1;padding:5px}div.entry.display-text[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]{padding:0}div.entry[_ngcontent-%COMP%]   div.in[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]{background-color:#fafafa;border:1px solid rgb(224,224,224);font-family:Roboto Mono,monospace}div.entry.display-text[_ngcontent-%COMP%]   div.in[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]{background-color:inherit;border-color:transparent}div.entry[_ngcontent-%COMP%]   div.out[_ngcontent-%COMP%]   .body.err[_ngcontent-%COMP%]{background-color:#fcc;color:var(--y-error-color)}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:.6}.comment[_ngcontent-%COMP%]{margin-top:1em;margin-left:5px;border-left:5px solid rgb(224,224,224);padding:1em}.comment[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:flex;align-items:center;font-weight:500}.comment[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .display-text[_ngcontent-%COMP%]{margin-left:5px}.block[_ngcontent-%COMP%]{font-weight:400;font-size:12px;color:#000000a7}"],changeDetection:0});var Li=Tt;var nc=["filename"],Pt=class Pt{constructor(t,e,i,a,l){this.dialogRef=t;this.data=l;this.bucket=a.getStackBucket(),this.storageClient=i.createStorageClient(),this.filenameForm=e.group({name:["",[L.required]],format:["ycs",[L.required]]})}save(){let t=this.filenameForm.get("format").value,e=this.filenameForm.get("name").value.trim()+"."+t,i=this.data.path;i.startsWith("/")&&(i=i.substring(1));let a=i?i+"/"+e:e,l=this.data.prefix+a,m=t==="xml"?new Ie([],{}).toXML():new Ie([],{}).toJSON(),S=t==="xml"?"application/xml":"application/json",b=new Blob([m],{type:S});this.storageClient.uploadObject(this.bucket,l,b).then(()=>{this.dialogRef.close(a)})}};Pt.\u0275fac=function(e){return new(e||Pt)(_(H),_(pe),_(P),_(ye),_(ie))},Pt.\u0275cmp=x({type:Pt,selectors:[["app-create-stack-dialog"]],viewQuery:function(e,i){if(e&1&&ae(nc,5),e&2){let a;oe(a=re())&&(i.filenameInput=a.first)}},decls:18,vars:4,consts:[["filename",""],["mat-dialog-title",""],[1,"ya-form",3,"formGroup"],["label","Name"],["type","text","formControlName","name"],["label","Format"],["formControlName","format"],["value","ycs"],["value","xml"],["align","end"],["mat-dialog-close",""],["appearance","primary",3,"click","disabled"]],template:function(e,i){if(e&1){let a=E();o(0,"h2",1),s(1,"Create stack"),r(),o(2,"mat-dialog-content")(3,"form",2)(4,"ya-field",3),u(5,"input",4,0),r(),o(7,"ya-field",5)(8,"select",6)(9,"option",7),s(10,"YCS"),r(),o(11,"option",8),s(12,"XML (deprecated)"),r()()()()(),o(13,"mat-dialog-actions",9)(14,"ya-button",10),s(15,"CANCEL"),r(),o(16,"ya-button",11),f("click",function(){return C(a),y(i.save())}),s(17,"SAVE"),r()()}if(e&2){let a;c(3),p("formGroup",i.filenameForm),c(),te("invalid",(a=i.filenameForm.get("name"))==null?null:a.invalid),c(12),p("disabled",!i.filenameForm.valid)}},dependencies:[w,G,An,In,ge,On,I,Y,U,q,W,ne,Z,J,T,ee],encapsulation:2});var Yi=Pt;var Vt=class Vt{constructor(t,e,i,a){this.dialogRef=t;this.data=a;this.storageClient=i.createStorageClient(),this.form=e.group({name:["",L.required]})}save(){let{path:t,bucket:e}=this.data;t.startsWith("/")&&(t=t.substring(1));let i=this.form.value.name,a=t?`${t}/${i}/`:`${i}/`;this.storageClient.uploadObject(e,a,new Blob).then(()=>this.dialogRef.close(!0))}};Vt.\u0275fac=function(e){return new(e||Vt)(_(H),_(pe),_(P),_(ie))},Vt.\u0275cmp=x({type:Vt,selectors:[["app-create-stack-folder-dialog"]],decls:11,vars:2,consts:[["mat-dialog-title",""],[1,"ya-form",3,"formGroup"],["label","Folder name"],["type","text","formControlName","name","pattern","\\w[\\w\\s\\.\\-\\(\\)\\[\\]]*"],["align","end"],["mat-dialog-close",""],["appearance","primary",3,"click","disabled"]],template:function(e,i){e&1&&(o(0,"h2",0),s(1,"Create folder"),r(),o(2,"mat-dialog-content")(3,"form",1)(4,"ya-field",2),u(5,"input",3),r()()(),o(6,"mat-dialog-actions",4)(7,"ya-button",5),s(8,"CANCEL"),r(),o(9,"ya-button",6),f("click",function(){return i.save()}),s(10,"CREATE"),r()()),e&2&&(c(3),p("formGroup",i.form),c(6),p("disabled",!i.form.valid))},dependencies:[w,G,ge,I,Y,Rn,U,q,W,ne,Z,J,T,ee],encapsulation:2,changeDetection:0});var Gi=Vt;var Nt=class Nt{constructor(t,e,i,a,l){this.dialogRef=t;this.data=l;this.storageClient=i.createStorageClient(),this.bucket=a.getStackBucket();let m=le.getBasename(le.getFilename(this.data.name));this.filenameForm=e.group({name:[m,[L.required]]})}async rename(){let t,e=this.data.name.lastIndexOf("/");e!==-1&&(t=this.data.name.substring(0,e+1));let a=await(await this.storageClient.getObject(this.bucket,this.data.name)).blob(),l=le.getExtension(le.getFilename(this.data.name))?.toLowerCase(),m=(t||"")+this.filenameForm.get("name").value+(l?"."+l:"");m!==this.data.name&&(await this.storageClient.uploadObject(this.bucket,m,a),await this.storageClient.deleteObject(this.bucket,this.data.name)),this.dialogRef.close(m)}};Nt.\u0275fac=function(e){return new(e||Nt)(_(H),_(pe),_(P),_(ye),_(ie))},Nt.\u0275cmp=x({type:Nt,selectors:[["app-rename-stack-dialog"]],decls:12,vars:4,consts:[["filename",""],["mat-dialog-title",""],[1,"ya-form",3,"formGroup"],["label","Name"],["type","text","formControlName","name"],["align","end"],["mat-dialog-close",""],["appearance","primary",3,"click","disabled"]],template:function(e,i){if(e&1){let a=E();o(0,"h2",1),s(1,"Rename stack"),r(),o(2,"mat-dialog-content")(3,"form",2)(4,"ya-field",3),u(5,"input",4,0),r()()(),o(7,"mat-dialog-actions",5)(8,"ya-button",6),s(9,"CANCEL"),r(),o(10,"ya-button",7),f("click",function(){return C(a),y(i.rename())}),s(11," RENAME "),r()()}if(e&2){let a;c(3),p("formGroup",i.filenameForm),c(),te("invalid",(a=i.filenameForm.get("name"))==null?null:a.invalid),c(6),p("disabled",!i.filenameForm.valid)}},dependencies:[w,G,ge,I,Y,U,q,W,ne,Z,J,T,ee],encapsulation:2});var Ui=Nt;var ac=["droparea"],oc=["uploader"],Hi=n=>({c:n});function rc(n,t){if(n&1){let e=E();o(0,"ya-page-button",11),f("clicked",function(){C(e);let a=d();return y(a.createStack())}),s(1,"Create stack"),r()}}function cc(n,t){if(n&1){let e=E();o(0,"ya-page-button",12),f("clicked",function(){C(e);let a=d();return y(a.openUploadDialog())}),s(1," Upload stack "),o(2,"input",13,1),f("change",function(){C(e);let a=d();return y(a.importStack())}),r()()}}function lc(n,t){if(n&1){let e=E();o(0,"ya-page-button",14),f("clicked",function(){C(e);let a=d();return y(a.createFolder())}),s(1," Create folder "),r()}}function sc(n,t){if(n&1){let e=E();o(0,"ya-page-button",15),f("clicked",function(){C(e);let a=d();return y(a.deleteSelectedStacks())}),s(1," Delete "),r()}if(n&2){let e=d();p("disabled",!e.selection.hasValue())}}function mc(n,t){if(n&1&&u(0,"ya-breadcrumb",17),n&2){let e=t.$implicit,i=d(3);p("link",e.route)("queryParams",ce(3,Hi,i.yamcs.context))("label",e.name)}}function pc(n,t){if(n&1&&(o(0,"ya-breadcrumb-trail"),u(1,"ya-breadcrumb",16),j(2,mc,1,5,"ya-breadcrumb",17,R),r()),n&2){let e=d(),i=d();c(),p("queryParams",ce(1,Hi,i.yamcs.context)),c(),B(e)}}function dc(n,t){n&1&&h(0,pc,4,3,"ya-breadcrumb-trail"),n&2&&v(t.length?0:-1)}function uc(n,t){if(n&1){let e=E();o(0,"th",33),f("click",function(a){return C(e),X(2).toggle(),y(a.stopPropagation())}),u(1,"ya-table-checkbox",34,2),r()}if(n&2){let e=d(2);c(),p("dataSource",e.dataSource)("selection",e.selection)}}function fc(n,t){if(n&1){let e=E();o(0,"td",35),f("click",function(a){return C(e),X(2).toggle(),y(a.stopPropagation())}),u(1,"ya-table-checkbox",36,2),r()}if(n&2){let e=t.$implicit,i=d(2);c(),p("dataSource",i.dataSource)("selection",i.selection)("item",e)}}function _c(n,t){n&1&&(o(0,"th",37),s(1,"Name"),r())}function gc(n,t){if(n&1){let e=E();o(0,"mat-icon",39),s(1," folder "),r(),o(2,"a",40),f("click",function(a){return C(e),y(a.stopPropagation())}),s(3),g(4,"filename"),r()}if(n&2){let e=d().$implicit,i=d(2);c(2),p("routerLink","/procedures/stacks/browse/"+e.name)("queryParams",ce(5,Hi,i.yamcs.context)),c(),D(" ",k(4,3,e.name)," ")}}function Cc(n,t){if(n&1){let e=E();o(0,"mat-icon",39),s(1," description "),r(),o(2,"a",41),g(3,"filename"),f("click",function(a){return C(e),y(a.stopPropagation())}),s(4),g(5,"filename"),r()}if(n&2){let e=d().$implicit,i=d(2);c(2),p("routerLink","/procedures/stacks/files/"+e.name)("queryParams",ce(8,Hi,i.yamcs.context))("title",k(3,4,e.name)),c(2),D(" ",k(5,6,e.name)," ")}}function yc(n,t){if(n&1&&(o(0,"td",38),h(1,gc,5,7)(2,Cc,6,10),r()),n&2){let e=t.$implicit;c(),v(e.folder?1:2)}}function hc(n,t){n&1&&(o(0,"th",37),s(1,"Visibility"),r())}function vc(n,t){n&1&&(o(0,"td",38),s(1,"Private"),r())}function Sc(n,t){n&1&&(o(0,"th",37),s(1,"Date modified"),r())}function kc(n,t){if(n&1&&(o(0,"td",38),s(1),g(2,"datetime"),r()),n&2){let e=t.$implicit;c(),D(" ",k(2,1,e.modified)||"-"," ")}}function bc(n,t){n&1&&u(0,"th",42)}function xc(n,t){if(n&1){let e=E();o(0,"ya-more")(1,"button",43),f("click",function(){C(e);let a=d().$implicit,l=d(2);return y(l.renameFile(a))}),s(2,"Rename"),r(),o(3,"a",44),s(4,"Download"),r(),u(5,"mat-divider"),o(6,"button",43),f("click",function(){C(e);let a=d().$implicit,l=d(2);return y(l.deleteFile(a))}),s(7,"Delete"),r()()}if(n&2){let e=d().$implicit;c(3),p("href",e.objectUrl,$t)}}function wc(n,t){if(n&1&&(o(0,"td",38),h(1,xc,8,1,"ya-more"),r()),n&2){let e=t.$implicit,i=d(2);c(),v(!e.folder&&i.mayManageStacks()?1:-1)}}function Ec(n,t){n&1&&u(0,"th",37)}function Dc(n,t){n&1&&u(0,"span")}function Fc(n,t){n&1&&u(0,"span")}function Mc(n,t){if(n&1&&(o(0,"span"),s(1),g(2,"filename"),g(3,"extension"),r()),n&2){let e=d(2).$implicit;c(),D("Unsupported format '",k(3,3,k(2,1,e.name)),"'")}}function Tc(n,t){if(n&1&&(o(0,"span"),h(1,Dc,1,0,"span"),g(2,"filename"),g(3,"extension"),g(4,"lowercase"),Wt(5,Fc,1,0,"span")(6,Mc,4,5,"span"),r()),n&2){let e,i=d().$implicit;c(),v((e=k(4,5,k(3,3,k(2,1,i.name))))==="xml"?1:e==="ycs"?5:6)}}function Pc(n,t){if(n&1&&(o(0,"td",45),h(1,Tc,7,7,"span"),r()),n&2){let e=t.$implicit;c(),v(e.folder?-1:1)}}function Vc(n,t){n&1&&u(0,"tr",46)}function Nc(n,t){if(n&1){let e=E();o(0,"tr",47),f("click",function(){let a=C(e).$implicit,l=d(2);return y(l.toggleOne(a))}),r()}if(n&2){let e=t.$implicit,i=d(2);te("selected",i.selection.isSelected(e))}}function Oc(n,t){if(n&1&&(o(0,"table",10),O(1,18),F(2,uc,3,2,"th",19)(3,fc,3,3,"td",20),A(),O(4,21),F(5,_c,2,0,"th",22)(6,yc,3,1,"td",23),A(),O(7,24),F(8,hc,2,0,"th",22)(9,vc,2,0,"td",23),A(),O(10,25),F(11,Sc,2,0,"th",22)(12,kc,3,3,"td",23),A(),O(13,26),F(14,bc,1,0,"th",27)(15,wc,2,1,"td",28),A(),O(16,29),F(17,Ec,1,0,"th",22)(18,Pc,2,1,"td",30),A(),F(19,Vc,1,0,"tr",31)(20,Nc,1,2,"tr",32),r()),n&2){let e=d();p("dataSource",e.dataSource),c(19),p("cdkHeaderRowDef",e.displayedColumns()),c(),p("cdkRowDefColumns",e.displayedColumns())}}function Ac(n,t){n&1&&(o(0,"ya-empty-message"),s(1,"Empty directory."),r())}function Ic(n,t){if(n&1){let e=E();o(0,"p")(1,"ya-button",49),f("click",function(){C(e);let a=d(4);return y(a.createStack())}),s(2,"Create a stack"),r(),s(3," or "),o(4,"ya-button",50),f("click",function(){C(e);let a=d(4);return y(a.openUploadDialog())}),s(5,"Import a stack"),r()()}}function $c(n,t){if(n&1&&(o(0,"ya-empty-message",48)(1,"p"),s(2," Stacks are used to interactively execute a prepared set of steps. To start, either: "),r(),h(3,Ic,6,0,"p"),r()),n&2){let e=d(3);c(3),v(e.mayManageStacks()?3:-1)}}function Rc(n,t){if(n&1&&(h(0,Ac,2,0,"ya-empty-message"),h(1,$c,4,1,"ya-empty-message",48)),n&2){let e=t,i=d(2);v(i.loaded&&e.length?0:-1),c(),v(i.loaded&&!e.length?1:-1)}}function jc(n,t){if(n&1&&(h(0,Rc,2,2),g(1,"async")),n&2){let e,i=d();v((e=k(1,1,i.breadcrumb$))?0:-1,e)}}var Ot=class Ot{constructor(t,e,i,a,l,m,S,b){this.dialog=t;this.yamcs=e;this.router=a;this.route=l;this.authService=m;this.messageService=S;this.configService=b;this.breadcrumb$=new N([]);this.dragActive$=new N(!1);this.displayedColumns=Le(["name","modified","actions","formatWarning"]);this.dataSource=new Je([]);this.selection=new oi(!0,[]);this.loaded=!1;this.converting=!1;i.setTitle("Stacks"),this.storageClient=e.createStorageClient(),this.bucket=b.getStackBucket(),this.loadCurrentFolder(),this.routerSubscription=a.events.pipe(qt(z=>z instanceof En)).subscribe(()=>{this.loadCurrentFolder()}),this.mayManageStacks()&&this.displayedColumns.set(["select",...this.displayedColumns()])}loadCurrentFolder(){let t={delimiter:"/"},e=this.route.snapshot.url;e.length&&(t.prefix=e.map(i=>i.path).join("/")+"/"),this.storageClient.listObjects(this.bucket,t).then(i=>{this.updateBrowsePath(),this.changedir(i),this.loaded=!0})}changedir(t){this.selection.clear();let e=[];for(let i of t.prefixes||[])e.push({folder:!0,name:i});for(let i of t.objects||[])i.name.endsWith("/")||e.push({folder:!1,name:i.name,modified:i.created,objectUrl:this.storageClient.getObjectURL(this.bucket,i.name)});this.dataSource.data=e}toggleOne(t){(!this.selection.isSelected(t)||this.selection.selected.length>1)&&this.selection.clear(),this.selection.toggle(t)}createStack(){this.dialog.open(Yi,{width:"400px",data:{path:this.getCurrentPath(),prefix:""}}).afterClosed().subscribe(e=>{e&&this.router.navigateByUrl(`/procedures/stacks/files/${e}?c=${this.yamcs.context}`)})}createFolder(){this.dialog.open(Gi,{width:"400px",data:{bucket:this.bucket,path:this.getCurrentPath()}}).afterClosed().subscribe({next:()=>this.loadCurrentFolder()})}openUploadDialog(){this.uploaderEl.nativeElement.click()}importStack(){let t=this.getCurrentPath();t.startsWith("/")&&(t=t.substring(1));let e=this.uploaderEl.nativeElement.files,i=[];for(let a in e)if(!isNaN(parseInt(a,10))){let l=e[a],b=""+(t?t+"/"+l.name:l.name),z=this.storageClient.uploadObject(this.bucket,b,l);i.push(z)}Promise.all(i).then(()=>this.loadCurrentFolder()).catch(a=>this.messageService.showError(a))}getCurrentPath(){let t="";for(let e of this.route.snapshot.url)t+="/"+e.path;return t||"/"}deleteSelectedStacks(){let t=[],e=[];for(let i of this.selection.selected)i.folder?e.push(this.storageClient.listObjects(this.bucket,{prefix:i.name}).then(a=>{let l=a.objects||[];t.push(...l.map(m=>m.name))})):t.push(i.name);Promise.all(e).then(()=>{if(confirm(`You are about to delete ${t.length} files. Are you sure you want to continue?`)){let i=[];for(let a of t)i.push(this.storageClient.deleteObject(this.bucket,a));Promise.all(i).then(()=>{this.loadCurrentFolder()})}})}renameFile(t){this.dialog.open(Ui,{data:{name:t.name},width:"400px"}).afterClosed().subscribe(i=>{i&&this.loadCurrentFolder()})}deleteFile(t){confirm(`Are you sure you want to delete ${t.name}?`)&&this.storageClient.deleteObject(this.bucket,t.name).then(()=>{this.loadCurrentFolder()})}dragEnter(t){return this.dragActive$.next(!0),t.preventDefault(),t.stopPropagation(),!1}dragOver(t){return t.preventDefault(),t.stopPropagation(),!1}dragLeave(t){return this.dragActive$.next(!1),t.preventDefault(),t.stopPropagation(),!1}drop(t){let e=t.dataTransfer||{};if(e){let i=this.getCurrentPath().substring(1);i!==""&&(i+="/"),va(e).then(a=>{let l=[];for(let m of a){let S=i+m._fullPath,b=this.storageClient.uploadObject(this.bucket,S,m);l.push(b)}Promise.all(l).finally(()=>{this.loadCurrentFolder()})})}return this.dragActive$.next(!1),t.preventDefault(),t.stopPropagation(),!1}mayManageStacks(){let t=this.authService.getUser();return t.hasObjectPrivilege("ManageBucket",this.bucket)||t.hasSystemPrivilege("ManageAnyBucket")}updateBrowsePath(){let t=[],e="";for(let i of this.route.snapshot.url)e+="/"+i.path,t.push({name:i.path,route:"/procedures/stacks/browse"+e});return this.breadcrumb$.next(t),e||"/"}ngOnDestroy(){this.routerSubscription?.unsubscribe()}};Ot.\u0275fac=function(e){return new(e||Ot)(_(Me),_(P),_(ze),_(Xt),_(Dn),_($e),_(Ae),_(ye))},Ot.\u0275cmp=x({type:Ot,selectors:[["ng-component"]],viewQuery:function(e,i){if(e&1&&(ae(ac,7),ae(oc,5)),e&2){let a;oe(a=re())&&(i.dropArea=a.first),oe(a=re())&&(i.uploaderEl=a.first)}},decls:16,vars:16,consts:[["droparea",""],["uploader",""],["cb",""],["label","Stacks"],["icon","add_box"],["icon","file_upload"],["icon","create_new_folder"],["icon","delete",3,"disabled"],[1,"droparea",3,"dragenter"],[1,"droparea-overlay",3,"dragover","dragleave","drop"],["mat-table","",1,"ya-data-table","expand",3,"dataSource"],["icon","add_box",3,"clicked"],["icon","file_upload",3,"clicked"],["type","file","hidden","","accept",".xml,.ycs","multiple","",3,"change"],["icon","create_new_folder",3,"clicked"],["icon","delete",3,"clicked","disabled"],["link","/procedures/stacks/browse","icon","account_tree",3,"queryParams"],[3,"link","queryParams","label"],["cdkColumnDef","select"],["mat-header-cell","","class","checkbox",3,"click",4,"cdkHeaderCellDef"],["mat-cell","","class","checkbox",3,"click",4,"cdkCellDef"],["cdkColumnDef","name"],["mat-header-cell","",4,"cdkHeaderCellDef"],["mat-cell","",4,"cdkCellDef"],["cdkColumnDef","visibility"],["cdkColumnDef","modified"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["cdkColumnDef","formatWarning"],["mat-cell","","style","text-align: right",4,"cdkCellDef"],["mat-header-row","",4,"cdkHeaderRowDef"],["mat-row","",3,"selected","click",4,"cdkRowDef","cdkRowDefColumns"],["mat-header-cell","",1,"checkbox",3,"click"],[3,"dataSource","selection"],["mat-cell","",1,"checkbox",3,"click"],[3,"dataSource","selection","item"],["mat-header-cell",""],["mat-cell",""],[1,"icon12",2,"vertical-align","middle","margin-right","7px"],[3,"click","routerLink","queryParams"],[3,"click","routerLink","queryParams","title"],["mat-header-cell","",1,"expand"],["mat-menu-item","",3,"click"],["mat-menu-item","","download","",3,"href"],["mat-cell","",2,"text-align","right"],["mat-header-row",""],["mat-row","",3,"click"],["headerTitle","Stacks"],["appearance","primary",3,"click"],[3,"click"]],template:function(e,i){if(e&1){let a=E();o(0,"ya-instance-page")(1,"ya-instance-toolbar",3),h(2,rc,2,0,"ya-page-button",4),h(3,cc,4,0,"ya-page-button",5),h(4,lc,2,0,"ya-page-button",6),h(5,sc,2,1,"ya-page-button",7),r(),o(6,"div",8,0),g(8,"async"),f("dragenter",function(m){return C(a),y(i.dragEnter(m))}),o(9,"div",9),g(10,"async"),f("dragover",function(m){return C(a),y(i.dragOver(m))})("dragleave",function(m){return C(a),y(i.dragLeave(m))})("drop",function(m){return C(a),y(i.drop(m))}),r(),o(11,"ya-panel"),h(12,dc,1,1),g(13,"async"),h(14,Oc,21,3,"table",10)(15,jc,2,3),r()()()}if(e&2){let a;c(2),v(i.mayManageStacks()?2:-1),c(),v(i.mayManageStacks()?3:-1),c(),v(i.mayManageStacks()?4:-1),c(),v(i.mayManageStacks()?5:-1),c(),te("active",k(8,10,i.dragActive$)),c(3),te("hide",!k(10,12,i.dragActive$)),c(3),v((a=k(13,14,i.breadcrumb$))?12:-1,a),c(2),v(i.dataSource&&i.dataSource.data.length?14:15)}},dependencies:[w,ve,Qn,ri,ci,li,Wn,Ce,ai,Ke,Te,mi,Ve,Pe,pi,Ne,di,Oe,fi,ui,T,Ci,Se,ke,na,Re,ra,ma,se,Sn,hi,ua,Si],styles:[".droparea[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;overflow:auto}.droparea-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;box-sizing:border-box;background:#1b61b91a;border:1px solid rgba(27,97,185,1);z-index:10}table[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}"],changeDetection:0});var qi=Ot;var At=class At{};At.\u0275fac=function(e){return new(e||At)},At.\u0275cmp=x({type:At,selectors:[["app-stacks-page"]],decls:1,vars:0,template:function(e,i){e&1&&u(0,"router-outlet")},dependencies:[Fn],encapsulation:2,changeDetection:0});var Wi=At;var Bc=n=>{let t=n,e=n.findIndex(a=>a.path==="-");e!==-1&&(t=n.slice(0,e));let i=t.map(a=>a.path).join("/");return{consumed:t,posParams:{objectName:new wn(i,{})}}},w0=[{path:"",canActivate:[Ji,Xi],canActivateChild:[Zi],runGuardsAndResolvers:"always",component:ha,children:[{path:"stacks",pathMatch:"full",redirectTo:"stacks/browse"},{path:"stacks/browse",component:Wi,children:[{path:"**",component:qi}]},{path:"stacks/files",children:[{matcher:Bc,providers:[Bt,fe],canActivate:[fe],canDeactivate:[Aa],children:[{path:"",pathMatch:"full",component:Li},{path:"-/log",component:Fi},{path:"-/settings",component:Mi}]}]},{path:"script",pathMatch:"full",component:wi},{path:"ext",canActivate:[Ji,Xi],canActivateChild:[Zi],runGuardsAndResolvers:"always",children:[{matcher:Ca,component:ga}]}]}];export{w0 as ROUTES};
