import{a as Dn}from"./chunk-VXDZPIOB.js";import{a as so}from"./chunk-SIU2FQZX.js";import{a as er}from"./chunk-6SSGZHTV.js";import{e as Qe,f as Hi,g as Xe,h as wn,i as Jo,j as Ko,k as Zo,l as Tn}from"./chunk-GVFSCYYF.js";import{a as Ho,b as Xo}from"./chunk-L67MW52F.js";import{$f as de,Aa as G,Ab as ln,Af as Go,Bc as Vo,Bf as L,Bg as $t,Ca as C,Cb as ae,Cc as M,Cf as pt,Dc as fe,De as $e,Df as yn,Dg as ft,Dh as jt,Ea as f,Ec as mn,F as v,Fc as V,Fh as b,G as S,Gb as tt,Gh as Wo,Hg as zo,Hh as Qo,Ia as Ee,Ib as Se,If as le,Ja as Me,Jb as ee,Jc as Fo,Je as it,Jf as Yo,K as vt,Ka as Pe,Kc as Ie,Ke as nt,Kf as F,Kg as Sn,La as St,Lf as qo,Lg as ht,Ma as To,Me as ot,Mg as gt,Na as X,Ne as Oo,Ng as zt,Oa as tn,Oc as ke,P as en,Pa as re,Pc as pe,Pe as Ao,Qf as _n,Ra as l,Rc as cn,Rf as dt,Rg as je,Sa as we,Sg as xn,Ta as A,Tc as Ve,U as wo,Ua as Do,Uc as pn,Ug as ue,V as m,Wa as nn,Wc as dn,We as Fe,Xa as Eo,Xc as un,Xe as Nt,Xf as Yt,Y as u,Ya as on,Ye as rt,Za as O,Zc as No,Ze as Rt,_,_a as Mo,_e as Ot,a as Ae,ad as Ro,af as At,bb as T,bf as at,bg as R,ca as et,cb as B,cd as Bt,da as $,db as rn,dd as It,df as lt,dh as jo,ec as sn,ef as Lt,eg as $o,f as U,gf as Gt,gg as Ne,hf as st,jb as xt,jf as mt,jg as bn,ka as x,kb as Be,kc as Io,kf as We,kg as H,lf as J,lg as qt,ma as w,mc as ko,mf as Lo,mg as ze,n as So,na as ge,ne as Ge,nf as ct,oa as me,ob as Et,oc as k,oe as Ye,og as ut,pa as ce,pe as fn,pg as W,qa as p,qc as g,qe,qh as Uo,ra as r,re as kt,rg as vn,sa as o,sb as ne,sc as I,se as Vt,ta as c,tb as Po,tc as D,te as Ft,ua as De,ub as an,ue as hn,va as Le,wa as Ui,wc as Mt,xa as K,xb as Bo,xc as Pt,y as xo,ya as Z,yc as E,ye as gn,zc as Ce,ze as Cn}from"./chunk-OXOWQRWE.js";function wt(a,t,e){let i=Ro(a,e?.in);return i.setTime(i.getTime()+t*No),i}var ir=a=>({c:a}),hr=()=>[];function gr(a,t){if(a&1){let e=G();r(0,"th",21),C("click",function(n){return v(e),X(2).toggle(),S(n.stopPropagation())}),c(1,"ya-table-checkbox",22,0),o()}if(a&2){let e=f(2);m(),p("dataSource",e.dataSource)("selection",e.selection)}}function Cr(a,t){if(a&1){let e=G();r(0,"td",23),C("click",function(n){return v(e),X(2).toggle(),S(n.stopPropagation())}),c(1,"ya-table-checkbox",24,0),o()}if(a&2){let e=t.$implicit,i=f(2);m(),p("dataSource",i.dataSource)("selection",i.selection)("item",e)}}function yr(a,t){a&1&&(r(0,"th",25),l(1,"Label"),o())}function _r(a,t){if(a&1&&l(0),a&2){let e=f().$implicit;A(" ",e.name," ")}}function br(a,t){a&1&&(r(0,"i"),l(1,"(none)"),o())}function vr(a,t){if(a&1&&(r(0,"td",26)(1,"a",27),x(2,_r,1,1),x(3,br,2,0,"i"),o()()),a&2){let e=t.$implicit,i=f(2);m(),p("routerLink",e.id)("queryParams",O(4,ir,i.yamcs.context)),m(),w(e.name?2:-1),m(),w(e.name?-1:3)}}function Sr(a,t){a&1&&(r(0,"th",28),l(1,"Description"),o())}function xr(a,t){if(a&1&&(r(0,"td",26),l(1),o()),a&2){let e=t.$implicit;m(),A(" ",e.description||"-"," ")}}function wr(a,t){a&1&&(r(0,"th",29),l(1,"Tags"),o())}function Tr(a,t){if(a&1&&(r(0,"ya-label"),l(1),o()),a&2){let e=t.$implicit;m(),we(e)}}function Dr(a,t){a&1&&l(0," - ")}function Er(a,t){if(a&1&&(r(0,"td",26),me(1,Tr,2,1,"ya-label",null,ge),x(3,Dr,1,0),o()),a&2){let e=t.$implicit;m(),ce(e.tags||on(1,hr)),m(2),w(e.tags?-1:3)}}function Mr(a,t){a&1&&(r(0,"th",25),l(1,"Type"),o())}function Pr(a,t){if(a&1&&(r(0,"td",26),l(1),o()),a&2){let e=t.$implicit;m(),A(" ",e.type," ")}}function Br(a,t){a&1&&c(0,"th",30)}function Ir(a,t){a&1&&c(0,"td",26)}function kr(a,t){a&1&&c(0,"tr",31)}function Vr(a,t){if(a&1){let e=G();r(0,"tr",32),C("click",function(){let n=v(e).$implicit,s=f(2);return S(s.toggleOne(n))}),o()}if(a&2){let e=t.$implicit,i=f(2);re("selected",i.selection.isSelected(e))}}function Fr(a,t){if(a&1&&(r(0,"table",4),K(1,5),$(2,gr,3,2,"th",6)(3,Cr,3,3,"td",7),Z(),K(4,8),$(5,yr,2,0,"th",9)(6,vr,4,6,"td",10),Z(),K(7,11),$(8,Sr,2,0,"th",12)(9,xr,2,1,"td",10),Z(),K(10,13),$(11,wr,2,0,"th",14)(12,Er,4,2,"td",15),Z(),K(13,16),$(14,Mr,2,0,"th",9)(15,Pr,2,1,"td",10),Z(),K(16,17),$(17,Br,1,0,"th",18)(18,Ir,1,0,"td",10),Z(),$(19,kr,1,0,"tr",19)(20,Vr,1,2,"tr",20),o()),a&2){let e=f();p("dataSource",e.dataSource)("trackBy",e.tableTrackerFn),m(19),p("matHeaderRowDef",e.displayedColumns),m(),p("matRowDefColumns",e.displayedColumns)}}var Ut=class Ut{constructor(t,e,i){this.yamcs=t;this.messageService=i;this.displayedColumns=["select","name","description","tags","type","actions"];this.tableTrackerFn=(t,e)=>e.id;this.dataSource=new We;this.selection=new jt(this.tableTrackerFn,!0,[]);e.setTitle("Timeline Bands"),this.refreshData()}ngAfterViewInit(){this.dataSource.sort=this.sort}toggleOne(t){(!this.selection.isSelected(t)||this.selection.selected.length>1)&&this.selection.clear(),this.selection.toggle(t)}deleteSelectedBands(){if(confirm("Are you sure you want to delete the selected bands?"))for(let t of this.selection.selected)this.deleteBand(t.id,!1)}deleteBand(t,e=!0){(!e||confirm("Are you sure you want to delete the selected band?"))&&this.yamcs.yamcsClient.deleteTimelineBand(this.yamcs.instance,t).then(()=>this.refreshData()).catch(i=>this.messageService.showError(i))}isGroupDeleteEnabled(){return!this.selection.isEmpty()}refreshData(){this.yamcs.yamcsClient.getTimelineBands(this.yamcs.instance).then(t=>{this.selection.matchNewValues(t.bands||[]),this.dataSource.data=t.bands||[]}).catch(t=>this.messageService.showError(t))}};Ut.\u0275fac=function(e){return new(e||Ut)(u(F),u(ae),u(J))},Ut.\u0275cmp=_({type:Ut,selectors:[["ng-component"]],viewQuery:function(e,i){if(e&1&&Ee(Fe,5),e&2){let n;Me(n=Pe())&&(i.sort=n.first)}},decls:8,vars:5,consts:[["cb",""],["label","Bands"],["routerLink","create","icon","add_box",3,"queryParams"],["icon","close",3,"clicked","disabled"],["mat-table","","matSort","","matSortActive","name","matSortDirection","asc","matSortDisableClear","",1,"ya-data-table","expand",3,"dataSource","trackBy"],["cdkColumnDef","select"],["mat-header-cell","","class","checkbox",3,"click",4,"cdkHeaderCellDef"],["mat-cell","","class","checkbox",3,"click",4,"cdkCellDef"],["matColumnDef","name"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","description"],["mat-header-cell","","class","wrap200",4,"matHeaderCellDef"],["cdkColumnDef","tags"],["mat-header-cell","",4,"cdkHeaderCellDef"],["mat-cell","",4,"cdkCellDef"],["matColumnDef","type"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"selected","click",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",1,"checkbox",3,"click"],[3,"dataSource","selection"],["mat-cell","",1,"checkbox",3,"click"],[3,"dataSource","selection","item"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[3,"routerLink","queryParams"],["mat-header-cell","",1,"wrap200"],["mat-header-cell",""],["mat-header-cell","",1,"expand"],["mat-header-row",""],["mat-row","",3,"click"]],template:function(e,i){e&1&&(r(0,"ya-instance-page")(1,"ya-instance-toolbar",1)(2,"ya-page-button",2),l(3," Create band "),o(),r(4,"ya-page-button",3),C("clicked",function(){return i.deleteSelectedBands()}),l(5," Delete "),o()(),r(6,"ya-panel"),x(7,Fr,21,4,"table",4),o()()),e&2&&(m(2),p("queryParams",O(3,ir,i.yamcs.context)),m(2),p("disabled",!i.isGroupDeleteEnabled()),m(3),w(i.dataSource?7:-1))},dependencies:[b,ee,it,nt,ot,Fe,Nt,rt,Ot,Lt,At,Rt,Gt,at,lt,st,mt,H,W,vn,ut,ft,zt],encapsulation:2,changeDetection:0});var En=Ut;var Ht=class Ht{};Ht.\u0275fac=function(e){return new(e||Ht)},Ht.\u0275cmp=_({type:Ht,selectors:[["app-create-band-wizard-step"]],inputs:{step:"step"},decls:8,vars:4,consts:[[1,"sub"]],template:function(e,i){e&1&&(r(0,"mat-toolbar",0)(1,"mat-toolbar-row")(2,"span")(3,"span"),l(4,"1. Select band type"),o(),l(5," \xA0\xA0\xA0\xA0\xA0\xA0\xA0 "),r(6,"span"),l(7,"2. Configure band"),o()()()()),e&2&&(m(3),re("active",i.step==="1"),m(3),re("active",i.step==="2"))},dependencies:[b,It,Bt],styles:["span[_ngcontent-%COMP%]{cursor:default}span[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{opacity:.3}span[_ngcontent-%COMP%]   span.active[_ngcontent-%COMP%]{opacity:1}mat-toolbar.sub[_ngcontent-%COMP%]{border-bottom:1px solid #d3d3d3;background-color:#fff;font-size:12px}.mat-toolbar-row[_ngcontent-%COMP%]{height:32px;padding:0 24px}.mat-toolbar-multiple-rows[_ngcontent-%COMP%]{min-height:32px}"],changeDetection:0});var ye=Ht;var Nr=a=>({c:a}),Wt=class Wt{constructor(t,e,i,n,s){this.yamcs=i;this.messageService=n;this.router=s;t.setTitle("Configure Command Band"),this.form=e.group({name:["",[g.required]],description:"",properties:e.group({})})}onConfirm(){let t=this.form.value;this.yamcs.yamcsClient.createTimelineBand(this.yamcs.instance,{name:t.name,description:t.description,type:"COMMAND_BAND",shared:!0,properties:t.properties}).then(()=>this.router.navigateByUrl(`/timeline/bands?c=${this.yamcs.context}`)).catch(e=>this.messageService.showError(e))}};Wt.\u0275fac=function(e){return new(e||Wt)(u(ae),u(pe),u(F),u(J),u(Se))},Wt.\u0275cmp=_({type:Wt,selectors:[["ng-component"]],decls:16,vars:5,consts:[["label","Create band"],["step","2"],[1,"form-content","ya-form"],["novalidate","","autocomplete","off",3,"formGroup"],["label","Label","hint","(required)"],["type","text","formControlName","name"],["label","Description","hint","(optional)"],["formControlName","description","rows","3"],["appearance","bottom"],["routerLink","../..",3,"queryParams"],["appearance","primary",3,"click","disabled"]],template:function(e,i){e&1&&(r(0,"ya-instance-page"),c(1,"ya-instance-toolbar",0)(2,"app-create-band-wizard-step",1),r(3,"div",2)(4,"form",3)(5,"ya-field",4),c(6,"input",5),o(),r(7,"ya-field",6),c(8,"textarea",7),o()(),r(9,"p"),l(10,"\xA0"),o(),r(11,"ya-toolbar",8)(12,"ya-button",9),l(13,"Cancel"),o(),r(14,"ya-button",10),C("click",function(){return i.onConfirm()}),l(15," CREATE "),o()()()()),e&2&&(m(4),p("formGroup",i.form),m(8),p("queryParams",O(3,Nr,i.yamcs.context)),m(2),p("disabled",!i.form.valid))},dependencies:[ye,b,E,k,I,D,M,V,ee,L,R,H,W,ue],encapsulation:2,changeDetection:0});var Mn=Wt;var Rr=["timeRuler"],Or=["itemBand"],Ar=["spacer"],Lr=["parameterPlot"],Gr=["parameterStates"],Yr=["commandBand"],Tt=a=>({c:a});function qr(a,t){if(a&1&&(c(0,"ya-page-icon-button",20),l(1," Create band ")),a&2){let e=f();p("queryParams",O(1,Tt,e.yamcs.context))}}var Qt=class Qt{constructor(t,e){this.yamcs=e;this.previewHeight=30;this.timeRulerContainer=xt.required("timeRuler");this.itemBandContainer=xt.required("itemBand");this.spacerContainer=xt.required("spacer");this.parameterPlotContainer=xt.required("parameterPlot");this.parameterStatesContainer=xt.required("parameterStates");this.commandBandContainer=xt.required("commandBand");t.setTitle("Create a band")}ngAfterViewInit(){this.createTimeRulerPreview(),this.createItemBandPreview(),this.createSpacerPreview(),this.createParameterPlotPreview(),this.createParameterStatesPreview(),this.createCommandBandPreview()}createTimeRulerPreview(){let t=this.timeRulerContainer().nativeElement;t.style.height=`${this.previewHeight+1}px`,this.timeRulerPreview=new Qe(t),this.timeRulerPreview.sidebar=void 0,this.timeRulerPreview.tool=void 0,this.timeRulerPreview.background="transparent";let e=new Date;e.setUTCHours(0,0,0,0);let i=new Date(e.getTime());i.setUTCMinutes(30),this.timeRulerPreview.setViewRange(e.getTime(),i.getTime());let n=new Tn(this.timeRulerPreview);n.timezone="UTC",n.contentHeight=this.previewHeight}createItemBandPreview(){let t=this.itemBandContainer().nativeElement;t.style.height=`${this.previewHeight+1}px`,this.itemBandPreview=new Qe(t),this.itemBandPreview.sidebar=void 0,this.itemBandPreview.tool=void 0,this.itemBandPreview.background="transparent",this.itemBandPreview.setViewRange(0,100);let e=new Xe(this.itemBandPreview);e.itemHeight=this.previewHeight,e.paddingTop=0,e.paddingBottom=0,e.items=[{start:10,stop:30,label:"A"},{start:50,stop:60,label:"B"},{start:80,stop:95,label:"C"}]}createSpacerPreview(){let t=this.spacerContainer().nativeElement;t.style.height=`${this.previewHeight+1}px`,this.spacerPreview=new Qe(t),this.spacerPreview.sidebar=void 0,this.spacerPreview.tool=void 0,this.spacerPreview.background="transparent";let e=new Hi(this.spacerPreview);e.text="[empty space]",e.contentHeight=this.previewHeight,e.paddingTop=0,e.paddingBottom=0}createParameterPlotPreview(){let t=this.parameterPlotContainer().nativeElement;t.style.height=`${this.previewHeight+1}px`,this.parameterPlotPreview=new Qe(t),this.parameterPlotPreview.sidebar=void 0,this.parameterPlotPreview.tool=void 0,this.parameterPlotPreview.background="transparent",this.parameterPlotPreview.setViewRange(0,50);let e=new wn(this.parameterPlotPreview);e.contentHeight=this.previewHeight,e.paddingTop=0,e.paddingBottom=0,e.fill="lime",e.labelBackground="rgba(255, 255, 255, 0.75)";let i=new Map;for(let n=0;n<50;n+=.01)i.set(n,Math.sin(n));e.lines=[{points:i,pointRadius:0}]}createParameterStatesPreview(){let t=this.parameterStatesContainer().nativeElement;t.style.height=`${this.previewHeight+1}px`,this.parameterStatesPreview=new Qe(t),this.parameterStatesPreview.sidebar=void 0,this.parameterStatesPreview.tool=void 0,this.parameterStatesPreview.background="transparent",this.parameterStatesPreview.setViewRange(0,100);let e=new Zo(this.parameterStatesPreview);e.contentHeight=this.previewHeight,e.paddingTop=0,e.paddingBottom=0,e.states=[{time:0,label:"ON",background:"#8dd3c7"},{time:30,label:"OFF",background:"#fdb462"},{time:50,label:"ON",background:"#8dd3c7"},{time:80,label:"OFF",background:"#fdb462"}]}createCommandBandPreview(){let t=this.commandBandContainer().nativeElement;t.style.height=`${this.previewHeight+1}px`,this.commandBandPreview=new Qe(t),this.commandBandPreview.sidebar=void 0,this.commandBandPreview.tool=void 0,this.commandBandPreview.background="transparent",this.commandBandPreview.setViewRange(0,100);let e=new Xe(this.commandBandPreview);e.itemHeight=this.previewHeight,e.paddingTop=0,e.paddingBottom=0,e.items=[{start:10,label:"A"},{start:50,label:"B"},{start:80,label:"C"}]}ngOnDestroy(){this.timeRulerPreview?.disconnect(),this.itemBandPreview?.disconnect(),this.spacerPreview?.disconnect(),this.parameterPlotPreview?.disconnect(),this.parameterStatesPreview?.disconnect(),this.commandBandPreview?.disconnect()}};Qt.\u0275fac=function(e){return new(e||Qt)(u(ae),u(F))},Qt.\u0275cmp=_({type:Qt,selectors:[["ng-component"]],viewQuery:function(e,i){e&1&&(St(i.timeRulerContainer,Rr,5),St(i.itemBandContainer,Or,5),St(i.spacerContainer,Ar,5),St(i.parameterPlotContainer,Lr,5),St(i.parameterStatesContainer,Gr,5),St(i.commandBandContainer,Yr,5)),e&2&&To(6)},decls:65,vars:18,consts:[["timeRuler",""],["itemBand",""],["spacer",""],["parameterPlot",""],["parameterStates",""],["commandBand",""],["ya-instance-toolbar-label",""],["step","1"],[1,"category-title"],[1,"band-type-list"],["routerLink","time-ruler",1,"band-type",3,"queryParams"],[1,"card"],[1,"card-title"],[1,"card-content"],[1,"card-preview"],["routerLink","item-band",1,"band-type",3,"queryParams"],["routerLink","spacer",1,"band-type",3,"queryParams"],["routerLink","parameter-plot",1,"band-type",3,"queryParams"],["routerLink","parameter-states",1,"band-type",3,"queryParams"],["routerLink","command-band",1,"band-type",3,"queryParams"],["routerLink","..","icon","arrow_back",3,"queryParams"]],template:function(e,i){e&1&&(r(0,"ya-instance-page")(1,"ya-instance-toolbar"),$(2,qr,2,3,"ng-template",6),o(),c(3,"app-create-band-wizard-step",7),r(4,"ya-panel")(5,"div",8),l(6,"General"),o(),r(7,"div",9)(8,"a",10)(9,"div",11)(10,"div",12),l(11,"Time ruler"),o(),r(12,"div",13),l(13,"Display absolute time, formatted in a timezone of choice."),o(),c(14,"div",14,0),o()(),r(16,"a",15)(17,"div",11)(18,"div",12),l(19,"Item band"),o(),r(20,"div",13),l(21,"Show a selection of timeline items."),o(),c(22,"div",14,1),o()(),r(24,"a",16)(25,"div",11)(26,"div",12),l(27,"Spacer"),o(),r(28,"div",13),l(29," Insert empty vertical space. "),c(30,"br")(31,"br"),o(),c(32,"div",14,2),o()()(),r(34,"p"),l(35,"\xA0"),o(),r(36,"div",8),l(37,"Yamcs content"),o(),r(38,"div",9)(39,"a",17)(40,"div",11)(41,"div",12),l(42,"Parameter plot"),o(),r(43,"div",13),l(44,"Plot the values of a numeric parameter."),o(),c(45,"div",14,3),o()(),r(47,"a",18)(48,"div",11)(49,"div",12),l(50,"Parameter states"),o(),r(51,"div",13),l(52,"Show state transitions of a parameter."),o(),c(53,"div",14,4),o()(),r(55,"a",19)(56,"div",11)(57,"div",12),l(58,"Commands"),o(),r(59,"div",13),l(60," Display issued commands. "),c(61,"br")(62,"br"),o(),c(63,"div",14,5),o()()()()()),e&2&&(m(8),p("queryParams",O(6,Tt,i.yamcs.context)),m(8),p("queryParams",O(8,Tt,i.yamcs.context)),m(8),p("queryParams",O(10,Tt,i.yamcs.context)),m(15),p("queryParams",O(12,Tt,i.yamcs.context)),m(8),p("queryParams",O(14,Tt,i.yamcs.context)),m(8),p("queryParams",O(16,Tt,i.yamcs.context)))},dependencies:[ye,b,ee,H,W,qt,$t,ft],styles:["div.category-title[_ngcontent-%COMP%]{font-size:18px;line-height:1.5;margin-bottom:1em}a.band-type[_ngcontent-%COMP%]{display:inline-block;width:260px;margin-right:20px;margin-bottom:20px;vertical-align:top;text-decoration:none}.card[_ngcontent-%COMP%]{border:1px solid rgba(0,0,0,.12);background:#fff;border-radius:4px;overflow:hidden}.card-title[_ngcontent-%COMP%]{align-items:center;display:flex;padding:15px;font-size:20px;font-weight:500;color:#000000de}.card-content[_ngcontent-%COMP%]{padding:0 15px 15px;min-height:2.4em;font-size:15px;color:#0000008a}.card-preview[_ngcontent-%COMP%]{height:30px;line-height:0;pointer-events:none}a.band-type[_ngcontent-%COMP%]:hover   .card[_ngcontent-%COMP%]{background-color:#f2f2f2}"],changeDetection:0});var Pn=Qt;function zr(a,t){a&1&&(r(0,"th",17),l(1,"Available"),o())}function jr(a,t){if(a&1&&l(0),a&2){let e=f().$implicit;A(" ",e.name," ")}}function Ur(a,t){a&1&&(r(0,"i"),l(1,"(no name)"),o())}function Hr(a,t){if(a&1&&(r(0,"td",18),x(1,jr,1,1)(2,Ur,2,0,"i"),o()),a&2){let e=t.$implicit;m(),w(e.name?1:2)}}function Wr(a,t){a&1&&c(0,"tr",19)}function Qr(a,t){if(a&1){let e=G();r(0,"tr",20),C("click",function(){let n=v(e).$implicit,s=f();return S(s.selectBand(n))}),o()}if(a&2){let e=t.$implicit,i=f();re("selected",i.isLeftSelected(e))}}function Xr(a,t){a&1&&(r(0,"th",17),l(1,"Selected"),o())}function Jr(a,t){if(a&1&&l(0),a&2){let e=f().$implicit;A(" ",e.name," ")}}function Kr(a,t){a&1&&(r(0,"i"),l(1,"(no name)"),o())}function Zr(a,t){if(a&1&&(r(0,"td",18),x(1,Jr,1,1)(2,Kr,2,0,"i"),o()),a&2){let e=t.$implicit;m(),w(e.name?1:2)}}function ea(a,t){a&1&&c(0,"tr",19)}function ta(a,t){if(a&1){let e=G();r(0,"tr",20),C("click",function(){let n=v(e).$implicit,s=f();return S(s.selectBand(n))}),o()}if(a&2){let e=t.$implicit,i=f();re("selected",i.isRightSelected(e))}}var Dt=class Dt{constructor(t){this.displayedColumns=["name"];this.availableDataSource=new We([]);this.selectedDataSource=new We([]);this.onChange=t=>{};this.bands$=t.yamcsClient.getTimelineBands(t.instance),this.bands$.then(e=>{this.availableDataSource.data=e.bands||[]})}writeValue(t){this.bands$.then(e=>{let i=e.bands||[];if(t){let n=t.map(h=>h.id),s=[],d=[];for(let h of i)n.indexOf(h.id)===-1&&s.push(h);for(let h of n)for(let y of i)y.id===h&&d.push(y);this.availableDataSource.data=s,this.selectedDataSource.data=d}else this.availableDataSource.data=[...i],this.selectedDataSource.data=[]})}registerOnChange(t){this.onChange=t}registerOnTouched(t){}selectBand(t){this.selectedBand=t}isLeftSelected(t){return t===this.selectedBand&&this.availableDataSource.data.indexOf(t)!==-1}isAnyLeftSelected(){return this.selectedBand&&this.availableDataSource.data.indexOf(this.selectedBand)!==-1}isRightSelected(t){return t===this.selectedBand&&this.selectedDataSource.data.indexOf(t)!==-1}isAnyRightSelected(){return this.selectedBand&&this.selectedDataSource.data.indexOf(this.selectedBand)!==-1}moveRight(){let t=this.selectedBand,e=[...this.availableDataSource.data],i=[...this.selectedDataSource.data],n=e.indexOf(t);n!==-1&&e.splice(n,1),i.indexOf(t)===-1&&i.push(t),this.availableDataSource.data=e,this.selectedDataSource.data=i,this.onChange(i)}moveLeft(){let t=this.selectedBand,e=[...this.availableDataSource.data],i=[...this.selectedDataSource.data],n=i.indexOf(t);n!==-1&&i.splice(n,1),e.indexOf(t)===-1&&e.push(t),this.availableDataSource.data=e,this.selectedDataSource.data=i,this.onChange(i)}moveUp(){let t=this.selectedBand,e=[...this.selectedDataSource.data],i=e.indexOf(t);i!==0&&(e[i]=e[i-1],e[i-1]=t),this.selectedDataSource.data=e,this.onChange(e)}moveDown(){let t=this.selectedBand,e=[...this.selectedDataSource.data],i=e.indexOf(t);i!==e.length-1&&(e[i]=e[i+1],e[i+1]=t),this.selectedDataSource.data=e,this.onChange(e)}};Dt.\u0275fac=function(e){return new(e||Dt)(u(F))},Dt.\u0275cmp=_({type:Dt,selectors:[["app-band-multi-select"]],features:[Eo([{provide:ko,useExisting:xo(()=>Dt),multi:!0}])],decls:28,vars:11,consts:[[2,"display","flex"],[1,"bands-from"],["mat-table","",1,"ya-data-table","no-frame",2,"width","100%",3,"dataSource"],["cdkColumnDef","name"],["mat-header-cell","",4,"cdkHeaderCellDef"],["mat-cell","",4,"cdkCellDef"],["mat-header-row","",4,"cdkHeaderRowDef"],["mat-row","",3,"selected","click",4,"cdkRowDef","cdkRowDefColumns"],[1,"shared-actions"],[3,"click","rightAlign","disabled"],[1,"icon12"],[3,"click","disabled"],[1,"bands-to"],[1,"bottom-actions"],[2,"flex","1 1 auto"],["icon","keyboard_arrow_down",3,"click","disabled"],["icon","keyboard_arrow_up",3,"click","disabled"],["mat-header-cell",""],["mat-cell",""],["mat-header-row",""],["mat-row","",3,"click"]],template:function(e,i){e&1&&(r(0,"div",0)(1,"div",1)(2,"table",2),K(3,3),$(4,zr,2,0,"th",4)(5,Hr,3,1,"td",5),Z(),$(6,Wr,1,0,"tr",6)(7,Qr,1,2,"tr",7),o()(),r(8,"div",8)(9,"ya-button",9),C("click",function(){return i.moveRight()}),l(10," Add "),r(11,"mat-icon",10),l(12,"chevron_right"),o()(),r(13,"ya-button",11),C("click",function(){return i.moveLeft()}),r(14,"mat-icon",10),l(15,"chevron_left"),o(),l(16," Remove "),o()(),r(17,"div",12)(18,"table",2),K(19,3),$(20,Xr,2,0,"th",4)(21,Zr,3,1,"td",5),Z(),$(22,ea,1,0,"tr",6)(23,ta,1,2,"tr",7),o()()(),r(24,"div",13),c(25,"div",14),r(26,"ya-icon-button",15),C("click",function(){return i.moveDown()}),o(),r(27,"ya-icon-button",16),C("click",function(){return i.moveUp()}),o()()),e&2&&(m(2),p("dataSource",i.availableDataSource),m(4),p("cdkHeaderRowDef",i.displayedColumns),m(),p("cdkRowDefColumns",i.displayedColumns),m(2),p("rightAlign",!0)("disabled",!i.isAnyLeftSelected()),m(4),p("disabled",!i.isAnyRightSelected()),m(5),p("dataSource",i.selectedDataSource),m(4),p("cdkHeaderRowDef",i.displayedColumns),m(),p("cdkRowDefColumns",i.displayedColumns),m(3),p("disabled",!i.isAnyRightSelected()),m(),p("disabled",!i.isAnyRightSelected()))},dependencies:[b,Ao,it,nt,ot,Oo,cn,rt,at,lt,st,mt,L,bn],styles:[".bands-from[_ngcontent-%COMP%], .bands-to[_ngcontent-%COMP%]{border:1px solid #d3d3d3;flex:1 1 0}.bands-from[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .bands-to[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{text-align:center}.bands-from[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .bands-to[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{cursor:pointer}.bands-from[_ngcontent-%COMP%]   table[_ngcontent-%COMP%], .bands-to[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{border-left:none;border-right:none}.bands-from[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .bands-to[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:none}.bands-from[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:last-of-type   td[_ngcontent-%COMP%], .bands-to[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:last-of-type{border-bottom:none}div.shared-actions[_ngcontent-%COMP%]{align-self:center;display:inline-flex;flex-direction:column;row-gap:2px;margin:1em}div.bottom-actions[_ngcontent-%COMP%]{display:flex;column-gap:2px;margin-top:2px}"],changeDetection:0});var Ct=Dt;var or=a=>({c:a});function ia(a,t){if(a&1&&(c(0,"ya-page-icon-button",9),l(1," Create view ")),a&2){let e=f();p("queryParams",O(1,or,e.yamcs.context))}}var Xt=class Xt{constructor(t,e,i,n,s){this.yamcs=e;this.formBuilder=i;this.messageService=n;this.router=s;t.setTitle("Create a view"),this.form=this.formBuilder.group({name:["",[g.required]],bands:[[],[]]})}onConfirm(){let t=this.form.value;this.yamcs.yamcsClient.createTimelineView(this.yamcs.instance,{name:t.name,bands:t.bands.map(e=>e.id)}).then(e=>this.router.navigateByUrl(`/timeline/chart?c=${this.yamcs.context}&view=${e.id}`)).catch(e=>this.messageService.showError(e))}};Xt.\u0275fac=function(e){return new(e||Xt)(u(ae),u(F),u(pe),u(J),u(Se))},Xt.\u0275cmp=_({type:Xt,selectors:[["ng-component"]],decls:18,vars:5,consts:[["ya-instance-toolbar-label",""],[1,"form-content","ya-form"],["novalidate","","autocomplete","off",3,"formGroup"],["label","Name","hint","(required)"],["type","text","formControlName","name"],["formControlName","bands"],["appearance","bottom"],["routerLink","..",3,"queryParams"],["appearance","primary",3,"click","disabled"],["routerLink","..","icon","arrow_back",3,"queryParams"]],template:function(e,i){e&1&&(r(0,"ya-instance-page")(1,"ya-instance-toolbar"),$(2,ia,2,3,"ng-template",0),o(),r(3,"div",1)(4,"form",2)(5,"ya-field",3),c(6,"input",4),o(),c(7,"ya-field-divider"),r(8,"h4"),l(9,"Bands"),o(),c(10,"app-band-multi-select",5),o(),r(11,"p"),l(12,"\xA0"),o(),r(13,"ya-toolbar",6)(14,"ya-button",7),l(15,"Cancel"),o(),r(16,"ya-button",8),C("click",function(){return i.onConfirm()}),l(17," CREATE "),o()()()()),e&2&&(m(4),p("formGroup",i.form),m(10),p("queryParams",O(3,or,i.yamcs.context)),m(2),p("disabled",!i.form.valid))},dependencies:[Ct,b,E,k,I,D,M,V,ee,L,R,de,H,W,qt,$t,ue],encapsulation:2,changeDetection:0});var Bn=Xt;function na(a,t){if(a&1&&(r(0,"form",0)(1,"ya-field",1),c(2,"input",2),o(),r(3,"ya-field",3),c(4,"textarea",4),o()()),a&2){let e=f();p("formGroup",e.form)}}var Jt=class Jt{constructor(t,e){this.yamcs=t;this.changeDetection=e;this.formConfigured$=new U(!1)}ngAfterViewInit(){this.formConfigured$.next(!0),this.changeDetection.detectChanges()}};Jt.\u0275fac=function(e){return new(e||Jt)(u(F),u(Be))},Jt.\u0275cmp=_({type:Jt,selectors:[["app-edit-command-band"]],inputs:{form:"form",band:"band"},decls:2,vars:3,consts:[[3,"formGroup"],["label","Label","hint","(required)"],["type","text","formControlName","name"],["label","Description","hint","(optional)"],["formControlName","description","rows","3"]],template:function(e,i){e&1&&(x(0,na,5,1,"form",0),T(1,"async")),e&2&&w(B(1,1,i.formConfigured$)?0:-1)},dependencies:[b,E,k,I,D,M,V,R,ne],encapsulation:2,changeDetection:0});var Kt=Jt;var rr={};function po(a){let t=rr[a];if(!t){let e=document.createElement("canvas").getContext("2d");e.fillStyle=a,t=String(e.fillStyle),rr[a]=t}return t}var Re=class{constructor(t){this.inputType=0;this.defaultValue=t}},be=class{constructor(t){this.inputType=1;this.defaultValue=t}},z=class{constructor(t){this.inputType=2;this.defaultValue=t}},Je=class{constructor(t){this.inputType=4;this.defaultValue=t}},In=class{constructor(t){this.inputType=3;this.defaultValue=t}};function oe(a,t){let e={};for(let i in a)e[i]=a[i].defaultValue;return Ae(Ae({},e),oa(a,t))}function yt(a){for(let t in a)(a[t]===null||a[t]==="")&&delete a[t]}function oa(a,t){let e={};for(let i in t){let n=a[i];n&&(n.inputType===0?e[i]=t[i]==="true":n.inputType===2?e[i]=Number(t[i]):n.inputType===1?e[i]=po(t[i]):(n.inputType===4||n.inputType===3||console.warn(`Unexpected property input type for ${i}`,n?.inputType),e[i]=t[i]))}return e}var Zt=class Zt{};Zt.\u0275fac=function(e){return new(e||Zt)},Zt.\u0275cmp=_({type:Zt,selectors:[["app-item-styles"]],inputs:{form:"form"},decls:53,vars:15,consts:[["backgroundColor_overrideBand",""],["textColor_overrideBand",""],["textSize_overrideBand",""],["marginLeft_overrideBand",""],["borderColor_overrideBand",""],["borderWidth_overrideBand",""],["cornerRadius_overrideBand",""],[1,"hint"],[3,"formGroup"],["formGroupName","properties",1,"style-table"],[1,"property"],["formControlName","backgroundColor_overrideBand"],[1,"widget"],["type","color","formControlName","backgroundColor"],["formControlName","textColor_overrideBand"],["type","color","formControlName","textColor"],["formControlName","textSize_overrideBand"],["type","number","formControlName","textSize","min","0",2,"width","100px"],["formControlName","marginLeft_overrideBand"],["type","number","formControlName","marginLeft","min","0",2,"width","100px"],["formControlName","borderColor_overrideBand"],["type","color","formControlName","borderColor"],["formControlName","borderWidth_overrideBand"],["type","number","formControlName","borderWidth","min","0",2,"width","100px"],["formControlName","cornerRadius_overrideBand"],["type","number","formControlName","cornerRadius","min","0",2,"width","100px"]],template:function(e,i){if(e&1&&(r(0,"p",7),l(1,"When unset, items inherit the styling of the band they are displayed on."),o(),r(2,"form",8)(3,"table",9)(4,"tr")(5,"td",10),c(6,"mat-slide-toggle",11,0),l(8," Background Color "),o(),r(9,"td",12),c(10,"input",13),o()(),r(11,"tr")(12,"td",10),c(13,"mat-slide-toggle",14,1),l(15," Text Color "),o(),r(16,"td",12),c(17,"input",15),o()(),r(18,"tr")(19,"td",10),c(20,"mat-slide-toggle",16,2),l(22," Text Size "),o(),r(23,"td",12),c(24,"input",17),o()(),r(25,"tr")(26,"td",10),c(27,"mat-slide-toggle",18,3),l(29," Margin Left "),o(),r(30,"td",12),c(31,"input",19),o()(),r(32,"tr")(33,"td",10),c(34,"mat-slide-toggle",20,4),l(36," Border Color "),o(),r(37,"td",12),c(38,"input",21),o()(),r(39,"tr")(40,"td",10),c(41,"mat-slide-toggle",22,5),l(43," Border Width "),o(),r(44,"td",12),c(45,"input",23),o()(),r(46,"tr")(47,"td",10),c(48,"mat-slide-toggle",24,6),l(50," Corner Radius "),o(),r(51,"td",12),c(52,"input",25),o()()()()),e&2){let n=X(7),s=X(14),d=X(21),h=X(28),y=X(35),P=X(42),N=X(49);m(2),p("formGroup",i.form),m(2),re("disabled",!n.checked),m(7),re("disabled",!s.checked),m(7),re("disabled",!d.checked),m(7),re("disabled",!h.checked),m(7),re("disabled",!y.checked),m(7),re("disabled",!P.checked),m(7),re("disabled",!N.checked)}},dependencies:[b,E,k,Ce,I,D,Ie,M,V,fe,$e],styles:[".style-table[_ngcontent-%COMP%]{width:100%;overflow:auto;border-spacing:0;border-collapse:collapse}.style-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .style-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-top:1px solid rgba(0,0,0,.03);border-bottom:1px solid rgba(0,0,0,.03)}.style-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:var(--y-background-color);text-align:left;font-weight:500;color:#000;width:150px;vertical-align:top}.style-table[_ngcontent-%COMP%]   .property[_ngcontent-%COMP%]{font-weight:500;font-size:11px;letter-spacing:.02em;line-height:12px;color:#000;width:150px}.style-table[_ngcontent-%COMP%]   .disabled[_ngcontent-%COMP%]   .property[_ngcontent-%COMP%]{font-style:italic;color:gray}.style-table[_ngcontent-%COMP%]   .widget[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{margin-left:10px}"],changeDetection:0});var _t=Zt;function la(a,t){if(a&1&&(l(0),T(1,"deltaWith")),a&2){let e=f();A(" (",rn(1,1,e.stop,e.start),") ")}}function sa(a,t){if(a&1&&(r(0,"dt"),l(1),o(),r(2,"dd"),l(3),T(4,"printObj"),o()),a&2){let e=t.$implicit;m(),A("\xA0\xA0",e.key),m(2),we(B(4,2,e.value))}}function ma(a,t){if(a&1&&(r(0,"mat-tab",16)(1,"div",4)(2,"dl",22)(3,"dt"),l(4,"Activity ID"),o(),r(5,"dd"),l(6),o(),r(7,"dt"),l(8,"Status"),o(),r(9,"dd"),l(10),o(),r(11,"dt"),l(12,"Started"),o(),r(13,"dd"),l(14),T(15,"datetime"),o(),r(16,"dt"),l(17,"Finished"),o(),r(18,"dd"),l(19),T(20,"datetime"),x(21,la,2,4),o(),r(22,"dt"),l(23,"User"),o(),r(24,"dd"),l(25),o()(),r(26,"div",23),c(27,"mat-divider"),o(),r(28,"dl",24)(29,"dt"),l(30,"Activity type"),o(),r(31,"dd"),l(32),o(),r(33,"dt"),l(34,"Arguments"),o(),c(35,"dd"),me(36,sa,5,4,null,null,ge),T(38,"keyvalue"),o()()()),a&2){let e=t;m(6),we(e.id||"-"),m(4),we(e.status||"-"),m(4),we(B(15,7,e.start)||"-"),m(5),A(" ",B(20,9,e.stop)??"-"," "),m(2),w(e.stop?21:-1),m(4),we(e.startedBy||"-"),m(7),we(e.type),m(4),ce(B(38,11,e.args))}}var ar="_overrideBand",ei=class ei{constructor(t,e,i,n,s){this.dialogRef=t;this.yamcs=i;this.messageService=n;this.data=s;this.resolutionOptions=[{id:"seconds",label:"seconds"},{id:"minutes",label:"minutes"},{id:"hours",label:"hours"}];this.startConstraintOptions=[{id:"START_ON",label:"Start on"}];let d=s.item,h=d.properties||{},y=oe(ii,h);this.form=e.group({name:[d.name,g.required],start:[d.start,g.required],duration:[d.duration,g.required],tags:[d.tags||[],[]],properties:e.group({backgroundColor:[y.backgroundColor,[]],backgroundColor_overrideBand:"backgroundColor"in h,borderColor:[y.borderColor,[]],borderColor_overrideBand:"borderColor"in h,borderWidth:[y.borderWidth,[]],borderWidth_overrideBand:"borderWidth"in h,cornerRadius:[y.cornerRadius,[]],cornerRadius_overrideBand:"cornerRadius"in h,marginLeft:[y.marginLeft,[]],marginLeft_overrideBand:"marginLeft"in h,textColor:[y.textColor,[]],textColor_overrideBand:"textColor"in h,textSize:[y.textSize,[]],textSize_overrideBand:"textSize"in h})}),this.updateDisabledState(),this.formSubscription=this.form.valueChanges.subscribe(()=>{this.updateDisabledState()})}save(){let t=this.form.value,e={name:t.name,start:le.toISOString(t.start),duration:t.duration,tags:t.tags,properties:t.properties};this.yamcs.yamcsClient.updateTimelineItem(this.yamcs.instance,this.data.item.id,e).then(i=>this.dialogRef.close(i)).catch(i=>this.messageService.showError(i))}delete(){confirm("Are you sure you want to delete this item?")&&this.yamcs.yamcsClient.deleteTimelineItem(this.yamcs.instance,this.data.item.id).then(()=>this.dialogRef.close()).catch(t=>this.messageService.showError(t))}updateDisabledState(){let{controls:t}=this.propertiesGroup;for(let e in t)if(e.endsWith(ar)){let i=t[e.substring(0,e.length-ar.length)];t[e].value?i.enable({onlySelf:!0}):i.disable({onlySelf:!0})}}get propertiesGroup(){return this.form.controls.properties}ngOnDestroy(){this.formSubscription?.unsubscribe()}};ei.\u0275fac=function(e){return new(e||ei)(u(Ge),u(pe),u(F),u(J),u(Ye))},ei.\u0275cmp=_({type:ei,selectors:[["ng-component"]],decls:30,vars:5,consts:[["mat-dialog-title",""],[1,"ya-form",3,"formGroup"],["animationDuration","0ms",1,"small-tabs",3,"mat-stretch-tabs"],["label","General"],[2,"margin-top","1em"],["label","Name"],["cdkFocusRegionstart","","type","text","formControlName","name",2,"width","100%"],["label","Tags"],["dialogTitle","Tags"],["formControlName","tags"],["label","Duration"],["formControlName","duration"],["label","Start"],["formControlName","start"],["label","Styles"],[3,"form"],["label","Activity"],["align","end"],[3,"click"],[2,"flex","1 1 auto"],["mat-dialog-close",""],["appearance","primary",3,"click","disabled"],[1,"dl-horizontal","no-lead"],[1,"section-divider"],[1,"dl-horizontal"]],template:function(e,i){if(e&1&&(r(0,"h2",0),l(1,"Update item"),o(),r(2,"mat-dialog-content")(3,"form",1)(4,"mat-tab-group",2)(5,"mat-tab",3)(6,"div",4)(7,"ya-field",5),c(8,"input",6),o(),r(9,"ya-field",7)(10,"ya-help",8),l(11," Tags allow to categorise items per band. Bands only show items for which one of the tags is matching. "),o(),c(12,"ya-tag-select",9),o(),r(13,"ya-field",10),c(14,"ya-duration-input",11),o(),c(15,"ya-field-divider"),r(16,"ya-field",12),c(17,"ya-date-time-input",13),o()()(),r(18,"mat-tab",14)(19,"div",4),c(20,"app-item-styles",15),o()(),x(21,ma,39,13,"mat-tab",16),o()()(),r(22,"mat-dialog-actions",17)(23,"ya-button",18),C("click",function(){return i.delete()}),l(24,"DELETE THIS ITEM"),o(),c(25,"div",19),r(26,"ya-button",20),l(27,"CANCEL"),o(),r(28,"ya-button",21),C("click",function(){return i.save()}),l(29,"SAVE"),o()()),e&2){let n;m(3),p("formGroup",i.form),m(),p("mat-stretch-tabs",!1),m(16),p("form",i.form),m(),w((n=i.data.item.activityDefinition)?21:-1,n),m(7),p("disabled",!i.form.valid)}},dependencies:[_t,b,E,k,I,D,M,V,qe,kt,Ft,Vt,hn,gn,Cn,L,dt,Yt,R,de,Ne,je,Bo,ze,jo,Uo],encapsulation:2,changeDetection:0});var Vn=ei;var ie={frozen:new Re(!1),itemBackgroundColor:new be("#77b1e1"),itemBorderColor:new be("#3d94c7"),itemBorderWidth:new z(1),itemCornerRadius:new z(0),itemHeight:new z(20),itemMarginLeft:new z(5),itemTextColor:new be("#333333"),itemTextOverflow:new In("show"),itemTextSize:new z(10),marginBottom:new z(7),marginTop:new z(7),multiline:new Re(!0),spaceBetweenItems:new z(0),spaceBetweenLines:new z(2)},ii={backgroundColor:new be(ie.itemBackgroundColor.defaultValue),borderColor:new be(ie.itemBorderColor.defaultValue),borderWidth:new z(ie.itemBorderWidth.defaultValue),cornerRadius:new z(ie.itemCornerRadius.defaultValue),marginLeft:new z(ie.itemMarginLeft.defaultValue),textColor:new be(ie.itemTextColor.defaultValue),textSize:new z(ie.itemTextSize.defaultValue)},Wi=class extends Xe{constructor(t,e,i){super(t.timeline),this.label=e.name,this.data={band:e};let n=oe(ie,e.properties||{});this.frozen=n.frozen,this.itemBackground=n.itemBackgroundColor,this.itemBorderColor=n.itemBorderColor,this.itemBorderWidth=n.itemBorderWidth,this.itemCornerRadius=n.itemCornerRadius,this.itemHeight=n.itemHeight,this.itemPaddingLeft=n.itemMarginLeft,this.itemTextColor=n.itemTextColor,this.itemTextOverflow=n.itemTextOverflow,this.itemTextSize=n.itemTextSize,this.paddingBottom=n.marginBottom,this.paddingTop=n.marginTop,this.multiline=n.multiline,this.spaceBetween=n.spaceBetweenItems,this.lineSpacing=n.spaceBetweenLines,this.addItemClickListener(s=>{i.open(Vn,{width:"600px",panelClass:"dialog-force-no-scrollbar",data:{item:s.item.data.item}}).afterClosed().subscribe(()=>t.refreshData())})}};var ni=class ni{constructor(){this.itemTextOverflowOptions=[{id:"show",label:"Show"},{id:"clip",label:"Clip"},{id:"hide",label:"Hide"}]}};ni.\u0275fac=function(e){return new(e||ni)},ni.\u0275cmp=_({type:ni,selectors:[["app-item-band-styles"]],inputs:{form:"form"},decls:85,vars:2,consts:[[3,"formGroup"],["formGroupName","properties",1,"style-table"],[1,"property"],["dialogTitle","Frozen"],[1,"widget"],["formControlName","frozen"],["dialogTitle","Multiline"],["formControlName","multiline"],["dialogTitle","Space Between Lines"],["type","number","formControlName","spaceBetweenLines","min","0",2,"width","100px"],["dialogTitle","Space Between Items"],["type","number","formControlName","spaceBetweenItems","min","0",2,"width","100px"],["type","number","formControlName","marginTop","min","0",2,"width","100px"],["type","number","formControlName","marginBottom","min","0",2,"width","100px"],["type","number","formControlName","itemHeight","min","0",2,"width","100px"],["type","color","formControlName","itemBackgroundColor"],["type","color","formControlName","itemTextColor"],["formControlName","itemTextOverflow",3,"options"],["type","number","formControlName","itemTextSize","min","0",2,"width","100px"],["type","number","formControlName","itemMarginLeft","min","0",2,"width","100px"],["type","color","formControlName","itemBorderColor"],["type","number","formControlName","itemBorderWidth","min","0",2,"width","100px"],["type","number","formControlName","itemCornerRadius","min","0",2,"width","100px"]],template:function(e,i){e&1&&(r(0,"form",0)(1,"table",1)(2,"tr")(3,"td",2),l(4," Frozen "),r(5,"ya-help",3),l(6," Fix this line to the top of the view. Frozen bands are always rendered above other bands. "),o()(),r(7,"td",4),c(8,"mat-slide-toggle",5),o()(),r(9,"tr")(10,"td",2),l(11," Multiline "),r(12,"ya-help",6),l(13," Draw items on multiple lines if otherwise there would be collisions. "),o()(),r(14,"td",4),c(15,"mat-slide-toggle",7),o()(),r(16,"tr")(17,"td",2),l(18," Space Between Lines "),r(19,"ya-help",8),l(20," In case of multilining, this indicates the vertical space between lines. "),o()(),r(21,"td",4),c(22,"input",9),o()(),r(23,"tr")(24,"td",2),l(25," Space Between Items "),r(26,"ya-help",10),l(27," In case of multilining, this indicates the minimum horizontal space between items. If an item does not meet this treshold, it gets rendered on a different line. "),o()(),r(28,"td",4),c(29,"input",11),o()(),r(30,"tr")(31,"td",2),l(32,"Margin Top"),o(),r(33,"td",4),c(34,"input",12),o()(),r(35,"tr")(36,"td",2),l(37,"Margin Bottom"),o(),r(38,"td",4),c(39,"input",13),o()(),r(40,"tr")(41,"td",2),l(42,"Item Height"),o(),r(43,"td",4),c(44,"input",14),o()(),r(45,"tr")(46,"td",2),l(47,"Item Background Color"),o(),r(48,"td",4),c(49,"input",15),o()(),r(50,"tr")(51,"td",2),l(52,"Item Text Color"),o(),r(53,"td",4),c(54,"input",16),o()(),r(55,"tr")(56,"td",2),l(57,"Item Text Overflow"),o(),r(58,"td",4),c(59,"ya-select",17),o()(),r(60,"tr")(61,"td",2),l(62,"Item Text Size"),o(),r(63,"td",4),c(64,"input",18),o()(),r(65,"tr")(66,"td",2),l(67,"Item Margin Left"),o(),r(68,"td",4),c(69,"input",19),o()(),r(70,"tr")(71,"td",2),l(72,"Item Border Color"),o(),r(73,"td",4),c(74,"input",20),o()(),r(75,"tr")(76,"td",2),l(77,"Item Border Width"),o(),r(78,"td",4),c(79,"input",21),o()(),r(80,"tr")(81,"td",2),l(82,"Item Corner Radius"),o(),r(83,"td",4),c(84,"input",22),o()()()()),e&2&&(p("formGroup",i.form),m(59),p("options",i.itemTextOverflowOptions))},dependencies:[b,E,k,Ce,I,D,Ie,M,V,fe,$e,Ne,zo],styles:[".style-table[_ngcontent-%COMP%]{width:100%;overflow:auto;border-spacing:0;border-collapse:collapse}.style-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .style-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-top:1px solid rgba(0,0,0,.03);border-bottom:1px solid rgba(0,0,0,.03)}.style-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:var(--y-background-color);text-align:left;font-weight:500;color:#000;width:150px;vertical-align:top}.style-table[_ngcontent-%COMP%]   .property[_ngcontent-%COMP%]{font-weight:500;font-size:11px;letter-spacing:.02em;line-height:12px;color:#000;width:150px}.style-table[_ngcontent-%COMP%]   .disabled[_ngcontent-%COMP%]   .property[_ngcontent-%COMP%]{font-style:italic;color:gray}.style-table[_ngcontent-%COMP%]   .widget[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{margin-left:10px}"],changeDetection:0});var oi=ni;function ca(a,t){if(a&1&&(r(0,"form",0)(1,"ya-field",1),c(2,"input",2),o(),r(3,"ya-field",3),c(4,"textarea",4),o(),r(5,"ya-field",5),c(6,"ya-tag-select",6),o(),c(7,"ya-field-divider"),r(8,"h4"),l(9,"Styles"),o(),c(10,"app-item-band-styles",7),o()),a&2){let e=f();p("formGroup",e.form),m(10),p("form",e.form)}}var ri=class ri{constructor(t,e){this.yamcs=t;this.changeDetection=e;this.formConfigured$=new U(!1)}ngAfterViewInit(){let t=oe(ie,this.band.properties||{}),e={frozen:[t.frozen,[g.required]],itemBackgroundColor:[t.itemBackgroundColor,[g.required]],itemBorderColor:[t.itemBorderColor,[g.required]],itemBorderWidth:[t.itemBorderWidth,[g.required]],itemCornerRadius:[t.itemCornerRadius,[g.required]],itemHeight:[t.itemHeight,[g.required]],itemMarginLeft:[t.itemMarginLeft,[g.required]],itemTextColor:[t.itemTextColor,[g.required]],itemTextOverflow:[t.itemTextOverflow,[g.required]],itemTextSize:[t.itemTextSize,[g.required]],marginBottom:[t.marginBottom,[g.required]],marginTop:[t.marginTop,[g.required]],multiline:[t.multiline,[g.required]],spaceBetweenItems:[t.spaceBetweenItems,[g.required]],spaceBetweenLines:[t.spaceBetweenLines,[g.required]]},i=this.form.get("properties");for(let n in e){let s=e[n];i.addControl(n,new Mt(s[0],s[1]))}this.formConfigured$.next(!0),this.changeDetection.detectChanges()}};ri.\u0275fac=function(e){return new(e||ri)(u(F),u(Be))},ri.\u0275cmp=_({type:ri,selectors:[["app-edit-item-band"]],inputs:{form:"form",band:"band"},decls:2,vars:3,consts:[[3,"formGroup"],["label","Label","hint","(required)"],["type","text","formControlName","name"],["label","Description","hint","(optional)"],["formControlName","description","rows","3"],["label","Tags"],["formControlName","tags"],[3,"form"]],template:function(e,i){e&1&&(x(0,ca,11,2,"form",0),T(1,"async")),e&2&&w(B(1,1,i.formConfigured$)?0:-1)},dependencies:[oi,b,E,k,I,D,M,V,R,de,je,ne],encapsulation:2,changeDetection:0});var ai=ri;var pa=["tt"],da=(a,t)=>t.label;function ua(a,t){if(a&1&&(De(0,"tr")(1,"td",2)(2,"span"),l(3,"\u2B24"),Le()(),De(4,"td"),l(5),Le(),De(6,"td"),l(7),Le()()),a&2){let e=t.$implicit;m(2),tn("color",e.color),m(3),A(" ",e.label," "),m(2),we(e.value??"-")}}var li=class li{constructor(){this.date=vt(null);this.legend=vt([])}show(t,e,i,n,s,d){this.date.set(i);let h=n.filter(N=>N.visible),y=[];for(let N=0;N<h.length;N++){let j=null,ve=s[N];ve&&ve.value!==null&&(j=d(ve.value)),y.push({color:h[N].lineColor,label:h[N].parameter,value:j})}this.legend.set(y);let P=this.tt.nativeElement;P.style.left=t+"px",P.style.top=e+"px",P.style.display="block"}hide(){let t=this.tt.nativeElement;t.style.display="none"}};li.\u0275fac=function(e){return new(e||li)},li.\u0275cmp=_({type:li,selectors:[["app-parameter-plot-tooltip"]],viewQuery:function(e,i){if(e&1&&Ee(pa,7),e&2){let n;Me(n=Pe())&&(i.tt=n.first)}},decls:9,vars:3,consts:[["tt",""],[1,"ya-tooltip"],["width","1"]],template:function(e,i){e&1&&(De(0,"div",1,0),l(2),T(3,"datetime"),Ui(4,"br")(5,"br"),De(6,"table"),me(7,ua,8,4,"tr",null,da),Le()()),e&2&&(m(2),A(" ",B(3,1,i.date())," "),m(5),ce(i.legend()))},dependencies:[ln,ze],styles:[".ya-tooltip[_ngcontent-%COMP%]{position:absolute;display:none;white-space:pre;border-radius:2px;max-width:350px;padding:6px 8px;margin-top:14px;background:#ffffffb3;border:1px solid var(--y-border-color);font-family:Roboto,sans-serif;font-size:10px}table[_ngcontent-%COMP%]{width:100%;overflow:auto;border-spacing:0;border-collapse:collapse}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-top:1px solid rgba(0,0,0,.03);border-bottom:1px solid rgba(0,0,0,.03)}"]});var Fn=li;var uo=class{constructor(t){this.watermarkObserver=t;this.bufferSize=500;this.bufferWatermark=400;this.pointer=0;this.alreadyWarned=!1;this.forceNextPoint=!1;this.buffer=Array(this.bufferSize).fill(void 0)}push(t){let e;if(this.pointer>0&&(e=this.buffer[this.pointer-1]),e&&!this.forceNextPoint){if(e.n===0&&t.n===0){e.time=Math.min(e.time,t.time),e.firstTime=Math.min(e.firstTime,t.firstTime),e.lastTime=Math.max(e.lastTime,t.lastTime);return}else if(e.n>0&&t.n>0){e.time=Math.min(e.time,t.time),e.firstTime=Math.min(e.firstTime,t.firstTime),e.lastTime=Math.max(e.lastTime,t.lastTime),e.min=Math.min(e.min,t.min),e.max=Math.max(e.max,t.max),e.n+=t.n,e.avg-=e.avg/e.n,e.avg+=t.avg/e.n;return}}this.pointer<this.bufferSize&&(this.buffer[this.pointer]=t,this.pointer>=this.bufferWatermark&&this.watermarkObserver&&!this.alreadyWarned&&(this.watermarkObserver(),this.alreadyWarned=!0),this.pointer=this.pointer+1),this.forceNextPoint=!1}snapshot(){return this.buffer.filter(t=>t!==void 0)}reset(){this.buffer.fill(void 0),this.pointer=0,this.alreadyWarned=!1,this.forceNextPoint=!1}},Nn=class{constructor(t){this.watermarkObserver=t;this.archiveData=new Map;this.realtimeBuffers=new Map}setArchiveData(t){this.archiveData.clear();for(let e of t)this.archiveData.set(e.name,e.series)}addRealtimeValue(t,e){let i=this.realtimeBuffers.get(t);i||(i=new uo(this.watermarkObserver),this.realtimeBuffers.set(t,i)),i.push(e)}forceNextPoint(){this.realtimeBuffers.forEach(t=>t.forceNextPoint=!0)}reset(){this.archiveData.clear(),this.realtimeBuffers.forEach(t=>t.reset())}snapshot(t,e){let i=[];for(let[n,s]of this.archiveData){let h=(this.realtimeBuffers.get(n)?.snapshot()||[]).filter(N=>N!==void 0),y=null;h.length>0&&(y=h[0].firstTime);let P=s.filter(N=>y===null||N.firstTime<y);h.length>0&&h[0].firstTime<=e&&(P=P.concat(h)),P=P.sort((N,j)=>N.firstTime-j.firstTime),i.push(P)}return i}};var Rn=class{constructor(t,e,i){this.yamcs=t;this.configService=i;this.resolution=6e3;this.loading$=new U(!1);this.data$=new U([]);this.parameters$=new U([]);this.syncSubscription=e.sync(()=>{this.plotBuffer.forceNextPoint(),this.emitDataUpdate()}),this.plotBuffer=new Nn(()=>{this.reloadVisibleRange()})}emitDataUpdate(){if(!this.loading$.getValue()){let t=this.visibleStart.getTime(),e=this.visibleStop.getTime(),i=this.plotBuffer.snapshot(t,e);this.data$.next(i)}}addParameter(...t){if(this.parameters$.next([...this.parameters$.value,...t]),this.realtimeSubscription){let e=t.map(i=>({name:i.qualifiedName}));this.addToRealtimeSubscription(e)}else this.connectRealtime()}removeParameter(t){let e=this.parameters$.value.filter(i=>i.qualifiedName!==t);this.parameters$.next(e)}reloadVisibleRange(){return this.updateWindow(this.visibleStart,this.visibleStop)}updateWindowOnly(t,e){this.visibleStart=t,this.visibleStop=e}updateWindow(t,e){if(this.configService.getConfig().tmArchive){this.loading$.next(!0);let i=(e.getTime()-t.getTime())/10,n=new Date(t.getTime()-i),s=new Date(e.getTime()),d=this.parameters$.value,h=[];for(let P of d)h.push(this.yamcs.yamcsClient.getParameterSamples(this.yamcs.instance,P.qualifiedName,{start:n.toISOString(),stop:s.toISOString(),count:this.resolution,fields:["time","n","avg","min","max","firstTime","lastTime"],gapTime:3e5,source:this.configService.isParameterArchiveEnabled()?"ParameterArchive":"replay"}));let y=Promise.allSettled(h);return this.lastLoadPromise=y,y.then(P=>{if(this.lastLoadPromise===y){this.loading$.next(!1),this.plotBuffer.reset(),this.visibleStart=t,this.visibleStop=e;let N=[];for(let j=0;j<P.length;j++){let ve=P[j];ve.status==="fulfilled"?N.push({name:d[j].qualifiedName,series:this.processSamples(ve.value)}):(console.warn(`Failed to retrieve samples for ${d[j].qualifiedName}`,ve.reason),N.push({name:d[j].qualifiedName,series:[]}))}this.plotBuffer.setArchiveData(N),this.emitDataUpdate(),this.lastLoadPromise=null}})}else{this.plotBuffer.reset(),this.visibleStart=t,this.visibleStop=e;let i=[],n=this.parameters$.value;for(let s=0;s<n.length;s++)i.push({name:n[s].qualifiedName,series:[]});this.plotBuffer.setArchiveData(i),this.emitDataUpdate()}}connectRealtime(){let t=this.parameters$.value.map(e=>({name:e.qualifiedName}));this.realtimeSubscription=this.yamcs.yamcsClient.createParameterSubscription({instance:this.yamcs.instance,processor:this.yamcs.processor,id:t,sendFromCache:!1,updateOnExpiration:!0,abortOnInvalid:!0,action:"REPLACE"},e=>{e.mapping&&(this.idMapping=Ae(Ae({},this.idMapping),e.mapping)),e.values&&e.values.length&&this.processRealtimeDelivery(e.values)})}addToRealtimeSubscription(t){this.realtimeSubscription.addReplyListener(()=>{this.realtimeSubscription.sendMessage({instance:this.yamcs.instance,processor:this.yamcs.processor,id:t,sendFromCache:!1,updateOnExpiration:!0,abortOnInvalid:!0,action:"ADD"})})}processRealtimeDelivery(t){for(let e of t){let i=this.idMapping[e.numericId],n=Date.parse(e.generationTime),s=le.convertValueToNumber(e.engValue);s===null||e.acquisitionStatus!=="ACQUIRED"?this.plotBuffer.addRealtimeValue(i.name,{time:n,firstTime:n,lastTime:n,n:1,avg:null,min:null,max:null}):this.plotBuffer.addRealtimeValue(i.name,{time:n,firstTime:n,lastTime:n,n:1,avg:s,min:s,max:s})}}disconnect(){this.data$.complete(),this.loading$.complete(),this.realtimeSubscription?.cancel(),this.syncSubscription?.unsubscribe()}processSamples(t){let e=[];for(let i of t)e.push({time:Date.parse(i.time),firstTime:Date.parse(i.firstTime??i.time),lastTime:Date.parse(i.lastTime??i.time),n:i.n,avg:i.avg,min:i.min,max:i.max});return e}};var he={frozen:new Re(!1),height:new z(30),minimum:new z,maximum:new z,zeroLineWidth:new z(0),zeroLineColor:new be("#ff0000"),minimumFractionDigits:new z(0),maximumFractionDigits:new z(2)};function fo(a,t){let e={};return e[`trace_${a}_parameter`]=new Je(""),e[`trace_${a}_lineColor`]=new be(t),e[`trace_${a}_visible`]=new Re(!0),e[`trace_${a}_lineWidth`]=new z(1),e[`trace_${a}_fill`]=new Re(!1),e[`trace_${a}_fillColor`]=new be("#dddddd"),e[`trace_${a}_minMax`]=new Re(!1),e[`trace_${a}_minMaxOpacity`]=new z(.17),e}function ho(a,t,e){let i=`trace_${a}_`,n=oe(t,e),s={};for(let d in n)s[d.slice(i.length)]=n[d];return s}var si=["#1b73e8","#129eaf","#d01984","#34a853","#7626bb","#e64b19"],Qi=class extends wn{constructor(t,e,i,n,s,d){super(t.timeline),this.label=e.name,this.data={band:e};let h=oe(he,e.properties||{});this.frozen=h.frozen??he.frozen.defaultValue,this.contentHeight=h.height??he.height.defaultValue,this.labelBackground="rgba(255, 255, 255, 0.75)",this.minimum=h.minimum??he.minimum.defaultValue,this.maximum=h.maximum??he.maximum.defaultValue,this.zeroLineWidth=h.zeroLineWidth??he.zeroLineWidth.defaultValue,this.zeroLineColor=h.zeroLineColor??he.zeroLineColor.defaultValue;let y=Intl.NumberFormat("en-US",{minimumFractionDigits:h.minimumFractionDigits??he.minimumFractionDigits.defaultValue,maximumFractionDigits:h.maximumFractionDigits??he.maximumFractionDigits.defaultValue,useGrouping:!1});this.labelFormatter=se=>y.format(se);let P=new en(document.body),N=d.position().flexibleConnectedTo(P).withPositions([{originX:"start",originY:"top",overlayX:"start",overlayY:"top"}]).withPush(!1),j=d.create({positionStrategy:N}),ve=new sn(Fn);this.tooltipInstance=j.attach(ve).instance;let Oe=[],qi=1;for(;;){let se=fo(qi,"#zzzzzz"),$i=ho(qi,se,e.properties||{});if(!$i.parameter)break;qi++,Oe.push($i)}this.dataSource=new Rn(i,n,s),this.dataSource.data$.subscribe(se=>{let $i=[];for(let Zi=0;Zi<Oe.length;Zi++){let Ze=Oe[Zi],zi=se.length?se[Zi]:[],ao=new Map,lo=new Map;for(let bt=0;bt<zi.length;bt++){let He=zi[bt];if(He.n===0)ao.set(He.time,null),lo.set(He.time,null);else{let bo=bt===0||zi[bt-1].n===0,vo=bt===zi.length-1||zi[bt+1].n===0,ji;bo&&!vo?ji=He.firstTime:!bo&&vo?ji=He.lastTime:ji=He.time,ao.set(ji,He.avg),lo.set(ji,[He.min,He.max])}}let fr=Math.floor(Ze.minMaxOpacity*255).toString(16);$i.push({visible:Ze.visible,points:ao,pointRadius:0,lohi:Ze.minMax?lo:void 0,lineColor:Ze.lineColor,lohiColor:po(Ze.lineColor)+fr,lineWidth:Ze.lineWidth,fill:Ze.fill?Ze.fillColor:"transparent"})}this.lines=$i}),this.backfillSubscription=i.yamcsClient.createBackfillingSubscription({instance:i.instance},se=>{se.finished&&this.dataSource.reloadVisibleRange()});let _e=[];for(let se=0;se<Oe.length;se++)_e.push({qualifiedName:Oe[se].parameter});_e.length&&this.dataSource.addParameter(..._e),this.addMouseMoveListener(se=>{this.tooltipInstance.show(se.clientX,se.clientY,new Date(se.time),Oe,se.points,this.labelFormatter)}),this.addMouseLeaveListener(se=>{this.tooltipInstance.hide()})}refreshData(){let t=this.timeline.start,e=this.timeline.stop;this.dataSource.updateWindow(new Date(t),new Date(e))}disconnectedCallback(){this.backfillSubscription?.cancel(),this.dataSource.disconnect()}};var mi=class mi{};mi.\u0275fac=function(e){return new(e||mi)},mi.\u0275cmp=_({type:mi,selectors:[["app-parameter-plot-styles"]],inputs:{form:"form"},decls:52,vars:1,consts:[[3,"formGroup"],["formGroupName","properties",1,"style-table"],[1,"property"],["dialogTitle","Frozen"],[1,"widget"],["formControlName","frozen"],["type","number","formControlName","height","min","0",1,"inline"],["dialogTitle","Minimum"],["type","number","formControlName","minimum",1,"inline"],[1,"hint"],["dialogTitle","Maximum"],["type","number","formControlName","maximum",1,"inline"],["type","number","formControlName","zeroLineWidth","min","0",1,"inline"],["type","color","formControlName","zeroLineColor"],["type","number","formControlName","minimumFractionDigits","min","0",1,"inline"],["type","number","formControlName","maximumFractionDigits","min","0",1,"inline"]],template:function(e,i){e&1&&(r(0,"form",0)(1,"table",1)(2,"tr")(3,"td",2),l(4," Frozen "),r(5,"ya-help",3),l(6," Fix this line to the top of the view. Frozen bands are always rendered above other bands. "),o()(),r(7,"td",4),c(8,"mat-slide-toggle",5),o()(),r(9,"tr")(10,"td",2),l(11,"Height"),o(),r(12,"td",4),c(13,"input",6),o()(),r(14,"tr")(15,"td",2),l(16," Minimum "),r(17,"ya-help",7),l(18," Minimum value on the Y axis. Values lower than the minimum are not visible. If undefined, the value is automatically derived from the actual trace data. "),o()(),r(19,"td",4),c(20,"input",8),r(21,"span",9),l(22,"Leave empty for automatic determination"),o()()(),r(23,"tr")(24,"td",2),l(25," Maximum "),r(26,"ya-help",10),l(27," Maximum value on the Y axis. Values higher than the maximum are not visible. If undefined, the value is automatically derived from the actual trace data. "),o()(),r(28,"td",4),c(29,"input",11),r(30,"span",9),l(31,"Leave empty for automatic determination"),o()()(),r(32,"tr")(33,"td",2),l(34,"Zero line width"),o(),r(35,"td",4),c(36,"input",12),o()(),r(37,"tr")(38,"td",2),l(39,"Zero line color"),o(),r(40,"td",4),c(41,"input",13),o()(),r(42,"tr")(43,"td",2),l(44,"Minimum fraction digits"),o(),r(45,"td",4),c(46,"input",14),o()(),r(47,"tr")(48,"td",2),l(49,"Maximum fraction digits"),o(),r(50,"td",4),c(51,"input",15),o()()()()),e&2&&p("formGroup",i.form)},dependencies:[b,E,k,Ce,I,D,Ie,M,V,fe,$e,Ne],styles:[".inline[_ngcontent-%COMP%]{display:inline-block!important;width:100px!important}",".style-table[_ngcontent-%COMP%]{width:100%;overflow:auto;border-spacing:0;border-collapse:collapse}.style-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .style-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-top:1px solid rgba(0,0,0,.03);border-bottom:1px solid rgba(0,0,0,.03)}.style-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:var(--y-background-color);text-align:left;font-weight:500;color:#000;width:150px;vertical-align:top}.style-table[_ngcontent-%COMP%]   .property[_ngcontent-%COMP%]{font-weight:500;font-size:11px;letter-spacing:.02em;line-height:12px;color:#000;width:150px}.style-table[_ngcontent-%COMP%]   .disabled[_ngcontent-%COMP%]   .property[_ngcontent-%COMP%]{font-style:italic;color:gray}.style-table[_ngcontent-%COMP%]   .widget[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{margin-left:10px}"],changeDetection:0});var ci=mi;function fa(a,t){a&1&&(r(0,"tr")(1,"td",4),l(2,"Min/max opacity"),o(),r(3,"td",5),c(4,"input",12),r(5,"span",13),l(6,"Value between 0 and 1"),o()()())}function ha(a,t){a&1&&(r(0,"tr")(1,"td",4),l(2,"Fill color"),o(),r(3,"td",5),c(4,"input",14),o()())}var pi=class pi{};pi.\u0275fac=function(e){return new(e||pi)},pi.\u0275cmp=_({type:pi,selectors:[["app-trace-styles"]],inputs:{form:"form"},decls:36,vars:4,consts:[["minMax",""],["fill",""],[3,"formGroup"],[1,"style-table"],[1,"property"],[1,"widget"],["formControlName","parameter",3,"fill"],["type","color","formControlName","lineColor"],["formControlName","visible"],["type","number","formControlName","lineWidth","min","0",1,"inline"],["formControlName","minMax"],["formControlName","fill"],["type","number","formControlName","minMaxOpacity","min","0","max","1","step","0.1",1,"inline"],[1,"hint"],["type","color","formControlName","fillColor"]],template:function(e,i){if(e&1&&(r(0,"form",2)(1,"table",3)(2,"tr")(3,"td",4),l(4,"Parameter"),o(),r(5,"td",5),c(6,"app-parameter-input",6),o()(),r(7,"tr")(8,"td",4),l(9,"Line color"),o(),r(10,"td",5),c(11,"input",7),o()(),r(12,"tr")(13,"td",4),l(14,"Visible"),o(),r(15,"td",5),c(16,"mat-slide-toggle",8),o()(),r(17,"tr")(18,"td",4),l(19,"Line width"),o(),r(20,"td",5),c(21,"input",9),o()(),r(22,"tr")(23,"td",4),l(24,"Show min/max"),o(),r(25,"td",5),c(26,"mat-slide-toggle",10,0),o()(),x(28,fa,7,0,"tr"),r(29,"tr")(30,"td",4),l(31,"Fill"),o(),r(32,"td",5),c(33,"mat-slide-toggle",11,1),o()(),x(35,ha,5,0,"tr"),o()()),e&2){let n=X(27),s=X(34);p("formGroup",i.form),m(6),p("fill",!0),m(22),w(n.checked?28:-1),m(7),w(s.checked?35:-1)}},dependencies:[Dn,b,E,k,Ce,I,D,Ie,Fo,M,V,$e],styles:[".inline[_ngcontent-%COMP%]{display:inline-block!important;width:100px!important}",".style-table[_ngcontent-%COMP%]{width:100%;overflow:auto;border-spacing:0;border-collapse:collapse}.style-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .style-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-top:1px solid rgba(0,0,0,.03);border-bottom:1px solid rgba(0,0,0,.03)}.style-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:var(--y-background-color);text-align:left;font-weight:500;color:#000;width:150px;vertical-align:top}.style-table[_ngcontent-%COMP%]   .property[_ngcontent-%COMP%]{font-weight:500;font-size:11px;letter-spacing:.02em;line-height:12px;color:#000;width:150px}.style-table[_ngcontent-%COMP%]   .disabled[_ngcontent-%COMP%]   .property[_ngcontent-%COMP%]{font-style:italic;color:gray}.style-table[_ngcontent-%COMP%]   .widget[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{margin-left:10px}"],changeDetection:0});var di=pi;function ga(a,t){if(a&1){let e=G();r(0,"ya-stepper-step",7)(1,"ya-stepper-step-actions")(2,"ya-icon-action",8),C("click",function(){let n=v(e).$index,s=f(2);return S(s.moveUp(n))}),o(),r(3,"ya-icon-action",9),C("click",function(){let n=v(e).$index,s=f(2);return S(s.moveDown(n))}),o(),r(4,"ya-icon-action",10),C("click",function(){let n=v(e).$index,s=f(2);return S(s.removeTrace(n))}),o(),r(5,"ya-icon-action",11),C("click",function(){let n=v(e).$index,s=f(2);return S(s.addTrace(n))}),o()(),c(6,"app-trace-styles",6),o()}if(a&2){let e=t.$implicit,i=t.$index,n=f(2);p("label",nn("Trace ",i+1))("expanded",!0),m(2),p("disabled",i===0),m(),p("disabled",i>=n.traces.controls.length-1),m(),p("disabled",n.traces.controls.length<=1),m(2),p("form",e)}}function Ca(a,t){if(a&1&&(r(0,"form",0)(1,"ya-stepper")(2,"ya-stepper-step",1)(3,"ya-field",2),c(4,"input",3),o(),r(5,"ya-field",4),c(6,"textarea",5),o(),c(7,"app-parameter-plot-styles",6),o(),me(8,ga,7,7,"ya-stepper-step",7,ge),o()()),a&2){let e=f();p("formGroup",e.form),m(2),p("expanded",!0),m(5),p("form",e.form),m(),ce(e.traces.controls)}}var ui=class ui{constructor(t,e,i){this.yamcs=t;this.changeDetection=e;this.formBuilder=i;this.formConfigured$=new U(!1)}ngAfterViewInit(){let t=oe(he,this.band.properties||{}),e={frozen:[t.frozen,[g.required]],height:[t.height,[g.required]],minimum:[t.minimum,[]],maximum:[t.maximum,[]],zeroLineColor:[t.zeroLineColor,[g.required]],zeroLineWidth:[t.zeroLineWidth,[g.required]],minimumFractionDigits:[t.minimumFractionDigits,[g.required]],maximumFractionDigits:[t.maximumFractionDigits,[g.required]]},i=this.form.get("properties");for(let s in e){let d=e[s];i.addControl(s,new Mt(d[0],d[1]))}let n=1;for(;;){let s=fo(n,"#zzzzzz"),d=ho(n,s,this.band.properties||{});if(!d.parameter)break;n++,this.addTrace().patchValue(d)}this.formConfigured$.next(!0),this.changeDetection.detectChanges()}get traces(){return this.form.controls.traces}addTrace(t){let e=t===void 0?0:t+1,i=si[e%si.length],n=this.formBuilder.group({parameter:["",[g.required]],lineColor:[i,[g.required]],visible:[!0,[g.required]],lineWidth:[1,[g.required]],minMax:[!0,[g.required]],minMaxOpacity:[.17,[g.required]],fill:[!1,[g.required]],fillColor:["#dddddd",[g.required]]});return t!==void 0?this.traces.insert(t+1,n):this.traces.push(n),n}removeTrace(t){this.traces.removeAt(t)}moveUp(t){let e=this.traces.at(t);this.traces.removeAt(t),this.traces.insert(t-1,e)}moveDown(t){let e=this.traces.at(t);this.traces.removeAt(t),this.traces.insert(t+1,e)}};ui.\u0275fac=function(e){return new(e||ui)(u(F),u(Be),u(ke))},ui.\u0275cmp=_({type:ui,selectors:[["app-edit-parameter-plot"]],inputs:{form:"form",band:"band"},decls:2,vars:3,consts:[[1,"ya-form",3,"formGroup"],["label","General",3,"expanded"],["label","Label","hint","(required)"],["type","text","formControlName","name"],["label","Description","hint","(optional)"],["formControlName","description","rows","3"],[3,"form"],[3,"label","expanded"],["icon","arrow_drop_up","matTooltip","Move up",3,"click","disabled"],["icon","arrow_drop_down","matTooltip","Move down",3,"click","disabled"],["icon","delete_outline","matTooltip","Remove trace",3,"click","disabled"],["icon","add_circle","matTooltip","Add trace below",3,"click"]],template:function(e,i){e&1&&(x(0,Ca,10,3,"form",0),T(1,"async")),e&2&&w(B(1,1,i.formConfigured$)?0:-1)},dependencies:[ci,di,b,E,k,I,D,M,V,Ve,R,pt,gt,ht,Sn,ne],encapsulation:2,changeDetection:0});var fi=ui;var ya=["tt"],_a=(a,t)=>t.label;function ba(a,t){a&1&&l(0," Other ")}function va(a,t){if(a&1&&l(0),a&2){let e=f().$implicit;A(" ",e.label," ")}}function Sa(a,t){if(a&1&&l(0),a&2){let e=f().$implicit;A(" ",e.count," x ")}}function xa(a,t){a&1&&l(0," - ")}function wa(a,t){if(a&1&&(De(0,"tr")(1,"td",3)(2,"span"),l(3,"\u2B24"),Le()(),De(4,"td"),x(5,ba,1,0)(6,va,1,1),Le(),De(7,"td"),x(8,Sa,1,1)(9,xa,1,0),Le()()),a&2){let e=t.$implicit;re("most-frequent",e.mostFrequent),m(2),tn("color",e.color),m(3),w(e.label==="__OTHER"?5:6),m(3),w(e.count>0?8:9)}}var hi=class hi{constructor(t){this.formatter=t;this.start=vt(null);this.stop=vt(null);this.legend=vt([])}show(t,e,i,n){let s;n&&(this.start.set(new Date(n.start)),this.stop.set(n.stop?new Date(n.stop):null),s=n.data.range);let d=[],h;for(let[P,N]of i.entries())if(P==="__OTHER"){let j={label:P,color:N,count:s?.otherCount||0,mostFrequent:!1};d.push(j)}else{let j=0;if(s){for(let Oe of s.values)if(Oe.value===P){j=Oe.count;break}}let ve={label:P,color:N,count:j,mostFrequent:!1};d.push(ve),(h===void 0||j>h.count)&&(h=ve)}h&&(h.mostFrequent=!0),this.legend.set(d);let y=this.tt.nativeElement;y.style.left=t+"px",y.style.top=e+"px",y.style.display="block"}hide(){let t=this.tt.nativeElement;t.style.display="none"}};hi.\u0275fac=function(e){return new(e||hi)(u(_n))},hi.\u0275cmp=_({type:hi,selectors:[["app-parameter-states-tooltip"]],viewQuery:function(e,i){if(e&1&&Ee(ya,7),e&2){let n;Me(n=Pe())&&(i.tt=n.first)}},decls:12,vars:6,consts:[["tt",""],[1,"ya-tooltip"],[3,"most-frequent"],["width","1"]],template:function(e,i){e&1&&(De(0,"div",1,0),l(2),T(3,"datetime"),Ui(4,"br"),l(5),T(6,"datetime"),Ui(7,"br")(8,"br"),De(9,"table"),me(10,wa,10,6,"tr",2,_a),Le()()),e&2&&(m(2),A(" ",B(3,2,i.start())," to "),m(3),A(" ",B(6,4,i.stop())||"-"," "),m(5),ce(i.legend()))},dependencies:[ln,ze],styles:[".ya-tooltip[_ngcontent-%COMP%]{position:absolute;display:none;white-space:pre;border-radius:2px;max-width:350px;padding:6px 8px;margin-top:14px;background:#ffffffb3;border:1px solid var(--y-border-color);font-family:Roboto,sans-serif;font-size:10px}table[_ngcontent-%COMP%]{width:100%;overflow:auto;border-spacing:0;border-collapse:collapse}td[_ngcontent-%COMP%]{border-top:1px solid rgba(0,0,0,.03);border-bottom:1px solid rgba(0,0,0,.03)}tr.most-frequent[_ngcontent-%COMP%]{background:#eee}"]});var On=hi;var go=class{constructor(){this.otherCount=0;this.mixed=!1;this.other=!1}},Co=class{constructor(t,e,i){this.maxGap=t;this.formatter=e;this.watermarkObserver=i;this.bufferSize=500;this.bufferWatermark=400;this.pointer=0;this.alreadyWarned=!1;this.buffer=Array(this.bufferSize).fill(void 0)}push(t){let e;this.pointer>0&&(e=this.buffer[this.pointer-1]);let i=le.toDate(t.generationTime).getTime(),n=this.formatter.formatValue(t.engValue),s={value:n,count:1},d=new go;if(d.start=i,d.stop=d.start,d.values=[s],d.mostFrequentValue=s,e&&e.values[0].value===n){e.stop=d.start,e.values[0].count++;return}else e&&e.stop-d.start<=this.maxGap&&(e.stop=d.start);this.pointer<this.bufferSize&&(this.buffer[this.pointer]=d,this.pointer>=this.bufferWatermark&&this.watermarkObserver&&!this.alreadyWarned&&(this.watermarkObserver(),this.alreadyWarned=!0),this.pointer=this.pointer+1)}snapshot(){return this.buffer.filter(t=>t!==void 0)}reset(){this.buffer.fill(void 0),this.pointer=0,this.alreadyWarned=!1}},An=class{constructor(t,e,i,n){this.maxGap=t;this.stateRemapper=i;this.archiveData=[];this.realtimeBuffer=new Co(t,e,n)}setArchiveData(t){this.archiveData=t}addRealtimeValue(t){this.realtimeBuffer.push(t)}reset(){this.archiveData.length=0,this.realtimeBuffer.reset()}snapshot(t,e){let i=this.archiveData,n=this.realtimeBuffer.snapshot();if(i.length>0&&n.length>0){let d=i[i.length-1],h=n[0];h.start-d.stop<=this.maxGap&&(d.stop=h.start)}let s=[...i,...n].filter(d=>d.stop>=t&&d.start<=e);return s=this.stateRemapper.applyMappings(s),s}};var Ta="#000000",lr=["#8dd3c7","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#bc80bd","#ccebc5","#ffffb3"],Ln=class{constructor(){this.cache=new Map;this.nextIndex=0}colorForValue(t){if(t==="__OTHER")return Ta;let e=this.cache.get(t);return e?this.cache.delete(t):(e=lr[this.nextIndex],this.nextIndex++,this.nextIndex>lr.length-1&&(this.nextIndex=0,this.keepSizeWithinLimits())),this.cache.set(t,e),e}reset(){this.cache.clear(),this.nextIndex=0}keepSizeWithinLimits(){for(;this.cache.size>1e3;){let e=0;for(var t of this.cache.keys()){if(e++>100)break;this.cache.delete(t)}}}};var Gn=class{constructor(){this.colorByValue=new Map;this.colorMap=new Ln}entries(){return this.colorByValue.entries()}resetColorAssignment(){this.colorMap.reset()}recalculate(t){let e=new Map;for(let n of t)for(let s of n.values)e.has(s.value)||e.set(s.value,s.color);let i=[...e.entries()].sort((n,s)=>n[0].localeCompare(s[0],void 0,{numeric:!0,sensitivity:"base"}));this.colorByValue.clear();for(let[n,s]of i)if(s)this.colorByValue.set(n,s);else{let d=this.colorMap.colorForValue(n);this.colorByValue.set(n,d)}this.colorByValue.set("__OTHER",this.colorMap.colorForValue("__OTHER"))}getBackground(t){return t.mostFrequentValue.color??this.colorMap.colorForValue(t.mostFrequentValue.value)}getForeground(t){let e=this.getBackground(t);return this.isDark(e)?"#fff":"#000"}getLabel(t){return t.mostFrequentValue.value??"null"}isDark(t){let e=t.charAt(0)==="#"?t.substring(1,7):t,i=parseInt(e.substring(0,2),16),n=parseInt(e.substring(2,4),16),s=parseInt(e.substring(4,6),16);return i*.299+n*.587+s*.114<=186}};function sr(a){let t=[];for(let e of a.values)t.push(Ae({},e));return{start:a.start,stop:a.stop,values:t,mostFrequentValue:Ae({},a.mostFrequentValue),otherCount:a.otherCount,mixed:a.mixed}}function mr(a,t){if(a.otherCount===0&&t.otherCount!==0||a.otherCount!==0&&t.otherCount===0||a.stop!==t.start)return!1;let e=a.values.filter(n=>n.count>0).map(n=>n.value).sort(),i=t.values.filter(n=>n.count>0).map(n=>n.value).sort();if(e.length!==i.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==i[n])return!1;return!0}var Yn=class{constructor(){this.mappings=[]}addMapping(t){this.mappings.push(t)}applyMappings(t){let e=[];for(let i of t){let n=sr(i);this.applyMappingsToState(n),e.push(n)}return this.reduceDistinctValues(e),this.compactStates(e),this.calculateMostFrequent(e),e}applyMappingsToState(t){let e=[];for(let n of t.values){let s=n.value,d;for(let h of this.mappings)if(h.type==="value")s===h.value&&(h.label&&(s=h.label),d=h.color||void 0);else if(h.type==="range"){let y=Number(h.start),P=Number(h.end);if(!isNaN(s)){let N=Number(s);N>=y&&N<=P&&(h.label&&(s=h.label),d=h.color||void 0)}}e.push({value:s,count:n.count,color:d})}let i=[];for(let n of e){let s=i.find(d=>d.value===n.value);s?s.count+=n.count:i.push(n)}t.values=i}reduceDistinctValues(t){let i=new Map;for(let s of t)for(let d of s.values){let h=i.get(d.value)||0;i.set(d.value,h+d.count)}let n=[...i.entries()].sort((s,d)=>d[1]-s[1]).slice(0,10).map(s=>s[0]);for(let s of t)for(let d=s.values.length-1;d>=0;d--){let h=s.values[d];n.indexOf(h.value)===-1&&(s.values.splice(d,1),s.otherCount+=h.count)}}compactStates(t){let e=[],i=null;for(let n of t)if(i&&mr(i,n)){i.otherCount+=n.otherCount,i.stop=n.stop;for(let s of n.values){let d=i.values.find(h=>h.value===s.value);d?d.count+=s.count:i.values.push(s)}}else e.push(n),i=n;t.length=0,t.push(...e)}calculateMostFrequent(t){for(let e of t){let i={value:null,count:0},n=0;for(let s of e.values)s.count>i.count&&(i=Ae({},s)),s.count>0&&n++;e.otherCount&&n++,e.otherCount>i.count&&(i={value:"__OTHER",count:e.otherCount}),e.mostFrequentValue=i,e.mixed=n>1}}};var cr=12e4,Ke={frozen:new Re(!1),height:new z(30),parameter:new Je("")};function yo(a){let t={};return t[`value_mapping_${a}_type`]=new Je(""),t[`value_mapping_${a}_value`]=new Je(""),t[`value_mapping_${a}_start`]=new z,t[`value_mapping_${a}_end`]=new z,t[`value_mapping_${a}_label`]=new Je(""),t[`value_mapping_${a}_color`]=new be(""),t}function _o(a,t,e){let i=`value_mapping_${a}_`,n=oe(t,e),s={};for(let d in n)n[d]!==""&&(s[d.slice(i.length)]=n[d]);return s}var Ji=class extends Xe{constructor(e,i,n,s,d,h,y){super(e.timeline);this.yamcs=n;this.formatter=d;this.configService=h;this.stateRemapper=new Yn;this.legend=new Gn;this.label=i.name,this.multiline=!1,this.itemTextOverflow="hide",this.itemHoverBorderWidth=1,this.data={band:i};let P=oe(Ke,i.properties||{});this.frozen=P.frozen??Ke.frozen.defaultValue,this.itemHeight=P.height??Ke.height.defaultValue,this.parameter=P.parameter??Ke.parameter.defaultValue;let N=0;for(;;){let _e=yo(N),se=_o(N,_e,i.properties||{});if(!se.type)break;N++,this.stateRemapper.addMapping(se)}let j=new en(document.body),ve=y.position().flexibleConnectedTo(j).withPositions([{originX:"start",originY:"top",overlayX:"start",overlayY:"top"}]).withPush(!1),Oe=y.create({positionStrategy:ve}),qi=new sn(On);this.tooltipInstance=Oe.attach(qi).instance,this.stateBuffer=new An(cr,this.formatter,this.stateRemapper,()=>{this.refreshData(!1)}),this.syncSubscription=s.sync(()=>{this.updateChart()}),this.backfillSubscription=n.yamcsClient.createBackfillingSubscription({instance:n.instance},_e=>{_e.finished&&this.refreshData(!1)}),this.addItemMouseEnterListener(_e=>{this.tooltipInstance.show(_e.clientX,_e.clientY,this.legend)}),this.addItemMouseMoveListener(_e=>{this.tooltipInstance.show(_e.clientX,_e.clientY,this.legend,_e.item)}),this.addItemMouseLeaveListener(_e=>{this.tooltipInstance.hide()}),this.mixedPattern=this.createMixedPattern()}refreshData(e=!0){let i=(this.timeline.stop-this.timeline.start)/10,n=this.timeline.start-i,s=this.timeline.stop,h={maxValues:15,maxGap:cr,start:new Date(n).toISOString(),stop:new Date(s).toISOString(),minRange:Math.floor((s-n)/5e3)};this.configService.getConfig().tmArchive?this.yamcs.yamcsClient.getParameterRanges(this.yamcs.instance,this.parameter,h).then(y=>{this.connectRealtime();let P=this.convertRangesToStates(y);this.stateBuffer.reset(),this.stateBuffer.setArchiveData(P)}).catch(y=>{console.warn(`Failed to retrieve samples for ${this.parameter}`,y),this.stateBuffer.reset(),this.stateBuffer.setArchiveData([])}).finally(()=>{e&&this.legend.resetColorAssignment(),this.updateChart()}):(this.connectRealtime(),this.stateBuffer.reset(),this.stateBuffer.setArchiveData([]),e&&this.legend.resetColorAssignment(),this.updateChart())}connectRealtime(){this.realtimeSubscription?.cancel(),this.realtimeSubscription=this.yamcs.yamcsClient.createParameterSubscription({instance:this.yamcs.instance,processor:this.yamcs.processor,id:[{name:this.parameter}],sendFromCache:!1,updateOnExpiration:!1,abortOnInvalid:!0,action:"REPLACE"},e=>{for(let i of e.values||[])this.stateBuffer.addRealtimeValue(i)})}convertRangesToStates(e){let i=[];for(let n of e){let s={start:le.toDate(n.start).getTime(),stop:le.toDate(n.stop).getTime(),values:[],otherCount:n.otherCount,mixed:!1,mostFrequentValue:{value:null,count:0}};for(let d=0;d<n.engValues?.length;d++){let h=this.formatter.formatValue(n.engValues[d]),y=n.counts[d];s.values.push({value:h,count:y})}i.push(s)}return i}updateChart(){let e=this.stateBuffer.snapshot(this.timeline.start,this.timeline.stop);this.legend.recalculate(e);let i=[];for(let n of e){let s,d,h;n.mixed?(s=this.mixedPattern,d="#000",h="Mixed"):n.otherCount>0?(s="#000",d="#fff",h="Misc"):(s=this.legend.getBackground(n),d=this.legend.getForeground(n),h=this.legend.getLabel(n));let y={start:n.start,stop:n.stop,background:s,textColor:d,label:h,borderWidth:0,data:{range:n}};i.push(y)}this.items=i}createMixedPattern(){let i=document.createElement("canvas");i.width=6,i.height=6;let n=i.getContext("2d");return n.fillStyle="#d3d3d3",n.beginPath(),n.moveTo(0,0),n.lineTo(6/3,0),n.lineTo(0,6/3),n.closePath(),n.fill(),n.beginPath(),n.moveTo(6*2/3,0),n.lineTo(6,0),n.lineTo(6,6*1/3),n.lineTo(6*1/3,6),n.lineTo(0,6),n.lineTo(0,6*2/3),n.closePath(),n.fill(),n.beginPath(),n.moveTo(6,6),n.lineTo(6,6-6/3),n.lineTo(6-6/3,6),n.closePath(),n.fill(),n.createPattern(i,"repeat")}disconnectedCallback(){this.backfillSubscription?.cancel(),this.realtimeSubscription?.cancel(),this.syncSubscription?.unsubscribe()}};var gi=class gi{};gi.\u0275fac=function(e){return new(e||gi)},gi.\u0275cmp=_({type:gi,selectors:[["app-parameter-states-styles"]],inputs:{form:"form"},decls:33,vars:2,consts:[[3,"formGroup"],["formGroupName","properties",1,"style-table"],[1,"property"],["dialogTitle","Frozen"],[1,"widget"],["formControlName","frozen"],["type","number","formControlName","height","min","0",2,"width","100px"],["formControlName","parameter",3,"fill"],[1,"hint"]],template:function(e,i){e&1&&(r(0,"form",0)(1,"table",1)(2,"tr")(3,"td",2),l(4," Frozen "),r(5,"ya-help",3),l(6," Fix this line to the top of the view. Frozen bands are always rendered above other bands. "),o()(),r(7,"td",4),c(8,"mat-slide-toggle",5),o()(),r(9,"tr")(10,"td",2),l(11,"Height"),o(),r(12,"td",4),c(13,"input",6),o()(),r(14,"tr")(15,"td",2),l(16,"Parameter"),o(),r(17,"td",4),c(18,"app-parameter-input",7),o()()(),c(19,"br"),r(20,"p",8),l(21," For best results the displayed parameter should have a limited amount of possible values and/or change infrequently. Else the visualization will not be very useful, especially when zoomed out. "),o(),r(22,"p",8),l(23," This generally means that "),r(24,"strong"),l(25,"enumeration"),o(),l(26," , "),r(27,"strong"),l(28,"boolean"),o(),l(29," or "),r(30,"strong"),l(31,"string"),o(),l(32," parameters are the best candidates. Or a numeric parameter with custom value mapping. "),o()()),e&2&&(p("formGroup",i.form),m(18),p("fill",!0))},dependencies:[Dn,b,E,k,Ce,I,D,Ie,M,V,fe,$e,Ne],styles:[".style-table[_ngcontent-%COMP%]{width:100%;overflow:auto;border-spacing:0;border-collapse:collapse}.style-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .style-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-top:1px solid rgba(0,0,0,.03);border-bottom:1px solid rgba(0,0,0,.03)}.style-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:var(--y-background-color);text-align:left;font-weight:500;color:#000;width:150px;vertical-align:top}.style-table[_ngcontent-%COMP%]   .property[_ngcontent-%COMP%]{font-weight:500;font-size:11px;letter-spacing:.02em;line-height:12px;color:#000;width:150px}.style-table[_ngcontent-%COMP%]   .disabled[_ngcontent-%COMP%]   .property[_ngcontent-%COMP%]{font-style:italic;color:gray}.style-table[_ngcontent-%COMP%]   .widget[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{margin-left:10px}"],changeDetection:0});var Ci=gi;function Da(a,t){a&1&&c(0,"input",15)}function Ea(a,t){a&1&&c(0,"input",22)(1,"input",23)}function Ma(a,t){if(a&1){let e=G();r(0,"tr",13)(1,"td"),c(2,"input",14,0),l(4),T(5,"titlecase"),o(),r(6,"td"),x(7,Da,1,0,"input",15)(8,Ea,2,0),o(),r(9,"td"),l(10,"\u2192"),o(),r(11,"td"),c(12,"input",16),o(),r(13,"td"),c(14,"ya-color-input",17),o(),r(15,"td",18)(16,"ya-icon-action",19),C("click",function(){let n=v(e).$index,s=f(3);return S(s.moveUp(n))}),o(),r(17,"ya-icon-action",20),C("click",function(){let n=v(e).$index,s=f(3);return S(s.moveDown(n))}),o(),r(18,"ya-icon-action",21),C("click",function(){let n=v(e).$index,s=f(3);return S(s.removeMapping(n))}),o()()()}if(a&2){let e=t.$implicit,i=t.$index,n=X(3),s=f(3);p("formGroupName",i),m(4),A(" ",B(5,5,e.value.type)," "),m(3),w(n.value==="value"?7:n.value==="range"?8:-1),m(9),p("disabled",i===0),m(),p("disabled",i>=s.valueMappings.controls.length-1)}}function Pa(a,t){if(a&1&&(r(0,"table",10)(1,"tr")(2,"th"),l(3,"Type"),o(),r(4,"th"),l(5," Condition "),r(6,"span",11),l(7,"(required)"),o()(),c(8,"th"),r(9,"th"),l(10,"Label"),o(),r(11,"th"),l(12,"Color"),o(),c(13,"th",12),o(),me(14,Ma,19,7,"tr",13,ge),o(),c(16,"br")),a&2){let e=f(2);m(14),ce(e.valueMappings.controls)}}function Ba(a,t){if(a&1){let e=G();r(0,"form",1)(1,"ya-stepper")(2,"ya-stepper-step",2)(3,"ya-field",3),c(4,"input",4),o(),r(5,"ya-field",5),c(6,"textarea",6),o(),c(7,"app-parameter-states-styles",7),o(),r(8,"ya-stepper-step",8),x(9,Pa,17,0),r(10,"ya-button",9),C("click",function(){v(e);let n=f();return S(n.addValueMapping())}),l(11,"Add value mapping"),o(),l(12," \xA0 "),r(13,"ya-button",9),C("click",function(){v(e);let n=f();return S(n.addRangeMapping())}),l(14,"Add range mapping"),o()()()()}if(a&2){let e=f();p("formGroup",e.form),m(2),p("expanded",!0),m(5),p("form",e.form),m(),p("expanded",!0),m(),w(e.valueMappings.length?9:-1)}}var yi=class yi{constructor(t,e,i){this.yamcs=t;this.changeDetection=e;this.formBuilder=i;this.formConfigured$=new U(!1)}ngAfterViewInit(){let t=oe(Ke,this.band.properties||{}),e={frozen:[t.frozen,[g.required]],height:[t.height,[g.required]],parameter:[t.parameter,[g.required]]},i=this.form.get("properties");for(let s in e){let d=e[s];i.addControl(s,new Mt(d[0],d[1]))}let n=0;for(;;){let s=yo(n),d=_o(n,s,this.band.properties||{});if(!d.type)break;n++,d.type==="value"?this.addValueMapping().patchValue(d):d.type==="range"&&this.addRangeMapping().patchValue(d)}this.formConfigured$.next(!0),this.changeDetection.detectChanges()}get valueMappings(){return this.form.controls.valueMappings}addValueMapping(){let t=this.formBuilder.group({type:["value",[g.required]],value:["",[g.required]],label:[""],color:[""]});return this.valueMappings.push(t),t}addRangeMapping(){let t=this.formBuilder.group({type:["range",[g.required]],start:["",[g.required]],end:["",[g.required]],label:[""],color:[""]});return this.valueMappings.push(t),t}removeMapping(t){this.valueMappings.removeAt(t)}moveUp(t){let e=this.valueMappings.at(t);this.valueMappings.removeAt(t),this.valueMappings.insert(t-1,e)}moveDown(t){let e=this.valueMappings.at(t);this.valueMappings.removeAt(t),this.valueMappings.insert(t+1,e)}};yi.\u0275fac=function(e){return new(e||yi)(u(F),u(Be),u(ke))},yi.\u0275cmp=_({type:yi,selectors:[["app-edit-parameter-states"]],inputs:{form:"form",band:"band"},decls:2,vars:3,consts:[["type",""],[1,"ya-form",3,"formGroup"],["label","General",3,"expanded"],["label","Label","hint","(required)"],["type","text","formControlName","name",2,"width","100%"],["label","Description","hint","(optional)"],["formControlName","description","rows","3"],[3,"form"],["label","Value mapping",3,"expanded"],["icon","add_circle",3,"click"],["formArrayName","valueMappings",1,"mappings"],[1,"hint"],[2,"width","99%"],[3,"formGroupName"],["type","hidden","formControlName","type"],["type","text","placeholder","value","formControlName","value",2,"width","164px"],["type","text","placeholder","(optional)","formControlName","label",2,"width","140px"],["formControlName","color","label","auto"],[2,"text-align","right"],["icon","arrow_drop_up","matTooltip","Move up",3,"click","disabled"],["icon","arrow_drop_down","matTooltip","Move down",3,"click","disabled"],["icon","delete_outline","matTooltip","Remove mapping",3,"click"],["type","number","placeholder","start","formControlName","start",2,"display","inline-block","width","80px","margin-right","4px"],["type","number","placeholder","end","formControlName","end",2,"display","inline-block","width","80px"]],template:function(e,i){e&1&&(x(0,Ba,15,5,"form",1),T(1,"async")),e&2&&w(B(1,1,i.formConfigured$)?0:-1)},dependencies:[Ci,b,E,k,Ce,I,D,M,V,fe,mn,Ve,L,yn,R,pt,gt,ht,an,ne],styles:["table.mappings[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{white-space:nowrap}table.mappings[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:not(:first-child), table.mappings[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:not(:first-child){padding-left:5px}table.mappings[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:not(:last-child), table.mappings[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:not(:last-child){padding-right:5px}"],changeDetection:0});var _i=yi;var qn={height:new z(34)};var bi=class bi{};bi.\u0275fac=function(e){return new(e||bi)},bi.\u0275cmp=_({type:bi,selectors:[["app-spacer-styles"]],inputs:{form:"form"},decls:7,vars:1,consts:[[3,"formGroup"],["formGroupName","properties",1,"style-table"],[1,"property"],[1,"widget"],["type","number","formControlName","height","min","0",2,"width","100px"]],template:function(e,i){e&1&&(r(0,"form",0)(1,"table",1)(2,"tr")(3,"td",2),l(4,"Height"),o(),r(5,"td",3),c(6,"input",4),o()()()()),e&2&&p("formGroup",i.form)},dependencies:[b,E,k,Ce,I,D,Ie,M,V,fe],styles:[".style-table[_ngcontent-%COMP%]{width:100%;overflow:auto;border-spacing:0;border-collapse:collapse}.style-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .style-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-top:1px solid rgba(0,0,0,.03);border-bottom:1px solid rgba(0,0,0,.03)}.style-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:var(--y-background-color);text-align:left;font-weight:500;color:#000;width:150px;vertical-align:top}.style-table[_ngcontent-%COMP%]   .property[_ngcontent-%COMP%]{font-weight:500;font-size:11px;letter-spacing:.02em;line-height:12px;color:#000;width:150px}.style-table[_ngcontent-%COMP%]   .disabled[_ngcontent-%COMP%]   .property[_ngcontent-%COMP%]{font-style:italic;color:gray}.style-table[_ngcontent-%COMP%]   .widget[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{margin-left:10px}"],changeDetection:0});var vi=bi;function Ia(a,t){if(a&1&&(r(0,"form",0)(1,"ya-field",1),c(2,"input",2),o(),r(3,"ya-field",3),c(4,"textarea",4),o(),c(5,"ya-field-divider"),r(6,"h4"),l(7,"Styles"),o(),c(8,"app-spacer-styles",5),o()),a&2){let e=f();p("formGroup",e.form),m(8),p("form",e.form)}}var Si=class Si{constructor(t,e){this.yamcs=t;this.changeDetection=e;this.formConfigured$=new U(!1)}ngAfterViewInit(){let e={height:[oe(qn,this.band.properties||{}).height,[g.required]]},i=this.form.get("properties");for(let n in e){let s=e[n];i.addControl(n,new Pt(s[0],s[1]))}this.formConfigured$.next(!0),this.changeDetection.detectChanges()}};Si.\u0275fac=function(e){return new(e||Si)(u(F),u(Be))},Si.\u0275cmp=_({type:Si,selectors:[["app-edit-spacer"]],inputs:{form:"form",band:"band"},decls:2,vars:3,consts:[[3,"formGroup"],["label","Label","hint","(optional)"],["type","text","formControlName","name",2,"width","100%"],["label","Description","hint","(optional)"],["formControlName","description","rows","3"],[3,"form"]],template:function(e,i){e&1&&(x(0,Ia,9,2,"form",0),T(1,"async")),e&2&&w(B(1,1,i.formConfigured$)?0:-1)},dependencies:[b,E,k,I,D,M,V,R,de,vi,ne],encapsulation:2,changeDetection:0});var xi=Si;function ka(a,t){if(a&1&&(r(0,"form",0)(1,"ya-field",1),c(2,"input",2),o(),r(3,"ya-field",3),c(4,"textarea",4),o(),K(5,5),r(6,"ya-field",6),c(7,"ya-timezone-select",7),o(),Z(),o()),a&2){let e=f();p("formGroup",e.form)}}var wi=class wi{constructor(t,e){this.yamcs=t;this.changeDetection=e;this.formConfigured$=new U(!1)}ngAfterViewInit(){let t={timezone:[this.band.properties.timezone,[g.required]]},e=this.form.get("properties");for(let i in t){let n=t[i];e.addControl(i,new Pt(n[0],n[1]))}this.formConfigured$.next(!0),this.changeDetection.detectChanges()}};wi.\u0275fac=function(e){return new(e||wi)(u(F),u(Be))},wi.\u0275cmp=_({type:wi,selectors:[["app-edit-time-ruler"]],inputs:{form:"form",band:"band"},decls:2,vars:3,consts:[[3,"formGroup"],["label","Label","hint","(required)"],["type","text","formControlName","name"],["label","Description","hint","(optional)"],["formControlName","description","rows","3"],["formGroupName","properties"],["label","Timezone"],["formControlName","timezone"]],template:function(e,i){e&1&&(x(0,ka,8,1,"form",0),T(1,"async")),e&2&&w(B(1,1,i.formConfigured$)?0:-1)},dependencies:[b,E,k,I,D,M,V,fe,R,xn,ne],encapsulation:2,changeDetection:0});var Ti=wi;function Va(a,t){if(a&1&&c(0,"app-edit-item-band",3),a&2){let e=f(),i=f();p("form",i.form)("band",e)}}function Fa(a,t){if(a&1&&c(0,"app-edit-spacer",3),a&2){let e=f(),i=f();p("form",i.form)("band",e)}}function Na(a,t){if(a&1&&c(0,"app-edit-time-ruler",3),a&2){let e=f(),i=f();p("form",i.form)("band",e)}}function Ra(a,t){if(a&1&&c(0,"app-edit-command-band",3),a&2){let e=f(),i=f();p("form",i.form)("band",e)}}function Oa(a,t){if(a&1&&c(0,"app-edit-parameter-plot",3),a&2){let e=f(),i=f();p("form",i.form)("band",e)}}function Aa(a,t){if(a&1&&c(0,"app-edit-parameter-states",3),a&2){let e=f(),i=f();p("form",i.form)("band",e)}}function La(a,t){if(a&1){let e=G();r(0,"ya-instance-page"),c(1,"ya-instance-toolbar",0),r(2,"div",1)(3,"form",2),x(4,Va,1,2,"app-edit-item-band",3)(5,Fa,1,2,"app-edit-spacer",3)(6,Na,1,2,"app-edit-time-ruler",3)(7,Ra,1,2,"app-edit-command-band",3)(8,Oa,1,2,"app-edit-parameter-plot",3)(9,Aa,1,2,"app-edit-parameter-states",3),o(),r(10,"p"),l(11,"\xA0"),o(),r(12,"ya-toolbar",4)(13,"ya-button",5),C("click",function(){v(e);let n=f();return S(n.location.back())}),l(14,"Cancel"),o(),r(15,"ya-button",6),T(16,"async"),C("click",function(){v(e);let n=f();return S(n.doOnConfirm())}),l(17," SAVE CHANGES "),o()()()()}if(a&2){let e=t,i=f();m(3),p("formGroup",i.form),m(),w(e.type==="ITEM_BAND"?4:e.type==="SPACER"?5:e.type==="TIME_RULER"?6:e.type==="COMMAND_BAND"?7:e.type==="PARAMETER_PLOT"?8:e.type==="PARAMETER_STATES"?9:-1),m(11),p("disabled",!B(16,3,i.dirty$)||!i.form.valid)}}var Di=class Di{constructor(t,e,i,n,s,d,h){this.yamcs=e;this.messageService=i;this.route=n;this.router=s;this.location=h;this.dirty$=new U(!1);t.setTitle("Edit band");let y=n.snapshot.paramMap.get("band");this.band$=e.yamcsClient.getTimelineBand(e.instance,y),this.band$.then(P=>{this.form=d.group({name:[P.name,[g.required]],description:[P.description||""],tags:[P.tags||[]],traces:d.array([]),valueMappings:d.array([]),properties:d.group({})}),this.formSubscription=this.form.valueChanges.subscribe(()=>{this.dirty$.next(!0)})}).catch(P=>this.messageService.showError(P))}doOnConfirm(){let t=this.route.snapshot.paramMap.get("band"),e=this.form.value,i={name:e.name,description:e.description,shared:!0,tags:e.tags,properties:e.properties};for(let n=0;n<this.traces.length;n++){let s=this.traces.at(n);for(let d in s.controls){let h=`trace_${n+1}_${d}`,y=s.controls[d].value;i.properties[h]=y}}for(let n=0;n<this.valueMappings.length;n++){let s=this.valueMappings.at(n);for(let d in s.controls){let h=`value_mapping_${n}_${d}`,y=s.controls[d].value;i.properties[h]=y}}yt(i.properties||{}),this.yamcs.yamcsClient.updateTimelineBand(this.yamcs.instance,t,i).then(()=>this.router.navigateByUrl(`/timeline/bands?c=${this.yamcs.context}`)).catch(n=>this.messageService.showError(n))}get traces(){return this.form.controls.traces}get valueMappings(){return this.form.controls.valueMappings}ngOnDestroy(){this.formSubscription?.unsubscribe()}};Di.\u0275fac=function(e){return new(e||Di)(u(ae),u(F),u(J),u(tt),u(Se),u(pe),u(Et))},Di.\u0275cmp=_({type:Di,selectors:[["ng-component"]],decls:2,vars:3,consts:[["label","Edit band"],[1,"form-content","ya-form"],["novalidate","","autocomplete","off",3,"formGroup"],[3,"form","band"],["appearance","bottom"],[3,"click"],["appearance","primary",3,"click","disabled"]],template:function(e,i){if(e&1&&(x(0,La,18,5,"ya-instance-page"),T(1,"async")),e&2){let n;w((n=B(1,1,i.band$))?0:-1,n)}},dependencies:[Kt,ai,fi,_i,xi,Ti,b,E,D,M,L,H,W,ue,ne],encapsulation:2,changeDetection:0});var $n=Di;function Ga(a,t){if(a&1){let e=G();r(0,"ya-instance-page"),c(1,"ya-instance-toolbar",0),r(2,"div",1)(3,"form",2)(4,"ya-field",3),c(5,"input",4),o(),r(6,"ya-field",5)(7,"ya-help",6),l(8," Tags allow to categorise items per band. Bands only show items for which one of the tags is matching. "),o(),c(9,"ya-tag-select",7),o(),r(10,"ya-field",8),c(11,"ya-duration-input",9),o(),c(12,"ya-field-divider"),r(13,"ya-field",10),c(14,"ya-date-time-input",11),o(),c(15,"ya-field-divider"),r(16,"h4"),l(17,"Styles"),o(),c(18,"app-item-styles",12),o(),r(19,"p"),l(20,"\xA0"),o(),r(21,"ya-toolbar",13)(22,"ya-button",14),C("click",function(){v(e);let n=f();return S(n.location.back())}),l(23,"Cancel"),o(),r(24,"ya-button",15),T(25,"async"),C("click",function(){v(e);let n=f();return S(n.doOnConfirm())}),l(26," SAVE CHANGES "),o()()()()}if(a&2){let e=f();m(3),p("formGroup",e.form),m(15),p("form",e.form),m(6),p("disabled",!B(25,3,e.dirty$)||!e.form.valid)}}var zn="_overrideBand",Ei=class Ei{constructor(t,e,i,n,s,d,h){this.yamcs=e;this.messageService=i;this.route=n;this.router=s;this.location=h;this.resolutionOptions=[{id:"seconds",label:"seconds"},{id:"minutes",label:"minutes"},{id:"hours",label:"hours"}];this.startConstraintOptions=[{id:"START_ON",label:"Start on"}];this.dirty$=new U(!1);t.setTitle("Edit Item");let y=n.snapshot.paramMap.get("item");this.item$=e.yamcsClient.getTimelineItem(e.instance,y),this.item$.then(P=>{let N=P.properties||{},j=oe(ii,N);this.form=d.group({name:[P.name,[g.required]],start:[P.start,g.required],duration:[P.duration,g.required],tags:[P.tags||[],[]],properties:d.group({backgroundColor:[j.backgroundColor,[]],backgroundColor_overrideBand:"backgroundColor"in N,borderColor:[j.borderColor,[]],borderColor_overrideBand:"borderColor"in N,borderWidth:[j.borderWidth,[]],borderWidth_overrideBand:"borderWidth"in N,cornerRadius:[j.cornerRadius,[]],cornerRadius_overrideBand:"cornerRadius"in N,marginLeft:[j.marginLeft,[]],marginLeft_overrideBand:"marginLeft"in N,textColor:[j.textColor,[]],textColor_overrideBand:"textColor"in N,textSize:[j.textSize,[]],textSize_overrideBand:"textSize"in N})}),this.updateDisabledState(),this.formSubscription=this.form.valueChanges.subscribe(()=>{this.updateDisabledState(),this.dirty$.next(!0)})}).catch(P=>this.messageService.showError(P))}updateDisabledState(){let{controls:t}=this.propertiesGroup;for(let e in t)if(e.endsWith(zn)){let i=t[e.substring(0,e.length-zn.length)];t[e].value?i.enable({onlySelf:!0}):i.disable({onlySelf:!0})}}get propertiesGroup(){return this.form.controls.properties}doOnConfirm(){let t=this.route.snapshot.paramMap.get("item"),e=this.form.value,i={name:e.name,start:le.toISOString(e.start),duration:e.duration,tags:e.tags,properties:{}};i.tags?.length||(i.clearTags=!0);let{controls:n}=this.propertiesGroup;for(let s in n)if(s.endsWith(zn)&&n[s].value){let d=s.substring(0,s.length-zn.length);i.properties[d]=n[d].value}i.properties?.length||(i.clearProperties=!0),this.yamcs.yamcsClient.updateTimelineItem(this.yamcs.instance,t,i).then(()=>this.router.navigateByUrl(`/timeline/items?c=${this.yamcs.context}`)).catch(s=>this.messageService.showError(s))}ngOnDestroy(){this.formSubscription?.unsubscribe()}};Ei.\u0275fac=function(e){return new(e||Ei)(u(ae),u(F),u(J),u(tt),u(Se),u(pe),u(Et))},Ei.\u0275cmp=_({type:Ei,selectors:[["ng-component"]],decls:2,vars:3,consts:[["label","Edit item"],[1,"form-content","ya-form"],["novalidate","","autocomplete","off",3,"formGroup"],["label","Name","hint","(required)"],["type","text","formControlName","name"],["label","Tags"],["dialogTitle","Tags"],["formControlName","tags"],["label","Duration"],["formControlName","duration"],["label","Start"],["formControlName","start"],[3,"form"],["appearance","bottom"],[3,"click"],["appearance","primary",3,"click","disabled"]],template:function(e,i){if(e&1&&(x(0,Ga,27,5,"ya-instance-page"),T(1,"async")),e&2){let n;w((n=B(1,1,i.item$))?0:-1,n)}},dependencies:[_t,b,E,k,I,D,M,V,L,dt,Yt,R,de,Ne,H,W,je,ue,ne],encapsulation:2,changeDetection:0});var jn=Ei;var pr=a=>({c:a});function Ya(a,t){if(a&1&&(c(0,"ya-page-icon-button",9),l(1," Update view ")),a&2){let e=f();p("queryParams",O(1,pr,e.yamcs.context))}}var Mi=class Mi{constructor(t,e,i,n,s,d,h){this.yamcs=e;this.messageService=i;this.route=n;this.router=s;this.location=d;this.dirty$=new U(!1);t.setTitle("Edit view");let y=n.snapshot.paramMap.get("view");this.form=h.group({name:[null,g.required],bands:[null,[]]}),e.yamcsClient.getTimelineView(e.instance,y).then(P=>{this.form.setValue({name:P.name,bands:P.bands||[]}),this.formSubscription=this.form.valueChanges.subscribe(()=>{this.dirty$.next(!0)})}).catch(P=>this.messageService.showError(P))}onConfirm(){let t=this.form.value,e={name:t.name,bands:t.bands.map(n=>n.id)},i=this.route.snapshot.paramMap.get("view");this.yamcs.yamcsClient.updateTimelineView(this.yamcs.instance,i,e).then(()=>this.router.navigateByUrl(`/timeline/views?c=${this.yamcs.context}`)).catch(n=>this.messageService.showError(n))}ngOnDestroy(){this.formSubscription?.unsubscribe()}};Mi.\u0275fac=function(e){return new(e||Mi)(u(ae),u(F),u(J),u(tt),u(Se),u(Et),u(pe))},Mi.\u0275cmp=_({type:Mi,selectors:[["ng-component"]],decls:19,vars:7,consts:[["ya-instance-toolbar-label",""],[1,"form-content","ya-form"],["novalidate","","autocomplete","off",3,"formGroup"],["label","Name","hint","(required)"],["type","text","formControlName","name"],["formControlName","bands"],["appearance","bottom"],["routerLink","..",3,"queryParams"],["appearance","primary",3,"click","disabled"],["routerLink","..","icon","arrow_back",3,"queryParams"]],template:function(e,i){e&1&&(r(0,"ya-instance-page")(1,"ya-instance-toolbar"),$(2,Ya,2,3,"ng-template",0),o(),r(3,"div",1)(4,"form",2)(5,"ya-field",3),c(6,"input",4),o(),c(7,"ya-field-divider"),r(8,"h4"),l(9,"Bands"),o(),c(10,"app-band-multi-select",5),o(),r(11,"p"),l(12,"\xA0"),o(),r(13,"ya-toolbar",6)(14,"ya-button",7),l(15,"Cancel"),o(),r(16,"ya-button",8),T(17,"async"),C("click",function(){return i.onConfirm()}),l(18," SAVE CHANGES "),o()()()()),e&2&&(m(4),p("formGroup",i.form),m(10),p("queryParams",O(5,pr,i.yamcs.context)),m(2),p("disabled",!B(17,3,i.dirty$)||!i.form.valid))},dependencies:[Ct,b,E,k,I,D,M,V,ee,L,R,de,H,W,qt,$t,ue,ne],encapsulation:2,changeDetection:0});var Un=Mi;var qa=a=>({c:a}),Pi=class Pi{constructor(t,e,i,n,s){this.yamcs=i;this.messageService=n;this.router=s;t.setTitle("Configure Item Band"),this.form=e.group({name:["",[g.required]],description:"",properties:e.group({frozen:[ie.frozen.defaultValue,[g.required]],itemBackgroundColor:[ie.itemBackgroundColor.defaultValue,[g.required]],itemBorderColor:[ie.itemBorderColor.defaultValue,[g.required]],itemBorderWidth:[ie.itemBorderWidth.defaultValue,[g.required]],itemCornerRadius:[ie.itemCornerRadius.defaultValue,[g.required]],itemHeight:[ie.itemHeight.defaultValue,[g.required]],itemMarginLeft:[ie.itemMarginLeft.defaultValue,[g.required]],itemTextColor:[ie.itemTextColor.defaultValue,[g.required]],itemTextOverflow:[ie.itemTextOverflow.defaultValue,[g.required]],itemTextSize:[ie.itemTextSize.defaultValue,[g.required]],marginBottom:[ie.marginBottom.defaultValue,[g.required]],marginTop:[ie.marginTop.defaultValue,[g.required]],multiline:[ie.multiline.defaultValue,[g.required]],spaceBetweenItems:[ie.spaceBetweenItems.defaultValue,[g.required]],spaceBetweenLines:[ie.spaceBetweenLines.defaultValue,[g.required]]}),tags:[[],[]]})}onConfirm(){let t=this.form.value;this.yamcs.yamcsClient.createTimelineBand(this.yamcs.instance,{name:t.name,description:t.description,type:"ITEM_BAND",shared:!0,tags:t.tags,properties:t.properties}).then(()=>this.router.navigateByUrl(`/timeline/bands?c=${this.yamcs.context}`)).catch(e=>this.messageService.showError(e))}};Pi.\u0275fac=function(e){return new(e||Pi)(u(ae),u(pe),u(F),u(J),u(Se))},Pi.\u0275cmp=_({type:Pi,selectors:[["ng-component"]],decls:22,vars:6,consts:[["label","Create band"],["step","2"],[1,"form-content","ya-form"],["novalidate","","autocomplete","off",3,"formGroup"],["label","Label","hint","(required)"],["type","text","formControlName","name"],["label","Description","hint","(optional)"],["formControlName","description","rows","3"],["label","Tags"],["formControlName","tags"],[3,"form"],["appearance","bottom"],["routerLink","../..",3,"queryParams"],["appearance","primary",3,"click","disabled"]],template:function(e,i){e&1&&(r(0,"ya-instance-page"),c(1,"ya-instance-toolbar",0)(2,"app-create-band-wizard-step",1),r(3,"div",2)(4,"form",3)(5,"ya-field",4),c(6,"input",5),o(),r(7,"ya-field",6),c(8,"textarea",7),o(),r(9,"ya-field",8),c(10,"ya-tag-select",9),o(),c(11,"ya-field-divider"),r(12,"h4"),l(13,"Styles"),o(),c(14,"app-item-band-styles",10),o(),r(15,"p"),l(16,"\xA0"),o(),r(17,"ya-toolbar",11)(18,"ya-button",12),l(19,"Cancel"),o(),r(20,"ya-button",13),C("click",function(){return i.onConfirm()}),l(21," CREATE "),o()()()()),e&2&&(m(4),p("formGroup",i.form),m(10),p("form",i.form),m(4),p("queryParams",O(4,qa,i.yamcs.context)),m(2),p("disabled",!i.form.valid))},dependencies:[ye,oi,b,E,k,I,D,M,V,ee,L,R,de,H,W,je,ue],encapsulation:2,changeDetection:0});var Hn=Pi;var Wn="_overrideBand",Bi=class Bi{constructor(t,e,i,n,s){this.dialogRef=t;this.yamcs=i;this.messageService=n;this.data=s;this.startConstraintOptions=[{id:"START_ON",label:"Start on"}];let d=oe(ii,{});this.form=e.group({name:["",g.required],start:[le.toISOString(i.getMissionTime()),g.required],duration:["",g.required],tags:[[],[]],properties:e.group({backgroundColor:[d.backgroundColor,[]],backgroundColor_overrideBand:!1,borderColor:[d.borderColor,[]],borderColor_overrideBand:!1,borderWidth:[d.borderWidth,[]],borderWidth_overrideBand:!1,cornerRadius:[d.cornerRadius,[]],cornerRadius_overrideBand:!1,marginLeft:[d.marginLeft,[]],marginLeft_overrideBand:!1,textColor:[d.textColor,[]],textColor_overrideBand:!1,textSize:[d.textSize,[]],textSize_overrideBand:!1})}),this.updateDisabledState(),this.formSubscription=this.form.valueChanges.subscribe(()=>{this.updateDisabledState()})}updateDisabledState(){let{controls:t}=this.propertiesGroup;for(let e in t)if(e.endsWith(Wn)){let i=t[e.substring(0,e.length-Wn.length)];t[e].value?i.enable({onlySelf:!0}):i.disable({onlySelf:!0})}}get propertiesGroup(){return this.form.controls.properties}save(){let t={type:this.data.type,name:this.form.value.name,start:le.toISOString(this.form.value.start),duration:this.form.value.duration,tags:this.form.value.tags,properties:{}},{controls:e}=this.propertiesGroup;for(let i in e)if(i.endsWith(Wn)&&e[i].value){let n=i.substring(0,i.length-Wn.length);t.properties[n]=e[n].value}this.yamcs.yamcsClient.createTimelineItem(this.yamcs.instance,t).then(i=>this.dialogRef.close(i)).catch(i=>this.messageService.showError(i))}ngOnDestroy(){this.formSubscription?.unsubscribe()}};Bi.\u0275fac=function(e){return new(e||Bi)(u(Ge),u(pe),u(F),u(J),u(Ye))},Bi.\u0275cmp=_({type:Bi,selectors:[["ng-component"]],decls:27,vars:7,consts:[["mat-dialog-title",""],[1,"ya-form",3,"formGroup"],["animationDuration","0ms",1,"small-tabs",3,"mat-stretch-tabs"],["label","General"],[2,"margin-top","1em"],["label","Name"],["cdkFocusRegionstart","","type","text","formControlName","name"],["label","Tags"],["dialogTitle","Tags"],["formControlName","tags"],["label","Duration"],["formControlName","duration"],["label","Start"],["formControlName","start"],["label","Styles"],[3,"form"],["align","end"],["mat-dialog-close",""],["appearance","primary",3,"click","disabled"]],template:function(e,i){e&1&&(r(0,"h2",0),l(1),T(2,"lowercase"),o(),r(3,"mat-dialog-content")(4,"form",1)(5,"mat-tab-group",2)(6,"mat-tab",3)(7,"div",4)(8,"ya-field",5),c(9,"input",6),o(),r(10,"ya-field",7)(11,"ya-help",8),l(12," Tags allow to categorise items per band. Bands only show items for which one of the tags is matching. "),o(),c(13,"ya-tag-select",9),o(),r(14,"ya-field",10),c(15,"ya-duration-input",11),o(),c(16,"ya-field-divider"),r(17,"ya-field",12),c(18,"ya-date-time-input",13),o()()(),r(19,"mat-tab",14)(20,"div",4),c(21,"app-item-styles",15),o()()()()(),r(22,"mat-dialog-actions",16)(23,"ya-button",17),l(24,"CANCEL"),o(),r(25,"ya-button",18),C("click",function(){return i.save()}),l(26,"SAVE"),o()()),e&2&&(m(),A("Add ",B(2,5,i.data.type)," item"),m(3),p("formGroup",i.form),m(),p("mat-stretch-tabs",!1),m(16),p("form",i.form),m(4),p("disabled",!i.form.valid))},dependencies:[_t,b,E,k,I,D,M,V,qe,kt,Ft,Vt,gn,Cn,L,dt,Yt,R,de,Ne,je,Po],encapsulation:2,changeDetection:0});var Ii=Bi;var za=a=>({c:a}),ja=()=>[];function Ua(a,t){if(a&1){let e=G();r(0,"th",25),C("click",function(n){return v(e),X(2).toggle(),S(n.stopPropagation())}),c(1,"ya-table-checkbox",26,1),o()}if(a&2){let e=f(2);m(),p("dataSource",e.dataSource)("selection",e.selection)}}function Ha(a,t){if(a&1){let e=G();r(0,"td",27),C("click",function(n){return v(e),X(2).toggle(),S(n.stopPropagation())}),c(1,"ya-table-checkbox",28,1),o()}if(a&2){let e=t.$implicit,i=f(2);m(),p("dataSource",i.dataSource)("selection",i.selection)("item",e)}}function Wa(a,t){a&1&&(r(0,"th",29),l(1,"Label"),o())}function Qa(a,t){if(a&1&&l(0),a&2){let e=f().$implicit;A(" ",e.name," ")}}function Xa(a,t){a&1&&(r(0,"i"),l(1,"(none)"),o())}function Ja(a,t){if(a&1&&(r(0,"td",30)(1,"a",31),x(2,Qa,1,1),x(3,Xa,2,0,"i"),o()()),a&2){let e=t.$implicit,i=f(2);m(),p("routerLink",e.id)("queryParams",O(4,za,i.yamcs.context)),m(),w(e.name?2:-1),m(),w(e.name?-1:3)}}function Ka(a,t){a&1&&(r(0,"th",29),l(1,"Tags"),o())}function Za(a,t){if(a&1&&(r(0,"ya-label"),l(1),o()),a&2){let e=t.$implicit;m(),we(e)}}function el(a,t){a&1&&l(0," - ")}function tl(a,t){if(a&1&&(r(0,"td",30),me(1,Za,2,1,"ya-label",null,ge),x(3,el,1,0),o()),a&2){let e=t.$implicit;m(),ce(e.tags||on(1,ja)),m(2),w(e.tags?-1:3)}}function il(a,t){a&1&&(r(0,"th",29),l(1,"Start"),o())}function nl(a,t){if(a&1&&(r(0,"td",30),l(1),T(2,"datetime"),o()),a&2){let e=t.$implicit;m(),A(" ",B(2,1,e.start)||"-"," ")}}function ol(a,t){a&1&&(r(0,"th",29),l(1,"Duration"),o())}function rl(a,t){if(a&1&&(r(0,"td",30),l(1),o()),a&2){let e=t.$implicit;m(),A(" ",e.duration," ")}}function al(a,t){a&1&&(r(0,"th",29),l(1,"Type"),o())}function ll(a,t){if(a&1&&(r(0,"td",30),l(1),o()),a&2){let e=t.$implicit;m(),A(" ",e.type," ")}}function sl(a,t){a&1&&c(0,"th",32)}function ml(a,t){a&1&&c(0,"td",30)}function cl(a,t){a&1&&c(0,"tr",33)}function pl(a,t){if(a&1){let e=G();r(0,"tr",34),C("click",function(){let n=v(e).$implicit,s=f(2);return S(s.toggleOne(n))}),o()}if(a&2){let e=t.$implicit,i=f(2);re("selected",i.selection.isSelected(e))}}function dl(a,t){if(a&1&&(r(0,"table",8),K(1,9),$(2,Ua,3,2,"th",10)(3,Ha,3,3,"td",11),Z(),K(4,12),$(5,Wa,2,0,"th",13)(6,Ja,4,6,"td",14),Z(),K(7,15),$(8,Ka,2,0,"th",16)(9,tl,4,2,"td",17),Z(),K(10,18),$(11,il,2,0,"th",13)(12,nl,3,3,"td",14),Z(),K(13,19),$(14,ol,2,0,"th",13)(15,rl,2,1,"td",14),Z(),K(16,20),$(17,al,2,0,"th",13)(18,ll,2,1,"td",14),Z(),K(19,21),$(20,sl,1,0,"th",22)(21,ml,1,0,"td",14),Z(),$(22,cl,1,0,"tr",23)(23,pl,1,2,"tr",24),o()),a&2){let e=f();p("dataSource",e.dataSource)("trackBy",e.tableTrackerFn),m(22),p("matHeaderRowDef",e.displayedColumns),m(),p("matRowDefColumns",e.displayedColumns)}}var ki=class ki{constructor(t,e,i,n){this.yamcs=t;this.messageService=i;this.dialog=n;this.displayedColumns=["select","name","tags","start","duration","type","actions"];this.tableTrackerFn=(t,e)=>e.id;this.dataSource=new We;this.selection=new jt(this.tableTrackerFn,!0,[]);e.setTitle("Timeline items"),this.refreshData()}ngAfterViewInit(){this.dataSource.sort=this.sort}toggleOne(t){(!this.selection.isSelected(t)||this.selection.selected.length>1)&&this.selection.clear(),this.selection.toggle(t)}deleteSelectedItems(){if(confirm("Are you sure you want to delete the selected items?"))for(let t of this.selection.selected)this.deleteItem(t.id,!1)}deleteItem(t,e=!0){(!e||confirm("Are you sure you want to delete the selected item?"))&&this.yamcs.yamcsClient.deleteTimelineItem(this.yamcs.instance,t).then(()=>this.refreshData()).catch(i=>this.messageService.showError(i))}isGroupDeleteEnabled(){return!this.selection.isEmpty()}openCreateItemDialog(t){this.dialog.open(Ii,{width:"600px",panelClass:"dialog-force-no-scrollbar",data:{type:t}}).afterClosed().subscribe(()=>this.refreshData())}refreshData(){this.yamcs.yamcsClient.getTimelineItems(this.yamcs.instance,{source:"rdb"}).then(t=>{this.selection.matchNewValues(t.items||[]),this.dataSource.data=t.items||[]}).catch(t=>this.messageService.showError(t))}};ki.\u0275fac=function(e){return new(e||ki)(u(F),u(ae),u(J),u(fn))},ki.\u0275cmp=_({type:ki,selectors:[["ng-component"]],viewQuery:function(e,i){if(e&1&&Ee(Fe,5),e&2){let n;Me(n=Pe())&&(i.sort=n.first)}},decls:14,vars:4,consts:[["itemMenu","matMenu"],["cb",""],["label","Items"],["icon","add_box",3,"matMenuTriggerFor"],[1,"ya-menu",3,"overlapTrigger"],["mat-menu-item","","matTooltipShowDelay","1000","matTooltip","Events are items that simply appear on the timeline",3,"click"],["mat-menu-item","","matTooltipShowDelay","1000","matTooltip","Activities are like events, but in addition have an execution status",3,"click"],["icon","close",3,"clicked","disabled"],["mat-table","","matSort","","matSortActive","name","matSortDirection","asc","matSortDisableClear","",1,"ya-data-table","expand",3,"dataSource","trackBy"],["cdkColumnDef","select"],["mat-header-cell","","class","checkbox",3,"click",4,"cdkHeaderCellDef"],["mat-cell","","class","checkbox",3,"click",4,"cdkCellDef"],["matColumnDef","name"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["cdkColumnDef","tags"],["mat-header-cell","","mat-sort-header","",4,"cdkHeaderCellDef"],["mat-cell","",4,"cdkCellDef"],["matColumnDef","start"],["matColumnDef","duration"],["matColumnDef","type"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"selected","click",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",1,"checkbox",3,"click"],[3,"dataSource","selection"],["mat-cell","",1,"checkbox",3,"click"],[3,"dataSource","selection","item"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[3,"routerLink","queryParams"],["mat-header-cell","",1,"expand"],["mat-header-row",""],["mat-row","",3,"click"]],template:function(e,i){if(e&1){let n=G();r(0,"ya-instance-page")(1,"ya-instance-toolbar",2)(2,"ya-page-button",3),l(3,"Create item"),o(),r(4,"mat-menu",4,0)(6,"button",5),C("click",function(){return v(n),S(i.openCreateItemDialog("EVENT"))}),l(7," Event item "),o(),r(8,"button",6),C("click",function(){return v(n),S(i.openCreateItemDialog("ACTIVITY"))}),l(9," Activity item "),o()(),r(10,"ya-page-button",7),C("clicked",function(){return v(n),S(i.deleteSelectedItems())}),l(11," Delete "),o()(),r(12,"ya-panel"),x(13,dl,24,4,"table",8),o()()}if(e&2){let n=X(5);m(2),p("matMenuTriggerFor",n),m(2),p("overlapTrigger",!1),m(6),p("disabled",!i.isGroupDeleteEnabled()),m(3),w(i.dataSource?13:-1)}},dependencies:[b,ee,it,nt,ot,dn,pn,un,Fe,Nt,rt,Ot,Lt,At,Rt,Gt,at,lt,st,mt,Ve,H,W,vn,ut,ft,zt,ze],encapsulation:2,changeDetection:0});var Qn=ki;var ul=a=>({c:a});function fl(a,t){if(a&1){let e=G();r(0,"ya-stepper-step",10)(1,"ya-stepper-step-actions")(2,"ya-icon-action",14),C("click",function(){let n=v(e).$index,s=f();return S(s.moveUp(n))}),o(),r(3,"ya-icon-action",15),C("click",function(){let n=v(e).$index,s=f();return S(s.moveDown(n))}),o(),r(4,"ya-icon-action",16),C("click",function(){let n=v(e).$index,s=f();return S(s.removeTrace(n))}),o(),r(5,"ya-icon-action",17),C("click",function(){let n=v(e).$index,s=f();return S(s.addTrace(n))}),o()(),c(6,"app-trace-styles",9),o()}if(a&2){let e=t.$implicit,i=t.$index,n=f();p("label",nn("Trace ",i+1))("expanded",!0),m(2),p("disabled",i===0),m(),p("disabled",i>=n.traces.controls.length-1),m(),p("disabled",n.traces.controls.length<=1),m(2),p("form",e)}}var Vi=class Vi extends ct{constructor(e){super();this.formBuilder=e;this.setTitle("Configure parameter plot"),this.form=e.group({name:["",[g.required]],description:"",traces:e.array([]),properties:e.group({frozen:[he.frozen.defaultValue,[g.required]],height:[he.height.defaultValue,[g.required]],minimum:[],maximum:[],zeroLineWidth:[he.zeroLineWidth.defaultValue,[g.required]],zeroLineColor:[he.zeroLineColor.defaultValue,[g.required]],minimumFractionDigits:[he.minimumFractionDigits.defaultValue,[g.required]],maximumFractionDigits:[he.maximumFractionDigits.defaultValue,[g.required]]})}),this.addTrace()}get traces(){return this.form.controls.traces}addTrace(e){let i=e===void 0?0:e+1,n=si[i%si.length],s=this.formBuilder.group({parameter:["",[g.required]],lineColor:[n,[g.required]],visible:[!0,[g.required]],lineWidth:[1,[g.required]],minMax:[!0,[g.required]],minMaxOpacity:[.17,[g.required]],fill:[!1,[g.required]],fillColor:["#dddddd",[g.required]]});e!==void 0?this.traces.insert(e+1,s):this.traces.push(s)}removeTrace(e){this.traces.removeAt(e)}moveUp(e){let i=this.traces.at(e);this.traces.removeAt(e),this.traces.insert(e-1,i)}moveDown(e){let i=this.traces.at(e);this.traces.removeAt(e),this.traces.insert(e+1,i)}onConfirm(){let e=this.form.value,i={name:e.name,description:e.description,type:"PARAMETER_PLOT",shared:!0,properties:{}};for(let n in e.properties){let s=e.properties[n];s!==null&&(i.properties[n]=s)}for(let n=0;n<this.traces.length;n++){let s=this.traces.at(n);for(let d in s.controls){let h=`trace_${n+1}_${d}`,y=s.controls[d].value;i.properties[h]=y}}yt(i.properties||{}),this.yamcs.yamcsClient.createTimelineBand(this.yamcs.instance,i).then(()=>this.router.navigateByUrl(`/timeline/bands?c=${this.yamcs.context}`)).catch(n=>this.messageService.showError(n))}};Vi.\u0275fac=function(i){return new(i||Vi)(u(ke))},Vi.\u0275cmp=_({type:Vi,selectors:[["app-create-parameter-plot"]],features:[et],decls:21,vars:7,consts:[["label","Create band"],["step","2"],[1,"form-content","ya-form"],["novalidate","","autocomplete","off",3,"formGroup"],["label","General",3,"expanded"],["label","Label","hint","(required)"],["type","text","formControlName","name",2,"width","100%"],["label","Description","hint","(optional)"],["formControlName","description","rows","3"],[3,"form"],[3,"label","expanded"],["appearance","bottom"],["routerLink","../..",3,"queryParams"],["appearance","primary",3,"click","disabled"],["icon","arrow_drop_up","matTooltip","Move up",3,"click","disabled"],["icon","arrow_drop_down","matTooltip","Move down",3,"click","disabled"],["icon","delete_outline","matTooltip","Remove trace",3,"click","disabled"],["icon","add_circle","matTooltip","Add trace below",3,"click"]],template:function(i,n){i&1&&(r(0,"ya-instance-page"),c(1,"ya-instance-toolbar",0)(2,"app-create-band-wizard-step",1),r(3,"div",2)(4,"form",3)(5,"ya-stepper")(6,"ya-stepper-step",4)(7,"ya-field",5),c(8,"input",6),o(),r(9,"ya-field",7),c(10,"textarea",8),o(),c(11,"app-parameter-plot-styles",9),o(),me(12,fl,7,7,"ya-stepper-step",10,ge),o()(),r(14,"p"),l(15,"\xA0"),o(),r(16,"ya-toolbar",11)(17,"ya-button",12),l(18,"Cancel"),o(),r(19,"ya-button",13),C("click",function(){return n.onConfirm()}),l(20," CREATE "),o()()()()),i&2&&(m(4),p("formGroup",n.form),m(2),p("expanded",!0),m(5),p("form",n.form),m(),ce(n.traces.controls),m(5),p("queryParams",O(5,ul,n.yamcs.context)),m(2),p("disabled",!n.form.valid))},dependencies:[ye,ci,di,b,E,k,I,D,M,V,ee,Ve,L,R,pt,H,W,gt,ht,Sn,ue],encapsulation:2,changeDetection:0});var Xn=Vi;var hl=a=>({c:a});function gl(a,t){a&1&&c(0,"input",21)}function Cl(a,t){a&1&&c(0,"input",28)(1,"input",29)}function yl(a,t){if(a&1){let e=G();r(0,"tr",19)(1,"td"),c(2,"input",20,0),l(4),T(5,"titlecase"),o(),r(6,"td"),x(7,gl,1,0,"input",21)(8,Cl,2,0),o(),r(9,"td"),l(10,"\u2192"),o(),r(11,"td"),c(12,"input",22),o(),r(13,"td"),c(14,"ya-color-input",23),o(),r(15,"td",24)(16,"ya-icon-action",25),C("click",function(){let n=v(e).$index,s=f(2);return S(s.moveUp(n))}),o(),r(17,"ya-icon-action",26),C("click",function(){let n=v(e).$index,s=f(2);return S(s.moveDown(n))}),o(),r(18,"ya-icon-action",27),C("click",function(){let n=v(e).$index,s=f(2);return S(s.removeMapping(n))}),o()()()}if(a&2){let e=t.$implicit,i=t.$index,n=X(3),s=f(2);p("formGroupName",i),m(4),A(" ",B(5,5,e.value.type)," "),m(3),w(n.value==="value"?7:n.value==="range"?8:-1),m(9),p("disabled",i===0),m(),p("disabled",i>=s.valueMappings.controls.length-1)}}function _l(a,t){if(a&1&&(r(0,"table",16)(1,"tr")(2,"th"),l(3,"Type"),o(),r(4,"th"),l(5," Condition "),r(6,"span",17),l(7,"(required)"),o()(),c(8,"th"),r(9,"th"),l(10,"Label"),o(),r(11,"th"),l(12,"Color"),o(),c(13,"th",18),o(),me(14,yl,19,7,"tr",19,ge),o(),c(16,"br")),a&2){let e=f();m(14),ce(e.valueMappings.controls)}}var Fi=class Fi extends ct{constructor(e){super();this.formBuilder=e;this.setTitle("Configure parameter states"),this.form=e.group({name:["",[g.required]],description:"",valueMappings:e.array([]),properties:e.group({frozen:[Ke.frozen.defaultValue,[g.required]],height:[Ke.height.defaultValue,[g.required]],parameter:["",[g.required]]})})}get valueMappings(){return this.form.controls.valueMappings}addValueMapping(){let e=this.formBuilder.group({type:["value",[g.required]],value:["",[g.required]],label:[""],color:[""]});this.valueMappings.push(e)}addRangeMapping(){let e=this.formBuilder.group({type:["range",[g.required]],start:["",[g.required]],end:["",[g.required]],label:[""],color:[""]});this.valueMappings.push(e)}removeMapping(e){this.valueMappings.removeAt(e)}moveUp(e){let i=this.valueMappings.at(e);this.valueMappings.removeAt(e),this.valueMappings.insert(e-1,i)}moveDown(e){let i=this.valueMappings.at(e);this.valueMappings.removeAt(e),this.valueMappings.insert(e+1,i)}onConfirm(){let e=this.form.value,i={name:e.name,description:e.description,type:"PARAMETER_STATES",shared:!0,properties:{}};for(let n in e.properties){let s=e.properties[n];s!==null&&(i.properties[n]=s)}for(let n=0;n<this.valueMappings.length;n++){let s=this.valueMappings.at(n);for(let d in s.controls){let h=`value_mapping_${n}_${d}`,y=s.controls[d].value;i.properties[h]=y}}yt(i.properties||{}),this.yamcs.yamcsClient.createTimelineBand(this.yamcs.instance,i).then(()=>this.router.navigateByUrl(`/timeline/bands?c=${this.yamcs.context}`)).catch(n=>this.messageService.showError(n))}};Fi.\u0275fac=function(i){return new(i||Fi)(u(ke))},Fi.\u0275cmp=_({type:Fi,selectors:[["app-create-parameter-states"]],features:[et],decls:26,vars:9,consts:[["type",""],["label","Create band"],["step","2"],[1,"form-content","ya-form"],["novalidate","","autocomplete","off",3,"formGroup"],["label","General",3,"expanded"],["label","Label","hint","(required)"],["type","text","formControlName","name",2,"width","100%"],["label","Description","hint","(optional)"],["formControlName","description","rows","3"],[3,"form"],["label","Value mapping",3,"expanded"],["icon","add_circle",3,"click"],["appearance","bottom"],["routerLink","../..",3,"queryParams"],["appearance","primary",3,"click","disabled"],["formArrayName","valueMappings",1,"mappings"],[1,"hint"],[2,"width","99%"],[3,"formGroupName"],["type","hidden","formControlName","type"],["type","text","placeholder","value","formControlName","value",2,"width","164px"],["type","text","placeholder","(optional)","formControlName","label",2,"width","140px"],["formControlName","color","label","auto"],[2,"text-align","right"],["icon","arrow_drop_up","matTooltip","Move up",3,"click","disabled"],["icon","arrow_drop_down","matTooltip","Move down",3,"click","disabled"],["icon","delete_outline","matTooltip","Remove mapping",3,"click"],["type","number","placeholder","start","formControlName","start",2,"display","inline-block","width","80px","margin-right","4px"],["type","number","placeholder","end","formControlName","end",2,"display","inline-block","width","80px"]],template:function(i,n){i&1&&(r(0,"ya-instance-page"),c(1,"ya-instance-toolbar",1)(2,"app-create-band-wizard-step",2),r(3,"div",3)(4,"form",4)(5,"ya-stepper")(6,"ya-stepper-step",5)(7,"ya-field",6),c(8,"input",7),o(),r(9,"ya-field",8),c(10,"textarea",9),o(),c(11,"app-parameter-states-styles",10),o(),r(12,"ya-stepper-step",11),x(13,_l,17,0),r(14,"ya-button",12),C("click",function(){return n.addValueMapping()}),l(15,"Add value mapping"),o(),l(16," \xA0 "),r(17,"ya-button",12),C("click",function(){return n.addRangeMapping()}),l(18,"Add range mapping"),o()()()(),r(19,"p"),l(20,"\xA0"),o(),r(21,"ya-toolbar",13)(22,"ya-button",14),l(23,"Cancel"),o(),r(24,"ya-button",15),C("click",function(){return n.onConfirm()}),l(25," CREATE "),o()()()()),i&2&&(m(4),p("formGroup",n.form),m(2),p("expanded",!0),m(5),p("form",n.form),m(),p("expanded",!0),m(),w(n.valueMappings.length?13:-1),m(9),p("queryParams",O(7,hl,n.yamcs.context)),m(2),p("disabled",!n.form.valid))},dependencies:[ye,Ci,b,E,k,Ce,I,D,M,V,fe,mn,ee,Ve,L,yn,R,pt,H,W,gt,ht,ue,an],styles:["table.mappings[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{white-space:nowrap}table.mappings[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:not(:first-child), table.mappings[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:not(:first-child){padding-left:5px}table.mappings[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:not(:last-child), table.mappings[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:not(:last-child){padding-right:5px}"],changeDetection:0});var Jn=Fi;var bl=a=>({c:a}),Ni=class Ni extends ct{constructor(t){super(),this.setTitle("Configure Spacer"),this.form=t.group({name:"",description:"",properties:t.group({height:[qn.height.defaultValue,[g.required]]})})}onConfirm(){let t=this.form.value;this.yamcs.yamcsClient.createTimelineBand(this.yamcs.instance,{name:t.name,description:t.description,type:"SPACER",shared:!0,properties:t.properties}).then(()=>this.router.navigateByUrl(`/timeline/bands?c=${this.yamcs.context}`)).catch(e=>this.messageService.showError(e))}};Ni.\u0275fac=function(e){return new(e||Ni)(u(ke))},Ni.\u0275cmp=_({type:Ni,selectors:[["ng-component"]],features:[et],decls:20,vars:6,consts:[["label","Create band"],["step","2"],[1,"form-content","ya-form"],["novalidate","","autocomplete","off",3,"formGroup"],["label","Label","hint","(optional)"],["type","text","formControlName","name",2,"width","100%"],["label","Description","hint","(optional)"],["formControlName","description","rows","3"],[3,"form"],["appearance","bottom"],["routerLink","../..",3,"queryParams"],["appearance","primary",3,"click","disabled"]],template:function(e,i){e&1&&(r(0,"ya-instance-page"),c(1,"ya-instance-toolbar",0)(2,"app-create-band-wizard-step",1),r(3,"div",2)(4,"form",3)(5,"ya-field",4),c(6,"input",5),o(),r(7,"ya-field",6),c(8,"textarea",7),o(),c(9,"ya-field-divider"),r(10,"h4"),l(11,"Styles"),o(),c(12,"app-spacer-styles",8),o(),r(13,"p"),l(14,"\xA0"),o(),r(15,"ya-toolbar",9)(16,"ya-button",10),l(17,"Cancel"),o(),r(18,"ya-button",11),C("click",function(){return i.onConfirm()}),l(19," CREATE "),o()()()()),e&2&&(m(4),p("formGroup",i.form),m(8),p("form",i.form),m(4),p("queryParams",O(4,bl,i.yamcs.context)),m(2),p("disabled",!i.form.valid))},dependencies:[ye,b,E,k,I,D,M,V,ee,L,R,de,H,W,ue,vi],encapsulation:2,changeDetection:0});var Kn=Ni;var vl=a=>({c:a}),Ri=class Ri extends ct{constructor(t){super(),this.setTitle("Configure Time Ruler"),this.form=t.group({name:["",[g.required]],description:"",properties:t.group({timezone:["UTC",[g.required]]})})}onConfirm(){let t=this.form.value;this.yamcs.yamcsClient.createTimelineBand(this.yamcs.instance,{name:t.name,description:t.description,type:"TIME_RULER",shared:!0,properties:t.properties}).then(()=>this.router.navigateByUrl(`/timeline/bands?c=${this.yamcs.context}`)).catch(e=>this.messageService.showError(e))}};Ri.\u0275fac=function(e){return new(e||Ri)(u(pe))},Ri.\u0275cmp=_({type:Ri,selectors:[["ng-component"]],features:[et],decls:19,vars:5,consts:[["label","Create band"],["step","2"],[1,"form-content","ya-form"],["novalidate","","autocomplete","off",3,"formGroup"],["label","Label","hint","(required)"],["type","text","formControlName","name"],["label","Description","hint","(optional)"],["formControlName","description","rows","3"],["formGroupName","properties"],["label","Timezone"],["formControlName","timezone"],["appearance","bottom"],["routerLink","../..",3,"queryParams"],["appearance","primary",3,"click","disabled"]],template:function(e,i){e&1&&(r(0,"ya-instance-page"),c(1,"ya-instance-toolbar",0)(2,"app-create-band-wizard-step",1),r(3,"div",2)(4,"form",3)(5,"ya-field",4),c(6,"input",5),o(),r(7,"ya-field",6),c(8,"textarea",7),o(),K(9,8),r(10,"ya-field",9),c(11,"ya-timezone-select",10),o(),Z(),o(),r(12,"p"),l(13,"\xA0"),o(),r(14,"ya-toolbar",11)(15,"ya-button",12),l(16,"Cancel"),o(),r(17,"ya-button",13),C("click",function(){return i.onConfirm()}),l(18," CREATE "),o()()()()),e&2&&(m(4),p("formGroup",i.form),m(11),p("queryParams",O(3,vl,i.yamcs.context)),m(2),p("disabled",!i.form.valid))},dependencies:[ye,b,E,k,I,D,M,V,fe,ee,L,R,H,W,xn,ue],encapsulation:2,changeDetection:0});var Zn=Ri;var Ki=class extends Xe{constructor(t,e){super(t.timeline),this.label=e.name,this.paddingBottom=7,this.paddingTop=7,this.lineSpacing=2,this.itemHeight=20,this.data={band:e}}};function Sl(a,t){if(a&1&&c(0,"app-edit-item-band",6),a&2){let e=f(),i=f();p("form",i.form)("band",e)}}function xl(a,t){if(a&1&&c(0,"app-edit-spacer",6),a&2){let e=f(),i=f();p("form",i.form)("band",e)}}function wl(a,t){if(a&1&&c(0,"app-edit-time-ruler",6),a&2){let e=f(),i=f();p("form",i.form)("band",e)}}function Tl(a,t){if(a&1&&c(0,"app-edit-command-band",6),a&2){let e=f(),i=f();p("form",i.form)("band",e)}}function Dl(a,t){if(a&1&&c(0,"app-edit-parameter-plot",6),a&2){let e=f(),i=f();p("form",i.form)("band",e)}}function El(a,t){if(a&1&&c(0,"app-edit-parameter-states",6),a&2){let e=f(),i=f();p("form",i.form)("band",e)}}function Ml(a,t){if(a&1&&(r(0,"div",1)(1,"h2"),l(2,"Edit band"),o(),r(3,"form",5),x(4,Sl,1,2,"app-edit-item-band",6)(5,xl,1,2,"app-edit-spacer",6)(6,wl,1,2,"app-edit-time-ruler",6)(7,Tl,1,2,"app-edit-command-band",6)(8,Dl,1,2,"app-edit-parameter-plot",6)(9,El,1,2,"app-edit-parameter-states",6),o()()),a&2){let e=t,i=f();m(3),p("formGroup",i.form),m(),w(e.type==="ITEM_BAND"?4:e.type==="SPACER"?5:e.type==="TIME_RULER"?6:e.type==="COMMAND_BAND"?7:e.type==="PARAMETER_PLOT"?8:e.type==="PARAMETER_STATES"?9:-1)}}var Oi=class Oi{constructor(t,e,i,n,s){this.dialogRef=t;this.yamcs=e;this.messageService=i;this.data=s;this.dirty$=new U(!1);let d=s.band;this.form=n.group({name:[d.name,[g.required]],description:[d.description||""],tags:[d.tags||[]],traces:n.array([]),valueMappings:n.array([]),properties:n.group({})}),this.formSubscription=this.form.valueChanges.subscribe(()=>{this.dirty$.next(!0)})}doOnConfirm(){let t=this.form.value,e={name:t.name,description:t.description,shared:this.data.band.shared,tags:t.tags,properties:t.properties};for(let i=0;i<this.traces.length;i++){let n=this.traces.at(i);for(let s in n.controls){let d=`trace_${i+1}_${s}`,h=n.controls[s].value;e.properties[d]=h}}for(let i=0;i<this.valueMappings.length;i++){let n=this.valueMappings.at(i);for(let s in n.controls){let d=`value_mapping_${i}_${s}`,h=n.controls[s].value;e.properties[d]=h}}yt(e.properties||{}),this.yamcs.yamcsClient.updateTimelineBand(this.yamcs.instance,this.data.band.id,e).then(i=>this.dialogRef.close(i)).catch(i=>this.messageService.showError(i))}get traces(){return this.form.controls.traces}get valueMappings(){return this.form.controls.valueMappings}ngOnDestroy(){this.formSubscription?.unsubscribe()}};Oi.\u0275fac=function(e){return new(e||Oi)(u(Ge),u(F),u(J),u(ke),u(Ye))},Oi.\u0275cmp=_({type:Oi,selectors:[["ng-component"]],decls:11,vars:4,consts:[[1,"central-pane"],[1,"ya-form",2,"max-width","600px"],[1,"footer"],["mat-dialog-close",""],["appearance","primary",3,"click","disabled"],["novalidate","","autocomplete","off",3,"formGroup"],[3,"form","band"]],template:function(e,i){if(e&1&&(r(0,"div",0),x(1,Ml,10,2,"div",1),o(),r(2,"div",2)(3,"mat-toolbar")(4,"mat-toolbar-row")(5,"ya-button",3),l(6,"CANCEL"),o(),l(7," \xA0\xA0 "),r(8,"ya-button",4),T(9,"async"),C("click",function(){return i.doOnConfirm()}),l(10," SAVE CHANGES "),o()()()()),e&2){let n;m(),w((n=i.data.band)?1:-1,n),m(7),p("disabled",!B(9,2,i.dirty$)||!i.form.valid)}},dependencies:[Kt,ai,fi,_i,xi,Ti,b,E,D,M,qe,It,Bt,L,ne],styles:[".mat-mdc-dialog-container{border-radius:0;position:relative}.central-pane[_ngcontent-%COMP%]{position:absolute;inset:0 0 64px;overflow:auto;padding:24px;font:400 12px/20px Roboto,sans-serif}.footer[_ngcontent-%COMP%]{position:absolute;bottom:0;height:64px;left:0;right:0;border-top:1px solid #d3d3d3}"],changeDetection:0});var eo=Oi;var Ai=class Ai{constructor(t,e,i,n,s){this.dialogRef=t;this.yamcs=e;this.messageService=n;this.data=s;this.dirty$=new U(!1);let d=s.view;this.form=i.group({name:[d.name,g.required],bands:[d.bands||[],[]]}),this.formSubscription=this.form.valueChanges.subscribe(()=>{this.dirty$.next(!0)})}onConfirm(){let t=this.form.value,e={name:t.name,bands:t.bands.map(n=>n.id)},i=this.data.view;this.yamcs.yamcsClient.updateTimelineView(this.yamcs.instance,i.id,e).then(n=>this.dialogRef.close(n)).catch(n=>this.messageService.showError(n))}ngOnDestroy(){this.formSubscription?.unsubscribe()}};Ai.\u0275fac=function(e){return new(e||Ai)(u(Ge),u(F),u(pe),u(J),u(Ye))},Ai.\u0275cmp=_({type:Ai,selectors:[["app-edit-view-dialog"]],decls:19,vars:4,consts:[[1,"ya-form",2,"max-width","600px"],["novalidate","","autocomplete","off",3,"formGroup"],["label","Name","hint","(required)"],["type","text","formControlName","name"],["formControlName","bands"],[1,"footer"],["mat-dialog-close",""],["appearance","primary",3,"click","disabled"]],template:function(e,i){e&1&&(r(0,"div",0)(1,"form",1)(2,"h2"),l(3,"Edit view"),o(),r(4,"ya-field",2),c(5,"input",3),o(),c(6,"ya-field-divider"),r(7,"h4"),l(8,"Bands"),o(),c(9,"app-band-multi-select",4),o()(),r(10,"div",5)(11,"mat-toolbar")(12,"mat-toolbar-row")(13,"ya-button",6),l(14,"CANCEL"),o(),l(15," \xA0\xA0 "),r(16,"ya-button",7),T(17,"async"),C("click",function(){return i.onConfirm()}),l(18," SAVE CHANGES "),o()()()()),e&2&&(m(),p("formGroup",i.form),m(15),p("disabled",!B(17,2,i.dirty$)||!i.form.valid))},dependencies:[Ct,b,E,k,I,D,M,V,qe,It,Bt,L,R,de,ne],styles:[".mat-mdc-dialog-container{border-radius:0;position:relative}.footer[_ngcontent-%COMP%]{position:absolute;bottom:0;height:64px;left:0;right:0;border-top:1px solid #d3d3d3}"],changeDetection:0});var to=Ai;var Li=class Li{constructor(t,e){this.dialogRef=t;this.data=e;this.date=new Pt(null,[g.required]);this.data.date&&this.date.setValue(le.toISOString(this.data.date))}select(){let t=le.toDate(this.date.value);this.dialogRef.close({date:t})}};Li.\u0275fac=function(e){return new(e||Li)(u(Ge),u(Ye))},Li.\u0275cmp=_({type:Li,selectors:[["ng-component"]],decls:10,vars:2,consts:[["mat-dialog-title",""],[1,"ya-form"],["label","Date"],[3,"formControl","showNow"],["align","end"],["mat-dialog-close",""],["appearance","primary",3,"click"]],template:function(e,i){e&1&&(r(0,"h2",0),l(1,"Jump to date"),o(),r(2,"mat-dialog-content",1)(3,"ya-field",2),c(4,"ya-date-time-input",3),o()(),r(5,"mat-dialog-actions",4)(6,"ya-button",5),l(7,"CANCEL"),o(),r(8,"ya-button",6),C("click",function(){return i.select()}),l(9,"OK"),o()()),e&2&&(m(4),p("formControl",i.date)("showNow",!0))},dependencies:[b,I,Vo,qe,kt,Ft,Vt,L,dt,R],encapsulation:2,changeDetection:0});var io=Li;var no=class extends Tn{constructor(t,e){super(t.timeline),this.contentHeight=20,this.label=e.name,this.timezone=e.properties.timezone,this.data={band:e}}};var Pl=["container"],dr=a=>({c:a});function Bl(a,t){if(a&1&&(r(0,"ya-page-button",18),l(1),T(2,"async"),o()),a&2){let e;f();let i=X(3),n=f();p("matMenuTriggerFor",i),m(),A(" ",((e=B(2,2,n.view$))==null?null:e.name)||"select view"," ")}}function Il(a,t){if(a&1){let e=G();r(0,"button",22),C("click",function(){let n=v(e).$implicit,s=f(2);return S(s.switchView(n))}),l(1),o()}if(a&2){let e=t.$implicit;m(),A(" ",e.name," ")}}function kl(a,t){if(a&1&&(x(0,Bl,3,4,"ya-page-button",18),T(1,"async"),r(2,"mat-menu",19,1),me(4,Il,2,1,"button",20,ge),c(6,"mat-divider"),r(7,"a",21)(8,"mat-icon"),l(9,"add_circle"),o(),l(10," Create view "),o()()),a&2){let e=f();w(B(1,2,e.view$)&&e.mayControlTimeline()?0:-1),m(4),ce(t),m(3),p("queryParams",O(4,dr,e.yamcs.context))}}function Vl(a,t){if(a&1&&(r(0,"ya-page-button",23),l(1," Create view "),o()),a&2){let e=f(2);p("queryParams",O(1,dr,e.yamcs.context))}}function Fl(a,t){if(a&1){let e=G();r(0,"ya-page-button",30),C("clicked",function(){let n=v(e),s=f(2);return S(s.openEditViewDialog(n))}),l(1," Edit view "),o()}}function Nl(a,t){if(a&1&&(r(0,"ya-page-button",25),l(1,"Add item"),o()),a&2){f();let e=X(7);p("matMenuTriggerFor",e)}}function Rl(a,t){if(a&1){let e=G();r(0,"ya-page-button",31),C("clicked",function(){v(e);let n=f(2);return S(n.saveSnapshot())}),l(1," Save snapshot "),o()}}function Ol(a,t){if(a&1){let e=G();x(0,Vl,2,3,"ya-page-button",23),T(1,"async"),x(2,Fl,2,0,"ya-page-button",24),T(3,"async"),x(4,Nl,2,1,"ya-page-button",25),T(5,"async"),r(6,"mat-menu",26,2)(8,"button",27),C("click",function(){v(e);let n=f();return S(n.openCreateItemDialog("EVENT"))}),l(9," Event item "),o(),r(10,"button",28),C("click",function(){v(e);let n=f();return S(n.openCreateItemDialog("ACTIVITY"))}),l(11," Activity item "),o()(),x(12,Rl,2,0,"ya-page-button",29),T(13,"async")}if(a&2){let e,i=f();w(B(1,5,i.view$)?-1:0),m(2),w((e=B(3,7,i.view$))?2:-1,e),m(2),w(B(5,9,i.view$)?4:-1),m(2),p("overlapTrigger",!1),m(6),w(B(13,11,i.view$)?12:-1)}}function Al(a,t){if(a&1&&(r(0,"span"),l(1),T(2,"datetime"),T(3,"datetime"),o()),a&2){let e=t;m(),Do(" ",rn(2,2,e==null?null:e.start,!1)," \u2013 ",B(3,5,e==null?null:e.stop)," ")}}var Gi=class Gi{constructor(t,e,i,n,s,d,h,y,P,N,j){this.yamcs=e;this.dialog=i;this.messageService=n;this.formatter=s;this.route=d;this.router=h;this.authService=y;this.synchronizer=P;this.configService=N;this.overlay=j;this.views$=new U([]);this.view$=new U(null);this.viewportRange$=new U(null);this.bands=[];this.subscriptions=[];t.setTitle("Timeline chart")}ngAfterViewInit(){let t=this.route.snapshot.queryParamMap,e=t.get("view");if(this.yamcs.yamcsClient.getTimelineViews(this.yamcs.instance).then(n=>{this.views$.next(n.views||[]);let s=null;for(let d of n.views||[])if(e===d.id){s=d;break}!s&&!e&&(s=n.views?.length?n.views[0]:null),s&&this.switchView(s)}),this.timeline=new Qe(this.container.nativeElement),this.timeline.addViewportChangeListener(n=>{this.viewportRange$.next({start:new Date(n.start),stop:new Date(n.stop)})}),this.viewportRange$.pipe(So(400)).forEach(n=>{this.refreshData(),this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParamsHandling:"merge",queryParams:{start:n.start.toISOString(),stop:n.stop.toISOString()}})}),t.get("start")&&t.get("stop")){let n=le.toDate(t.get("start")),s=le.toDate(t.get("stop"));this.timeline.setViewRange(n.getTime(),s.getTime())}else{let n=this.yamcs.getMissionTime(),s=wt(n,-30),d=wt(n,30);this.timeline.setViewRange(s.getTime(),d.getTime())}let i=new Jo(this.timeline);i.time=this.yamcs.getMissionTime().getTime(),this.subscriptions.push(this.synchronizer.sync(()=>{i.time=this.yamcs.getMissionTime().getTime()})),new Ko(this.timeline),new er(this.timeline,this.formatter),this.refreshData()}refreshView(){let t=this.view$.value;t&&this.yamcs.yamcsClient.getTimelineView(this.yamcs.instance,t.id).then(e=>this.switchView(e)).catch(e=>this.messageService.showError(e))}switchView(t){this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{view:t?.id||null},queryParamsHandling:"merge"}),this.view$.next(t);for(let e of this.timeline.getBands())this.timeline.removeChild(e);if(t){for(let e of t.bands||[])if(e.type==="TIME_RULER"){let i=new no(this,e);this.bands.push(i),this.installBandListeners(i)}else if(e.type==="ITEM_BAND"){let i=new Wi(this,e,this.dialog);this.bands.push(i),this.installBandListeners(i)}else if(e.type==="SPACER"){let i=new Hi(this.timeline);this.bands.push(i)}else if(e.type==="COMMAND_BAND"){let i=new Ki(this,e);this.bands.push(i),this.installBandListeners(i)}else if(e.type==="PARAMETER_PLOT"){let i=new Qi(this,e,this.yamcs,this.synchronizer,this.configService,this.overlay);this.bands.push(i),this.installBandListeners(i)}else if(e.type==="PARAMETER_STATES"){let i=new Ji(this,e,this.yamcs,this.synchronizer,this.formatter,this.configService,this.overlay);this.bands.push(i),this.installBandListeners(i)}this.refreshData()}}onVisibilityChange(){document.hidden||this.refreshView()}installBandListeners(t){t.addHeaderClickListener(e=>{let i=e.band.data.band;this.dialog.open(eo,{width:"70%",height:"100%",autoFocus:!1,position:{right:"0"},panelClass:"dialog-full-size",data:{band:i}}).afterClosed().subscribe(s=>{s&&this.refreshView()})})}refreshData(){let t=[],e=[],i=this.timeline.stop-this.timeline.start,n=this.timeline.start-i,s=this.timeline.stop+i;for(let d of this.bands)d instanceof Wi?(t.push(d),e.push(this.yamcs.yamcsClient.getTimelineItems(this.yamcs.instance,{source:"rdb",band:d.data.band.id,start:new Date(n).toISOString(),stop:new Date(s).toISOString()}))):d instanceof Ki?(t.push(d),e.push(this.yamcs.yamcsClient.getTimelineItems(this.yamcs.instance,{source:"commands",band:d.data.band.id,start:new Date(n).toISOString(),stop:new Date(s).toISOString()}))):(d instanceof Qi||d instanceof Ji)&&d.refreshData();e.length&&Promise.all(e).then(d=>{for(let h=0;h<d.length;h++){let y=t[h];this.populateItems(y,d[h].items||[])}}).catch(d=>this.messageService.showError(d))}populateItems(t,e){let i=[];for(let n of e){let s=le.toDate(n.start).getTime(),d=le.convertProtoDurationToMillis(n.duration),h={start:s,stop:d?s+d:void 0,label:n.name,data:{item:n}},{properties:y}=n;if(y&&("backgroundColor"in y&&(h.background=y.backgroundColor),"borderColor"in y&&(h.borderColor=y.borderColor),"borderWidth"in y&&(h.borderWidth=Number(y.borderWidth)),"cornerRadius"in y&&(h.cornerRadius=Number(y.cornerRadius)),"marginLeft"in y&&(h.paddingLeft=Number(y.marginLeft)),"textColor"in y&&(h.textColor=y.textColor),"textSize"in y&&(h.textSize=Number(y.textSize))),n.status)switch(n.status){case"COMPLETED":h.label=h.label?h.label+" \u2713":"\u2713";break;case"FAILED":h.label=h.label?h.label+" \u2717":"\u2717";break;case"PLANNED":case"IN_PROGRESS":h.label=h.label?h.label+" \u25F7":"\u25F7";break;case"ABORTED":h.label=h.label?h.label+" \u23F9":"\u23F9";break}i.push(h)}t.items=i}openCreateItemDialog(t){this.dialog.open(Ii,{width:"600px",panelClass:"dialog-force-no-scrollbar",data:{type:t}}).afterClosed().subscribe(()=>this.refreshData())}openEditViewDialog(t){this.dialog.open(to,{width:"70%",height:"100%",panelClass:"dialog-full-size",autoFocus:!1,position:{right:"0"},data:{view:t}}).afterClosed().subscribe(e=>{e&&this.switchView(e)})}toggleMove(t){this.timeline.panBy(t),window.clearInterval(this.moveInterval),this.moveInterval=window.setInterval(()=>this.timeline.panBy(t),50)}untoggleMove(){window.clearInterval(this.moveInterval),this.moveInterval=void 0}pageLeft(){let{start:t,stop:e}=this.timeline,i=this.timeline.distanceBetween(t,e);this.timeline.panBy(-i)}pageRight(){let{start:t,stop:e}=this.timeline,i=this.timeline.distanceBetween(t,e);this.timeline.panBy(i)}zoomIn(){this.timeline.zoomIn()}zoomOut(){this.timeline.zoomOut()}show3Hours(){let t=this.timeline.start+(this.timeline.stop-this.timeline.start)/2,e=so(t,-1.5),i=so(t,1.5);this.timeline.setViewRange(e.getTime(),i.getTime())}show1Hour(){let t=this.timeline.start+(this.timeline.stop-this.timeline.start)/2,e=wt(t,-30),i=wt(t,30);this.timeline.setViewRange(e.getTime(),i.getTime())}show10Minutes(){let t=this.timeline.start+(this.timeline.stop-this.timeline.start)/2,e=wt(t,-5),i=wt(t,5);this.timeline.setViewRange(e.getTime(),i.getTime())}jumpToToday(){let t=this.yamcs.getMissionTime();t.setUTCHours(0,0,0,0);let e=t.getTime();t.setUTCDate(t.getUTCDate()+1);let i=t.getTime();this.timeline.setViewRange(e,i)}jumpToNow(){let t=this.yamcs.getMissionTime();this.timeline.panTo(t.getTime())}openJumpToDialog(){let t=this.timeline.center;this.dialog.open(io,{width:"400px",data:{date:new Date(t)}}).afterClosed().subscribe(e=>{e&&this.timeline.panTo(e.date.getTime())})}saveSnapshot(){let t=document.createElement("a");try{t.href=this.timeline.toDataURL(),t.download="timeline_"+this.view$.value.name+"_export.png",document.body.appendChild(t),t.click()}finally{document.body.removeChild(t)}}mayControlTimeline(){return this.authService.getUser().hasSystemPrivilege("ControlTimeline")}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe()),this.timeline.disconnect()}};Gi.\u0275fac=function(e){return new(e||Gi)(u(ae),u(F),u(fn),u(J),u(_n),u(tt),u(Se),u(qo),u(Lo),u(Yo),u(Io))},Gi.\u0275cmp=_({type:Gi,selectors:[["ng-component"]],viewQuery:function(e,i){if(e&1&&Ee(Pl,7),e&2){let n;Me(n=Pe())&&(i.container=n.first)}},hostBindings:function(e,i){e&1&&C("visibilitychange",function(){return i.onVisibilityChange()},wo)},decls:33,vars:8,consts:[["container",""],["viewMenu","matMenu"],["itemMenu","matMenu"],[3,"noscroll"],["label","Timeline chart"],[1,"controls"],["icon","west",3,"click"],["icon","chevron_left",3,"mousedown","mouseup","mouseleave"],["icon","chevron_right",3,"mousedown","mouseup","mouseleave"],["icon","east",3,"click"],["icon","today",3,"click"],["icon","my_location",3,"click"],["icon","directions",3,"click"],[3,"click"],["icon","add",3,"click"],["icon","remove",3,"click"],[1,"timeline-container"],[1,"info"],["primary","true","dropdown","true","icon","view_timeline",3,"matMenuTriggerFor"],[1,"ya-menu"],["mat-menu-item",""],["mat-menu-item","","routerLink","/timeline/views/create",3,"queryParams"],["mat-menu-item","",3,"click"],["routerLink","/timeline/views/create","icon","add_circle",3,"queryParams"],["icon","settings"],["icon","add_box",3,"matMenuTriggerFor"],[1,"ya-menu",3,"overlapTrigger"],["mat-menu-item","","matTooltipShowDelay","1000","matTooltip","Events are items that simply appear on the timeline",3,"click"],["mat-menu-item","","matTooltipShowDelay","1000","matTooltip","Activities are like events, but in addition have an execution status",3,"click"],["icon","photo_camera"],["icon","settings",3,"clicked"],["icon","photo_camera",3,"clicked"]],template:function(e,i){if(e&1){let n=G();r(0,"ya-instance-page",3)(1,"ya-instance-toolbar",4),x(2,kl,11,6),T(3,"async"),x(4,Ol,14,13),o(),r(5,"div",5)(6,"ya-button-group")(7,"ya-icon-button",6),C("click",function(){return v(n),S(i.pageLeft())}),o(),r(8,"ya-icon-button",7),C("mousedown",function(){return v(n),S(i.toggleMove(-50))})("mouseup",function(){return v(n),S(i.untoggleMove())})("mouseleave",function(){return v(n),S(i.untoggleMove())}),o(),r(9,"ya-icon-button",8),C("mousedown",function(){return v(n),S(i.toggleMove(50))})("mouseup",function(){return v(n),S(i.untoggleMove())})("mouseleave",function(){return v(n),S(i.untoggleMove())}),o(),r(10,"ya-icon-button",9),C("click",function(){return v(n),S(i.pageRight())}),o()(),r(11,"ya-button-group")(12,"ya-button",10),C("click",function(){return v(n),S(i.jumpToToday())}),l(13,"Today"),o(),r(14,"ya-button",11),C("click",function(){return v(n),S(i.jumpToNow())}),l(15,"Now"),o(),r(16,"ya-button",12),C("click",function(){return v(n),S(i.openJumpToDialog())}),l(17,"Jump to..."),o()(),r(18,"ya-button-group")(19,"ya-button",13),C("click",function(){return v(n),S(i.show3Hours())}),l(20,"3 hours"),o(),r(21,"ya-button",13),C("click",function(){return v(n),S(i.show1Hour())}),l(22,"1 hour"),o(),r(23,"ya-button",13),C("click",function(){return v(n),S(i.show10Minutes())}),l(24,"10 min"),o()(),r(25,"ya-button-group")(26,"ya-icon-button",14),C("click",function(){return v(n),S(i.zoomIn())}),o(),r(27,"ya-icon-button",15),C("click",function(){return v(n),S(i.zoomOut())}),o()()(),c(28,"div",16,0),r(30,"div",17),x(31,Al,4,7,"span"),T(32,"async"),o()()}if(e&2){let n,s;p("noscroll",!0),m(2),w((n=B(3,4,i.views$))?2:-1,n),m(2),w(i.mayControlTimeline()?4:-1),m(27),w((s=B(32,6,i.viewportRange$))?31:-1,s)}},dependencies:[b,ee,cn,hn,dn,pn,un,Ve,L,Go,bn,H,W,ut,ne,ze],styles:[".timeline-container[_ngcontent-%COMP%]{line-height:0;border-top:1px solid #d1d5da;position:absolute;inset:36px 0 0}.info[_ngcontent-%COMP%]{position:absolute;bottom:35px;right:0;margin-right:16px;background:#fff;opacity:.75;font-size:12px;line-height:12px}.controls[_ngcontent-%COMP%]{height:24px;margin:6px;display:flex;align-items:center;column-gap:7px}"],changeDetection:0});var oo=Gi;var ur=a=>({c:a}),Ll=(a,t)=>({c:a,view:t});function Gl(a,t){if(a&1){let e=G();r(0,"th",17),C("click",function(n){return v(e),X(2).toggle(),S(n.stopPropagation())}),c(1,"ya-table-checkbox",18,0),o()}if(a&2){let e=f(2);m(),p("dataSource",e.dataSource)("selection",e.selection)}}function Yl(a,t){if(a&1){let e=G();r(0,"td",19),C("click",function(n){return v(e),X(2).toggle(),S(n.stopPropagation())}),c(1,"ya-table-checkbox",20,0),o()}if(a&2){let e=t.$implicit,i=f(2);m(),p("dataSource",i.dataSource)("selection",i.selection)("item",e)}}function ql(a,t){a&1&&(r(0,"th",21),l(1,"Label"),o())}function $l(a,t){if(a&1&&(r(0,"td",22)(1,"a",23),l(2),o()()),a&2){let e=t.$implicit,i=f(2);m(),p("routerLink",e.id)("queryParams",O(3,ur,i.yamcs.context)),m(),A(" ",e.name," ")}}function zl(a,t){a&1&&(r(0,"th",24),l(1,"Description"),o())}function jl(a,t){if(a&1&&(r(0,"td",22),l(1),o()),a&2){let e=t.$implicit;m(),A(" ",e.description||"-"," ")}}function Ul(a,t){a&1&&c(0,"th",25)}function Hl(a,t){if(a&1&&(r(0,"td",22)(1,"ya-text-action",26),l(2," Show on chart "),o()()),a&2){let e=t.$implicit,i=f(2);m(),p("queryParams",Mo(1,Ll,i.yamcs.context,e.id))}}function Wl(a,t){a&1&&c(0,"tr",27)}function Ql(a,t){if(a&1){let e=G();r(0,"tr",28),C("click",function(){let n=v(e).$implicit,s=f(2);return S(s.toggleOne(n))}),o()}if(a&2){let e=t.$implicit,i=f(2);re("selected",i.selection.isSelected(e))}}function Xl(a,t){if(a&1&&(r(0,"table",4),K(1,5),$(2,Gl,3,2,"th",6)(3,Yl,3,3,"td",7),Z(),K(4,8),$(5,ql,2,0,"th",9)(6,$l,3,5,"td",10),Z(),K(7,11),$(8,zl,2,0,"th",12)(9,jl,2,1,"td",10),Z(),K(10,13),$(11,Ul,1,0,"th",14)(12,Hl,3,4,"td",10),Z(),$(13,Wl,1,0,"tr",15)(14,Ql,1,2,"tr",16),o()),a&2){let e=f();p("dataSource",e.dataSource)("trackBy",e.tableTrackerFn),m(13),p("matHeaderRowDef",e.displayedColumns),m(),p("matRowDefColumns",e.displayedColumns)}}var Yi=class Yi{constructor(t,e,i){this.yamcs=t;this.messageService=i;this.displayedColumns=["select","name","description","actions"];this.tableTrackerFn=(t,e)=>e.id;this.dataSource=new We;this.selection=new jt(this.tableTrackerFn,!0,[]);e.setTitle("Timeline Views"),this.refreshData()}ngAfterViewInit(){this.dataSource.sort=this.sort}toggleOne(t){(!this.selection.isSelected(t)||this.selection.selected.length>1)&&this.selection.clear(),this.selection.toggle(t)}deleteSelectedViews(){if(confirm("Are you sure you want to delete the selected views?"))for(let t of this.selection.selected)this.deleteView(t.id,!1)}deleteView(t,e=!0){(!e||confirm("Are you sure you want to delete the selected view?"))&&this.yamcs.yamcsClient.deleteTimelineView(this.yamcs.instance,t).then(()=>this.refreshData()).catch(i=>this.messageService.showError(i))}isGroupDeleteEnabled(){return!this.selection.isEmpty()}refreshData(){this.yamcs.yamcsClient.getTimelineViews(this.yamcs.instance).then(t=>{this.selection.matchNewValues(t.views||[]),this.dataSource.data=t.views||[]}).catch(t=>this.messageService.showError(t))}};Yi.\u0275fac=function(e){return new(e||Yi)(u(F),u(ae),u(J))},Yi.\u0275cmp=_({type:Yi,selectors:[["ng-component"]],viewQuery:function(e,i){if(e&1&&Ee(Fe,5),e&2){let n;Me(n=Pe())&&(i.sort=n.first)}},decls:8,vars:5,consts:[["cb",""],["label","Views"],["routerLink","create","icon","add_box",3,"queryParams"],["icon","close",3,"clicked","disabled"],["mat-table","","matSort","","matSortActive","name","matSortDirection","asc","matSortDisableClear","",1,"ya-data-table","expand",3,"dataSource","trackBy"],["cdkColumnDef","select"],["mat-header-cell","","class","checkbox",3,"click",4,"cdkHeaderCellDef"],["mat-cell","","class","checkbox",3,"click",4,"cdkCellDef"],["matColumnDef","name"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","description"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"selected","click",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",1,"checkbox",3,"click"],[3,"dataSource","selection"],["mat-cell","",1,"checkbox",3,"click"],[3,"dataSource","selection","item"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[3,"routerLink","queryParams"],["mat-header-cell",""],["mat-header-cell","",1,"expand"],["icon","visibility","routerLink","/timeline/chart",3,"queryParams"],["mat-header-row",""],["mat-row","",3,"click"]],template:function(e,i){e&1&&(r(0,"ya-instance-page")(1,"ya-instance-toolbar",1)(2,"ya-page-button",2),l(3," Create view "),o(),r(4,"ya-page-button",3),C("clicked",function(){return i.deleteSelectedViews()}),l(5," Delete "),o()(),r(6,"ya-panel"),x(7,Xl,15,4,"table",4),o()()),e&2&&(m(2),p("queryParams",O(3,ur,i.yamcs.context)),m(2),p("disabled",!i.isGroupDeleteEnabled()),m(3),w(i.dataSource?7:-1))},dependencies:[b,ee,it,nt,ot,Fe,Nt,rt,Ot,Lt,At,Rt,Gt,at,lt,st,mt,H,W,ut,ft,zt,$o],encapsulation:2,changeDetection:0});var ro=Yi;var ah=[{path:"",canActivate:[Wo,Ho],canActivateChild:[Qo],runGuardsAndResolvers:"always",component:Xo,children:[{path:"",pathMatch:"full",redirectTo:"chart"},{path:"chart",component:oo},{path:"views",pathMatch:"full",component:ro},{path:"views/create",pathMatch:"full",component:Bn},{path:"views/:view",pathMatch:"full",component:Un},{path:"bands",pathMatch:"full",component:En},{path:"bands/create",pathMatch:"full",component:Pn},{path:"bands/create/item-band",pathMatch:"full",component:Hn},{path:"bands/create/spacer",pathMatch:"full",component:Kn},{path:"bands/create/time-ruler",pathMatch:"full",component:Zn},{path:"bands/create/parameter-plot",pathMatch:"full",component:Xn},{path:"bands/create/parameter-states",pathMatch:"full",component:Jn},{path:"bands/create/command-band",pathMatch:"full",component:Mn},{path:"bands/:band",pathMatch:"full",component:$n},{path:"items",pathMatch:"full",component:Qn},{path:"items/:item",pathMatch:"full",component:jn}]}];export{ah as ROUTES};
