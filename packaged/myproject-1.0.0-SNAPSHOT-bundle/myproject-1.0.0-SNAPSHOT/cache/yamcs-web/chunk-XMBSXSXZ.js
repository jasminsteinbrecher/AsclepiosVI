import{a as qe,b as We}from"./chunk-L67MW52F.js";import{Aa as A,Bf as z,Bg as Ve,Ca as C,Cb as ut,Cc as ht,Cg as Ne,D as at,Dg as Tt,Ea as l,F as g,Fc as gt,Ff as Me,Fg as $e,Fh as D,G as _,Gb as Qt,Gh as ze,Hb as Jt,Hg as Re,Hh as He,Ia as lt,Ib as Kt,If as k,Ja as pt,Jb as vt,Je as ye,Ka as mt,Kb as Xt,Ke as fe,Kf as L,Lf as St,Me as he,N as qt,Na as V,Ng as Be,Pa as N,Pc as ae,Qg as Ye,Ra as c,Rc as oe,Rf as Ie,Sa as w,Ta as S,Tc as _t,Uc as re,Uf as bt,Ug as je,V as s,Y as d,Ye as ge,Za as G,Ze as _e,_ as x,_e as Ce,a as Rt,af as Se,b as Bt,bb as f,bf as be,bg as Ee,cb as h,cg as Oe,da as M,db as dt,df as xe,dh as Ue,ef as Ae,f as b,gf as De,hf as Te,ib as I,jc as Zt,jf as we,ka as u,kg as xt,lf as O,lg as ke,ma as v,mf as q,mg as $,n as jt,na as rt,ne as ce,ng as Le,oa as ct,oc as te,oe as se,og as At,pa as st,pe as Ct,pg as Dt,qa as p,qc as ee,qe as le,qh as Ge,ra as r,re as pe,sa as o,sb as E,sc as yt,se as me,ta as m,tc as ft,te as de,ua as zt,ue,v as Ut,va as Ht,vc as ie,ve,xa as P,xb as Wt,xc as Y,ya as F,yc as ne,yg as Pe,z as Gt,zg as Fe}from"./chunk-OXOWQRWE.js";function Xe(i,e){if(i&1&&(c(0),f(1,"deltaWith")),i&2){let t=l();S(" (",dt(1,1,t.stop,t.start),") ")}}function Ze(i,e){if(i&1&&(r(0,"dt"),c(1),o(),r(2,"dd"),c(3),f(4,"printObj"),o()),i&2){let t=e.$implicit;s(),S("\xA0\xA0",t.key),s(2),w(h(4,2,t.value))}}function ti(i,e){if(i&1&&(r(0,"ya-panel")(1,"dl",0)(2,"dt"),c(3,"Activity ID"),o(),r(4,"dd"),c(5),o(),r(6,"dt"),c(7,"Status"),o(),r(8,"dd"),c(9),o(),r(10,"dt"),c(11,"Started"),o(),r(12,"dd"),c(13),f(14,"datetime"),o(),r(15,"dt"),c(16,"Finished"),o(),r(17,"dd"),c(18),f(19,"datetime"),u(20,Xe,2,4),o(),r(21,"dt"),c(22,"User"),o(),r(23,"dd"),c(24),o()(),r(25,"div",1),m(26,"mat-divider"),o(),r(27,"dl",2)(28,"dt"),c(29,"Activity type"),o(),r(30,"dd"),c(31),o(),r(32,"dt"),c(33,"Arguments"),o(),m(34,"dd"),ct(35,Ze,5,4,null,null,rt),f(37,"keyvalue"),o()()),i&2){let t=e;s(5),w(t.id),s(4),w(t.status),s(4),w(h(14,7,t.start)),s(5),S(" ",h(19,9,t.stop)??"-"," "),s(2),v(t.stop?20:-1),s(4),w(t.startedBy),s(7),w(t.type),s(4),st(h(37,11,t.args))}}var H=class H{constructor(e,t){this.yamcs=e;this.messageService=t;this.activityId=I.required();this.activity$=new b(null)}ngOnInit(){let{yamcs:e}=this;e.yamcsClient.getActivity(e.instance,this.activityId()).then(t=>{this.activity$.next(t)}).catch(t=>this.messageService.showError(t))}};H.\u0275fac=function(t){return new(t||H)(d(L),d(O))},H.\u0275cmp=x({type:H,selectors:[["ng-component"]],inputs:{activityId:[1,"activityId"]},decls:2,vars:3,consts:[[1,"dl-horizontal","no-lead"],[1,"section-divider"],[1,"dl-horizontal"]],template:function(t,n){if(t&1&&(u(0,ti,38,13,"ya-panel"),f(1,"async")),t&2){let a;v((a=h(1,1,n.activity$))?0:-1,a)}},dependencies:[D,ue,Tt,E,Wt,$,Ue,Ge],encapsulation:2,changeDetection:0});var wt=H;var W=class W{constructor(e,t,n){this.dialogRef=e;this.data=n;this.form=t.group({failureReason:["",[ee.required]]})}async submit(){this.dialogRef.close({failureReason:this.form.value.failureReason})}};W.\u0275fac=function(t){return new(t||W)(d(ce),d(ae),d(se))},W.\u0275cmp=x({type:W,selectors:[["app-set-failed-dialog"]],decls:12,vars:2,consts:[["filename",""],["mat-dialog-title",""],[1,"ya-form",3,"formGroup"],["label","Failure reason"],["type","text","formControlName","failureReason"],["align","end"],["mat-dialog-close",""],["appearance","primary",3,"click","disabled"]],template:function(t,n){if(t&1){let a=A();r(0,"h2",1),c(1,"Set failed"),o(),r(2,"mat-dialog-content")(3,"form",2)(4,"ya-field",3),m(5,"input",4,0),o()()(),r(7,"mat-dialog-actions",5)(8,"ya-button",6),c(9,"CANCEL"),o(),r(10,"ya-button",7),C("click",function(){return g(a),_(n.submit())}),c(11,"SUBMIT"),o()()}t&2&&(s(3),p("formGroup",n.form),s(7),p("disabled",!n.form.valid))},dependencies:[D,ne,te,yt,ft,ht,gt,le,pe,de,me,z,Ee],encapsulation:2,changeDetection:0});var Q=W;var J=class J{constructor(){this.synchronizer=at(q);this.elapsed$=new b(0)}ngOnChanges(){this.syncSubscription?.unsubscribe(),this.activity&&(this.updateState(),this.activity.stop||(this.syncSubscription=this.synchronizer.sync(()=>this.updateState())))}updateState(){if(!this.activity.start)return;let e=new Date(this.activity.start);if(this.activity.stop){let t=new Date(this.activity.stop);this.elapsed$.next(this.millisBetween(e,t))}else{let t=this.millisBetween(e,new Date);this.elapsed$.next(t)}}millisBetween(e,t){return t.getTime()-e.getTime()}ngOnDestroy(){this.syncSubscription?.unsubscribe()}};J.\u0275fac=function(t){return new(t||J)},J.\u0275cmp=x({type:J,selectors:[["app-activity-duration"]],inputs:{activity:"activity"},features:[qt],decls:3,vars:5,template:function(t,n){t&1&&(c(0),f(1,"async"),f(2,"duration")),t&2&&w(h(2,3,h(1,1,n.elapsed$)))},dependencies:[D,E,Le],encapsulation:2,changeDetection:0});var It=J;function ni(i,e){if(i&1&&(r(0,"mat-icon",0),c(1,"check_circle"),o()),i&2){let t=l();p("matTooltip",t.status)}}function ai(i,e){if(i&1&&(r(0,"mat-icon",1),c(1,"cached"),o()),i&2){let t=l();p("matTooltip",t.status)}}function oi(i,e){if(i&1&&(r(0,"mat-icon",2),c(1,"highlight_off"),o()),i&2){let t=l();p("matTooltip",t.status)}}function ri(i,e){if(i&1&&(r(0,"mat-icon",3),c(1,"cached"),o()),i&2){let t=l();p("matTooltip",t.status)}}function ci(i,e){if(i&1&&(r(0,"mat-icon",4),c(1,"stop_circle"),o()),i&2){let t=l();p("matTooltip",t.status)}}function si(i,e){if(i&1&&(u(0,ni,2,1,"mat-icon",0),u(1,ai,2,1,"mat-icon",1),u(2,oi,2,1,"mat-icon",2),u(3,ri,2,1,"mat-icon",3),u(4,ci,2,1,"mat-icon",4)),i&2){let t=e;v(t.status==="SUCCESSFUL"?0:-1),s(),v(t.status==="RUNNING"?1:-1),s(),v(t.status==="FAILED"?2:-1),s(),v(t.status==="CANCELLED"&&!t.stop?3:-1),s(),v(t.status==="CANCELLED"&&t.stop?4:-1)}}var K=class K{constructor(){this.activity=I.required()}};K.\u0275fac=function(t){return new(t||K)},K.\u0275cmp=x({type:K,selectors:[["app-activity-icon"]],inputs:{activity:[1,"activity"]},decls:1,vars:1,consts:[[1,"success",3,"matTooltip"],[1,"spin",3,"matTooltip"],[1,"failed",3,"matTooltip"],[1,"warning","spin",3,"matTooltip"],[1,"cancelled",3,"matTooltip"]],template:function(t,n){if(t&1&&u(0,si,5,5),t&2){let a;v((a=n.activity())?0:-1,a)}},dependencies:[D,oe,_t],styles:[".success[_ngcontent-%COMP%]{color:#00c752}.warning[_ngcontent-%COMP%]{color:var(--y-warning-color)}.failed[_ngcontent-%COMP%]{color:var(--y-error-color)}.cancelled[_ngcontent-%COMP%]{color:#d3d3d3}.spin[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_yspin 2s infinite linear}@keyframes _ngcontent-%COMP%_yspin{0%{-webkit-transform:rotate(0deg);transform:rotate(0)}to{-webkit-transform:rotate(359deg);transform:rotate(359deg)}}"],changeDetection:0});var Et=K;var Ot=class{constructor(e){this.watermarkObserver=e;this.dirty=!1;this.archiveActivities=[];this.bufferSize=500;this.bufferWatermark=400;this.pointer=0;this.alreadyWarned=!1;this.realtimeBuffer=Array(this.bufferSize).fill(void 0)}addArchiveData(e){this.archiveActivities=this.archiveActivities.concat(e),this.dirty=!0}addRealtimeActivity(e){this.pointer<this.bufferSize&&(this.realtimeBuffer[this.pointer]=e,this.pointer>=this.bufferWatermark&&this.watermarkObserver&&!this.alreadyWarned&&(this.alreadyWarned=!0,this.watermarkObserver()),this.pointer=this.pointer+1),this.dirty=!0}reset(){this.archiveActivities=[],this.realtimeBuffer.fill(void 0),this.pointer=0,this.alreadyWarned=!1,this.dirty=!0}snapshot(){let e=this.archiveActivities;return this.realtimeBuffer.map(t=>{if(!t)return;let n=e.findIndex(a=>a.id==t.id);n===-1?e.push(t):e[n]=t}),e.sort((t,n)=>{let a=-t.start.localeCompare(n.start);return a!==0?a:n.seq-t.seq}),e}compact(e){let t=this.snapshot();t.length=Math.min(e,t.length),this.reset(),this.archiveActivities=t,this.dirty=!0}};var kt=class extends Zt{constructor(t,n){super();this.yamcs=t;this.pageSize=100;this.blockHasMore=!1;this.activities$=new b([]);this.loading$=new b(!1);this.streaming$=new b(!1);this.syncSubscription=n.sync(()=>{this.buffer.dirty&&!this.loading$.getValue()&&(this.emitActivities(),this.buffer.dirty=!1)}),this.buffer=new Ot(()=>{this.blockHasMore=!0,this.buffer.compact(500)})}connect(t){return this.activities$}emitActivities(){let t=this.buffer.snapshot();this.activities$.next(t)}loadActivities(t){return this.loading$.next(!0),Promise.all([this.loadPage(Bt(Rt({},t),{limit:this.pageSize}))]).then(n=>{let a=n[0];return this.loading$.next(!1),this.buffer.reset(),this.blockHasMore=!1,this.buffer.addArchiveData(a),this.emitActivities(),a})}hasMore(){return!!this.continuationToken&&!this.blockHasMore}loadPage(t){return this.options=t,this.yamcs.yamcsClient.getActivities(this.yamcs.instance,t).then(n=>(this.continuationToken=n.continuationToken,n.activities||[]))}loadMoreData(t){this.continuationToken&&this.loadPage(Bt(Rt({},t),{next:this.continuationToken,limit:this.pageSize})).then(n=>{this.buffer.addArchiveData(n)})}startStreaming(){this.streaming$.next(!0),this.realtimeSubscription=this.yamcs.yamcsClient.createActivitySubscription({instance:this.yamcs.instance},t=>{!this.loading$.getValue()&&this.matchesFilter(t)&&this.buffer.addRealtimeActivity(t)})}matchesFilter(t){return!(this.options&&(this.options.type&&t.type!==this.options.type||this.options.status&&t.status!==this.options.status||this.options.q&&(!t.detail||t.detail.indexOf(this.options.q)===-1)))}stopStreaming(){this.realtimeSubscription?.cancel(),this.streaming$.next(!1)}disconnect(t){this.stopStreaming(),this.syncSubscription?.unsubscribe(),this.activities$.complete(),this.loading$.complete(),this.streaming$.complete()}};var mi=i=>({c:i});function di(i,e){if(i&1){let t=A();r(0,"ya-page-button",34),C("clicked",function(){g(t);let a=l();return _(a.cancelSelectedActivities())}),c(1," Cancel "),o()}if(i&2){let t=l();p("disabled",!t.isGroupCancelEnabled())}}function ui(i,e){if(i&1){let t=A();m(0,"ya-date-time-input",35)(1,"ya-date-time-input",36),r(2,"ya-button",33),C("click",function(){g(t);let a=l();return _(a.applyCustomDates())}),c(3,"Apply"),o()}if(i&2){let t=l();s(2),p("disabled",t.filterForm.invalid)}}function vi(i,e){if(i&1){let t=A();r(0,"ya-button",37),C("click",function(){g(t);let a=l();return _(a.jumpToNow())}),c(1,"Jump to now"),o()}}function yi(i,e){i&1&&m(0,"ya-dots")}function fi(i,e){i&1&&m(0,"th",38)}function hi(i,e){if(i&1){let t=A();r(0,"td",39),C("click",function(a){return g(t),V(2).toggle(),_(a.stopPropagation())}),m(1,"ya-table-checkbox",40,1),o()}if(i&2){let t=e.$implicit,n=l();s(),p("dataSource",n.dataSource)("selection",n.selection)("item",t)}}function gi(i,e){i&1&&m(0,"th",41)}function _i(i,e){if(i&1&&(r(0,"td",42),m(1,"app-activity-icon",43),o()),i&2){let t=e.$implicit;s(),p("activity",t)}}function Ci(i,e){i&1&&(r(0,"th",44),c(1,"Id"),o())}function Si(i,e){if(i&1&&(r(0,"td",45)(1,"a",46),c(2),o()()),i&2){let t=e.$implicit,n=l();s(),p("routerLink",t.id)("matTooltip",t.id)("queryParams",G(4,mi,n.yamcs.context)),s(),S(" ",t.id.substring(0,8)," ")}}function bi(i,e){i&1&&(r(0,"th",44),c(1,"Start"),o())}function xi(i,e){if(i&1&&(r(0,"td",47),c(1),f(2,"datetime"),o()),i&2){let t=e.$implicit;s(),S(" ",h(2,1,t.start)," ")}}function Ai(i,e){i&1&&(r(0,"th",44),c(1,"Type"),o())}function Di(i,e){if(i&1&&(r(0,"td",47),c(1),o()),i&2){let t=e.$implicit;s(),S(" ",t.type," ")}}function Ti(i,e){i&1&&(r(0,"th",44),c(1,"Detail"),o())}function wi(i,e){if(i&1&&(r(0,"td",47),c(1),o()),i&2){let t=e.$implicit;s(),S(" ",t.detail||"-"," ")}}function Mi(i,e){i&1&&(r(0,"th",44),c(1,"Duration"),o())}function Ii(i,e){if(i&1&&m(0,"app-activity-duration",43),i&2){let t=l().$implicit;p("activity",t)}}function Ei(i,e){i&1&&c(0," - ")}function Oi(i,e){if(i&1&&(r(0,"td",47),u(1,Ii,1,1,"app-activity-duration",43)(2,Ei,1,0),o()),i&2){let t=e.$implicit;s(),v(t.start?1:2)}}function ki(i,e){i&1&&m(0,"th",48)}function Li(i,e){if(i&1){let t=A();r(0,"ya-more")(1,"button",50),C("click",function(){g(t);let a=l().$implicit,y=l();return _(y.cancelActivity(a))}),c(2," Cancel "),o()()}if(i&2){let t=l().$implicit,n=l();s(),p("disabled",t.stop!==void 0||!n.mayControlActivities())}}function Pi(i,e){i&1&&(r(0,"span",49),c(1),o()),i&2&&(s(),S(" ",e," "))}function Fi(i,e){if(i&1){let t=A();r(0,"ya-button",51),C("click",function(){g(t);let a=l().$implicit,y=l();return _(y.setSuccessful(a))}),c(1,"Set successful"),o(),c(2," \xA0 "),r(3,"ya-button",52),C("click",function(){g(t);let a=l().$implicit,y=l();return _(y.setFailed(a))}),c(4,"Set failed"),o()}}function Vi(i,e){if(i&1&&(r(0,"td",47),u(1,Li,3,1,"ya-more"),u(2,Pi,2,1,"span",49),u(3,Fi,5,0),o()),i&2){let t,n=e.$implicit,a=l();s(),v(a.mayControlActivities()?1:-1),s(),v((t=n.failureReason)?2:-1,t),s(),v(n.type==="MANUAL"&&n.status==="RUNNING"&&a.mayControlActivities()?3:-1)}}function Ni(i,e){i&1&&m(0,"tr",53)}function $i(i,e){if(i&1){let t=A();r(0,"tr",54),C("click",function(){let a=g(t).$implicit,y=l();return _(y.toggleOne(a))}),o()}if(i&2){let t=e.$implicit,n=l();N("selected",n.selection.isSelected(t))}}var Lt="NO_LIMIT",X=class X{constructor(e,t,n,a,y,B,$t,Ji){this.yamcs=e;this.authService=t;this.router=n;this.route=a;this.messageService=$t;this.dialog=Ji;this.filterForm=new ie({status:new Y([]),filter:new Y,type:new Y([]),interval:new Y(Lt),customStart:new Y(null),customStop:new Y(null)});this.columns=[{id:"select",label:"",alwaysVisible:!0},{id:"status",label:"Status",alwaysVisible:!0},{id:"id",label:"Id",alwaysVisible:!0},{id:"start",label:"Start",visible:!0},{id:"type",label:"Type",visible:!0},{id:"detail",label:"Detail",visible:!0},{id:"duration",label:"Duration",visible:!0},{id:"actions",label:"",alwaysVisible:!0}];this.typeOptions$=new b([{id:"MANUAL",label:"Manual",icon:"emoji_people"}]);this.statusOptions$=new b([{id:"RUNNING",label:"Running",icon:"cached"},{id:"SUCCESSFUL",label:"Successful",icon:"check_circle"},{id:"CANCELLED",label:"Cancelled",icon:"stop_circle"},{id:"FAILED",label:"Failed",icon:"highlight_off"}]);this.intervalOptions=[{id:"PT1H",label:"Last hour"},{id:"PT6H",label:"Last 6 hours"},{id:"P1D",label:"Last 24 hours"},{id:"NO_LIMIT",label:"No limit"},{id:"CUSTOM",label:"Custom",group:!0}];this.status=[];this.type=[];this.selection=new ve(!0,[]);this.tableTrackerFn=(e,t)=>t.id;y.setTitle("Activities"),e.yamcsClient.getExecutors(e.instance).then(T=>{for(let nt of T)this.typeOptions$.next([...this.typeOptions$.value,{id:nt.type,label:nt.displayName,icon:nt.icon||"new_label"}])}).catch(T=>this.messageService.showError(T)),this.dataSource=new kt(e,B),this.dataSource.startStreaming(),this.initializeOptions(),this.loadData(),this.filterForm.get("filter").valueChanges.pipe(jt(400)).forEach(T=>{this.filter=T,this.loadData()}),this.filterForm.get("status").valueChanges.forEach(T=>{this.status=T,this.loadData()}),this.filterForm.get("type").valueChanges.forEach(T=>{this.type=T,this.loadData()}),this.filterForm.get("interval").valueChanges.forEach(T=>{if(T==="CUSTOM"){let nt=this.validStart||this.yamcs.getMissionTime(),Ke=this.validStop||this.yamcs.getMissionTime();this.filterForm.get("customStart").setValue(k.toISOString(nt)),this.filterForm.get("customStop").setValue(k.toISOString(Ke))}else T==="NO_LIMIT"?(this.validStart=null,this.validStop=null,this.appliedInterval=T,this.loadData()):(this.validStop=e.getMissionTime(),this.validStart=k.subtractDuration(this.validStop,T),this.appliedInterval=T,this.loadData())})}initializeOptions(){let e=this.route.snapshot.queryParamMap;if(e.has("filter")&&(this.filter=e.get("filter")||"",this.filterForm.get("filter").setValue(this.filter)),e.has("status")&&(this.type=e.getAll("status"),this.filterForm.get("status").setValue(this.status)),e.has("type")&&(this.type=e.getAll("type"),this.filterForm.get("type").setValue(this.type)),e.has("interval"))if(this.appliedInterval=e.get("interval"),this.filterForm.get("interval").setValue(this.appliedInterval),this.appliedInterval==="CUSTOM"){let t=e.get("customStart");this.filterForm.get("customStart").setValue(t),this.validStart=k.toDate(t);let n=e.get("customStop");this.filterForm.get("customStop").setValue(n),this.validStop=k.toDate(n)}else this.appliedInterval==="NO_LIMIT"?(this.validStart=null,this.validStop=null):(this.validStop=this.yamcs.getMissionTime(),this.validStart=k.subtractDuration(this.validStop,this.appliedInterval));else this.appliedInterval=Lt,this.validStop=null,this.validStart=null}jumpToNow(){let e=this.filterForm.value.interval;e==="NO_LIMIT"?this.filterForm.get("interval").setValue(Lt):e==="CUSTOM"?this.filterForm.get("interval").setValue(Lt):(this.validStop=this.yamcs.getMissionTime(),this.validStart=k.subtractDuration(this.validStop,e),this.loadData())}applyCustomDates(){this.validStart=k.toDate(this.filterForm.value.customStart),this.validStop=k.toDate(this.filterForm.value.customStop),this.appliedInterval="CUSTOM",this.loadData()}loadData(){this.updateURL();let e={};this.validStart&&(e.start=this.validStart.toISOString()),this.validStop&&(e.stop=this.validStop.toISOString()),this.filter&&(e.q=this.filter),this.status.length&&(e.status=this.status),this.type.length&&(e.type=this.type),this.dataSource.loadActivities(e).catch(t=>this.messageService.showError(t))}loadMoreData(){let e={};this.validStart&&(e.start=this.validStart.toISOString()),this.status&&(e.status=this.status),this.filter&&(e.q=this.filter),this.dataSource.loadMoreData(e)}updateURL(){this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{filter:this.filter||null,status:this.type.length?this.status:null,type:this.type.length?this.type:null,interval:this.appliedInterval,customStart:this.appliedInterval==="CUSTOM"?this.filterForm.value.customStart:null,customStop:this.appliedInterval==="CUSTOM"?this.filterForm.value.customStop:null},queryParamsHandling:"merge"})}mayControlActivities(){return this.authService.getUser().hasSystemPrivilege("ControlActivities")}toggleOne(e){(!this.selection.isSelected(e)||this.selection.selected.length>1)&&this.selection.clear(),this.selection.toggle(e)}isGroupCancelEnabled(){for(let e of this.selection.selected)if(!e.stop)return!0;return!1}cancelSelectedActivities(){for(let e of this.selection.selected)e.stop,this.cancelActivity(e)}cancelActivity(e){this.yamcs.yamcsClient.cancelActivity(this.yamcs.instance,e.id).catch(t=>this.messageService.showError(t))}setSuccessful(e){this.yamcs.yamcsClient.completeManualActivity(this.yamcs.instance,e.id).catch(t=>this.messageService.showError(t))}setFailed(e){this.dialog.open(Q,{width:"400px",data:{activity:e}}).afterClosed().subscribe(t=>{t&&this.yamcs.yamcsClient.completeManualActivity(this.yamcs.instance,e.id,{failureReason:t.failureReason}).catch(n=>this.messageService.showError(n))})}};X.\u0275fac=function(t){return new(t||X)(d(L),d(St),d(Kt),d(Qt),d(ut),d(q),d(O),d(Ct))},X.\u0275cmp=x({type:X,selectors:[["ng-component"]],decls:51,vars:27,consts:[["columnChooser",""],["cb",""],["label","Activities"],["icon","cancel",3,"disabled"],[3,"formGroup"],["formControlName","filter","placeholder","Filter by text search"],["preferenceKey","activities",3,"columns"],["formControlName","status","emptyOption","Any status",3,"options"],["formControlName","type","emptyOption","Any type",3,"options"],["icon","access_time","formControlName","interval",3,"options"],[3,"duration","start","stop"],["mat-table","",1,"ya-data-table","expand",3,"dataSource","trackBy"],["cdkColumnDef","select"],["mat-header-cell","","class","checkbox",4,"cdkHeaderCellDef"],["mat-cell","","class","checkbox",3,"click",4,"cdkCellDef"],["matColumnDef","status"],["mat-header-cell","","class","status",4,"matHeaderCellDef"],["mat-cell","","class","status",4,"matCellDef"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","","class","mono",4,"matCellDef"],["matColumnDef","start"],["mat-cell","",4,"matCellDef"],["cdkColumnDef","type"],["mat-header-cell","",4,"cdkHeaderCellDef"],["mat-cell","",4,"cdkCellDef"],["cdkColumnDef","detail"],["cdkColumnDef","duration"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"selected","click",4,"matRowDef","matRowDefColumns"],["appearance","bottom","align","center"],[3,"click","disabled"],["icon","cancel",3,"clicked","disabled"],["formControlName","customStart"],["formControlName","customStop"],[3,"click"],["mat-header-cell","",1,"checkbox"],["mat-cell","",1,"checkbox",3,"click"],[3,"dataSource","selection","item"],["mat-header-cell","",1,"status"],["mat-cell","",1,"status"],[3,"activity"],["mat-header-cell",""],["mat-cell","",1,"mono"],[3,"routerLink","matTooltip","queryParams"],["mat-cell",""],["mat-header-cell","",1,"expand"],[1,"alert"],["mat-menu-item","",3,"click","disabled"],["icon","thumb_up",3,"click"],["icon","thumb_down",3,"click"],["mat-header-row",""],["mat-row","",3,"click"]],template:function(t,n){if(t&1){let a=A();r(0,"ya-instance-page")(1,"ya-instance-toolbar",2),u(2,di,2,1,"ya-page-button",3),o(),r(3,"ya-panel")(4,"ya-filter-bar",4),m(5,"ya-search-filter",5)(6,"ya-column-chooser",6,0),o(),r(8,"ya-filter-bar",4),m(9,"ya-multi-select",7),f(10,"async"),m(11,"ya-multi-select",8),f(12,"async"),m(13,"ya-select",9),u(14,ui,4,1)(15,vi,2,0,"ya-button"),u(16,yi,1,0,"ya-dots"),f(17,"async"),o(),m(18,"ya-table-window",10),r(19,"table",11),P(20,12),M(21,fi,1,0,"th",13)(22,hi,3,3,"td",14),F(),P(23,15),M(24,gi,1,0,"th",16)(25,_i,2,1,"td",17),F(),P(26,18),M(27,Ci,2,0,"th",19)(28,Si,3,6,"td",20),F(),P(29,21),M(30,bi,2,0,"th",19)(31,xi,3,3,"td",22),F(),P(32,23),M(33,Ai,2,0,"th",24)(34,Di,2,1,"td",25),F(),P(35,26),M(36,Ti,2,0,"th",24)(37,wi,2,1,"td",25),F(),P(38,27),M(39,Mi,2,0,"th",24)(40,Oi,3,1,"td",25),F(),P(41,28),M(42,ki,1,0,"th",29)(43,Vi,4,3,"td",22),F(),M(44,Ni,1,0,"tr",30),f(45,"async"),M(46,$i,1,2,"tr",31),f(47,"async"),o(),r(48,"ya-toolbar",32)(49,"ya-button",33),C("click",function(){return g(a),_(n.loadMoreData())}),c(50,"Load more"),o()()()()}if(t&2){let a=V(7);s(2),v(n.mayControlActivities()?2:-1),s(2),p("formGroup",n.filterForm),s(2),p("columns",n.columns),s(2),p("formGroup",n.filterForm),s(),p("options",h(10,17,n.statusOptions$)),s(2),p("options",h(12,19,n.typeOptions$)),s(2),p("options",n.intervalOptions),s(),v(n.filterForm.value.interval==="CUSTOM"?14:15),s(2),v(h(17,21,n.dataSource.loading$)?16:-1),s(2),p("duration",n.appliedInterval)("start",n.validStart)("stop",n.validStop),s(),p("dataSource",n.dataSource)("trackBy",n.tableTrackerFn),s(25),p("matHeaderRowDef",h(45,23,a.displayedColumns$)),s(2),p("matRowDefColumns",h(47,25,a.displayedColumns$)),s(3),p("disabled",!n.dataSource.hasMore())}},dependencies:[It,Et,D,yt,ft,ht,gt,vt,ye,fe,he,re,ge,Ce,Ae,Se,_e,De,be,xe,Te,we,_t,z,Me,Ie,bt,Oe,xt,Dt,Pe,Fe,At,Tt,$e,Re,Be,Ye,je,E,$],styles:[".alert[_ngcontent-%COMP%]{color:var(--y-error-color)!important}"],changeDetection:0});var Pt=X;var U=class U{constructor(){this.yamcs=at(L);this.messageService=at(O);this.activity$=new b(null)}connect(e){let{yamcs:t}=this,n=!1;this.activitySubscription?.cancel(),this.activitySubscription=t.yamcsClient.createActivitySubscription({instance:t.instance},a=>{n&&a.id===e&&this.activity$.next(a)}),t.yamcsClient.getActivity(t.instance,e).then(a=>{this.activity$.next(a),n=!0}).catch(a=>this.messageService.showError(a))}disconnect(){this.activitySubscription?.cancel(),this.activitySubscription=void 0}};U.\u0275fac=function(t){return new(t||U)},U.\u0275prov=Gt({token:U,factory:U.\u0275fac,providedIn:"root"});var Z=U;var Ri=["logContainer"],Bi=["top"],Yi=["bottom"];function ji(i,e){if(i&1&&(r(0,"tr")(1,"td",11),c(2),o(),r(3,"td",12),c(4),f(5,"datetime"),o(),r(6,"td",13),c(7),o()()),i&2){let t=e.$implicit,n=e.$index;N("activity",t.source==="ACTIVITY")("service",t.source==="SERVICE")("warning",t.level==="WARNING")("error",t.level==="ERROR"),s(2),w(n+1),s(2),S(" [",dt(5,11,t.time,!1),"] "),s(3),w(t.message)}}function Ui(i,e){i&1&&(r(0,"tr")(1,"td",14),m(2,"ya-dots"),o()())}function Gi(i,e){i&1&&u(0,Ui,3,0,"tr"),i&2&&v(e.stop?-1:0)}var tt=class tt{constructor(e,t,n,a){this.yamcs=e;this.messageService=t;this.syncService=n;this.activityId=I.required();this.archivedLogs=[];this.realtimeLogs=[];this.logs$=new b([]);this.dirty$=new b(!1);this.activity$=a.activity$}ngOnInit(){let{yamcs:e}=this;this.activityLogSubscription=e.yamcsClient.createActivityLogSubscription({instance:e.instance,activity:this.activityId()},t=>{for(let n of this.archivedLogs)if(t.time===n.time&&t.level===n.level&&t.message===n.message&&t.source===n.source)return;this.realtimeLogs.push(t),this.dirty$.next(!0)}),e.yamcsClient.getActivityLog(e.instance,this.activityId()).then(t=>{this.archivedLogs=t.filter(n=>{for(let a of this.realtimeLogs)if(n.time===a.time&&n.level===a.level&&n.message===a.message&&n.source===a.source)return!1;return!0}),this.emitLogs()}).catch(t=>this.messageService.showError(t)),this.syncSubscription=this.syncService.syncFast(()=>{this.dirty$.value&&(this.emitLogs(),this.dirty$.next(!1))})}emitLogs(){if(this.logs$.next([...this.archivedLogs,...this.realtimeLogs]),this.logContainer){let{nativeElement:e}=this.logContainer;Math.abs(e.scrollHeight-e.clientHeight-e.scrollTop)<=1&&setTimeout(()=>{this.bottomAnchor.nativeElement.scrollIntoView()})}}ngOnDestroy(){this.activityLogSubscription?.cancel(),this.syncSubscription?.unsubscribe()}};tt.\u0275fac=function(t){return new(t||tt)(d(L),d(O),d(q),d(Z))},tt.\u0275cmp=x({type:tt,selectors:[["ng-component"]],viewQuery:function(t,n){if(t&1&&(lt(Ri,5),lt(Bi,5),lt(Yi,5)),t&2){let a;pt(a=mt())&&(n.logContainer=a.first),pt(a=mt())&&(n.topAnchor=a.first),pt(a=mt())&&(n.bottomAnchor=a.first)}},inputs:{activityId:[1,"activityId"]},decls:17,vars:5,consts:[["logContainer",""],["top",""],["bottom",""],[1,"log-actions"],["icon","vertical_align_top",3,"click"],["icon","vertical_align_bottom",3,"click"],[1,"log-container"],[1,"top"],[1,"logs","mono",2,"width","100%"],[3,"activity","service","warning","error"],[1,"bottom"],["width","1",2,"text-align","right"],["width","1",1,"time",2,"white-space","nowrap"],[1,"message"],["colspan","3"]],template:function(t,n){if(t&1){let a=A();r(0,"div",3)(1,"ya-button",4),C("click",function(){g(a);let B=V(8);return _(B.scrollIntoView())}),c(2,"Jump to top"),o(),r(3,"ya-button",5),C("click",function(){g(a);let B=V(16);return _(B.scrollIntoView())}),c(4," Jump to bottom "),o()(),r(5,"div",6,0),m(7,"div",7,1),r(9,"table",8),ct(10,ji,8,14,"tr",9,rt),f(12,"async"),u(13,Gi,1,1),f(14,"async"),o(),m(15,"div",10,2),o()}if(t&2){let a;s(10),st(h(12,1,n.logs$)),s(3),v((a=h(14,3,n.activity$))?13:-1,a)}},dependencies:[D,z,bt,E,$],styles:[".log-container[_ngcontent-%COMP%]{border-top:1px solid rgba(0,0,0,.12);position:absolute;inset:48px 0 0;overflow:auto;padding-left:12px}.log-actions[_ngcontent-%COMP%]{height:24px;margin:12px;display:flex}.log-actions[_ngcontent-%COMP%]   ya-button[_ngcontent-%COMP%]{margin-right:7px}.extra-bar-container[_ngcontent-%COMP%]{padding:12px;border-bottom:1.1px solid rgba(0,0,0,.08)}.extra-bar[_ngcontent-%COMP%]{height:24px;line-height:24px}.separator[_ngcontent-%COMP%]{border-right:1px solid rgba(0,0,0,.12)}table.logs[_ngcontent-%COMP%]{line-height:12px}table.logs[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-size:12px;color:#000000a7;vertical-align:top}table.logs[_ngcontent-%COMP%]   td.time[_ngcontent-%COMP%]{opacity:.8}table.logs[_ngcontent-%COMP%]   tr.service[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-weight:700}table.logs[_ngcontent-%COMP%]   td.message[_ngcontent-%COMP%]{white-space:pre-wrap}.top[_ngcontent-%COMP%], .bottom[_ngcontent-%COMP%]{visibility:hidden;line-height:0}.warning[_ngcontent-%COMP%]{color:var(--y-warning-color)!important}.error[_ngcontent-%COMP%]{color:var(--y-error-color)!important}"],changeDetection:0});var Ft=tt;function qi(i,e){if(i&1&&(zt(0,"span",1),c(1),Ht()),i&2){let t=e;N("successful",t.status==="SUCCESSFUL")("running",t.status==="RUNNING")("failed",t.status==="FAILED")("cancelled",t.status==="CANCELLED"),s(),S(" ",t.status," ")}}var et=class et{constructor(){this.activity=I.required()}};et.\u0275fac=function(t){return new(t||et)},et.\u0275cmp=x({type:et,selectors:[["app-activity-status"]],inputs:{activity:[1,"activity"]},decls:1,vars:1,consts:[[1,"status",3,"successful","running","failed","cancelled"],[1,"status"]],template:function(t,n){if(t&1&&u(0,qi,2,9,"span",0),t&2){let a;v((a=n.activity())?0:-1,a)}},dependencies:[D],styles:[".status[_ngcontent-%COMP%]{padding:4px;border-radius:2px}.status.successful[_ngcontent-%COMP%]{background:#28a745;color:#fff}.status.failed[_ngcontent-%COMP%]{background:#dc3545;color:#fff}.status.running[_ngcontent-%COMP%], .status.cancelled[_ngcontent-%COMP%]{background:#eee;color:#333}"],changeDetection:0});var Vt=et;var Yt=i=>({c:i});function zi(i,e){if(i&1&&(m(0,"ya-page-icon-button",13),c(1," Activity details ")),i&2){let t=l(2);p("queryParams",G(1,Yt,t.yamcs.context))}}function Hi(i,e){if(i&1){let t=A();r(0,"ya-page-button",14),C("clicked",function(){g(t);let a=l(),y=l();return _(y.setSuccessful(a))}),c(1," Set successful "),o(),r(2,"ya-page-button",15),C("clicked",function(){g(t);let a=l(),y=l();return _(y.setFailed(a))}),c(3," Set failed "),o()}}function Wi(i,e){if(i&1){let t=A();r(0,"ya-page-button",16),C("clicked",function(){g(t);let a=l(),y=l();return _(y.cancelActivity(a))}),c(1," Cancel "),o()}if(i&2){let t=l();p("disabled",!!t.stop)}}function Qi(i,e){if(i&1&&(r(0,"ya-instance-page")(1,"ya-instance-toolbar"),M(2,zi,2,3,"ng-template",2),u(3,Hi,4,0),u(4,Wi,2,1,"ya-page-button",3),o(),r(5,"div",4)(6,"div",5)(7,"span",6),c(8),o(),m(9,"br"),r(10,"span",7),c(11),o(),m(12,"br"),r(13,"span",7),c(14),f(15,"datetime"),o(),m(16,"br"),o(),r(17,"div",8),m(18,"app-activity-status",9),o()(),r(19,"ya-page-tabs")(20,"a",10,0),c(22," Activity log "),o(),r(23,"a",11,1),c(25," Details "),o()(),r(26,"div",12),m(27,"router-outlet"),o()()),i&2){let t=e,n=V(21),a=V(24),y=l();s(3),v(t.type==="MANUAL"&&t.status==="RUNNING"&&y.mayControlActivities()?3:-1),s(),v(y.mayControlActivities()?4:-1),s(4),w(t.detail),s(3),S("ID: ",t.id),s(3),S("Started ",h(15,12,t.start)),s(4),p("activity",t),s(2),N("active",n.isActive),p("queryParams",G(14,Yt,y.yamcs.context)),s(3),N("active",a.isActive),p("queryParams",G(16,Yt,y.yamcs.context))}}var it=class it{constructor(e,t,n,a,y,B){this.yamcs=t;this.messageService=n;this.authService=a;this.dialog=y;this.activityService=B;this.activityId=I.required();this.activity$=B.activity$.pipe(Ut($t=>{$t&&e.setTitle($t.detail)}))}ngOnInit(){this.activityService.connect(this.activityId())}mayControlActivities(){return this.authService.getUser().hasSystemPrivilege("ControlActivities")}setSuccessful(e){this.yamcs.yamcsClient.completeManualActivity(this.yamcs.instance,e.id).catch(t=>this.messageService.showError(t))}setFailed(e){this.dialog.open(Q,{width:"400px",data:{activity:e}}).afterClosed().subscribe(t=>{t&&this.yamcs.yamcsClient.completeManualActivity(this.yamcs.instance,e.id,{failureReason:t.failureReason}).catch(n=>this.messageService.showError(n))})}cancelActivity(e){this.yamcs.yamcsClient.cancelActivity(this.yamcs.instance,e.id).catch(t=>this.messageService.showError(t))}ngOnDestroy(){this.activityService.disconnect()}};it.\u0275fac=function(t){return new(t||it)(d(ut),d(L),d(O),d(St),d(Ct),d(Z))},it.\u0275cmp=x({type:it,selectors:[["ng-component"]],inputs:{activityId:[1,"activityId"]},decls:2,vars:3,consts:[["rla","routerLinkActive"],["rlb","routerLinkActive"],["ya-instance-toolbar-label",""],["icon","cancel",3,"disabled"],[1,"activity-header"],[1,"activity-header-left"],[1,"title"],[1,"subtitle"],[1,"activity-header-right"],[3,"activity"],["routerLink","log","routerLinkActive","",3,"queryParams"],["routerLink","details","routerLinkActive","",3,"queryParams"],[1,"tab-content-wrapper"],["routerLink","..","icon","arrow_back",3,"queryParams"],["icon","thumb_up",3,"clicked"],["icon","thumb_down",3,"clicked"],["icon","cancel",3,"clicked","disabled"]],template:function(t,n){if(t&1&&(u(0,Qi,28,18,"ya-instance-page"),f(1,"async")),t&2){let a;v((a=h(1,1,n.activity$))?0:-1,a)}},dependencies:[Vt,D,Jt,vt,Xt,xt,Dt,ke,At,Ve,Ne,E,$],styles:[".activity-header[_ngcontent-%COMP%]{height:100px;border-bottom:1px solid rgba(0,0,0,.1);display:flex}.activity-header-left[_ngcontent-%COMP%]{flex:1 1 auto;align-self:center;margin-left:24px;margin-right:24px}.activity-header-left[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:larger}.activity-header-left[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{font-size:smaller;color:gray}.activity-header-right[_ngcontent-%COMP%]{flex:1 1 auto;align-self:center;text-align:right;margin-left:24px;margin-right:24px}.tab-content-wrapper[_ngcontent-%COMP%]{position:absolute;inset:137px 0 0;overflow:auto}.tab-content-wrapper.noscroll[_ngcontent-%COMP%]{overflow:hidden}"],changeDetection:0});var Nt=it;var oo=[{path:"",canActivate:[ze,qe],canActivateChild:[He],runGuardsAndResolvers:"always",component:We,children:[{path:"",pathMatch:"full",component:Pt},{path:":activityId",component:Nt,children:[{path:"",pathMatch:"full",redirectTo:"log"},{path:"log",component:Ft},{path:"details",component:wt}]}]}];export{oo as ROUTES};
