import{a as oi,b as li}from"./chunk-L67MW52F.js";import{Aa as F,Ag as te,Bf as Y,C as nt,Ca as v,Cb as xt,Cc as k,Cf as Gt,Cg as Xt,D as De,De as Ne,Dg as Ge,Ea as p,Eh as ni,F as S,Fa as gt,Fc as V,Ff as Wt,Fh as M,G as E,Ga as Ct,Gb as Mt,Gg as Zt,Gh as ai,H as pt,Hg as q,Hh as ri,Ib as we,If as y,Jb as Ie,Je as Pt,Jf as Qt,Kb as Ot,Ke as Ft,Kf as x,La as ht,Lf as Ye,Ma as yt,Me as Nt,Na as b,Ne as Rt,Pa as xe,Pc as wt,Pe as Lt,Pg as ei,Qg as ti,Ra as s,Rf as me,Ta as $,Tc as Pe,Uc as It,Uf as Bt,Ug as ii,V as l,Vf as Ht,Y as d,Ya as R,Ye as Re,Za as ot,Ze as At,_,_e as kt,a as tt,ab as _t,af as Vt,b as it,bb as T,be as Me,bf as Le,bg as Z,cb as w,cg as Ut,da as f,df as Ae,dg as pe,eb as St,ef as Yt,f as P,gf as qt,hf as ke,ib as W,ig as qe,jb as Et,jc as Dt,jf as Ve,ka as g,kf as $t,kg as $e,la as dt,lf as X,ma as C,mf as jt,mg as zt,na as ut,ne as B,oa as ft,oc as se,oe as H,og as Jt,pa as vt,pb as Te,pe as Fe,pg as je,qa as c,qc as I,qe as U,ra as a,rb as bt,re as z,sa as r,sb as le,sc as L,se as J,ta as m,tc as A,te as K,uc as ce,vc as Tt,wc as h,xa as O,xc as oe,ya as D,yc as Q,yg as Kt,z as mt,za as G,zg as ee}from"./chunk-OXOWQRWE.js";var lt=(i,e)=>De(at).canActivate(i,e);var ae=class ae{constructor(e,t){this.authService=e;this.router=t}canActivate(e,t){return this.authService.getUser().hasSystemPrivilege("ReadEvents")?!0:(this.router.navigate(["/403"],{queryParams:{page:t.url}}),!1)}canActivateChild(e,t){return this.canActivate(e,t)}};ae.\u0275fac=function(t){return new(t||ae)(nt(Ye),nt(we))},ae.\u0275prov=mt({token:ae,factory:ae.\u0275fac,providedIn:"root"});var at=ae;var de=class de{constructor(e,t,n,o){this.dialogRef=e;this.yamcs=n;this.data=o;this.severityOptions=[{id:"INFO",label:"INFO"},{id:"WATCH",label:"WATCH"},{id:"WARNING",label:"WARNING"},{id:"DISTRESS",label:"DISTRESS"},{id:"CRITICAL",label:"CRITICAL"},{id:"SEVERE",label:"SEVERE"}];this.form=t.group({message:["",I.required],severity:"INFO",time:[y.toISOString(n.getMissionTime()),I.required]})}save(){this.yamcs.yamcsClient.createEvent(this.yamcs.instance,{message:this.form.value.message,severity:this.form.value.severity,time:y.toISOString(this.form.value.time)}).then(e=>this.dialogRef.close(e))}};de.\u0275fac=function(t){return new(t||de)(d(B),d(wt),d(x),d(H))},de.\u0275cmp=_({type:de,selectors:[["app-create-event-dialog"]],decls:15,vars:4,consts:[["mat-dialog-title",""],[1,"ya-form",3,"formGroup"],["label","Message"],["formControlName","message","rows","3"],["label","Severity"],["formControlName","severity",3,"options"],["label","Event time"],["formControlName","time","step","1",3,"showNow"],["align","end"],["mat-dialog-close",""],["appearance","primary",3,"click","disabled"]],template:function(t,n){t&1&&(a(0,"h2",0),s(1,"Create event"),r(),a(2,"mat-dialog-content")(3,"form",1)(4,"ya-field",2),m(5,"textarea",3),r(),a(6,"ya-field",4),m(7,"ya-select",5),r(),a(8,"ya-field",6),m(9,"ya-date-time-input",7),r()()(),a(10,"mat-dialog-actions",8)(11,"ya-button",9),s(12,"CANCEL"),r(),a(13,"ya-button",10),v("click",function(){return n.save()}),s(14,"SAVE"),r()()),t&2&&(l(3),c("formGroup",n.form),l(4),c("options",n.severityOptions),l(2),c("showNow",!0),l(4),c("disabled",!n.form.valid))},dependencies:[M,Q,se,L,A,k,V,U,z,K,J,Y,me,Z,q],encapsulation:2,changeDetection:0});var We=de;var si="INFO",ci=[],ue=class ue{constructor(e,t,n,o){this.dialogRef=e;this.yamcs=t;this.messageService=n;this.data=o;this.form=new ce({name:new h("",I.required),filter:new h(""),severity:new h(si,I.required),source:new h(ci),shared:new h(!1,I.required)});this.form.patchValue({filter:o.filter||void 0,severity:o.severity,source:o.source})}save(){let{value:e}=this.form;this.yamcs.yamcsClient.createQuery(this.yamcs.instance,"events",{name:e.name,shared:e.shared??!1,query:{filter:e.filter??void 0,source:e.source??ci,severity:e.severity??si}}).then(t=>this.dialogRef.close(t)).catch(t=>this.messageService.showError(t))}};ue.\u0275fac=function(t){return new(t||ue)(d(B),d(x),d(X),d(H))},ue.\u0275cmp=_({type:ue,selectors:[["app-create-event-query-dialog"]],decls:25,vars:3,consts:[["mat-dialog-title",""],[1,"ya-form",3,"formGroup"],["label","Name"],["formControlName","name","type","text"],["label","Query"],["formControlName","filter"],["label","Severity"],["formControlName","severity"],["id","INFO","label","Info level"],["id","WATCH","label","Watch level"],["id","WARNING","label","Warning level"],["id","DISTRESS","label","Distress level"],["id","CRITICAL","label","Critical level"],["id","SEVERE","label","Severe level"],["label","Source"],["formControlName","source","emptyOption","Any source",3,"options"],["label","Share with other users"],["formControlName","shared"],["align","end"],["mat-dialog-close",""],["appearance","primary",3,"click","disabled"]],template:function(t,n){t&1&&(a(0,"h2",0),s(1,"Save query"),r(),a(2,"mat-dialog-content")(3,"form",1)(4,"ya-field",2),m(5,"input",3),r(),a(6,"ya-field",4),m(7,"ya-filter-textarea",5),r(),a(8,"ya-field",6)(9,"ya-select",7),m(10,"ya-option",8)(11,"ya-option",9)(12,"ya-option",10)(13,"ya-option",11)(14,"ya-option",12)(15,"ya-option",13),r()(),a(16,"ya-field",14),m(17,"ya-multi-select",15),r(),a(18,"ya-field",16),m(19,"mat-slide-toggle",17),r()()(),a(20,"mat-dialog-actions",18)(21,"ya-button",19),s(22,"CANCEL"),r(),a(23,"ya-button",20),v("click",function(){return n.save()}),s(24,"SAVE"),r()()),t&2&&(l(3),c("formGroup",n.form),l(14),c("options",n.data.sourceOptions),l(6),c("disabled",!n.form.valid))},dependencies:[M,Q,se,L,A,k,V,U,z,K,J,Ne,Y,Z,pe,ee,te,q],encapsulation:2,changeDetection:0});var Be=ue;function Si(i,e){i&1&&s(0,` -
`)}function Ei(i,e){if(i&1&&m(0,"ya-highlight",0),i&2){let t=p();c("text",t.summary)("term",t.highlight)}}function bi(i,e){if(i&1&&m(0,"br")(1,"ya-highlight",0),i&2){let t=p(2);l(),c("text",t.detail)("term",t.highlight)}}function xi(i,e){if(i&1){let t=F();a(0,"ya-icon-action",1),v("click",function(){S(t);let o=p();return E(o.toggleExpanded())}),r(),g(1,bi,2,2),T(2,"async")}if(i&2){let t=p();l(),C(w(2,1,t.expanded$)?1:-1)}}var fe=class fe{constructor(){this.expanded$=new P(!1)}ngOnInit(){if(this.message!==null&&this.message!==void 0){let e=this.message.indexOf(`
`);e===-1?this.summary=this.message:(this.summary=this.message.substring(0,e),e+1<this.message.length&&(this.detail=this.message.substring(e+1)))}}toggleExpanded(){this.expanded$.next(!this.expanded$.value)}};fe.\u0275fac=function(t){return new(t||fe)},fe.\u0275cmp=_({type:fe,selectors:[["app-event-message"]],inputs:{message:"message",highlight:"highlight"},decls:3,vars:3,consts:[[3,"text","term"],["icon","more_horiz",3,"click"]],template:function(t,n){t&1&&(g(0,Si,1,0),g(1,Ei,1,2,"ya-highlight",0),g(2,xi,3,3)),t&2&&(C(n.summary===null||n.summary===void 0?0:-1),l(),C(n.summary!==null&&n.summary!==void 0?1:-1),l(),C(n.detail?2:-1))},dependencies:[M,qe,Gt,le],encapsulation:2,changeDetection:0});var He=fe;var Mi=()=>({level:"info",tooltip:"Info"}),Oi=()=>({level:"watch",tooltip:"Watch"}),Di=()=>({level:"warning",tooltip:"Warning"}),Ti=()=>({level:"distress",tooltip:"Distress"}),wi=()=>({level:"critical",tooltip:"Critical"}),Ii=()=>({level:"severe",tooltip:"Severe"}),Pi=()=>({level:"severe",tooltip:"Error"});function Fi(i,e){i&1&&G(0)}function Ni(i,e){if(i&1&&f(0,Fi,1,0,"ng-container",1),i&2){p();let t=b(8);c("ngTemplateOutlet",t)("ngTemplateOutletContext",R(2,Mi))}}function Ri(i,e){i&1&&G(0)}function Li(i,e){if(i&1&&f(0,Ri,1,0,"ng-container",1),i&2){p();let t=b(8);c("ngTemplateOutlet",t)("ngTemplateOutletContext",R(2,Oi))}}function Ai(i,e){i&1&&G(0)}function ki(i,e){if(i&1&&f(0,Ai,1,0,"ng-container",1),i&2){p();let t=b(8);c("ngTemplateOutlet",t)("ngTemplateOutletContext",R(2,Di))}}function Vi(i,e){i&1&&G(0)}function Yi(i,e){if(i&1&&f(0,Vi,1,0,"ng-container",1),i&2){p();let t=b(8);c("ngTemplateOutlet",t)("ngTemplateOutletContext",R(2,Ti))}}function qi(i,e){i&1&&G(0)}function $i(i,e){if(i&1&&f(0,qi,1,0,"ng-container",1),i&2){p();let t=b(8);c("ngTemplateOutlet",t)("ngTemplateOutletContext",R(2,wi))}}function ji(i,e){i&1&&G(0)}function Gi(i,e){if(i&1&&f(0,ji,1,0,"ng-container",1),i&2){p();let t=b(8);c("ngTemplateOutlet",t)("ngTemplateOutletContext",R(2,Ii))}}function Wi(i,e){i&1&&G(0)}function Qi(i,e){if(i&1&&f(0,Wi,1,0,"ng-container",1),i&2){p();let t=b(8);c("ngTemplateOutlet",t)("ngTemplateOutletContext",R(2,Pi))}}function Bi(i,e){if(i&1&&(pt(),a(0,"svg",2),m(1,"rect",3)(2,"rect",4)(3,"rect",5)(4,"rect",6)(5,"rect",7),r()),i&2){let t=e.level,n=e.tooltip,o=p();xe("grayscale",o.grayscale),c("ngClass",t)("matTooltip",n)}}var ve=class ve{constructor(){this.grayscale=!1}};ve.\u0275fac=function(t){return new(t||ve)},ve.\u0275cmp=_({type:ve,selectors:[["app-event-severity"]],inputs:{severity:"severity",grayscale:"grayscale"},decls:9,vars:1,consts:[["img",""],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["width","29","height","5","viewBox","0 0 58 10",3,"ngClass","matTooltip"],["x","0","width","10","height","10",1,"r1"],["x","12","width","10","height","10",1,"r2"],["x","24","width","10","height","10",1,"r3"],["x","36","width","10","height","10",1,"r4"],["x","48","width","10","height","10",1,"r5"]],template:function(t,n){if(t&1&&(g(0,Ni,1,3,"ng-container")(1,Li,1,3,"ng-container")(2,ki,1,3,"ng-container")(3,Yi,1,3,"ng-container")(4,$i,1,3,"ng-container")(5,Gi,1,3,"ng-container")(6,Qi,1,3,"ng-container"),f(7,Bi,6,4,"ng-template",null,0,St)),t&2){let o;C((o=n.severity)==="INFO"?0:o==="WATCH"?1:o==="WARNING"?2:o==="DISTRESS"?3:o==="CRITICAL"?4:o==="SEVERE"?5:o==="ERROR"?6:-1)}},dependencies:[Pe,Te,bt],styles:["svg[_ngcontent-%COMP%]{display:inline-block}.info[_ngcontent-%COMP%]   .r1[_ngcontent-%COMP%], .info[_ngcontent-%COMP%]   .r2[_ngcontent-%COMP%], .info[_ngcontent-%COMP%]   .r3[_ngcontent-%COMP%], .info[_ngcontent-%COMP%]   .r4[_ngcontent-%COMP%], .info[_ngcontent-%COMP%]   .r5[_ngcontent-%COMP%]{fill:#ccc}.watch[_ngcontent-%COMP%]   .r1[_ngcontent-%COMP%]{fill:#ff8c00}.watch.grayscale[_ngcontent-%COMP%]   .r1[_ngcontent-%COMP%]{fill:#a0a0a0}.watch[_ngcontent-%COMP%]   .r2[_ngcontent-%COMP%], .watch[_ngcontent-%COMP%]   .r3[_ngcontent-%COMP%], .watch[_ngcontent-%COMP%]   .r4[_ngcontent-%COMP%], .watch[_ngcontent-%COMP%]   .r5[_ngcontent-%COMP%]{fill:#ccc}.warning[_ngcontent-%COMP%]   .r1[_ngcontent-%COMP%], .warning[_ngcontent-%COMP%]   .r2[_ngcontent-%COMP%]{fill:#ff8c00}.warning.grayscale[_ngcontent-%COMP%]   .r1[_ngcontent-%COMP%], .warning.grayscale[_ngcontent-%COMP%]   .r2[_ngcontent-%COMP%]{fill:#a0a0a0}.warning[_ngcontent-%COMP%]   .r3[_ngcontent-%COMP%], .warning[_ngcontent-%COMP%]   .r4[_ngcontent-%COMP%], .warning[_ngcontent-%COMP%]   .r5[_ngcontent-%COMP%]{fill:#ccc}.distress[_ngcontent-%COMP%]   .r1[_ngcontent-%COMP%], .distress[_ngcontent-%COMP%]   .r2[_ngcontent-%COMP%], .distress[_ngcontent-%COMP%]   .r3[_ngcontent-%COMP%]{fill:red}.distress.grayscale[_ngcontent-%COMP%]   .r1[_ngcontent-%COMP%], .distress.grayscale[_ngcontent-%COMP%]   .r2[_ngcontent-%COMP%], .distress.grayscale[_ngcontent-%COMP%]   .r3[_ngcontent-%COMP%]{fill:#a0a0a0}.distress[_ngcontent-%COMP%]   .r4[_ngcontent-%COMP%], .distress[_ngcontent-%COMP%]   .r5[_ngcontent-%COMP%]{fill:#ccc}.critical[_ngcontent-%COMP%]   .r1[_ngcontent-%COMP%], .critical[_ngcontent-%COMP%]   .r2[_ngcontent-%COMP%], .critical[_ngcontent-%COMP%]   .r3[_ngcontent-%COMP%], .critical[_ngcontent-%COMP%]   .r4[_ngcontent-%COMP%]{fill:red}.critical.grayscale[_ngcontent-%COMP%]   .r1[_ngcontent-%COMP%], .critical.grayscale[_ngcontent-%COMP%]   .r2[_ngcontent-%COMP%], .critical.grayscale[_ngcontent-%COMP%]   .r3[_ngcontent-%COMP%], .critical.grayscale[_ngcontent-%COMP%]   .r4[_ngcontent-%COMP%]{fill:#a0a0a0}.critical[_ngcontent-%COMP%]   .r5[_ngcontent-%COMP%]{fill:#ccc}.severe[_ngcontent-%COMP%]   .r1[_ngcontent-%COMP%], .severe[_ngcontent-%COMP%]   .r2[_ngcontent-%COMP%], .severe[_ngcontent-%COMP%]   .r3[_ngcontent-%COMP%], .severe[_ngcontent-%COMP%]   .r4[_ngcontent-%COMP%], .severe[_ngcontent-%COMP%]   .r5[_ngcontent-%COMP%]{fill:red}.severe.grayscale[_ngcontent-%COMP%]   .r1[_ngcontent-%COMP%], .severe.grayscale[_ngcontent-%COMP%]   .r2[_ngcontent-%COMP%], .severe.grayscale[_ngcontent-%COMP%]   .r3[_ngcontent-%COMP%], .severe.grayscale[_ngcontent-%COMP%]   .r4[_ngcontent-%COMP%], .severe.grayscale[_ngcontent-%COMP%]   .r5[_ngcontent-%COMP%]{fill:#a0a0a0}@media print{svg[_ngcontent-%COMP%]{-webkit-print-color-adjust:exact;print-color-adjust:exact}}"],changeDetection:0});var Ue=ve;var Hi=["*"],Ui=()=>({matrixParams:"exact",paths:"exact",queryParams:"ignored"}),pi=i=>({c:i}),ge=class ge{constructor(e){this.yamcs=e}};ge.\u0275fac=function(t){return new(t||ge)(d(x))},ge.\u0275cmp=_({type:ge,selectors:[["app-events-page-tabs"]],ngContentSelectors:Hi,decls:9,vars:12,consts:[["rla","routerLinkActive"],["rlb","routerLinkActive"],["routerLink","/events","routerLinkActive","",3,"routerLinkActiveOptions","queryParams"],["routerLink","/events/queries","routerLinkActive","",3,"queryParams"],["actions",""]],template:function(t,n){if(t&1&&(gt(),a(0,"ya-page-tabs")(1,"a",2,0),s(3," Query "),r(),a(4,"a",3,1),s(6," Saved queries "),r(),O(7,4),Ct(8),D(),r()),t&2){let o=b(2),u=b(5);l(),xe("active",o.isActive),c("routerLinkActiveOptions",R(7,Ui))("queryParams",ot(8,pi,n.yamcs.context)),l(3),xe("active",u.isActive),c("queryParams",ot(10,pi,n.yamcs.context))}},dependencies:[M,Ie,Ot,Xt],styles:[".mat-mdc-tab-link[_ngcontent-%COMP%]{height:36px;min-width:0;font-size:13px}.actions[_ngcontent-%COMP%]{display:flex;align-items:center}"],changeDetection:0});var Ce=ge;var he=class he{constructor(e,t,n){this.dialogRef=e;this.yamcs=t;this.data=n;this.downloadURL$=new P(null);this.form=new Tt({start:new oe(null),stop:new oe(null),severity:new oe(null,I.required),filter:new oe(null),source:new oe([]),delimiter:new oe(null,I.required)});this.form.setValue({start:n.start?y.toISOString(n.start):"",stop:n.stop?y.toISOString(n.stop):"",filter:n.filter||"",source:n.source,severity:n.severity,delimiter:"TAB"}),this.formChangeSubscription=this.form.valueChanges.subscribe(()=>{this.updateURL()}),this.updateURL()}closeDialog(){this.dialogRef.close(!0)}updateURL(){if(this.form.valid){let e={delimiter:this.form.value.delimiter,severity:this.form.value.severity};if(this.form.value.start&&(e.start=y.toISOString(this.form.value.start)),this.form.value.stop&&(e.stop=y.toISOString(this.form.value.stop)),this.form.value.filter&&(e.filter=this.form.value.filter),this.form.value.source.length){let n=this.form.value.source;e.source=n}let t=this.yamcs.yamcsClient.getEventsDownloadURL(this.yamcs.instance,e);this.downloadURL$.next(t)}else this.downloadURL$.next(null)}ngOnDestroy(){this.formChangeSubscription?.unsubscribe()}};he.\u0275fac=function(t){return new(t||he)(d(B),d(x),d(H))},he.\u0275cmp=_({type:he,selectors:[["ng-component"]],decls:31,vars:6,consts:[["mat-dialog-title",""],[1,"ya-form"],[3,"formGroup"],["label","Start"],["formControlName","start"],["label","Stop"],["formControlName","stop"],["label","Query"],["formControlName","filter"],["label","Severity"],["formControlName","severity"],["id","INFO","label","Info level"],["id","WATCH","label","Watch level"],["id","WARNING","label","Warning level"],["id","DISTRESS","label","Distress level"],["id","CRITICAL","label","Critical level"],["id","SEVERE","label","Severe level"],["label","Source"],["formControlName","source","emptyOption","Any source",3,"options"],["label","CSV column delimiter"],["formControlName","delimiter"],["id","COMMA","label","Comma"],["id","SEMICOLON","label","Semicolon"],["id","TAB","label","Tab"],["align","end"],["mat-dialog-close",""],["appearance","primary",3,"click","link","disabled"]],template:function(t,n){t&1&&(a(0,"h2",0),s(1,"Export events"),r(),a(2,"mat-dialog-content",1)(3,"form",2)(4,"ya-field",3),m(5,"ya-date-time-input",4),r(),a(6,"ya-field",5),m(7,"ya-date-time-input",6),r(),a(8,"ya-field",7),m(9,"ya-filter-textarea",8),r(),a(10,"ya-field",9)(11,"ya-select",10),m(12,"ya-option",11)(13,"ya-option",12)(14,"ya-option",13)(15,"ya-option",14)(16,"ya-option",15)(17,"ya-option",16),r()(),a(18,"ya-field",17),m(19,"ya-multi-select",18),r(),a(20,"ya-field",19)(21,"ya-select",20),m(22,"ya-option",21)(23,"ya-option",22)(24,"ya-option",23),r()()()(),a(25,"mat-dialog-actions",24)(26,"ya-button",25),s(27,"CANCEL"),r(),a(28,"ya-download-button",26),T(29,"async"),v("click",function(){return n.closeDialog()}),s(30," DOWNLOAD "),r()()),t&2&&(l(3),c("formGroup",n.form),l(16),c("options",n.data.sourceOptions),l(9),c("link",w(29,4,n.downloadURL$))("disabled",!n.form.valid))},dependencies:[M,Q,L,A,k,V,U,z,K,J,Y,me,Ht,Z,pe,ee,te,q,le],encapsulation:2});var ze=he;function ye(i,e,t,n){let o=e.label+' = ""',u=Me(i.state,o,t,n);u.selection={anchor:t+o.length-1},i.dispatch(u)}function di(i,e,t,n){i.dispatch(Me(i.state,e.label+" = ",t,n))}function ui(i,e,t,n){i.dispatch(Me(i.state,e.label+" = ",t,n))}function st(i,e,t,n){i.dispatch(Me(i.state,e.label+" ",t,n))}var fi=[{label:"message",type:"method",info:"Filter by event message",apply:ye},{label:"seqNumber",type:"method",info:"Filter by event sequence number",apply:ui},{label:"severity",type:"method",info:"Filter by event severity (info, watch, warning, distress, critical, severe)",apply:di},{label:"source",type:"method",info:"Filter by event source",apply:ye},{label:"type",type:"method",info:"Filter by event type",apply:ye},{section:"Exclude events",label:"-message",type:"method",info:"Exclude events based on message",apply:ye},{section:"Exclude events",label:"-seqNumber",type:"method",info:"Exclude events based on sequence number",apply:ui},{section:"Exclude events",label:"-severity",type:"method",info:"Exclude events based on severity (info, watch, warning, distress, critical, severe)",apply:di},{section:"Exclude events",label:"-source",type:"method",info:"Exclude events based on source",apply:ye},{section:"Exclude events",label:"-type",type:"method",info:"Exclude events based on type",apply:ye},{section:"Logical operators",label:"AND",type:"constant",apply:st},{section:"Logical operators",label:"OR",type:"constant",apply:st},{section:"Logical operators",label:"NOT",type:"constant",apply:st}];var Je=class{constructor(e){this.watermarkObserver=e;this.dirty=!1;this.archiveEvents=[];this.bufferSize=500;this.bufferWatermark=400;this.pointer=0;this.alreadyWarned=!1;this.realtimeBuffer=Array(this.bufferSize).fill(void 0)}addArchiveData(e){this.archiveEvents=this.archiveEvents.concat(e),this.dirty=!0}addRealtimeEvent(e){this.pointer<this.bufferSize&&(this.realtimeBuffer[this.pointer]=e,this.pointer>=this.bufferWatermark&&this.watermarkObserver&&!this.alreadyWarned&&(this.alreadyWarned=!0,this.watermarkObserver()),this.pointer=this.pointer+1),this.dirty=!0}reset(){this.archiveEvents=[],this.realtimeBuffer.fill(void 0),this.pointer=0,this.alreadyWarned=!1,this.dirty=!0}snapshot(){let e=this.realtimeBuffer.filter(n=>n!==void 0);return this.archiveEvents.concat(e).sort((n,o)=>{let u=-n.generationTime.localeCompare(o.generationTime);return u===0&&(u=-n.source.localeCompare(o.source)),u!==0?u:o.seqNumber-n.seqNumber})}compact(e){let t=this.snapshot();t.length=Math.min(e,t.length),this.reset(),this.archiveEvents=t,this.dirty=!0}};var Ke=class extends Dt{constructor(t,n){super();this.yamcs=t;this.pageSize=100;this.blockHasMore=!1;this.events$=new P([]);this.sources$=new P([]);this.loading$=new P(!1);this.streaming$=new P(!1);this.syncSubscription=n.sync(()=>{this.eventBuffer.dirty&&!this.loading$.getValue()&&(this.emitEvents(),this.eventBuffer.dirty=!1)}),this.eventBuffer=new Je(()=>{this.blockHasMore=!0,this.eventBuffer.compact(500)})}connect(){return this.events$}emitEvents(){this.events$.next(this.eventBuffer.snapshot())}loadEvents(t){return this.loading$.next(!0),this.streaming$.value&&this.realtimeSubscription.sendMessage({instance:this.yamcs.instance,filter:t.filter}),Promise.all([this.yamcs.yamcsClient.getEventSources(this.yamcs.instance),this.loadPage(it(tt({},t),{limit:this.pageSize+1}))]).then(n=>{let o=n[0],u=n[1];return this.eventBuffer.reset(),this.blockHasMore=!1,this.eventBuffer.addArchiveData(u),this.sources$.next(o),this.emitEvents(),u}).catch(n=>{throw this.eventBuffer.reset(),n}).finally(()=>{this.loading$.next(!1)})}hasMore(){return this.offscreenRecord!=null&&!this.blockHasMore}loadPage(t){return this.options=t,this.yamcs.yamcsClient.getEvents(this.yamcs.instance,t).then(n=>(n.length>this.pageSize?(n.splice(n.length-1,1),this.offscreenRecord=n[n.length-1]):this.offscreenRecord=null,n))}async loadMoreData(t){if(this.offscreenRecord)return this.loadPage(it(tt({},t),{stop:this.offscreenRecord.generationTime,limit:this.pageSize+1})).then(n=>{this.eventBuffer.addArchiveData(n),this.emitEvents()})}startStreaming(){this.streaming$.next(!0),this.realtimeSubscription=this.yamcs.yamcsClient.createEventSubscription({instance:this.yamcs.instance,filter:this.options.filter},t=>{this.addEventSource(t),!this.loading$.getValue()&&this.matchesFilter(t)&&this.eventBuffer.addRealtimeEvent(t)})}addEventSource(t){if(t.source){for(let n of this.sources$.value)if(n===t.source)return;this.sources$.next([...this.sources$.value,t.source].sort((n,o)=>n.toLowerCase().localeCompare(o.toLocaleLowerCase())))}}matchesFilter(t){if(this.options){if(this.options.source?.length&&this.options.source.indexOf(t.source)===-1)return!1;if(this.options.severity)switch(this.options.severity){case"SEVERE":case"ERROR":if(t.severity==="CRITICAL")return!1;case"CRITICAL":if(t.severity==="DISTRESS")return!1;case"DISTRESS":if(t.severity==="WARNING")return!1;case"WARNING":if(t.severity==="WATCH")return!1;case"WATCH":if(t.severity==="INFO")return!1}}return!0}stopStreaming(){this.realtimeSubscription?.cancel(),this.streaming$.next(!1)}disconnect(){this.stopStreaming(),this.syncSubscription?.unsubscribe(),this.events$.complete(),this.sources$.complete(),this.loading$.complete(),this.streaming$.complete()}};var Ji=["searchFilter"];function Ki(i,e){if(i&1){let t=F();a(0,"ya-page-button",7),v("clicked",function(){S(t);let o=p();return E(o.createEvent())}),s(1,"Create event"),r()}}function Xi(i,e){if(i&1){let t=F();a(0,"ya-page-button",8),v("clicked",function(){S(t);let o=p();return E(o.stopStreaming())}),s(1," Stop streaming "),r()}}function Zi(i,e){if(i&1){let t=F();a(0,"ya-page-button",9),v("clicked",function(){S(t);let o=p();return E(o.startStreaming())}),s(1," Start streaming "),r()}}function en(i,e){if(i&1){let t=F();m(0,"ya-date-time-input",50)(1,"ya-date-time-input",51),a(2,"ya-button",49),v("click",function(){S(t);let o=p(2);return E(o.applyCustomDates())}),s(3,"Apply"),r()}if(i&2){let t=p(2);l(2),c("disabled",t.filterForm.invalid)}}function tn(i,e){i&1&&m(0,"ya-dots")}function nn(i,e){i&1&&(a(0,"div",29),s(1," Listening for events "),m(2,"ya-dots",52),r())}function on(i,e){if(i&1){let t=F();s(0," \xA0 "),a(1,"a",53),v("click",function(o){return S(t),p(2),b(15).doSearch(),E(o.preventDefault())}),s(2," Apply filter "),r(),s(3," . ")}}function an(i,e){if(i&1&&(a(0,"ya-table-top"),s(1," The search filter has changed. "),g(2,on,4,0),T(3,"async"),r()),i&2){p();let t=b(15);l(2),C(w(3,1,t.errorState$)?-1:2)}}function rn(i,e){i&1&&(a(0,"th",54),s(1,"Severity"),r())}function ln(i,e){if(i&1&&(a(0,"td",55),m(1,"app-event-severity",56),r()),i&2){let t=e.$implicit;l(),c("severity",t.severity)}}function sn(i,e){i&1&&(a(0,"th",57),s(1,"Message"),r())}function cn(i,e){if(i&1&&(a(0,"td",58),m(1,"app-event-message",59),r()),i&2){let t=e.$implicit,n=p(2);l(),c("message",t.message)("highlight",n.filterForm.value.filter)}}function mn(i,e){i&1&&(a(0,"th",54),s(1,"Type"),r())}function pn(i,e){if(i&1&&m(0,"ya-highlight",60),i&2){let t=p().$implicit,n=p(2);c("text",t.type)("term",n.filterForm.value.filter)}}function dn(i,e){i&1&&s(0," - ")}function un(i,e){if(i&1&&(a(0,"td",55),g(1,pn,1,2,"ya-highlight",60)(2,dn,1,0),r()),i&2){let t=e.$implicit;l(),C(t.type?1:2)}}function fn(i,e){i&1&&(a(0,"th",54),s(1,"Source"),r())}function vn(i,e){if(i&1&&m(0,"ya-highlight",60),i&2){let t=p().$implicit,n=p(2);c("text",t.source)("term",n.filterForm.value.filter)}}function gn(i,e){i&1&&s(0," - ")}function Cn(i,e){if(i&1&&(a(0,"td",55),g(1,vn,1,2,"ya-highlight",60)(2,gn,1,0),r()),i&2){let t=e.$implicit;l(),C(t.source?1:2)}}function hn(i,e){i&1&&(a(0,"th",54),s(1,"Generation time"),r())}function yn(i,e){if(i&1&&(a(0,"td",61),s(1),T(2,"datetime"),r()),i&2){let t=e.$implicit;l(),$(" ",w(2,1,t.generationTime)||"-"," ")}}function _n(i,e){i&1&&(a(0,"th",54),s(1,"Reception time"),r())}function Sn(i,e){if(i&1&&(a(0,"td",61),s(1),T(2,"datetime"),r()),i&2){let t=e.$implicit;l(),$(" ",w(2,1,t.receptionTime)||"-"," ")}}function En(i,e){i&1&&(a(0,"th",54),s(1,"Sequence number"),r())}function bn(i,e){if(i&1&&(a(0,"td",55),s(1),r()),i&2){let t=e.$implicit;l(),$(" ",t.seqNumber??"-"," ")}}function xn(i,e){if(i&1&&(a(0,"th",54),s(1),r()),i&2){let t=p().$implicit;l(),$(" ",t.label," ")}}function Mn(i,e){if(i&1&&s(0),i&2){let t=p().$implicit,n=p().$implicit;$(" ",t.extra[n.id]??"-"," ")}}function On(i,e){i&1&&s(0," - ")}function Dn(i,e){if(i&1&&(a(0,"td",55),g(1,Mn,1,1)(2,On,1,0),r()),i&2){let t=e.$implicit;l(),C(t.extra?1:2)}}function Tn(i,e){if(i&1&&(O(0,45),f(1,xn,2,1,"th",34)(2,Dn,3,1,"td",35),D()),i&2){let t=e.$implicit;c("cdkColumnDef",t.id)}}function wn(i,e){i&1&&m(0,"tr",62)}function In(i,e){if(i&1&&m(0,"tr",63),i&2){let t=e.$implicit;c("ngClass",t.severity)}}function Pn(i,e){if(i&1){let t=F();a(0,"ya-panel")(1,"app-events-page-tabs")(2,"ya-button",10),v("click",function(){S(t);let o=p();return E(o.clearQuery())}),s(3," Clear query "),r(),a(4,"ya-button",11),v("click",function(){S(t);let o=p();return E(o.openSaveQueryDialog())}),s(5," Save query "),r()(),a(6,"ya-filter-bar",12)(7,"ya-select",13),m(8,"ya-option",14)(9,"ya-option",15)(10,"ya-option",16)(11,"ya-option",17)(12,"ya-option",18),r(),g(13,en,4,1),a(14,"ya-search-filter2",19,0),v("typedValue",function(o){S(t);let u=p();return E(u.parseQuery(o))}),r(),a(16,"ya-select",20),m(17,"ya-option",21)(18,"ya-option",22)(19,"ya-option",23)(20,"ya-option",24)(21,"ya-option",25)(22,"ya-option",26),r(),m(23,"ya-multi-select",27),T(24,"async"),r(),a(25,"ya-table-window",28),g(26,tn,1,0,"ya-dots"),T(27,"async"),g(28,nn,3,0,"div",29),T(29,"async"),a(30,"ya-button",30),v("click",function(){S(t);let o=p();return E(o.exportEvents())}),s(31,"Export CSV"),r(),m(32,"ya-column-chooser",31,1),r(),g(34,an,4,3,"ya-table-top"),a(35,"table",32),O(36,33),f(37,rn,2,0,"th",34)(38,ln,2,1,"td",35),D(),O(39,36),f(40,sn,2,0,"th",37)(41,cn,2,2,"td",38),D(),O(42,39),f(43,mn,2,0,"th",34)(44,un,3,1,"td",35),D(),O(45,40),f(46,fn,2,0,"th",34)(47,Cn,3,1,"td",35),D(),O(48,41),f(49,hn,2,0,"th",34)(50,yn,3,3,"td",42),D(),O(51,43),f(52,_n,2,0,"th",34)(53,Sn,3,3,"td",42),D(),O(54,44),f(55,En,2,0,"th",34)(56,bn,2,1,"td",35),D(),ft(57,Tn,3,1,"ng-container",45,ut),f(59,wn,1,0,"tr",46),T(60,"async"),f(61,In,1,1,"tr",47),T(62,"async"),r(),a(63,"ya-toolbar",48)(64,"ya-button",49),v("click",function(){S(t);let o=p();return E(o.loadMoreData())}),s(65,"Load more"),r()()()}if(i&2){let t=b(15),n=b(33),o=p();l(2),c("disabled",!o.isClearQueryEnabled()),l(4),c("formGroup",o.filterForm),l(7),C(o.filterForm.value.interval==="CUSTOM"?13:-1),l(),c("completions",o.completions),l(9),c("options",w(24,16,o.sourceOptions$)),l(2),c("duration",o.appliedInterval)("start",o.validStart)("stop",o.validStop),l(),C(w(27,18,o.dataSource.loading$)?26:-1),l(2),C(w(29,20,o.dataSource.streaming$)?28:-1),l(4),c("columns",o.columns),l(2),C(t.dirty()?34:-1),l(),c("dataSource",o.dataSource),l(22),vt(o.extraColumns),l(2),c("cdkHeaderRowDef",w(60,22,n.displayedColumns$)),l(2),c("cdkRowDefColumns",w(62,24,n.displayedColumns$)),l(3),c("disabled",!o.dataSource.hasMore())}}var _e="PT1H",Se=class Se{constructor(e,t,n,o,u,$n,jn,hi,yi){this.yamcs=e;this.authService=t;this.dialog=n;this.messageService=u;this.router=$n;this.route=jn;this.filter=W();this.severity=W();this.source=W([],{transform:ni});this.interval=W();this.customStart=W();this.customStop=W();this.parseFilterSubscription=W.required();this.searchFilter=Et.required("searchFilter");this.completions=fi;this.filterForm=new ce({filter:new h(null),severity:new h("INFO"),source:new h([]),interval:new h(_e),customStart:new h(null),customStop:new h(null)});this.columns=[{id:"severity",label:"Severity",visible:!0},{id:"gentime",label:"Generation time",alwaysVisible:!0},{id:"message",label:"Message",alwaysVisible:!0},{id:"source",label:"Source",visible:!0},{id:"type",label:"Type",visible:!0},{id:"rectime",label:"Reception time"},{id:"seqNumber",label:"Sequence number"}];this.extraColumns=[];this.sourceOptions$=new P([]);this.downloadURL$=new P(null);hi.setTitle("Events");let ct=o.getConfig().events;if(ct){this.extraColumns=ct.extraColumns||[];for(let re of this.extraColumns)for(let N=0;N<this.columns.length;N++)if(this.columns[N].id===re.after){this.columns.splice(N+1,0,re);break}}e.yamcsClient.getEventSources(e.instance).then(re=>{for(let N of re)this.sourceOptions$.next([...this.sourceOptions$.value,{id:N,label:N}])}),this.dataSource=new Ke(e,yi),this.dataSource.sources$.subscribe(re=>{this.sourceOptions$.next(re.map(N=>({id:N,label:N})))})}ngOnInit(){this.parseFilterSubscription().addMessageListener(e=>{e.errorMessage?this.searchFilter().addErrorMark(e.errorMessage,{beginLine:e.beginLine,beginColumn:e.beginColumn,endLine:e.endLine,endColumn:e.endColumn}):this.searchFilter().clearErrorMark()}),this.initializeOptions(),this.loadData(),this.filterForm.get("filter").valueChanges.forEach(e=>{this.loadData()}),this.filterForm.get("severity").valueChanges.forEach(e=>{this.loadData()}),this.filterForm.get("source").valueChanges.forEach(e=>{this.loadData()}),this.filterForm.get("interval").valueChanges.forEach(e=>{if(e==="CUSTOM"){let t=this.validStart||this.yamcs.getMissionTime(),n=this.validStop||this.yamcs.getMissionTime();this.filterForm.get("customStart").setValue(y.toISOString(t)),this.filterForm.get("customStop").setValue(y.toISOString(n))}else e==="NO_LIMIT"?(this.validStart=null,this.validStop=null,this.appliedInterval=e,this.loadData()):e&&(this.validStop=this.yamcs.getMissionTime(),this.validStart=y.subtractDuration(this.validStop,e),this.appliedInterval=e,this.loadData())})}initializeOptions(){if(this.filter()){let e=this.filter();this.filterForm.get("filter").setValue(e)}if(this.severity()){let e=this.severity();this.filterForm.get("severity").setValue(e)}if(this.source()){let e=this.source();this.filterForm.get("source").setValue(e)}if(this.interval())if(this.appliedInterval=this.interval(),this.filterForm.get("interval").setValue(this.appliedInterval),this.appliedInterval==="CUSTOM"){let e=this.customStart();this.filterForm.get("customStart").setValue(e),this.validStart=y.toDate(e);let t=this.customStop();this.filterForm.get("customStop").setValue(t),this.validStop=y.toDate(t)}else this.appliedInterval==="NO_LIMIT"?(this.validStart=null,this.validStop=null):(this.validStop=this.yamcs.getMissionTime(),this.validStart=y.subtractDuration(this.validStop,this.appliedInterval));else this.appliedInterval=_e,this.validStop=this.yamcs.getMissionTime(),this.validStart=y.subtractDuration(this.validStop,_e)}jumpToNow(){let e=this.filterForm.controls.interval.value;e==="NO_LIMIT"?this.filterForm.get("interval").setValue(_e):e==="CUSTOM"?this.filterForm.get("interval").setValue(_e):e&&(this.validStop=this.yamcs.getMissionTime(),this.validStart=y.subtractDuration(this.validStop,e),this.loadData())}startStreaming(){this.filterForm.get("interval").setValue("NO_LIMIT"),this.dataSource.startStreaming()}stopStreaming(){this.dataSource.stopStreaming()}applyCustomDates(){let{controls:e}=this.filterForm;this.validStart=y.toDate(e.customStart.value),this.validStop=y.toDate(e.customStop.value),this.appliedInterval="CUSTOM",this.loadData()}loadData(){let{controls:e}=this.filterForm;this.updateURL();let t={severity:e.severity.value};this.validStart&&(t.start=this.validStart.toISOString()),this.validStop&&(t.stop=this.validStop.toISOString());let n=e.filter.value;n&&(t.filter=n);let o=e.source.value;o?.length&&(t.source=o),this.dataSource.loadEvents(t).catch(u=>this.messageService.showError(u))}loadMoreData(){let{controls:e}=this.filterForm,t={severity:e.severity.value};this.validStart&&(t.start=this.validStart.toISOString());let n=e.filter.value;n&&(t.filter=n);let o=e.source.value;o?.length&&(t.source=o),this.dataSource.loadMoreData(t).catch(u=>this.messageService.showError(u))}updateURL(){let{controls:e}=this.filterForm;this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{filter:e.filter.value||null,severity:e.severity.value,source:e.source.value?e.source.value:null,interval:this.appliedInterval,customStart:this.appliedInterval==="CUSTOM"?e.customStart.value:null,customStop:this.appliedInterval==="CUSTOM"?e.customStop.value:null},queryParamsHandling:"merge"})}clearQuery(){this.filterForm.reset({severity:"INFO",source:[],interval:_e})}openSaveQueryDialog(){let{controls:e}=this.filterForm;this.dialog.open(Be,{width:"800px",data:{severity:e.severity.value,filter:this.searchFilter().getTypedValue(),source:e.source.value,sourceOptions:this.sourceOptions$.value}}).afterClosed().subscribe(t=>{t&&this.messageService.showInfo("Query saved")})}parseQuery(e){this.parseFilterSubscription().sendMessage({resource:"events",filter:e})}isClearQueryEnabled(){let e=this.filterForm.value;return this.searchFilter().empty()||e.severity!=="INFO"||e.source?.length}mayWriteEvents(){return this.authService.getUser().hasSystemPrivilege("WriteEvents")}createEvent(){this.dialog.open(We,{width:"400px"}).afterClosed().subscribe(t=>{t&&this.jumpToNow()})}exportEvents(){let{controls:e}=this.filterForm;this.dialog.open(ze,{width:"800px",data:{severity:e.severity.value,start:this.validStart,stop:this.validStop,filter:e.filter.value,source:e.source.value,sourceOptions:this.sourceOptions$.value}})}ngOnDestroy(){this.parseFilterSubscription().cancel()}};Se.\u0275fac=function(t){return new(t||Se)(d(x),d(Ye),d(Fe),d(Qt),d(X),d(we),d(Mt),d(xt),d(jt))},Se.\u0275cmp=_({type:Se,selectors:[["ng-component"]],viewQuery:function(t,n){t&1&&ht(n.searchFilter,Ji,5),t&2&&yt()},inputs:{filter:[1,"filter"],severity:[1,"severity"],source:[1,"source"],interval:[1,"interval"],customStart:[1,"customStart"],customStop:[1,"customStop"],parseFilterSubscription:[1,"parseFilterSubscription"]},decls:9,vars:5,consts:[["searchFilter",""],["columnChooser",""],["label","Events"],["icon","add_box"],["matTooltip","Pause streaming events","icon","pause"],["icon","play_arrow"],["icon","refresh",3,"clicked"],["icon","add_box",3,"clicked"],["matTooltip","Pause streaming events","icon","pause",3,"clicked"],["icon","play_arrow",3,"clicked"],["appearance","text","icon","clear",3,"click","disabled"],["appearance","text","icon","save",3,"click"],[1,"query",2,"margin-top","16px",3,"formGroup"],["icon","access_time","formControlName","interval"],["id","PT1H","label","Last hour"],["id","PT6H","label","Last 6 hours"],["id","P1D","label","Last 24 hours"],["id","NO_LIMIT","label","No limit"],["id","CUSTOM","label","Custom","group","true"],["formControlName","filter","placeholder","Search events",2,"flex","1 1 auto",3,"typedValue","completions"],["formControlName","severity"],["id","INFO","label","Info level"],["id","WATCH","label","Watch level"],["id","WARNING","label","Warning level"],["id","DISTRESS","label","Distress level"],["id","CRITICAL","label","Critical level"],["id","SEVERE","label","Severe level"],["formControlName","source","emptyOption","Any source",3,"options"],[3,"duration","start","stop"],[2,"text-align","right","flex","1 1 150px"],["appearance","text","icon","download",3,"click"],["preferenceKey","events","appearance","text","icon","view_columns",3,"columns"],["mat-table","",1,"ya-data-table","expand",3,"dataSource"],["cdkColumnDef","severity"],["mat-header-cell","",4,"cdkHeaderCellDef"],["mat-cell","",4,"cdkCellDef"],["cdkColumnDef","message"],["mat-header-cell","","class","expand",4,"cdkHeaderCellDef"],["mat-cell","","class","mono message expand",4,"cdkCellDef"],["cdkColumnDef","type"],["cdkColumnDef","source"],["cdkColumnDef","gentime"],["mat-cell","","style","white-space: nowrap",4,"cdkCellDef"],["cdkColumnDef","rectime"],["cdkColumnDef","seqNumber"],[3,"cdkColumnDef"],["mat-header-row","",4,"cdkHeaderRowDef"],["mat-row","",3,"ngClass",4,"cdkRowDef","cdkRowDefColumns"],["appearance","bottom","align","center"],[3,"click","disabled"],["formControlName","customStart"],["formControlName","customStop"],["fontSize","16"],["href","",1,"ya-link",3,"click"],["mat-header-cell",""],["mat-cell",""],[3,"severity"],["mat-header-cell","",1,"expand"],["mat-cell","",1,"mono","message","expand"],[3,"message","highlight"],[3,"text","term"],["mat-cell","",2,"white-space","nowrap"],["mat-header-row",""],["mat-row","",3,"ngClass"]],template:function(t,n){t&1&&(a(0,"ya-instance-page")(1,"ya-instance-toolbar",2),g(2,Ki,2,0,"ya-page-button",3),g(3,Xi,2,0,"ya-page-button",4),T(4,"async"),dt(5,Zi,2,0,"ya-page-button",5),a(6,"ya-page-button",6),v("clicked",function(){return n.jumpToNow()}),s(7,"Jump to now"),r()(),g(8,Pn,66,26,"ya-panel"),r()),t&2&&(l(2),C(n.mayWriteEvents()?2:-1),l(),C(w(4,3,n.dataSource.streaming$)?3:5),l(5),C(n.dataSource?8:-1))},dependencies:[He,Ce,Ue,M,Te,L,A,k,V,Lt,Pt,Ft,Nt,Rt,Re,Le,Ae,ke,Ve,Pe,Y,Wt,me,Bt,Ut,qe,$e,je,ee,te,Jt,Ge,Zt,q,ei,ti,ii,le,zt],styles:[".ya-filter-bar.query[_ngcontent-%COMP%]{height:unset}.ya-data-table[_ngcontent-%COMP%]   td.mat-mdc-cell.message[_ngcontent-%COMP%]{white-space:pre-wrap}.WATCH[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .WARNING[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{color:var(--y-warning-color)!important}.ERROR[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .DISTRESS[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .CRITICAL[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .SEVERE[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{color:var(--y-error-color)!important}"],changeDetection:0});var Xe=Se;var vi="INFO",gi=[],Ee=class Ee{constructor(e,t,n,o){this.dialogRef=e;this.yamcs=t;this.messageService=n;this.data=o;this.form=new ce({name:new h("",I.required),filter:new h(""),severity:new h(vi,I.required),source:new h(gi),shared:new h(!1,I.required)});let{query:u}=o;this.form.patchValue({name:u.name,filter:u.query.filter||void 0,severity:u.query.severity,source:u.query.source,shared:u.shared})}save(){let{value:e}=this.form,t=this.data.query.id;this.yamcs.yamcsClient.editQuery(this.yamcs.instance,"events",t,{name:e.name,shared:e.shared??!1,query:{filter:e.filter??void 0,source:e.source??gi,severity:e.severity??vi}}).then(n=>this.dialogRef.close(n)).catch(n=>this.messageService.showError(n))}};Ee.\u0275fac=function(t){return new(t||Ee)(d(B),d(x),d(X),d(H))},Ee.\u0275cmp=_({type:Ee,selectors:[["app-edit-event-query-dialog"]],decls:25,vars:3,consts:[["mat-dialog-title",""],[1,"ya-form",3,"formGroup"],["label","Name"],["formControlName","name","type","text"],["label","Query"],["formControlName","filter"],["label","Severity"],["formControlName","severity"],["id","INFO","label","Info level"],["id","WATCH","label","Watch level"],["id","WARNING","label","Warning level"],["id","DISTRESS","label","Distress level"],["id","CRITICAL","label","Critical level"],["id","SEVERE","label","Severe level"],["label","Source"],["formControlName","source","emptyOption","Any source",3,"options"],["label","Share with other users"],["formControlName","shared"],["align","end"],["mat-dialog-close",""],["appearance","primary",3,"click","disabled"]],template:function(t,n){t&1&&(a(0,"h2",0),s(1,"Edit query"),r(),a(2,"mat-dialog-content")(3,"form",1)(4,"ya-field",2),m(5,"input",3),r(),a(6,"ya-field",4),m(7,"ya-filter-textarea",5),r(),a(8,"ya-field",6)(9,"ya-select",7),m(10,"ya-option",8)(11,"ya-option",9)(12,"ya-option",10)(13,"ya-option",11)(14,"ya-option",12)(15,"ya-option",13),r()(),a(16,"ya-field",14),m(17,"ya-multi-select",15),r(),a(18,"ya-field",16),m(19,"mat-slide-toggle",17),r()()(),a(20,"mat-dialog-actions",18)(21,"ya-button",19),s(22,"CANCEL"),r(),a(23,"ya-button",20),v("click",function(){return n.save()}),s(24,"SAVE"),r()()),t&2&&(l(3),c("formGroup",n.form),l(14),c("options",n.data.sourceOptions),l(6),c("disabled",!n.form.valid))},dependencies:[M,Q,se,L,A,k,V,U,z,K,J,Ne,Y,Z,pe,ee,te,q],encapsulation:2,changeDetection:0});var Ze=Ee;var Fn=(i,e,t,n)=>({filter:i,severity:e,source:t,c:n});function Nn(i,e){i&1&&(a(0,"th",11),s(1,"Name"),r())}function Rn(i,e){if(i&1&&(a(0,"td",12)(1,"a",13),s(2),r()()),i&2){let t=e.$implicit,n=p();l(),c("queryParams",_t(2,Fn,t.query.filter,t.query.severity,t.query.source,n.yamcs.context)),l(),$(" ",t.name," ")}}function Ln(i,e){i&1&&(a(0,"th",14),s(1,"Visibility"),r())}function An(i,e){if(i&1&&(a(0,"td",12),s(1),r()),i&2){let t=e.$implicit;l(),$(" ",t.shared?"Shared":"Private"," ")}}function kn(i,e){i&1&&m(0,"th",15)}function Vn(i,e){if(i&1){let t=F();a(0,"td",12)(1,"ya-more")(2,"button",16),v("click",function(){let o=S(t).$implicit,u=p();return E(u.openEditQueryDialog(o))}),s(3,"Edit query"),r(),a(4,"button",16),v("click",function(){let o=S(t).$implicit,u=p();return E(u.openDeleteQueryDialog(o))}),s(5,"Delete query"),r()()()}}function Yn(i,e){i&1&&m(0,"tr",17)}function qn(i,e){i&1&&m(0,"tr",18)}var be=class be{constructor(e,t,n){this.yamcs=e;this.messageService=t;this.dialog=n;this.displayedColumns=["name","visibility","actions"];this.dataSource=new $t;this.sourceOptions=[];this.refreshTable(),e.yamcsClient.getEventSources(e.instance).then(o=>{this.sourceOptions=o.map(u=>({id:u,label:u}))})}refreshTable(){this.yamcs.yamcsClient.getQueries(this.yamcs.instance,"events").then(e=>this.dataSource.data=e).catch(e=>this.messageService.showError(e))}openEditQueryDialog(e){this.dialog.open(Ze,{width:"800px",data:{query:e,sourceOptions:this.sourceOptions}}).afterClosed().subscribe(t=>{t&&(this.refreshTable(),this.messageService.showInfo("Query updated"))})}openDeleteQueryDialog(e){confirm(`Are you sure you want to delete query ${e.name}`)&&this.yamcs.yamcsClient.deleteQuery(this.yamcs.instance,"events",e.id).then(()=>this.refreshTable()).catch(t=>this.messageService.showError(t))}};be.\u0275fac=function(t){return new(t||be)(d(x),d(X),d(Fe))},be.\u0275cmp=_({type:be,selectors:[["app-event-query-list"]],decls:16,vars:3,consts:[["label","Events"],["mat-table","",1,"ya-data-table","expand",2,"margin-top","16px",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","","style","min-width: 200px",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","visibility"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",2,"min-width","200px"],["mat-cell",""],["routerLink","/events",3,"queryParams"],["mat-header-cell",""],["mat-header-cell","",1,"expand"],["mat-menu-item","",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(t,n){t&1&&(a(0,"ya-instance-page"),m(1,"ya-instance-toolbar",0),a(2,"ya-panel"),m(3,"app-events-page-tabs"),a(4,"table",1),O(5,2),f(6,Nn,2,0,"th",3)(7,Rn,3,7,"td",4),D(),O(8,5),f(9,Ln,2,0,"th",6)(10,An,2,1,"td",4),D(),O(11,7),f(12,kn,1,0,"th",8)(13,Vn,6,0,"td",4),D(),f(14,Yn,1,0,"tr",9)(15,qn,1,0,"tr",10),r()()()),t&2&&(l(4),c("dataSource",n.dataSource),l(10),c("matHeaderRowDef",n.displayedColumns),l(),c("matRowDefColumns",n.displayedColumns))},dependencies:[Ce,M,Ie,It,Re,kt,Yt,Vt,At,qt,Le,Ae,ke,Ve,$e,je,Kt,Ge],encapsulation:2});var et=be;var Ci=(i,e)=>{let n=De(x).yamcsClient.createParseFilterSubscription({resource:"events",filter:""},()=>null);return new Promise((o,u)=>{n.addReplyListener(()=>{o(n)})})};var Qa=[{path:"",canActivate:[ai,oi],canActivateChild:[ri],runGuardsAndResolvers:"always",component:li,children:[{path:"",pathMatch:"full",component:Xe,canActivate:[lt],resolve:{parseFilterSubscription:Ci}},{path:"queries",component:et,canActivate:[lt]}]}];export{Qa as ROUTES};
