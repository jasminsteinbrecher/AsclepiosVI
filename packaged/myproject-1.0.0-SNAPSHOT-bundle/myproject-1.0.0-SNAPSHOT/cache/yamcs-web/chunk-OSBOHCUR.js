import{a as Rt}from"./chunk-6SSGZHTV.js";import{a as Ie,b as bt,e as wt,f as Ct,g as St,i as Tt,j as Dt,l as Ae}from"./chunk-GVFSCYYF.js";import{a as ft,b as _t}from"./chunk-L67MW52F.js";import{Aa as ce,Af as st,Bc as tt,Bf as P,Ca as m,Cb as Ye,Cc as x,Ea as X,F as g,Fc as E,Fh as I,G as f,Gb as qe,Gh as yt,Hh as vt,Ia as he,Ib as He,If as p,Ja as ge,Ka as fe,Kf as j,P as Ve,Pc as ee,Qf as lt,Ra as c,Rc as it,Rf as z,Ta as Pe,Tc as ot,Ua as je,V as y,Vf as ct,Y as u,_ as R,_a as ze,a as Ee,bb as T,bg as L,cb as k,db as Le,dc as We,ec as Je,f as Q,gg as mt,jg as pt,ka as se,kc as Qe,kg as dt,lc as Ke,lf as rt,ma as le,mf as at,mg as ut,n as Ge,na as Ne,nc as Xe,ne as G,oa as Fe,oc as Ze,oe as V,og as ht,pa as Oe,pe as nt,pg as gt,qa as b,qb as Ue,qc as B,qe as N,ra as a,re as F,sa as s,sb as ye,sc as M,se as O,ta as S,tc as A,te as $,vc as et,wa as $e,xc as ve,yc as Z}from"./chunk-OXOWQRWE.js";var te=class te{constructor(t,e,i,o){this.dialogRef=t;this.yamcs=i;this.data=o;let n=i.getMissionTime(),r;this.data&&(this.data.start&&(n=this.data.start),this.data.stop&&(r=this.data.stop)),this.form=e.group({name:[p.generateRandomName(),B.required],start:[p.toISOString(n),[B.required]],stop:[r?p.toISOString(r):""]})}start(){let t={start:p.toISOString(this.form.value.start),endAction:"STOP"};this.form.value.stop&&(t.stop=p.toISOString(this.form.value.stop)),this.dialogRef.close({instance:this.yamcs.instance,name:this.form.value.name,type:"Archive",persistent:!0,config:JSON.stringify(t)})}};te.\u0275fac=function(e){return new(e||te)(u(G),u(ee),u(j),u(V))},te.\u0275cmp=R({type:te,selectors:[["app-start-replay-dialog"]],decls:17,vars:2,consts:[["mat-dialog-title",""],[1,"ya-form",3,"formGroup"],["label","Start time"],["formControlName","start"],["label","Stop time","hint","(optional)"],["formControlName","stop"],["label","Processor name"],["type","text","formControlName","name"],[1,"hint"],["align","end"],["mat-dialog-close",""],["appearance","primary",3,"click","disabled"]],template:function(e,i){e&1&&(a(0,"h2",0),c(1,"Start replay processor"),s(),a(2,"mat-dialog-content")(3,"form",1)(4,"ya-field",2),S(5,"ya-date-time-input",3),s(),a(6,"ya-field",4),S(7,"ya-date-time-input",5),s(),a(8,"ya-field",6),S(9,"input",7),a(10,"span",8),c(11,"Must be unique. Other users can join your replay via this name"),s()()()(),a(12,"mat-dialog-actions",9)(13,"ya-button",10),c(14,"CANCEL"),s(),a(15,"ya-button",11),m("click",function(){return i.start()}),c(16,"START"),s()()),e&2&&(y(3),b("formGroup",i.form),y(12),b("disabled",!i.form.valid))},dependencies:[I,Z,Ze,M,A,x,E,N,F,$,O,P,z,L],encapsulation:2});var _e=te;var ie=class ie{constructor(t,e,i,o){this.dialogRef=t;this.yamcs=e;this.downloadURL$=new Q(null);this.form=i.group({start:[null,B.required],stop:[null,B.required]}),this.form.valueChanges.subscribe(w=>{if(this.form.valid){let _=e.yamcsClient.getPacketsDownloadURL(e.instance,{start:p.toISOString(w.start),stop:p.toISOString(w.stop),format:"raw"});this.downloadURL$.next(_)}else this.downloadURL$.next(null)});let n=o.start,r=o.stop;(!n||!r)&&(r=this.yamcs.getMissionTime(),n=p.subtractDuration(r,"PT1H")),this.form.setValue({start:p.toISOString(n),stop:p.toISOString(r)})}closeDialog(){this.dialogRef.close()}};ie.\u0275fac=function(e){return new(e||ie)(u(G),u(j),u(ee),u(V))},ie.\u0275cmp=R({type:ie,selectors:[["app-download-dump-dialog"]],decls:14,vars:5,consts:[["mat-dialog-title",""],[1,"ya-form",3,"formGroup"],["label","Start"],["formControlName","start"],["label","Stop"],["formControlName","stop"],["align","end"],["mat-dialog-close",""],["appearance","primary",3,"click","link","disabled"]],template:function(e,i){e&1&&(a(0,"h2",0),c(1,"Download Packet Dump"),s(),a(2,"mat-dialog-content")(3,"form",1)(4,"ya-field",2),S(5,"ya-date-time-input",3),s(),a(6,"ya-field",4),S(7,"ya-date-time-input",5),s()()(),a(8,"mat-dialog-actions",6)(9,"ya-button",7),c(10,"CANCEL"),s(),a(11,"ya-download-button",8),T(12,"async"),m("click",function(){return i.closeDialog()}),c(13," DOWNLOAD "),s()()),e&2&&(y(3),b("formGroup",i.form),y(8),b("link",k(12,3,i.downloadURL$))("disabled",!i.form.valid))},dependencies:[I,Z,M,A,x,E,N,F,$,O,P,z,ct,L,ye],encapsulation:2});var Se=ie;var oe=class oe{constructor(t,e){this.dialogRef=t;this.data=e;this.date=new ve(null,[B.required]);this.data.date&&this.date.setValue(p.toISOString(this.data.date))}select(){let t=p.toDate(this.date.value);this.dialogRef.close({date:t})}};oe.\u0275fac=function(e){return new(e||oe)(u(G),u(V))},oe.\u0275cmp=R({type:oe,selectors:[["app-jump-to-dialog"]],decls:10,vars:2,consts:[["mat-dialog-title",""],[1,"ya-form"],["label","Date"],[3,"formControl","showNow"],["align","end"],["mat-dialog-close",""],["appearance","primary",3,"click"]],template:function(e,i){e&1&&(a(0,"h2",0),c(1,"Jump to date"),s(),a(2,"mat-dialog-content",1)(3,"ya-field",2),S(4,"ya-date-time-input",3),s()(),a(5,"mat-dialog-actions",4)(6,"ya-button",5),c(7,"CANCEL"),s(),a(8,"ya-button",6),m("click",function(){return i.select()}),c(9,"OK"),s()()),e&2&&(y(4),b("formControl",i.date)("showNow",!0))},dependencies:[I,M,tt,N,F,$,O,P,z,L],encapsulation:2});var Te=oe;var U=2,Y=class extends St{constructor(t,e,i,o,n){super(t),this.label=e,this.borderWidth=0,this.multiline=!1,this.itemBorderColor="rgba(0, 0, 0, 0.1)",this.itemBorderWidth=1,this.itemCornerRadius=0,this.itemTextOverflow="hide",this.itemTextSize=10,this.itemHeight=14,this.paddingBottom=U,this.paddingTop=U,this.backgroundRGB=i,this.itemBackground=this.backgroundRGB.toCssString(),this.foregroundRGB=o,this.itemTextColor=this.foregroundRGB.toCssString(),this.formatter=n,this.background="white",this.addHeaderMouseEnterListener(r=>{this.background=t.sidebar.hoverOverlayColor}),this.addHeaderMouseLeaveListener(r=>{this.background="white"}),this.addItemClickListener(r=>{let{start:w,stop:_}=r.item;w&&_?this.timeline.setSelection(w,_):this.timeline.clearSelection()})}setupTooltip(t){this.addItemMouseMoveListener(e=>{let{start:i,stop:o,data:n}=e.item,r=n.name+`
`;if(r+=`Start: ${this.formatter.formatDateTime(i,!0)}
`,r+=`Stop : ${this.formatter.formatDateTime(o,!0)}
`,n.count>=0){let w=(o-i)/1e3;r+=`Count: ${n.count}`;let _=n.count/w;_>=1e3?r+=` (${(_/1e3).toFixed(3)} kHz)`:_>1&&(r+=` (${_.toFixed(3)} Hz)`)}else n.description&&(r+=n.description);t.show(r,e.clientX,e.clientY)}),this.addItemMouseLeaveListener(e=>{t.hide()})}loadData(t){let e=[];for(let i of t.records){let o=p.toDate(i.first).getTime(),n=p.toDate(i.last).getTime(),r={start:o,stop:n,data:{name:t.name,count:i.num}};if(i.num>1){let w=(n-o)/1e3,_=i.num/w;_>=1e3?r.label=`${(_/1e3).toFixed(1)} kHz`:_>=.1?r.label=`${_.toFixed(1)} Hz`:r.label="< 0.1 Hz",_>=1?r.background=this.backgroundRGB.toCssString(1):_>=.3?r.background=this.backgroundRGB.toCssString(_):r.background=this.backgroundRGB.toCssString(.3)}e.push(r)}this.items=e}};var D=class{constructor(t,e,i){this.r=t;this.g=e;this.b=i}toCssString(t){if(t===void 0)return`rgb(${this.r},${this.g},${this.b})`;{let e=255-t*(255-this.r),i=255-t*(255-this.g),o=255-t*(255-this.b);return`rgb(${e},${i},${o})`}}};var De=class extends bt{constructor(t){super(t);let e=document.createElement("canvas");e.width=30,e.height=30;let i=e.getContext("2d");i.fillStyle="rgba(148, 0, 211, 0.07)",i.fillRect(0,0,30,30),i.beginPath(),i.moveTo(30,0),i.lineTo(0,30),i.strokeStyle="rgba(221, 221, 221, 0.2)",i.stroke(),this.pattern=i.createPattern(e,"repeat")}drawOverlay(t){if(!this.replayRequest)return;let{start:e,stop:i,endAction:o}=this.replayRequest;if(e&&i){let n=Math.round(this.timeline.positionTime(new Date(e).getTime())),r=Math.round(this.timeline.positionTime(new Date(i).getTime()));if(t.fillRect({x:n+.5,y:0,width:r-n,height:t.ctx.canvas.height,fill:this.pattern}),t.strokePath({color:"rgba(148, 0, 211, 0.3)",lineWidth:1,path:new Ie(n+.5,0).lineTo(n+.5,t.ctx.canvas.height)}),t.strokePath({color:"rgba(148, 0, 211, 0.3)",lineWidth:1,path:new Ie(r+.5,0).lineTo(r+.5,t.ctx.canvas.height)}),o==="LOOP"){let{fontFamily:w,textSize:_}=this.timeline;t.fillText({x:r-3,y:0,align:"right",baseline:"top",text:"\u221E",color:"darkviolet",font:`${_}px ${w}`})}}}get replayRequest(){return this._replayRequest}set replayRequest(t){this._replayRequest=t,this.reportMutation()}};var q=class extends Ct{constructor(t,e){super(t),this.label=e,this.background="#f5f5f5",this.contentHeight=20}};var ne=class ne{constructor(t,e,i,o){this.dialogRef=t;this.yamcs=i;this.data=o;let n=i.getMissionTime(),r;this.data&&(this.data.start&&(n=this.data.start),this.data.stop&&(r=this.data.stop)),this.form=e.group({start:[p.toISOString(n),[B.required]],stop:[r?p.toISOString(r):""]})}submit(){let t={start:p.toISOString(this.form.value.start)};this.form.value.stop&&(t.stop=p.toISOString(this.form.value.stop)),this.dialogRef.close(t)}};ne.\u0275fac=function(e){return new(e||ne)(u(G),u(ee),u(j),u(V))},ne.\u0275cmp=R({type:ne,selectors:[["app-modify-replay-dialog"]],decls:13,vars:2,consts:[["mat-dialog-title",""],[1,"ya-form",3,"formGroup"],["label","Start time"],["formControlName","start"],["label","Stop time","hint","(optional)"],["formControlName","stop"],["align","end"],["mat-dialog-close",""],["appearance","primary",3,"click","disabled"]],template:function(e,i){e&1&&(a(0,"h2",0),c(1,"Configure replay"),s(),a(2,"mat-dialog-content")(3,"form",1)(4,"ya-field",2),S(5,"ya-date-time-input",3),s(),a(6,"ya-field",4),S(7,"ya-date-time-input",5),s()()(),a(8,"mat-dialog-actions",6)(9,"ya-button",7),c(10,"CANCEL"),s(),a(11,"ya-button",8),m("click",function(){return i.submit()}),c(12,"SUBMIT"),s()()),e&2&&(y(3),b("formGroup",i.form),y(8),b("disabled",!i.form.valid))},dependencies:[I,Z,M,A,x,E,N,F,$,O,P,z,L],encapsulation:2});var Re=ne;var Ot=["tt"],re=class re{show(t,e,i){let o=this.tt.nativeElement;o.style.left=e+"px",o.style.top=i+"px",o.style.display="block",o.innerText=t}hide(){let t=this.tt.nativeElement;t.style.display="none"}};re.\u0275fac=function(e){return new(e||re)},re.\u0275cmp=R({type:re,selectors:[["ng-component"]],viewQuery:function(e,i){if(e&1&&he(Ot,7),e&2){let o;ge(o=fe())&&(i.tt=o.first)}},decls:2,vars:0,consts:[["tt",""],[1,"ya-tooltip"]],template:function(e,i){e&1&&$e(0,"div",1,0)},styles:[".ya-tooltip[_ngcontent-%COMP%]{position:absolute;display:none;white-space:pre;color:#fff;border-radius:2px;max-width:250px;padding:6px 8px;margin-top:14px;background:#616161e6;font-family:Roboto Mono,monospace;font-size:10px}"]});var ke=re;var $t=["container"],jt=(v,t)=>({background:v,color:t,backgroundClip:"padding-box"});function zt(v,t){if(v&1){let e=ce();a(0,"ya-page-button",28),m("clicked",function(){let o=g(e),n=X(),r=X();return f(r.enableLoop(n,o.endAction!=="LOOP"))}),c(1),s()}if(v&2){let e=t;b("disabled",!e.start||!e.stop)("icon",e.endAction==="LOOP"?"repeat_on":"repeat"),y(),Pe(" Repeat: ",e.endAction==="LOOP"?"on":"off"," ")}}function Lt(v,t){if(v&1&&se(0,zt,2,3,"ya-page-button",27),v&2){let e;le((e=t.replayRequest)?0:-1,e)}}function Ut(v,t){if(v&1){let e=ce();a(0,"ya-button",29),T(1,"async"),m("click",function(){g(e);let o=X();return f(o.fitSelection())}),c(2," Fit selection "),s()}if(v&2){let e=X();b("disabled",!k(1,1,e.rangeSelection$))}}function Yt(v,t){if(v&1){let e=ce();a(0,"label",20)(1,"input",30),m("change",function(){g(e);let o=X();return f(o.updateLegend())}),s(),c(2),s()}if(v&2){let e=t.$implicit;b("ngStyle",ze(3,jt,e.bg,e.fg)),y(),b("formControlName",e.id),y(),Pe(" ",e.name," ")}}function qt(v,t){if(v&1&&(a(0,"span"),c(1),T(2,"datetime"),T(3,"datetime"),s()),v&2){let e=t;y(),je(" ",Le(2,2,e==null?null:e.start,!1)," \u2013 ",k(3,5,e==null?null:e.stop)," ")}}var kt=new D(141,182,194),Bt=new D(70,70,70),Mt=new D(255,165,0),Pt=new D(173,94,0),It=new D(255,255,102),At=new D(28,75,139),xt=new D(238,232,170),Et=new D(85,85,85),Gt=new D(255,222,173),Vt=new D(28,75,139);function de(v){return"linear-gradient(to right, "+v.toCssString(.3)+" 30%, "+v.toCssString()+")"}var ae=class ae{constructor(t,e,i,o,n,r,w,_,Me,C){this.yamcs=e;this.route=i;this.router=o;this.overlay=n;this.dialog=r;this.snackBar=w;this.messageService=_;this.synchronizer=Me;this.formatter=C;this.legendOptions=[{id:"packets",name:"Packets",bg:de(kt),fg:Bt.toCssString(),checked:!0},{id:"parameters",name:"Parameter groups",bg:de(Gt),fg:Vt.toCssString(),checked:!0},{id:"commands",name:"Commands",bg:de(xt),fg:Et.toCssString(),checked:!1},{id:"events",name:"Events",bg:de(It),fg:At.toCssString(),checked:!1}];this.processor$=new Q(null);this.rangeSelection$=new Q(null);this.viewportRange$=new Q(null);this.tool$=new Q("hand");this.packetNames=[];this.subscriptions=[];t.setTitle("Archive browser"),(e.connectionInfo$.value?.instance?.capabilities||[]).indexOf("ccsds-completeness")!==-1&&(this.legendOptions=[{id:"completeness",name:"Completeness",bg:de(Mt),fg:Pt.toCssString(),checked:!0},...this.legendOptions]),this.processor$.next(e.getProcessor()),e.processor&&(this.processorSubscription=this.yamcs.yamcsClient.createProcessorSubscription({instance:e.instance,processor:e.processor},d=>{this.processor$.next(d)})),this.filterForm=new et({});let ue=this.route.snapshot.queryParamMap;for(let d of this.legendOptions){let h=d.checked;ue.has(d.id)&&(h=ue.get(d.id)==="true"),this.filterForm.addControl(d.id,new ve(h))}let H=new Ve(document.body),W=this.overlay.position().flexibleConnectedTo(H).withPositions([{originX:"start",originY:"top",overlayX:"start",overlayY:"top"}]).withPush(!1),J=this.overlay.create({positionStrategy:W}),l=new Je(ke);this.tooltipInstance=J.attach(l).instance}hideTooltip(){this.tooltipInstance.hide()}ngAfterViewInit(){this.yamcs.yamcsClient.getPacketNames(this.yamcs.instance).then(t=>{this.packetNames=t.packets||[],this.initializeTimeline()})}initializeTimeline(){this.timeline=new wt(this.container.nativeElement),this.timeline.addViewportChangeListener(n=>{this.viewportRange$.next({start:new Date(n.start),stop:new Date(n.stop)})}),this.viewportRange$.pipe(Ge(400)).forEach(n=>{this.refreshData();let r={};for(let w of this.legendOptions)r[w.id]=this.filterForm.value[w.id];this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParamsHandling:"merge",queryParams:Ee({start:new Date(n.start).toISOString(),stop:new Date(n.stop).toISOString()},r)})}),this.timeline.addViewportDoubleClickListener(n=>{this.yamcs.getProcessor()?.replay&&this.yamcs.yamcsClient.editReplayProcessor(this.yamcs.instance,this.yamcs.processor,{seek:new Date(n.time).toISOString()}).catch(w=>this.messageService.showError(w))});let t=this.route.snapshot.queryParamMap;if(t.get("start")&&t.get("stop")){let n=p.toDate(t.get("start")),r=p.toDate(t.get("stop"));this.timeline.setViewRange(n.getTime(),r.getTime())}else{let n=this.yamcs.getMissionTime();n.setUTCHours(0,0,0,0);let r=new Date(n.getTime());r.setUTCDate(n.getUTCDate()+1),this.timeline.setViewRange(n.getTime(),r.getTime())}let e=new Tt(this.timeline);e.time=this.yamcs.getMissionTime().getTime();let i=new De(this.timeline);this.subscriptions.push(this.synchronizer.sync(()=>{e.time=this.yamcs.getMissionTime().getTime();let n=this.processor$.value?.replayRequest;i.replayRequest=n})),new Dt(this.timeline),new Rt(this.timeline,this.formatter);let o=new Ae(this.timeline);o.contentHeight=20,o.label="UTC",o.timezone="UTC",o.frozen=!0,o.fullHeight="underlay",this.timeline.addViewportSelectionListener(n=>{n.selection?this.rangeSelection$.next({start:new Date(n.selection.start),stop:new Date(n.selection.stop)}):this.rangeSelection$.next(null)})}fitAll(){let t=[];t.push(this.yamcs.yamcsClient.getPackets(this.yamcs.instance,{limit:1,order:"asc"})),t.push(this.yamcs.yamcsClient.getPackets(this.yamcs.instance,{limit:1,order:"desc"})),Promise.all(t).then(e=>{let i=e[0],o=e[1];if(i.packets?.length&&o.packets?.length){let n=p.toDate(i.packets[0].generationTime),r=p.toDate(o.packets[0].generationTime);this.timeline.setViewRange(n.getTime(),r.getTime())}}).catch(e=>this.messageService.showError(e))}fitSelection(){var t=this.rangeSelection$.value;t&&(this.timeline.setViewRange(t.start.getTime(),t.stop.getTime()),this.timeline.clearSelection())}jumpToToday(){let t=this.yamcs.getMissionTime();t.setUTCHours(0,0,0,0);let e=t.getTime();t.setUTCDate(t.getUTCDate()+1);let i=t.getTime();this.timeline.setViewRange(e,i)}jumpToNow(){let t=this.yamcs.getMissionTime();this.timeline.panTo(t.getTime())}openJumpToDialog(){let t=this.timeline.center;this.dialog.open(Te,{width:"400px",data:{date:new Date(t)}}).afterClosed().subscribe(i=>{i&&this.timeline.panTo(i.date.getTime())})}toggleMove(t){this.timeline.panBy(t),window.clearInterval(this.moveInterval),this.moveInterval=window.setInterval(()=>this.timeline.panBy(t),50)}untoggleMove(){window.clearInterval(this.moveInterval),this.moveInterval=void 0}pageLeft(){let{start:t,stop:e}=this.timeline,i=this.timeline.distanceBetween(t,e);this.timeline.panBy(-i)}pageRight(){let{start:t,stop:e}=this.timeline,i=this.timeline.distanceBetween(t,e);this.timeline.panBy(i)}zoomIn(){this.timeline.zoomIn()}zoomOut(){this.timeline.zoomOut()}setTool(t){this.tool$.next(t),this.timeline.tool=t}replayRange(){let t=this.rangeSelection$.value;if(t){let e=this.processor$.value;e?.replay?this.modifyReplay(e,t):this.startReplay(t)}}startReplay(t){this.dialog.open(_e,{width:"400px",data:{start:t.start,stop:t.stop}}).afterClosed().subscribe(e=>{e&&(this.snackBar.open("Initializing replay...",void 0,{horizontalPosition:"end"}),this.yamcs.yamcsClient.createProcessor(e).then(()=>{this.yamcs.switchContext(this.yamcs.instance,e.name),this.snackBar.open("Joining replay",void 0,{duration:3e3,horizontalPosition:"end"})}).catch(i=>{this.snackBar.open("Failed to initialize replay",void 0,{duration:3e3,horizontalPosition:"end"})}))})}modifyReplay(t,e){this.dialog.open(Re,{width:"400px",data:{start:e.start,stop:e.stop}}).afterClosed().subscribe(i=>{i&&(this.snackBar.open("Updating replay...",void 0,{horizontalPosition:"end"}),this.yamcs.yamcsClient.editReplayProcessor(t.instance,t.name,i).catch(o=>{this.messageService.showError(o)}).finally(()=>this.snackBar.dismiss()))})}enableLoop(t,e){this.yamcs.yamcsClient.editReplayProcessor(t.instance,t.name,{loop:e}).catch(i=>this.messageService.showError(i))}downloadDump(){let t=this.rangeSelection$.value;t&&this.dialog.open(Se,{width:"400px",data:{start:t.start,stop:t.stop}})}updateLegend(){this.refreshData()}refreshData(){let t=this.timeline.stop-this.timeline.start,e=p.clampDate(this.timeline.start-t).toISOString(),i=p.clampDate(this.timeline.stop+t).toISOString(),o=Math.min(Math.floor(t/1e3),2147483647),n=Promise.resolve([]);this.filterForm.value.completeness&&(n=this.yamcs.yamcsClient.streamCompletenessIndex(this.yamcs.instance,{start:e,stop:i,mergeTime:o}).then(C=>this.groupRecordsByName(C)));let r=Promise.resolve([]);this.filterForm.value.packets&&(r=this.yamcs.yamcsClient.streamPacketIndex(this.yamcs.instance,{start:e,stop:i,mergeTime:o}).then(C=>this.groupRecordsByName(C)));let w=Promise.resolve([]);this.filterForm.value.parameters&&(w=this.yamcs.yamcsClient.streamParameterIndex(this.yamcs.instance,{start:e,stop:i,mergeTime:o}).then(C=>this.groupRecordsByName(C)));let _=Promise.resolve([]);this.filterForm.value.commands&&(_=this.yamcs.yamcsClient.streamCommandIndex(this.yamcs.instance,{start:e,stop:i,mergeTime:o}).then(C=>this.groupRecordsByName(C)));let Me=Promise.resolve([]);this.filterForm.value.events&&(Me=this.yamcs.yamcsClient.streamEventIndex(this.yamcs.instance,{start:e,stop:i,mergeTime:o}).then(C=>this.groupRecordsByName(C))),Promise.all([n,r,w,_,Me]).then(C=>{let K=C[0],ue=C[1],H=C[2],W=C[3],J=C[4];for(let l of this.timeline.getBands())l instanceof Ae||this.timeline.removeChild(l);K.sort((l,d)=>l.name.localeCompare(d.name));for(let l=0;l<K.length;l++){l===0&&new q(this.timeline,"Completeness");let d=K[l],h=new Y(this.timeline,d.name,Mt,Pt,this.formatter);h.borderWidth=l===K.length-1?1:0,h.paddingBottom=l===K.length-1?20:U,h.setupTooltip(this.tooltipInstance),h.loadData(d)}if(this.filterForm.value.packets)for(let l=0;l<this.packetNames.length;l++){l===0&&new q(this.timeline,"Packets");let d=this.packetNames[l],h=new Y(this.timeline,d,kt,Bt,this.formatter);h.borderWidth=l===this.packetNames.length-1?1:0,h.paddingBottom=l===this.packetNames.length-1?20:U,h.setupTooltip(this.tooltipInstance);let xe=ue.find(Nt=>Nt.name===d);xe&&h.loadData(xe)}H.sort((l,d)=>l.name.localeCompare(d.name));for(let l=0;l<H.length;l++){l===0&&new q(this.timeline,"Parameter Groups");let d=H[l],h=new Y(this.timeline,d.name,Gt,Vt,this.formatter);h.borderWidth=l===H.length-1?1:0,h.paddingBottom=l===H.length-1?20:U,h.setupTooltip(this.tooltipInstance),h.loadData(d)}W.sort((l,d)=>l.name.localeCompare(d.name));for(let l=0;l<W.length;l++){l===0&&new q(this.timeline,"Commands");let d=W[l],h=new Y(this.timeline,d.name,xt,Et,this.formatter);h.borderWidth=l===W.length-1?1:0,h.paddingBottom=l===W.length-1?30:U,h.setupTooltip(this.tooltipInstance),h.loadData(d)}J.sort((l,d)=>l.name.localeCompare(d.name));for(let l=0;l<J.length;l++){l===0&&new q(this.timeline,"Events");let d=J[l],h=new Y(this.timeline,d.name,It,At,this.formatter);h.borderWidth=l===J.length-1?1:0,h.paddingBottom=l===J.length-1?20:U,h.setupTooltip(this.tooltipInstance),h.loadData(d)}})}groupRecordsByName(t){let e=new Map;for(let i of t){let o=e.get(i.id.name);o||(o={name:i.id.name,records:[]},e.set(i.id.name,o)),o.records.push(i)}return[...e.values()]}ngOnDestroy(){this.processorSubscription?.cancel(),this.subscriptions.forEach(t=>t.unsubscribe()),this.timeline.disconnect()}};ae.\u0275fac=function(e){return new(e||ae)(u(Ye),u(j),u(qe),u(He),u(Qe),u(nt),u(Ke),u(rt),u(at),u(lt))},ae.\u0275cmp=R({type:ae,selectors:[["ng-component"]],viewQuery:function(e,i){if(e&1&&he($t,7),e&2){let o;ge(o=fe())&&(i.container=o.first)}},hostBindings:function(e,i){e&1&&m("mouseleave",function(){return i.hideTooltip()})},decls:58,vars:22,consts:[["container",""],["noscroll","true"],["label","Archive browser"],["icon","video_settings",3,"clicked","disabled"],["icon","file_download",3,"clicked","disabled"],["matTooltip","Refresh view","icon","refresh",3,"clicked"],[1,"controls",3,"formGroup"],["icon","west",3,"click"],["icon","chevron_left",3,"mousedown","mouseup","mouseleave"],["icon","chevron_right",3,"mousedown","mouseup","mouseleave"],["icon","east",3,"click"],["matTooltip","Show all archive data","icon","fit_screen",3,"click"],["matTooltip","Zoom to selected range","icon","fit_screen",3,"disabled"],["icon","today",3,"click"],["icon","my_location",3,"click"],["icon","directions",3,"click"],["icon","add",3,"click"],["icon","remove",3,"click"],["matTooltip","Use pan tool","icon","pan_tool",3,"click","toggled"],["matTooltip","Use range selection tool","icon","highlight_alt",3,"click","toggled"],[1,"legend",3,"ngStyle"],[1,"timeline-container"],[1,"zoom-actions"],[1,"zoom-actions-inner","elevation-z1"],["mat-button","",3,"click"],[1,"separator"],[1,"info"],[3,"disabled","icon"],[3,"clicked","disabled","icon"],["matTooltip","Zoom to selected range","icon","fit_screen",3,"click","disabled"],["type","checkbox",3,"change","formControlName"]],template:function(e,i){if(e&1){let o=ce();a(0,"ya-instance-page",1)(1,"ya-instance-toolbar",2)(2,"ya-page-button",3),T(3,"async"),m("clicked",function(){return g(o),f(i.replayRange())}),c(4," Replay range "),s(),se(5,Lt,1,1),T(6,"async"),a(7,"ya-page-button",4),T(8,"async"),m("clicked",function(){return g(o),f(i.downloadDump())}),c(9," Download dump "),s(),a(10,"ya-page-button",5),m("clicked",function(){return g(o),f(i.refreshData())}),c(11," Refresh "),s()(),a(12,"div",6)(13,"ya-button-group")(14,"ya-icon-button",7),m("click",function(){return g(o),f(i.pageLeft())}),s(),a(15,"ya-icon-button",8),m("mousedown",function(){return g(o),f(i.toggleMove(-50))})("mouseup",function(){return g(o),f(i.untoggleMove())})("mouseleave",function(){return g(o),f(i.untoggleMove())}),s(),a(16,"ya-icon-button",9),m("mousedown",function(){return g(o),f(i.toggleMove(50))})("mouseup",function(){return g(o),f(i.untoggleMove())})("mouseleave",function(){return g(o),f(i.untoggleMove())}),s(),a(17,"ya-icon-button",10),m("click",function(){return g(o),f(i.pageRight())}),s()(),a(18,"ya-button-group")(19,"ya-button",11),m("click",function(){return g(o),f(i.fitAll())}),c(20," Fit all "),s(),se(21,Ut,3,3,"ya-button",12),T(22,"async"),a(23,"ya-button",13),m("click",function(){return g(o),f(i.jumpToToday())}),c(24,"Today"),s(),a(25,"ya-icon-button",14),m("click",function(){return g(o),f(i.jumpToNow())}),s(),a(26,"ya-button",15),m("click",function(){return g(o),f(i.openJumpToDialog())}),c(27,"Jump to..."),s()(),a(28,"ya-button-group")(29,"ya-icon-button",16),m("click",function(){return g(o),f(i.zoomIn())}),s(),a(30,"ya-icon-button",17),m("click",function(){return g(o),f(i.zoomOut())}),s()(),a(31,"ya-button-group")(32,"ya-icon-button",18),T(33,"async"),m("click",function(){return g(o),f(i.setTool("hand"))}),s(),a(34,"ya-icon-button",19),T(35,"async"),m("click",function(){return g(o),f(i.setTool("range-select"))}),s()(),a(36,"ya-button-group"),Fe(37,Yt,3,6,"label",20,Ne),s()(),S(39,"div",21,0),a(41,"div",22)(42,"div",23)(43,"button",24),m("click",function(){return g(o),f(i.zoomIn())}),a(44,"mat-icon"),c(45,"add"),s()(),S(46,"span",25),a(47,"button",24),m("click",function(){return g(o),f(i.zoomOut())}),a(48,"mat-icon"),c(49,"remove"),s()()()(),a(50,"div",26),se(51,qt,4,7,"span"),T(52,"async"),a(53,"ya-help")(54,"p"),c(55," This view allows inspecting the content of the TM Archive, as well as retrieving data as packets. Data is grouped by packet name in bands. For each band, index blocks indicate the presence of data at a particular time range. Note that a single index block does not necessarily mean that there was no gap in the data. When zooming in, more gaps may appear. "),s(),a(56,"p"),c(57,"Pan around by grabbing the canvas."),s()()()()}if(e&2){let o,n;y(2),b("disabled",!k(3,8,i.rangeSelection$)),y(3),le((o=k(6,10,i.processor$))?5:-1,o),y(2),b("disabled",!k(8,12,i.rangeSelection$)),y(5),b("formGroup",i.filterForm),y(9),le(k(22,14,i.tool$)==="range-select"?21:-1),y(11),b("toggled",k(33,16,i.tool$)==="hand"),y(2),b("toggled",k(35,18,i.tool$)==="range-select"),y(3),Oe(i.legendOptions),y(14),le((n=k(52,20,i.viewportRange$))?51:-1,n)}},dependencies:[I,Ue,Xe,M,A,x,E,We,it,ot,P,st,mt,pt,dt,gt,ht,ye,ut],styles:[".tooltip[_ngcontent-%COMP%]{position:absolute}.timeline-container[_ngcontent-%COMP%]{line-height:0;border-top:1px solid rgba(0,0,0,.1);position:absolute;inset:36px 0 0}.zoom-actions[_ngcontent-%COMP%]{position:absolute;bottom:35px;left:201px;right:0;margin:0 auto;text-align:center}.zoom-actions-inner[_ngcontent-%COMP%]{display:inline-block;background-color:#fafafa}.zoom-actions[_ngcontent-%COMP%]   .mat-button[_ngcontent-%COMP%]{line-height:inherit;min-width:0}.zoom-actions[_ngcontent-%COMP%]   .mat-mdc-button[_ngcontent-%COMP%]:not(:disabled){color:#000}.info[_ngcontent-%COMP%]{position:absolute;bottom:35px;right:0;padding:0 16px;background:#fff;opacity:.75;font-size:12px;line-height:12px}label.legend[_ngcontent-%COMP%]{height:22px;font-size:12px;padding:0 5px;border:1px solid rgba(0,0,0,.1);display:inline-flex;align-items:center;user-select:none;-webkit-user-select:none}.controls[_ngcontent-%COMP%]{height:24px;margin:6px;display:flex;align-items:center;column-gap:7px}"],changeDetection:0});var Be=ae;var xo=[{path:"",canActivate:[yt,ft],canActivateChild:[vt],runGuardsAndResolvers:"always",component:_t,children:[{path:"",pathMatch:"full",component:Be}]}];export{xo as ROUTES};
