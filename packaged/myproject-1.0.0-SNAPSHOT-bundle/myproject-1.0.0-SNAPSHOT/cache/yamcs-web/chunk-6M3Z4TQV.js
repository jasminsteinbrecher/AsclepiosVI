import{a as ge}from"./chunk-E6DCO4NE.js";import{a as ct}from"./chunk-SIU2FQZX.js";import{a as zt}from"./chunk-TRW3DCW5.js";import"./chunk-IGBCSVEE.js";import{a as Ut,b as Wt}from"./chunk-L67MW52F.js";import{Aa as D,Bf as H,Ca as A,Cc as P,Cg as Bt,Dg as X,Dh as Xe,Ea as c,F as h,Fa as vt,Fc as F,Fg as Gt,Fh as E,G as g,Ga as ht,Gb as oe,Gh as qt,Hg as Z,Hh as jt,If as b,Jb as j,Kb as At,Kf as z,Na as Me,O as Ct,Pa as q,Pc as Ye,Ra as r,Rc as W,Rf as Ke,Sa as M,Sf as Ot,Ta as C,Tc as le,Tf as Lt,Ua as O,Uc as wt,Ug as Qe,V as m,Vg as he,Y as w,Ya as gt,Ye as re,Za as k,Ze as me,_ as I,_e as ce,_f as Nt,af as se,bb as v,bf as de,bg as Je,ca as V,cb as x,cg as ve,da as f,db as xt,df as pe,eb as St,ef as _e,eg as Pt,f as Y,fa as B,gf as ue,gg as Ft,hf as Ce,ib as Ne,jc as Tt,jf as fe,k as Le,ka as d,kf as ze,kg as K,la as ft,lg as $t,ma as p,mg as J,n as ut,ne as Be,nf as $,ng as Ht,oc as Fe,oe as Ge,og as Rt,pe as Dt,pg as Q,qa as _,qe as Ue,ra as o,re as qe,rf as It,sa as l,sb as yt,sc as L,se as je,sf as Et,ta as u,tc as N,te as We,tf as kt,ub as Pe,uc as bt,uf as Mt,vc as $e,vf as Vt,wc as He,xa as S,xc as te,ya as y,yb as ae,yc as Re,yg as Yt}from"./chunk-OXOWQRWE.js";var Xt=["*"],Zt=()=>({matrixParams:"exact",paths:"exact",queryParams:"ignored"}),Ze=t=>({c:t}),xe=class xe{constructor(n){this.yamcs=n}};xe.\u0275fac=function(e){return new(e||xe)(w(z))},xe.\u0275cmp=I({type:xe,selectors:[["app-alarms-page-tabs"]],ngContentSelectors:Xt,decls:15,vars:22,consts:[["rla","routerLinkActive"],["rlb","routerLinkActive"],["rlc","routerLinkActive"],["rld","routerLinkActive"],["routerLink","/alarms","routerLinkActive","",3,"routerLinkActiveOptions","queryParams"],["routerLink","/alarms/pending","routerLinkActive","",3,"queryParams"],["routerLink","/alarms/history","routerLinkActive","",3,"queryParams"],["routerLink","/alarms/log","routerLinkActive","",3,"queryParams"],["actions",""]],template:function(e,i){if(e&1&&(vt(),o(0,"ya-page-tabs")(1,"a",4,0),r(3," Active "),l(),o(4,"a",5,1),r(6," Pending "),l(),o(7,"a",6,2),r(9," History "),l(),o(10,"a",7,3),r(12," Action log "),l(),S(13,8),ht(14),y(),l()),e&2){let a=Me(2),s=Me(5),T=Me(8),ne=Me(11);m(),q("active",a.isActive),_("routerLinkActiveOptions",gt(13,Zt))("queryParams",k(14,Ze,i.yamcs.context)),m(3),q("active",s.isActive),_("queryParams",k(16,Ze,i.yamcs.context)),m(3),q("active",T.isActive),_("queryParams",k(18,Ze,i.yamcs.context)),m(3),q("active",ne.isActive),_("queryParams",k(20,Ze,i.yamcs.context))}},dependencies:[E,j,At,Bt],styles:[".mat-mdc-tab-link[_ngcontent-%COMP%]{height:36px;min-width:0;font-size:13px}"],changeDetection:0});var R=xe;function ei(t,n){if(t&1){let e=D();u(0,"ya-date-time-input",13)(1,"ya-date-time-input",14),o(2,"ya-button",15),A("click",function(){h(e);let a=c();return g(a.applyCustomDates())}),r(3,"Apply"),l()}if(t&2){let e=c();m(2),_("disabled",e.filterForm.invalid)}}function ti(t,n){if(t&1){let e=D();o(0,"ya-button",16),A("click",function(){h(e);let a=c();return g(a.jumpToNow())}),r(1,"Jump to now"),l()}}function ii(t,n){t&1&&(o(0,"th",17),r(1,"Time"),l())}function ni(t,n){if(t&1&&(o(0,"td",18),r(1),v(2,"datetime"),l()),t&2){let e=n.$implicit;m(),M(x(2,1,e.time))}}function ai(t,n){t&1&&(o(0,"th",17),r(1,"User"),l())}function oi(t,n){if(t&1&&(o(0,"td",18),r(1),l()),t&2){let e=n.$implicit;m(),M(e.user||"-")}}function li(t,n){t&1&&(o(0,"th",17),r(1,"Action"),l())}function ri(t,n){if(t&1&&(o(0,"td",18),u(1,"ya-action-log-summary",19),l()),t&2){let e=n.$implicit;m(),_("text",e.summary)}}function mi(t,n){t&1&&u(0,"th",20)}function ci(t,n){t&1&&u(0,"td",18)}function si(t,n){t&1&&u(0,"tr",21)}function di(t,n){t&1&&u(0,"tr",22)}var Se=class Se extends ${constructor(e){super();this.route=e;this.interval=Ne();this.customStart=Ne();this.customStop=Ne();this.filterForm=new bt({interval:new He("NO_LIMIT"),customStart:new He(null),customStop:new He(null)});this.displayedColumns=["time","user","summary","actions"];this.intervalOptions=[{id:"PT1H",label:"Last hour"},{id:"PT6H",label:"Last 6 hours"},{id:"P1D",label:"Last 24 hours"},{id:"NO_LIMIT",label:"No limit"},{id:"CUSTOM",label:"Custom",group:!0}];this.dataSource=new ze;this.setTitle("Alarm action log")}ngOnInit(){this.initializeOptions(),this.loadData(),this.filterForm.get("interval").valueChanges.forEach(e=>{if(e==="CUSTOM"){let i=new Date,a=this.validStart||i,s=this.validStop||i;this.filterForm.get("customStart").setValue(b.toISOString(a)),this.filterForm.get("customStop").setValue(b.toISOString(s))}else e==="NO_LIMIT"?(this.validStart=null,this.validStop=null,this.appliedInterval=e,this.loadData()):e&&(this.validStop=new Date,this.validStart=b.subtractDuration(this.validStop,e),this.appliedInterval=e,this.loadData())})}initializeOptions(){if(this.interval())if(this.appliedInterval=this.interval(),this.filterForm.get("interval").setValue(this.appliedInterval),this.appliedInterval==="CUSTOM"){let e=this.customStart();this.filterForm.get("customStart").setValue(e),this.validStart=b.toDate(e);let i=this.customStop();this.filterForm.get("customStop").setValue(i),this.validStop=b.toDate(i)}else this.appliedInterval==="NO_LIMIT"?(this.validStart=null,this.validStop=null):(this.validStop=new Date,this.validStart=b.subtractDuration(this.validStop,this.appliedInterval));else this.appliedInterval="NO_LIMIT",this.validStop=null,this.validStart=null}jumpToNow(){this.filterForm.get("interval").setValue("NO_LIMIT")}applyCustomDates(){let{controls:e}=this.filterForm;this.validStart=b.toDate(e.customStart.value),this.validStop=b.toDate(e.customStop.value),this.appliedInterval="CUSTOM",this.loadData()}loadData(){this.updateURL();let e={service:"AlarmsApi"};this.validStart&&(e.start=this.validStart.toISOString()),this.validStop&&(e.stop=this.validStop.toISOString()),this.yamcs.yamcsClient.getAuditRecords(this.yamcs.instance,e).then(i=>this.dataSource.data=i.records||[]).catch(i=>this.messageService.showError(i))}updateURL(){let{controls:e}=this.filterForm;this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{interval:this.appliedInterval,customStart:this.appliedInterval==="CUSTOM"?e.customStart.value:null,customStop:this.appliedInterval==="CUSTOM"?e.customStop.value:null},queryParamsHandling:"merge"})}};Se.\u0275fac=function(i){return new(i||Se)(w(oe))},Se.\u0275cmp=I({type:Se,selectors:[["app-alarms-action-log-tab"]],inputs:{interval:[1,"interval"],customStart:[1,"customStart"],customStop:[1,"customStop"]},features:[V],decls:23,vars:7,consts:[["label","Alarms"],[2,"margin-top","16px",3,"formGroup"],["icon","access_time","formControlName","interval",3,"options"],["mat-table","",1,"ya-data-table","expand",3,"dataSource"],["matColumnDef","time"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","user"],["matColumnDef","summary"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["formControlName","customStart"],["formControlName","customStop"],[3,"click","disabled"],[3,"click"],["mat-header-cell",""],["mat-cell",""],[3,"text"],["mat-header-cell","",1,"expand"],["mat-header-row",""],["mat-row",""]],template:function(i,a){i&1&&(o(0,"ya-instance-page"),u(1,"ya-instance-toolbar",0),o(2,"ya-panel"),u(3,"app-alarms-page-tabs"),o(4,"ya-filter-bar",1),u(5,"ya-select",2),d(6,ei,4,1),d(7,ti,2,0,"ya-button"),l(),o(8,"table",3),S(9,4),f(10,ii,2,0,"th",5)(11,ni,3,3,"td",6),y(),S(12,7),f(13,ai,2,0,"th",5)(14,oi,2,1,"td",6),y(),S(15,8),f(16,li,2,0,"th",5)(17,ri,2,1,"td",6),y(),S(18,9),f(19,mi,1,0,"th",10)(20,ci,1,0,"td",6),y(),f(21,si,1,0,"tr",11)(22,di,1,0,"tr",12),l()()()),i&2&&(m(4),_("formGroup",a.filterForm),m(),_("options",a.intervalOptions),m(),p(a.filterForm.value.interval==="CUSTOM"?6:-1),m(),p(a.filterForm.value.interval!=="CUSTOM"?7:-1),m(),_("dataSource",a.dataSource),m(13),_("matHeaderRowDef",a.displayedColumns),m(),_("matRowDefColumns",a.displayedColumns))},dependencies:[R,E,L,N,P,F,re,ce,_e,se,me,ue,de,pe,Ce,fe,It,H,Ke,ve,K,Q,X,Z,J],encapsulation:2,changeDetection:0});var et=Se;function pi(t,n){if(t&1&&r(0),t&2){let e=c(2);C(" /",e.data.alarms[0].id.name," ")}}function _i(t,n){if(t&1&&(r(0),d(1,pi,1,1)),t&2){let e=c();C(" ",e.data.alarms[0].id.namespace," "),m(),p(e.data.alarms[0].id.name?1:-1)}}function ui(t,n){if(t&1&&r(0),t&2){let e=c();C(" ",e.data.alarms.length," selected alarms. ")}}var ye=class ye{constructor(n,e,i,a){this.dialogRef=n;this.yamcs=i;this.data=a;this.formGroup=e.group({comment:void 0})}async acknowledge(){let n=this.data.alarms,e=this.formGroup.get("comment").value;for(let i of n){let a={};e&&(a.comment=e);let s=i.id.namespace+(i.id.name?"/"+i.id.name:"");this.yamcs.yamcsClient.acknowledgeAlarm(this.yamcs.instance,this.yamcs.processor,s,i.seqNum,a)}this.dialogRef.close()}};ye.\u0275fac=function(e){return new(e||ye)(w(Be),w(Ye),w(z),w(Ge))},ye.\u0275cmp=I({type:ye,selectors:[["app-acknowledge-alarm-dialog"]],decls:14,vars:4,consts:[["mat-dialog-title",""],[1,"ya-form",3,"formGroup"],["label","Comment"],["formControlName","comment","rows","5",2,"resize","none"],["align","end"],["mat-dialog-close",""],["appearance","primary",3,"click","disabled"]],template:function(e,i){e&1&&(o(0,"h2",0),r(1,"Acknowledge"),l(),o(2,"mat-dialog-content")(3,"p"),d(4,_i,2,2),d(5,ui,1,1),l(),o(6,"form",1)(7,"ya-field",2),u(8,"textarea",3),l()()(),o(9,"mat-dialog-actions",4)(10,"ya-button",5),r(11,"CANCEL"),l(),o(12,"ya-button",6),A("click",function(){return i.acknowledge()}),r(13," OK "),l()()),e&2&&(m(4),p(i.data.alarms.length===1?4:-1),m(),p(i.data.alarms.length!==1?5:-1),m(),_("formGroup",i.formGroup),m(6),_("disabled",!i.formGroup.valid))},dependencies:[E,Re,Fe,L,N,P,F,Ue,qe,We,je,H,Je],encapsulation:2,changeDetection:0});var it=ye;var Ci=t=>({c:t});function fi(t,n){if(t&1&&(o(0,"ya-attr",0)(1,"a",6),r(2),l()()),t&2){let e=c();m(),_("routerLink","/telemetry/parameters/"+e.alarm.id.namespace+"/"+e.alarm.id.name)("queryParams",k(4,Ci,e.yamcs.context)),m(),O(" ",e.alarm.id.namespace,"/",e.alarm.id.name," ")}}function vi(t,n){if(t&1&&r(0),t&2){let e=c(2);O(" ",e.alarm.id.namespace,"/",e.alarm.id.name," ")}}function hi(t,n){if(t&1&&r(0),t&2){let e=c(2);C(" ",e.alarm.id.namespace," ")}}function gi(t,n){if(t&1&&(o(0,"ya-attr",1),d(1,vi,1,2)(2,hi,1,1),l()),t&2){let e=c();m(),p(e.alarm.id.name?1:2)}}function xi(t,n){t&1&&(o(0,"span"),r(1,"\u2193"),l())}function Si(t,n){t&1&&(o(0,"span"),r(1,"\u2191"),l())}function yi(t,n){t&1&&(o(0,"span"),r(1,"\u2193"),l())}function Ai(t,n){t&1&&(o(0,"span"),r(1,"\u2191"),l())}function Ti(t,n){if(t&1&&(u(0,"ya-attr-divider"),o(1,"ya-attr",7),u(2,"app-alarm-level",8),r(3),v(4,"value"),d(5,xi,2,0,"span")(6,Si,2,0,"span"),l(),u(7,"ya-attr-divider"),o(8,"ya-attr",9)(9,"ya-expirable",10),u(10,"app-alarm-level",8),r(11),v(12,"value"),d(13,yi,2,0,"span"),d(14,Ai,2,0,"span"),l()()),t&2){let e=n,i=c();m(2),_("level",i.alarm.severity)("grayscale",!0),m(),C(" \xA0",x(4,10,e.triggerValue.engValue)," "),m(2),p(e.triggerValue.rangeCondition==="LOW"?5:e.triggerValue.rangeCondition==="HIGH"?6:-1),m(4),_("pval",e.currentValue),m(),_("level",e.currentValue.monitoringResult)("grayscale",!0),m(),C(" \xA0",x(12,12,e.currentValue.engValue)," "),m(2),p(e.currentValue.rangeCondition==="LOW"?13:-1),m(),p(e.currentValue.rangeCondition==="HIGH"?14:-1)}}function bi(t,n){t&1&&(u(0,"ya-attr-divider"),o(1,"ya-attr",11),r(2),l()),t&2&&(m(2),C(" ",n.triggerEvent.message," "))}function wi(t,n){if(t&1&&r(0),t&2){let e=c(2);C(" Acknowledged by ",e.alarm.acknowledgeInfo.acknowledgedBy," ")}}function Di(t,n){if(t&1&&(o(0,"blockquote",13),r(1),l()),t&2){let e=c(2);m(),C(" ",e.alarm.acknowledgeInfo.acknowledgeMessage," ")}}function Ii(t,n){if(t&1&&(u(0,"ya-attr-divider"),o(1,"ya-attr"),f(2,wi,1,1,"ng-template",12),r(3),v(4,"datetime"),d(5,Di,2,1,"blockquote",13),l()),t&2){let e=c();m(3),C(" On ",x(4,2,e.alarm.acknowledgeInfo.acknowledgeTime)," "),m(2),p(e.alarm.acknowledgeInfo.acknowledgeMessage?5:-1)}}function Ei(t,n){if(t&1&&r(0),t&2){let e=c();C("Shelved by ",e.shelvedBy)}}function ki(t,n){if(t&1&&(o(0,"blockquote",13),r(1),l()),t&2){let e=c();m(),C(" ",e.shelveMessage," ")}}function Mi(t,n){if(t&1&&(o(0,"ya-attr",14),r(1),v(2,"datetime"),l()),t&2){let e=c();m(),C(" ",x(2,1,e.shelveExpiration)," ")}}function Vi(t,n){if(t&1&&(u(0,"ya-attr-divider"),o(1,"ya-attr"),f(2,Ei,1,1,"ng-template",12),r(3),v(4,"datetime"),d(5,ki,2,1,"blockquote",13),l(),d(6,Mi,3,3,"ya-attr",14)),t&2){let e=n;m(3),C(" On ",x(4,3,e.shelveTime)," "),m(2),p(e.shelveMessage?5:-1),m(),p(e.shelveExpiration?6:-1)}}function Oi(t,n){if(t&1){let e=D();o(0,"ya-button",19),A("click",function(){h(e);let a=c(2);return g(a.acknowledgeAlarm.emit(a.alarm))}),r(1," ACKNOWLEDGE "),l()}}function Li(t,n){if(t&1){let e=D();o(0,"ya-button",20),A("click",function(){h(e);let a=c(2);return g(a.shelveAlarm.emit(a.alarm))}),r(1,"SHELVE"),l()}}function Ni(t,n){if(t&1){let e=D();o(0,"ya-button",21),A("click",function(){h(e);let a=c(2);return g(a.unshelveAlarm.emit(a.alarm))}),r(1,"UNSHELVE"),l()}}function Pi(t,n){if(t&1){let e=D();o(0,"ya-toolbar",5),d(1,Oi,2,0,"ya-button",15),d(2,Li,2,0,"ya-button",16),d(3,Ni,2,0,"ya-button",17),o(4,"ya-button",18),A("click",function(){h(e);let a=c();return g(a.clearAlarm.emit(a.alarm))}),r(5,"CLEAR"),l()()}if(t&2){let e=c();m(),p(!e.alarm.shelveInfo&&!e.alarm.acknowledged?1:-1),m(),p(e.alarm.shelveInfo?-1:2),m(),p(e.alarm.shelveInfo?3:-1)}}var Ae=class Ae{constructor(n){this.yamcs=n;this.mayControl=!1;this.acknowledgeAlarm=new B;this.shelveAlarm=new B;this.unshelveAlarm=new B;this.clearAlarm=new B}};Ae.\u0275fac=function(e){return new(e||Ae)(w(z))},Ae.\u0275cmp=I({type:Ae,selectors:[["app-alarm-detail"]],inputs:{alarm:"alarm",mayControl:"mayControl"},outputs:{acknowledgeAlarm:"acknowledgeAlarm",shelveAlarm:"shelveAlarm",unshelveAlarm:"unshelveAlarm",clearAlarm:"clearAlarm"},decls:14,vars:12,consts:[["label","Parameter"],["label","Event"],["label","Severity"],[3,"level"],["label","Violations"],["appearance","bottom"],[1,"ya-link",3,"routerLink","queryParams"],["label","Trigger value"],[3,"level","grayscale"],["label","Live value"],[3,"pval"],["label","Trigger event"],["ya-attr-label",""],[2,"border-left","4px solid #eee","padding-left","1em","font-style","italic"],["label","Shelve expiration"],["icon","notifications_off"],["icon","timer"],["icon","timer_off"],["icon","clear_all",3,"click"],["icon","notifications_off",3,"click"],["icon","timer",3,"click"],["icon","timer_off",3,"click"]],template:function(e,i){if(e&1&&(o(0,"ya-attr-list"),d(1,fi,3,6,"ya-attr",0),d(2,gi,3,1,"ya-attr",1),o(3,"ya-attr",2),u(4,"app-alarm-level",3),r(5),l(),o(6,"ya-attr",4),r(7),v(8,"number"),l(),d(9,Ti,15,14),d(10,bi,3,1),d(11,Ii,6,4),d(12,Vi,7,5),l(),d(13,Pi,6,3,"ya-toolbar",5)),e&2){let a,s,T;m(),p(i.alarm.type==="PARAMETER"?1:-1),m(),p(i.alarm.type==="EVENT"?2:-1),m(2),_("level",i.alarm.severity),m(),C(" ",i.alarm.severity," "),m(2),C(" ",x(8,10,i.alarm.violations)," "),m(2),p((a=i.alarm.parameterDetail)?9:-1,a),m(),p((s=i.alarm.eventDetail)?10:-1,s),m(),p(i.alarm.acknowledgeInfo?11:-1),m(),p((T=i.alarm.shelveInfo)?12:-1,T),m(),p(i.mayControl&&!i.alarm.readonly?13:-1)}},dependencies:[ge,E,j,kt,Vt,Et,Mt,H,Nt,Qe,ae,J,he],encapsulation:2,changeDetection:0});var nt=Ae;function Fi(t,n){t&1&&(o(0,"mat-icon",0),r(1,"timer"),l())}function $i(t,n){t&1&&(o(0,"mat-icon",1),r(1,"pending"),l())}function Hi(t,n){t&1&&(o(0,"mat-icon",2),r(1,"check_circle_outline"),l())}function Ri(t,n){t&1&&(o(0,"mat-icon",3),r(1,"notifications_none"),l())}function Yi(t,n){if(t&1&&d(0,Hi,2,0,"mat-icon",2)(1,Ri,2,0,"mat-icon",3),t&2){let e=c(2);p(e.alarm.acknowledged?0:1)}}function Bi(t,n){t&1&&(o(0,"mat-icon",4),r(1,"check_circle"),l())}function Gi(t,n){t&1&&(o(0,"mat-icon",5),r(1," notification_important "),l())}function Ui(t,n){if(t&1&&d(0,Bi,2,0,"mat-icon",4)(1,Gi,2,0,"mat-icon",5),t&2){let e=c(2);p(e.alarm.acknowledged?0:1)}}function qi(t,n){if(t&1&&d(0,$i,2,0,"mat-icon",1)(1,Yi,2,1)(2,Ui,2,1),t&2){let e=c();p(e.alarm.pending?0:e.alarm.processOK?1:2)}}var Te=class Te{};Te.\u0275fac=function(e){return new(e||Te)},Te.\u0275cmp=I({type:Te,selectors:[["app-alarm-state-icon"]],inputs:{alarm:"alarm"},decls:2,vars:1,consts:[["matTooltip","Shelved"],["matTooltip","Pending"],["matTooltip","RTN, acknowledged"],["matTooltip","RTN, unacknowledged",1,"unacked"],["matTooltip","Active, acknowledged"],["matTooltip","Active, unacknowledged",1,"unacked"]],template:function(e,i){e&1&&d(0,Fi,2,0,"mat-icon",0)(1,qi,3,1),e&2&&p(i.alarm.shelveInfo?0:1)},dependencies:[E,W,le],encapsulation:2});var at=Te;var pt=t=>({c:t});function ji(t,n){t&1&&(o(0,"th",19),r(1,"Alarm type"),l())}function Wi(t,n){t&1&&(o(0,"mat-icon",21),r(1,"event_note"),l())}function zi(t,n){t&1&&(o(0,"mat-icon",21),r(1,"toll"),l())}function Ki(t,n){if(t&1&&(o(0,"td",20),d(1,Wi,2,0,"mat-icon",21),d(2,zi,2,0,"mat-icon",21),r(3),v(4,"titlecase"),l()),t&2){let e=n.$implicit;m(),p(e.type==="EVENT"?1:-1),m(),p(e.type==="PARAMETER"?2:-1),m(),C(" ",x(4,3,e.type||"-")," ")}}function Ji(t,n){t&1&&(o(0,"th",19),r(1,"Alarm name"),l())}function Qi(t,n){if(t&1&&(o(0,"a",22),r(1),l()),t&2){let e=c(2).$implicit,i=c();_("routerLink","/telemetry/parameters"+e.id.namespace+"/"+e.id.name)("queryParams",k(4,pt,i.yamcs.context)),m(),O(" ",e.id.namespace,"/",e.id.name," ")}}function Xi(t,n){if(t&1&&r(0),t&2){let e=c(2).$implicit;O(" ",e.id.namespace,"/",e.id.name," ")}}function Zi(t,n){if(t&1&&d(0,Qi,2,6,"a",22)(1,Xi,1,2),t&2){let e=c().$implicit;p(e.parameterDetail?0:1)}}function en(t,n){if(t&1&&(o(0,"a",22),r(1),l()),t&2){let e=c(2).$implicit,i=c();_("routerLink","/telemetry/parameters"+e.id.namespace)("queryParams",k(3,pt,i.yamcs.context)),m(),C(" ",e.id.namespace," ")}}function tn(t,n){if(t&1&&r(0),t&2){let e=c(2).$implicit;C(" ",e.id.namespace," ")}}function nn(t,n){if(t&1&&d(0,en,2,5,"a",22)(1,tn,1,1),t&2){let e=c().$implicit;p(e.parameterDetail?0:1)}}function an(t,n){if(t&1&&(o(0,"a",22),r(1),l()),t&2){let e=c(2).$implicit,i=c();_("routerLink","/telemetry/parameters"+e.id.name)("queryParams",k(3,pt,i.yamcs.context)),m(),C(" ",e.id.name," ")}}function on(t,n){if(t&1&&r(0),t&2){let e=c(2).$implicit;C(" ",e.id.name," ")}}function ln(t,n){if(t&1&&d(0,an,2,5,"a",22)(1,on,1,1),t&2){let e=c().$implicit;p(e.parameterDetail?0:1)}}function rn(t,n){if(t&1&&(o(0,"td",20),d(1,Zi,2,1),d(2,nn,2,1),d(3,ln,2,1),l()),t&2){let e=n.$implicit;m(),p(e.id.namespace&&e.id.name?1:-1),m(),p(e.id.namespace&&!e.id.name?2:-1),m(),p(!e.id.namespace&&e.id.name?3:-1)}}function mn(t,n){t&1&&(o(0,"th",23),r(1,"State"),l())}function cn(t,n){if(t&1&&(o(0,"td",24),u(1,"app-alarm-state-icon",25),l()),t&2){let e=n.$implicit;m(),_("alarm",e)}}function sn(t,n){t&1&&(o(0,"th",19),r(1,"Alarm time"),l())}function dn(t,n){if(t&1&&(o(0,"td",20)(1,"span",26),v(2,"datetime"),u(3,"app-ago",27),l()()),t&2){let e=n.$implicit;m(),_("matTooltip",x(2,2,e.triggerTime)),m(2),_("time",e.triggerTime)}}function pn(t,n){t&1&&(o(0,"th",23),r(1,"Severity"),l())}function _n(t,n){if(t&1&&(o(0,"td",24),u(1,"app-alarm-level",28),l()),t&2){let e=n.$implicit;m(),_("level",e.severity)("grayscale",e.pending)}}function un(t,n){t&1&&(o(0,"th",19),r(1,"Trip value"),l())}function Cn(t,n){t&1&&(o(0,"span"),r(1,"\u2193"),l())}function fn(t,n){t&1&&(o(0,"span"),r(1,"\u2191"),l())}function vn(t,n){if(t&1&&(r(0),v(1,"value"),d(2,Cn,2,0,"span"),d(3,fn,2,0,"span")),t&2){let e=n;C(" ",x(1,3,e.triggerValue.engValue)," "),m(2),p(e.triggerValue.rangeCondition==="LOW"?2:-1),m(),p(e.triggerValue.rangeCondition==="HIGH"?3:-1)}}function hn(t,n){t&1&&r(0),t&2&&C(" ",n.triggerEvent.message||"-"," ")}function gn(t,n){if(t&1&&(o(0,"td",29),d(1,vn,4,5),d(2,hn,1,1),l()),t&2){let e,i,a=n.$implicit;m(),p((e=a.parameterDetail)?1:-1,e),m(),p((i=a.eventDetail)?2:-1,i)}}function xn(t,n){t&1&&(o(0,"th",19),r(1,"Live value"),l())}function Sn(t,n){t&1&&(o(0,"span"),r(1,"\u2193"),l())}function yn(t,n){t&1&&(o(0,"span"),r(1,"\u2191"),l())}function An(t,n){if(t&1&&(r(0),v(1,"value"),d(2,Sn,2,0,"span"),d(3,yn,2,0,"span")),t&2){let e=n;C(" ",x(1,3,e.currentValue.engValue)," "),m(2),p(e.currentValue.rangeCondition==="LOW"?2:-1),m(),p(e.currentValue.rangeCondition==="HIGH"?3:-1)}}function Tn(t,n){t&1&&r(0),t&2&&C(" ",n.triggerEvent.message||"-"," ")}function bn(t,n){if(t&1&&(o(0,"td",29),d(1,An,4,5),d(2,Tn,1,1),l()),t&2){let e,i,a=n.$implicit;m(),p((e=a.parameterDetail)?1:-1,e),m(),p((i=a.eventDetail)?2:-1,i)}}function wn(t,n){t&1&&(o(0,"th",19),r(1,"Violations"),l())}function Dn(t,n){if(t&1&&(o(0,"td",20),r(1),v(2,"number"),l()),t&2){let e=n.$implicit;m(),M(x(2,1,e.violations))}}function In(t,n){t&1&&u(0,"th",30)}function En(t,n){if(t&1){let e=D();o(0,"ya-more")(1,"button",31),A("click",function(){h(e);let a=c().$implicit,s=c();return g(s.acknowledgeAlarm.emit(a))}),r(2," Acknowledge... "),l(),o(3,"button",31),A("click",function(){h(e);let a=c().$implicit,s=c();return g(s.shelveAlarm.emit(a))}),r(4," Shelve... "),l(),o(5,"button",31),A("click",function(){h(e);let a=c().$implicit,s=c();return g(s.unshelveAlarm.emit(a))}),r(6," Unshelve "),l()()}if(t&2){let e=c().$implicit;m(),_("disabled",e.shelveInfo||e.acknowledged),m(2),_("disabled",e.shelveInfo),m(2),_("disabled",!e.shelveInfo)}}function kn(t,n){if(t&1&&(o(0,"td",20),d(1,En,7,3,"ya-more"),l()),t&2){let e=n.$implicit,i=c();m(),p(i.mayControl&&!e.readonly&&!e.pending?1:-1)}}function Mn(t,n){t&1&&u(0,"tr",32)}function Vn(t,n){if(t&1){let e=D();o(0,"tr",33),A("click",function(){let a=h(e).$implicit,s=c();return g(s.toggleOne(a))}),l()}if(t&2){let e=n.$implicit,i=c();q("selected",i.selection.isSelected(e))("hide",i.hideAlarm(e))}}function On(t,n){t&1&&r(0,"-")}var ie=class ie extends ${constructor(){super(...arguments);this.displayedColumns=["state","severity","time","alarm","type","trip_value","live_value","actions"];this.view="standard";this.mayControl=!1;this.acknowledgeAlarm=new B;this.shelveAlarm=new B;this.unshelveAlarm=new B;this.tableTrackerFn=(e,i)=>`${i.triggerTime}__${i.id.namespace}__${i.id.name}__${i.seqNum}`}ngOnInit(){this.view==="pending"&&this.displayedColumns.splice(this.displayedColumns.length-1,0,"violations")}toggleOne(e){(!this.selection.isSelected(e)||this.selection.selected.length>1)&&this.selection.clear(),this.selection.toggle(e),this.openDetailPane()}hideAlarm(e){if(this.view==="pending")return!e.pending;if(this.view==="standard")return e.pending||!!e.shelveInfo;if(this.view==="all")return e.pending;if(this.view==="unacknowledged")return e.pending||!!e.shelveInfo||e.acknowledged;if(this.view==="acknowledged")return e.pending||!!e.shelveInfo||!e.acknowledged;if(this.view==="shelved")return e.pending||!e.shelveInfo}};ie.\u0275fac=(()=>{let e;return function(a){return(e||(e=Ct(ie)))(a||ie)}})(),ie.\u0275cmp=I({type:ie,selectors:[["app-alarms-table"]],inputs:{dataSource:"dataSource",selection:"selection",view:"view",mayControl:"mayControl"},outputs:{acknowledgeAlarm:"acknowledgeAlarm",shelveAlarm:"shelveAlarm",unshelveAlarm:"unshelveAlarm"},features:[V],decls:32,vars:6,consts:[["dash",""],["mat-table","",1,"ya-data-table","expand",3,"dataSource","trackBy"],["matColumnDef","type"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","alarm"],["matColumnDef","state"],["mat-header-cell","","class","status",4,"matHeaderCellDef"],["mat-cell","","class","status",4,"matCellDef"],["matColumnDef","time"],["matColumnDef","severity"],["matColumnDef","trip_value"],["mat-cell","","class","wrap200",4,"matCellDef"],["matColumnDef","live_value"],["matColumnDef","violations"],["matColumnDef","actions"],["mat-header-cell","","style","width: 100%",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"selected","hide","click",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],[2,"vertical-align","middle"],[3,"routerLink","queryParams"],["mat-header-cell","",1,"status"],["mat-cell","",1,"status"],[3,"alarm"],[3,"matTooltip"],[3,"time"],[3,"level","grayscale"],["mat-cell","",1,"wrap200"],["mat-header-cell","",2,"width","100%"],["mat-menu-item","",3,"click","disabled"],["mat-header-row",""],["mat-row","",3,"click"]],template:function(i,a){i&1&&(o(0,"table",1),S(1,2),f(2,ji,2,0,"th",3)(3,Ki,5,5,"td",4),y(),S(4,5),f(5,Ji,2,0,"th",3)(6,rn,4,3,"td",4),y(),S(7,6),f(8,mn,2,0,"th",7)(9,cn,2,1,"td",8),y(),S(10,9),f(11,sn,2,0,"th",3)(12,dn,4,4,"td",4),y(),S(13,10),f(14,pn,2,0,"th",7)(15,_n,2,2,"td",8),y(),S(16,11),f(17,un,2,0,"th",3)(18,gn,3,2,"td",12),y(),S(19,13),f(20,xn,2,0,"th",3)(21,bn,3,2,"td",12),y(),S(22,14),f(23,wn,2,0,"th",3)(24,Dn,3,3,"td",4),y(),S(25,15),f(26,In,1,0,"th",16)(27,kn,2,1,"td",4),y(),f(28,Mn,1,0,"tr",17)(29,Vn,1,4,"tr",18),l(),f(30,On,1,0,"ng-template",null,0,St)),i&2&&(q("hide",a.dataSource.isEmpty()),_("dataSource",a.dataSource)("trackBy",a.tableTrackerFn),m(28),_("matHeaderRowDef",a.displayedColumns),m(),_("matRowDefColumns",a.displayedColumns))},dependencies:[zt,ge,at,E,j,W,wt,re,ce,_e,se,me,ue,de,pe,Ce,fe,le,Yt,ae,Pe,J,he],styles:[".hide[_ngcontent-%COMP%]{display:none}td[_ngcontent-%COMP%]{cursor:pointer}"]});var be=ie;var we=class extends Tt{constructor(e,i){super();this.yamcs=e;this.pendingOnly=i;this.alarms$=new Y([]);this.filteredAlarms$=new Y([]);this.loading$=new Y(!1);this.alarmsByName={};this.filter=null;this.unacknowledgedAlarms$=this.alarms$.pipe(Le(a=>a.filter(s=>!s.shelveInfo&&!s.acknowledged))),this.acknowledgedAlarms$=this.alarms$.pipe(Le(a=>a.filter(s=>!s.shelveInfo&&s.acknowledged))),this.shelvedAlarms$=this.alarms$.pipe(Le(a=>a.filter(s=>!!s.shelveInfo)))}connect(){return this.filteredAlarms$}setFilter(e){this.filter=e||null}loadAlarms(){this.loading$.next(!0),this.yamcs.yamcsClient.getActiveAlarms(this.yamcs.instance,this.yamcs.processor).then(e=>{this.loading$.next(!1);for(let i of e)this.processAlarm(i);this.updateSubject()}),this.alarmSubscription=this.yamcs.yamcsClient.createAlarmSubscription({instance:this.yamcs.instance,processor:this.yamcs.processor,includePending:!0},e=>{this.processAlarm(e),this.updateSubject()})}updateSubject(){let i=[...Object.values(this.alarmsByName).sort((a,s)=>{let T=a.acknowledged===s.acknowledged?0:a.acknowledged?1:-1;if(T===0){let ne=this.getNumericSeverity(a.severity),Oe=this.getNumericSeverity(s.severity);T=ne===Oe?0:ne<Oe?1:-1}if(T===0){let ne=a.id.namespace+"/"+a.id.name,Oe=s.id.namespace+"/"+s.id.name;T=ne.localeCompare(Oe)}return T})];if(this.alarms$.next(i),this.filter){let a=i.filter(s=>(s.id.namespace+"/"+s.id.name).toLowerCase().indexOf(this.filter)!==-1);this.filteredAlarms$.next(a)}else this.filteredAlarms$.next(i)}getNumericSeverity(e){switch(e){case"WATCH":return 0;case"WARNING":return 1;case"DISTRESS":return 2;case"CRITICAL":return 3;case"SEVERE":return 4;default:return 5}}disconnect(){this.alarms$.complete(),this.filteredAlarms$.complete(),this.loading$.complete(),this.alarmSubscription&&this.alarmSubscription.cancel()}isEmpty(){return!this.filteredAlarms$.getValue().length}processAlarm(e){let i=e.id.namespace+"/"+e.id.name;this.pendingOnly?e.pending?this.alarmsByName[i]=e:delete this.alarmsByName[i]:e.pending?delete this.alarmsByName[i]:e.processOK&&!e.triggered&&e.acknowledged?delete this.alarmsByName[i]:this.alarmsByName[i]=e}};function Ln(t,n){if(t&1&&r(0),t&2){let e=c(2);C(" /",e.data.alarms[0].id.name," ")}}function Nn(t,n){if(t&1&&(r(0),d(1,Ln,1,1)),t&2){let e=c();C(" ",e.data.alarms[0].id.namespace," "),m(),p(e.data.alarms[0].id.name?1:-1)}}function Pn(t,n){if(t&1&&r(0),t&2){let e=c();C(" ",e.data.alarms.length," selected alarms. ")}}var De=class De{constructor(n,e,i,a){this.dialogRef=n;this.yamcs=i;this.data=a;this.durationOptions=[{id:"PT15M",label:"15 minutes"},{id:"PT30M",label:"30 minutes"},{id:"PT1H",label:"1 hour"},{id:"PT2H",label:"2 hours"},{id:"P1D",label:"1 day"},{id:"UNLIMITED",label:"unlimited"}];this.formGroup=e.group({duration:"PT2H",comment:void 0})}async shelve(){let n=this.data.alarms,e=this.formGroup.get("comment").value,i=null;if(this.formGroup.get("duration").value!=="UNLIMITED"){let a=this.formGroup.get("duration").value;i=b.convertDurationToMillis(a)}for(let a of n){let s={};e&&(s.comment=e),i&&(s.shelveDuration=i);let T=a.id.namespace+(a.id.name?"/"+a.id.name:"");this.yamcs.yamcsClient.shelveAlarm(this.yamcs.instance,this.yamcs.processor,T,a.seqNum,s)}this.dialogRef.close()}};De.\u0275fac=function(e){return new(e||De)(w(Be),w(Ye),w(z),w(Ge))},De.\u0275cmp=I({type:De,selectors:[["app-shelve-alarm-dialog"]],decls:16,vars:5,consts:[["mat-dialog-title",""],[1,"ya-form",3,"formGroup"],["label","Duration"],["formControlName","duration",3,"options"],["label","Comment"],["formControlName","comment","rows","5",2,"resize","none"],["align","end"],["mat-dialog-close",""],["appearance","primary",3,"click","disabled"]],template:function(e,i){e&1&&(o(0,"h2",0),r(1,"Shelve"),l(),o(2,"mat-dialog-content")(3,"p"),d(4,Nn,2,2),d(5,Pn,1,1),l(),o(6,"form",1)(7,"ya-field",2),u(8,"ya-select",3),l(),o(9,"ya-field",4),u(10,"textarea",5),l()()(),o(11,"mat-dialog-actions",6)(12,"ya-button",7),r(13,"CANCEL"),l(),o(14,"ya-button",8),A("click",function(){return i.shelve()}),r(15,"OK"),l()()),e&2&&(m(4),p(i.data.alarms.length===1?4:-1),m(),p(i.data.alarms.length!==1?5:-1),m(),_("formGroup",i.formGroup),m(2),_("options",i.durationOptions),m(6),_("disabled",!i.formGroup.valid))},dependencies:[E,Re,Fe,L,N,P,F,Ue,qe,We,je,H,Je,Z],encapsulation:2,changeDetection:0});var ot=De;function Fn(t,n){t&1&&(r(0," Alarms "),o(1,"ya-help"),r(2," An alarm can be in these states: "),o(3,"table",4)(4,"tr")(5,"td",5)(6,"mat-icon",6),r(7," notification_important "),l()(),o(8,"td"),r(9,"The alarm is unacknowledged and the cause of the alarm still exists."),l()(),o(10,"tr")(11,"td")(12,"mat-icon",6),r(13,"notifications_none"),l()(),o(14,"td"),r(15," The alarm is unacknowledged and the cause that generated the alarm no longer exists. "),l()(),o(16,"tr")(17,"td")(18,"mat-icon",6),r(19,"check_circle"),l()(),o(20,"td"),r(21,"The alarm is acknowledged and the cause of the alarm still exists."),l()(),o(22,"tr")(23,"td")(24,"mat-icon",6),r(25," check_circle_outline "),l()(),o(26,"td"),r(27," The alarm is acknowledged and the cause that generated the alarm no longer exists. "),l()(),o(28,"tr")(29,"td")(30,"mat-icon",6),r(31,"timer"),l()(),o(32,"td"),r(33,"The alarm was shelved."),l()()()())}function $n(t,n){if(t&1){let e=D();o(0,"ya-page-button",7),A("clicked",function(){h(e);let a=c();return g(a.acknowledgeAlarms(a.selection.selected))}),r(1," Acknowledge "),l()}if(t&2){let e=c();_("disabled",!e.mayControlSelection())}}function Hn(t,n){if(t&1){let e=D();o(0,"ya-page-button",8),A("clicked",function(){h(e);let a=c();return g(a.shelveAlarms(a.selection.selected))}),r(1," Shelve "),l()}if(t&2){let e=c();_("disabled",!e.mayControlSelection())}}function Rn(t,n){if(t&1){let e=D();o(0,"ya-detail-toolbar"),r(1,"Alarm detail"),l(),o(2,"div",9)(3,"app-alarm-detail",10),A("acknowledgeAlarm",function(a){h(e);let s=c();return g(s.acknowledgeAlarms([a]))})("shelveAlarm",function(a){h(e);let s=c();return g(s.shelveAlarms([a]))})("unshelveAlarm",function(a){h(e);let s=c();return g(s.unshelveAlarms([a]))})("clearAlarm",function(a){h(e);let s=c();return g(s.clearAlarms([a]))}),l()()}if(t&2){let e=c();m(3),_("alarm",n)("mayControl",e.mayControlAlarms())}}function Yn(t,n){t&1&&(o(0,"ya-detail-toolbar"),r(1,"Select an alarm"),l())}function Bn(t,n){if(t&1){let e=D();o(0,"ya-panel"),u(1,"app-alarms-page-tabs"),o(2,"dl",11)(3,"dt"),r(4,"Unacknowledged alarms:"),l(),o(5,"dd")(6,"strong"),r(7),v(8,"async"),l()(),o(9,"dt"),r(10,"Acknowledged alarms:"),l(),o(11,"dd")(12,"strong"),r(13),v(14,"async"),l()(),o(15,"dt"),r(16,"Shelved alarms:"),l(),o(17,"dd")(18,"strong"),r(19),v(20,"async"),l()()(),o(21,"ya-filter-bar",12),u(22,"ya-search-filter",13)(23,"ya-select",14),l(),o(24,"app-alarms-table",15),v(25,"async"),A("acknowledgeAlarm",function(a){h(e);let s=c();return g(s.acknowledgeAlarms([a]))})("shelveAlarm",function(a){h(e);let s=c();return g(s.shelveAlarms([a]))})("unshelveAlarm",function(a){h(e);let s=c();return g(s.unshelveAlarms([a]))}),l()()}if(t&2){let e,i,a,s=c();m(7),M((e=x(8,9,s.dataSource.unacknowledgedAlarms$))==null?null:e.length),m(6),M((i=x(14,11,s.dataSource.acknowledgedAlarms$))==null?null:i.length),m(6),M((a=x(20,13,s.dataSource.shelvedAlarms$))==null?null:a.length),m(2),_("formGroup",s.filterForm),m(2),_("options",s.viewOptions),m(),_("dataSource",s.dataSource)("selection",s.selection)("view",x(25,15,s.view$))("mayControl",s.mayControlAlarms())}}var Ie=class Ie extends ${constructor(e,i){super();this.route=e;this.dialog=i;this.filterForm=new $e({filter:new te,view:new te("standard")});this.detailAlarm$=new Y(null);this.selection=new Xe((e,i)=>`${i.triggerTime}__${i.id.namespace}__${i.id.name}__${i.seqNum}`,!1,[]);this.viewOptions=[{id:"standard",label:"Standard view (ack & unack)"},{id:"unacknowledged",label:"Unacknowledged alarms"},{id:"acknowledged",label:"Acknowledged alarms"},{id:"shelved",label:"Shelved alarms"},{id:"all",label:"All alarms"}];this.view$=new Y("standard");this.setTitle("Alarms"),this.selectionSubscription=this.selection.changed.subscribe(()=>{let a=this.selection.selected;a.length===1?this.detailAlarm$.next(a[0]):this.detailAlarm$.next(null)}),this.dataSource=new we(this.yamcs,!1),this.dataSource.loadAlarms(),this.alarmsSubscription=this.dataSource.alarms$.subscribe(a=>{this.selection.matchNewValues(a);let s=this.detailAlarm$.value;if(s){for(let T of a)if(this.isSameAlarm(T,s)){this.detailAlarm$.next(T);break}}}),this.initializeOptions(),this.filterForm.get("filter").valueChanges.pipe(ut(400)).forEach(a=>{this.filter=a,this.updateURL(),this.dataSource.setFilter(a)}),this.filterForm.get("view").valueChanges.forEach(a=>{this.view$.next(a),this.updateURL(),this.selection.clear()})}initializeOptions(){let e=this.route.snapshot.queryParamMap;if(e.has("filter")&&(this.filter=e.get("filter")||"",this.filterForm.get("filter").setValue(this.filter)),e.has("view")){let i=e.get("view");this.view$.next(i),this.filterForm.get("view").setValue(i)}}isSameAlarm(e,i){return e.seqNum===i.seqNum&&e.id.namespace===i.id.namespace&&e.id.name===i.id.name&&e.triggerTime===i.triggerTime}acknowledgeAlarms(e){this.dialog.open(it,{width:"400px",data:{alarms:e}}).afterClosed().subscribe(()=>this.selection.clear())}shelveAlarms(e){this.dialog.open(ot,{width:"400px",data:{alarms:e}}).afterClosed().subscribe(()=>this.selection.clear())}unshelveAlarms(e){for(let i of e){let a=i.id.namespace+(i.id.name?"/"+i.id.name:"");this.yamcs.yamcsClient.unshelveAlarm(this.yamcs.instance,this.yamcs.processor,a,i.seqNum).then(()=>this.selection.clear()).catch(s=>this.messageService.showError(s))}}clearAlarms(e){for(let i of e){let a=i.id.namespace+(i.id.name?"/"+i.id.name:"");this.yamcs.yamcsClient.clearAlarm(this.yamcs.instance,this.yamcs.processor,a,i.seqNum,{})}}mayControlAlarms(){return this.authService.getUser().hasSystemPrivilege("ControlAlarms")}mayControlSelection(){let{selected:e}=this.selection;if(!e.length)return!1;for(let i of e)if(i.readonly)return!1;return!0}updateURL(){this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{filter:this.filter||null,view:this.view$.value||null},queryParamsHandling:"merge"})}ngOnDestroy(){this.selectionSubscription?.unsubscribe(),this.alarmsSubscription?.unsubscribe()}};Ie.\u0275fac=function(i){return new(i||Ie)(w(oe),w(Dt))},Ie.\u0275cmp=I({type:Ie,selectors:[["ng-component"]],features:[V],decls:11,vars:6,consts:[["ya-instance-toolbar-label",""],["icon","notifications_off",3,"disabled"],["icon","timer",3,"disabled"],[1,"table-wrapper"],[1,"ya-data-table"],["width","1"],[1,"icon16",2,"vertical-align","middle"],["icon","notifications_off",3,"clicked","disabled"],["icon","timer",3,"clicked","disabled"],[2,"padding","0 16px"],[3,"acknowledgeAlarm","shelveAlarm","unshelveAlarm","clearAlarm","alarm","mayControl"],[1,"dl-horizontal"],[3,"formGroup"],["formControlName","filter","placeholder","Filter by text search"],["formControlName","view",3,"options"],[3,"acknowledgeAlarm","shelveAlarm","unshelveAlarm","dataSource","selection","view","mayControl"]],template:function(i,a){if(i&1&&(o(0,"ya-instance-page")(1,"ya-instance-toolbar"),f(2,Fn,34,0,"ng-template",0),d(3,$n,2,1,"ya-page-button",1),d(4,Hn,2,1,"ya-page-button",2),l(),o(5,"ya-detail-pane"),d(6,Rn,4,2),v(7,"async"),ft(8,Yn,2,0,"ya-detail-toolbar"),l(),o(9,"div",3),d(10,Bn,26,17,"ya-panel"),l()()),i&2){let s;m(3),p(a.mayControlAlarms()?3:-1),m(),p(a.mayControlAlarms()?4:-1),m(2),p((s=x(7,4,a.detailAlarm$))?6:8,s),m(4),p(a.dataSource?10:-1)}},dependencies:[nt,R,be,E,L,N,P,F,W,Ot,Lt,ve,Ft,K,Q,$t,Rt,X,Gt,Z,yt],styles:[".table-wrapper[_ngcontent-%COMP%]{position:relative;overflow:auto;height:100%}mat-row[_ngcontent-%COMP%]{cursor:pointer}mat-row[_ngcontent-%COMP%]:hover{background:#fafafa}"],changeDetection:0});var lt=Ie;var _t=t=>({c:t});function Gn(t,n){if(t&1){let e=D();u(0,"ya-date-time-input",7)(1,"ya-date-time-input",8),o(2,"ya-button",9),A("click",function(){h(e);let a=c();return g(a.applyCustomDates())}),r(3,"Apply"),l()}if(t&2){let e=c();m(2),_("disabled",e.filterForm.invalid)}}function Un(t,n){if(t&1){let e=D();o(0,"ya-button",10),A("click",function(){h(e);let a=c();return g(a.jumpToNow())}),r(1,"Jump to now"),l()}}function qn(t,n){t&1&&(o(0,"th",28),r(1,"Severity"),l())}function jn(t,n){if(t&1&&(o(0,"td",29),u(1,"app-alarm-level",30),l()),t&2){let e=n.$implicit;m(),_("level",e.severity)("grayscale",!0)}}function Wn(t,n){t&1&&(o(0,"th",28),r(1,"Alarm type"),l())}function zn(t,n){t&1&&(o(0,"mat-icon",31),r(1,"event_note"),l())}function Kn(t,n){t&1&&(o(0,"mat-icon",31),r(1,"toll"),l())}function Jn(t,n){if(t&1&&(o(0,"td",29),d(1,zn,2,0,"mat-icon",31),d(2,Kn,2,0,"mat-icon",31),r(3),v(4,"titlecase"),l()),t&2){let e=n.$implicit;m(),p(e.type==="EVENT"?1:-1),m(),p(e.type==="PARAMETER"?2:-1),m(),C(" ",x(4,3,e.type||"-")," ")}}function Qn(t,n){t&1&&(o(0,"th",28),r(1,"Start"),l())}function Xn(t,n){if(t&1&&(o(0,"td",29),r(1),v(2,"datetime"),l()),t&2){let e=n.$implicit;m(),M(x(2,1,e.triggerTime)||"-")}}function Zn(t,n){t&1&&(o(0,"th",28),r(1,"Stop"),l())}function ea(t,n){if(t&1&&(o(0,"td",29),r(1),v(2,"datetime"),l()),t&2){let e=n.$implicit;m(),C(" ",x(2,1,e.updateTime)||"-"," ")}}function ta(t,n){t&1&&(o(0,"th",28),r(1,"Trip value"),l())}function ia(t,n){t&1&&(o(0,"span"),r(1,"\u2193"),l())}function na(t,n){t&1&&(o(0,"span"),r(1,"\u2191"),l())}function aa(t,n){if(t&1&&(r(0),v(1,"value"),d(2,ia,2,0,"span"),d(3,na,2,0,"span")),t&2){let e=n;C(" ",x(1,3,e.triggerValue.engValue)," "),m(2),p(e.triggerValue.rangeCondition==="LOW"?2:-1),m(),p(e.triggerValue.rangeCondition==="HIGH"?3:-1)}}function oa(t,n){t&1&&r(0),t&2&&C(" ",n.triggerEvent.message||"-"," ")}function la(t,n){if(t&1&&(o(0,"td",32),d(1,aa,4,5),d(2,oa,1,1),l()),t&2){let e,i,a=n.$implicit;m(),p((e=a.parameterDetail)?1:-1,e),m(),p((i=a.eventDetail)?2:-1,i)}}function ra(t,n){t&1&&(o(0,"th",28),r(1,"Alarm name"),l())}function ma(t,n){if(t&1&&(o(0,"a",33),r(1),l()),t&2){let e=c(2).$implicit,i=c(2);_("routerLink","/telemetry/parameters"+e.id.namespace+"/"+e.id.name)("queryParams",k(4,_t,i.yamcs.context)),m(),O(" ",e.id.namespace,"/",e.id.name," ")}}function ca(t,n){if(t&1&&r(0),t&2){let e=c(2).$implicit;O(" ",e.id.namespace,"/",e.id.name," ")}}function sa(t,n){if(t&1&&d(0,ma,2,6,"a",33)(1,ca,1,2),t&2){let e=c().$implicit;p(e.parameterDetail?0:1)}}function da(t,n){if(t&1&&(o(0,"a",33),r(1),l()),t&2){let e=c(2).$implicit,i=c(2);_("routerLink","/telemetry/parameters"+e.id.namespace)("queryParams",k(3,_t,i.yamcs.context)),m(),C(" ",e.id.namespace," ")}}function pa(t,n){if(t&1&&r(0),t&2){let e=c(2).$implicit;C(" ",e.id.namespace," ")}}function _a(t,n){if(t&1&&d(0,da,2,5,"a",33)(1,pa,1,1),t&2){let e=c().$implicit;p(e.parameterDetail?0:1)}}function ua(t,n){if(t&1&&(o(0,"a",33),r(1),l()),t&2){let e=c(2).$implicit,i=c(2);_("routerLink","/telemetry/parameters"+e.id.name)("queryParams",k(3,_t,i.yamcs.context)),m(),C(" ",e.id.name," ")}}function Ca(t,n){if(t&1&&r(0),t&2){let e=c(2).$implicit;C(" ",e.id.name," ")}}function fa(t,n){if(t&1&&d(0,ua,2,5,"a",33)(1,Ca,1,1),t&2){let e=c().$implicit;p(e.parameterDetail?0:1)}}function va(t,n){if(t&1&&(o(0,"td",29),d(1,sa,2,1),d(2,_a,2,1),d(3,fa,2,1),l()),t&2){let e=n.$implicit;m(),p(e.id.namespace&&e.id.name?1:-1),m(),p(e.id.namespace&&!e.id.name?2:-1),m(),p(!e.id.namespace&&e.id.name?3:-1)}}function ha(t,n){t&1&&(o(0,"th",28),r(1,"Duration"),l())}function ga(t,n){if(t&1&&(r(0),v(1,"duration")),t&2){let e=c().$implicit,i=c(2);C(" ",x(1,1,i.durationFor(e))||"-"," ")}}function xa(t,n){if(t&1&&(o(0,"mat-icon",34),r(1,"comment"),l()),t&2){let e=c(2).$implicit;_("matTooltip",e.clearInfo==null?null:e.clearInfo.clearMessage)}}function Sa(t,n){if(t&1&&(r(0),d(1,xa,2,1,"mat-icon",34)),t&2){let e=c().$implicit;C(" (cleared by ",e.clearInfo==null?null:e.clearInfo.clearedBy,") "),m(),p(e.clearInfo!=null&&e.clearInfo.clearMessage?1:-1)}}function ya(t,n){if(t&1&&(o(0,"td",29),d(1,ga,2,3),d(2,Sa,2,2),l()),t&2){let e=n.$implicit;m(),p(e.updateTime?1:-1),m(),p(e.clearInfo!=null&&e.clearInfo.clearedBy?2:-1)}}function Aa(t,n){t&1&&(o(0,"th",35),r(1,"Violations"),l())}function Ta(t,n){if(t&1&&(r(0),v(1,"number"),v(2,"number")),t&2){let e=c().$implicit;O(" ",x(1,2,e.violations)," (",xt(2,4,e.violations/e.count*100,"1.2-2"),"%) ")}}function ba(t,n){t&1&&r(0," - ")}function wa(t,n){if(t&1&&(o(0,"td",36),d(1,Ta,3,7)(2,ba,1,0),l()),t&2){let e=n.$implicit;m(),p(e.violations?1:2)}}function Da(t,n){t&1&&u(0,"th",37)}function Ia(t,n){if(t&1){let e=D();o(0,"ya-text-action",40),A("click",function(){h(e);let a=c().$implicit,s=c(2);return g(s.showChart(a))}),r(1," Show chart "),l()}}function Ea(t,n){if(t&1){let e=D();o(0,"ya-text-action",41),A("click",function(){h(e);let a=c().$implicit,s=c(2);return g(s.showData(a))}),r(1," Show data "),l()}}function ka(t,n){if(t&1&&(o(0,"td",29),d(1,Ia,2,0,"ya-text-action",38),d(2,Ea,2,0,"ya-text-action",39),l()),t&2){let e=n.$implicit;m(),p(e.parameterDetail?1:-1),m(),p(e.parameterDetail?2:-1)}}function Ma(t,n){t&1&&u(0,"tr",42)}function Va(t,n){t&1&&u(0,"tr",43)}function Oa(t,n){if(t&1&&(o(0,"table",4),S(1,11),f(2,qn,2,0,"th",12)(3,jn,2,2,"td",13),y(),S(4,14),f(5,Wn,2,0,"th",12)(6,Jn,5,5,"td",13),y(),S(7,15),f(8,Qn,2,0,"th",12)(9,Xn,3,3,"td",13),y(),S(10,16),f(11,Zn,2,0,"th",12)(12,ea,3,3,"td",13),y(),S(13,17),f(14,ta,2,0,"th",12)(15,la,3,2,"td",18),y(),S(16,19),f(17,ra,2,0,"th",12)(18,va,4,3,"td",13),y(),S(19,20),f(20,ha,2,0,"th",12)(21,ya,3,2,"td",13),y(),S(22,21),f(23,Aa,2,0,"th",22)(24,wa,3,1,"td",23),y(),S(25,24),f(26,Da,1,0,"th",25)(27,ka,3,2,"td",13),y(),f(28,Ma,1,0,"tr",26)(29,Va,1,0,"tr",27),l()),t&2){let e=c();_("dataSource",e.dataSource),m(28),_("matHeaderRowDef",e.displayedColumns),m(),_("matRowDefColumns",e.displayedColumns)}}var Ee=class Ee extends ${constructor(e){super();this.route=e;this.filterForm=new $e({interval:new te("NO_LIMIT"),customStart:new te(null),customStop:new te(null)});this.displayedColumns=["severity","start","stop","duration","alarm","type","triggerValue","violations","actions"];this.intervalOptions=[{id:"PT1H",label:"Last hour"},{id:"PT6H",label:"Last 6 hours"},{id:"P1D",label:"Last 24 hours"},{id:"NO_LIMIT",label:"No limit"},{id:"CUSTOM",label:"Custom",group:!0}];this.dataSource=new ze;this.setTitle("Alarm history"),this.initializeOptions(),this.loadData(),this.filterForm.get("interval").valueChanges.forEach(i=>{if(i==="CUSTOM"){let a=new Date,s=this.validStart||a,T=this.validStop||a;this.filterForm.get("customStart").setValue(b.toISOString(s)),this.filterForm.get("customStop").setValue(b.toISOString(T))}else i==="NO_LIMIT"?(this.validStart=null,this.validStop=null,this.appliedInterval=i,this.loadData()):(this.validStop=new Date,this.validStart=b.subtractDuration(this.validStop,i),this.appliedInterval=i,this.loadData())})}initializeOptions(){let e=this.route.snapshot.queryParamMap;if(e.has("interval"))if(this.appliedInterval=e.get("interval"),this.filterForm.get("interval").setValue(this.appliedInterval),this.appliedInterval==="CUSTOM"){let i=e.get("customStart");this.filterForm.get("customStart").setValue(i),this.validStart=b.toDate(i);let a=e.get("customStop");this.filterForm.get("customStop").setValue(a),this.validStop=b.toDate(a)}else this.appliedInterval==="NO_LIMIT"?(this.validStart=null,this.validStop=null):(this.validStop=new Date,this.validStart=b.subtractDuration(this.validStop,this.appliedInterval));else this.appliedInterval="NO_LIMIT",this.validStop=null,this.validStart=null}jumpToNow(){this.filterForm.get("interval").setValue("NO_LIMIT")}applyCustomDates(){this.validStart=b.toDate(this.filterForm.value.customStart),this.validStop=b.toDate(this.filterForm.value.customStop),this.appliedInterval="CUSTOM",this.loadData()}loadData(e){this.updateURL();let i={};this.validStart&&(i.start=this.validStart.toISOString()),this.validStop&&(i.stop=this.validStop.toISOString()),this.yamcs.yamcsClient.getAlarms(this.yamcs.instance,i).then(a=>this.dataSource.data=a).catch(a=>this.messageService.showError(a))}updateURL(){this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{interval:this.appliedInterval,customStart:this.appliedInterval==="CUSTOM"?this.filterForm.value.customStart:null,customStop:this.appliedInterval==="CUSTOM"?this.filterForm.value.customStop:null},queryParamsHandling:"merge"})}durationFor(e){if(e.updateTime)return b.toDate(e.updateTime).getTime()-b.toDate(e.triggerTime).getTime()}showChart(e){let i=e.triggerTime,a=e.updateTime||e.clearInfo?.clearTime,s,T;a?(s=i,T=a):(s=i,T=ct(b.toDate(i),1).toISOString()),this.router.navigate(["/telemetry/parameters"+e.parameterDetail?.triggerValue.id.name,"-","chart"],{queryParams:{c:this.yamcs.context,interval:"CUSTOM",customStart:s,customStop:T}})}showData(e){let i=e.triggerTime,a=e.updateTime||e.clearInfo?.clearTime,s,T;a?(s=i,T=a):(s=i,T=ct(b.toDate(i),1).toISOString()),this.router.navigate(["/telemetry/parameters"+e.parameterDetail?.triggerValue.id.name,"-","data"],{queryParams:{c:this.yamcs.context,interval:"CUSTOM",customStart:s,customStop:T}})}};Ee.\u0275fac=function(i){return new(i||Ee)(w(oe))},Ee.\u0275cmp=I({type:Ee,selectors:[["ng-component"]],features:[V],decls:13,vars:6,consts:[["label","Alarms"],[1,"table-wrapper"],[2,"margin-top","16px",3,"formGroup"],["icon","access_time","formControlName","interval",3,"options"],["mat-table","",1,"ya-data-table","expand",3,"dataSource"],["appearance","bottom","align","center"],[3,"disabled"],["formControlName","customStart"],["formControlName","customStop"],[3,"click","disabled"],[3,"click"],["matColumnDef","severity"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","type"],["matColumnDef","start"],["matColumnDef","stop"],["matColumnDef","triggerValue"],["mat-cell","","class","wrap200",4,"matCellDef"],["matColumnDef","alarm"],["matColumnDef","duration"],["matColumnDef","violations"],["mat-header-cell","","style","text-align: right",4,"matHeaderCellDef"],["mat-cell","","style","text-align: right",4,"matCellDef"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],[3,"level","grayscale"],[2,"vertical-align","middle"],["mat-cell","",1,"wrap200"],[3,"routerLink","queryParams"],[3,"matTooltip"],["mat-header-cell","",2,"text-align","right"],["mat-cell","",2,"text-align","right"],["mat-header-cell","",1,"expand"],["icon","show_chart"],["icon","view_headline"],["icon","show_chart",3,"click"],["icon","view_headline",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(i,a){i&1&&(o(0,"ya-instance-page"),u(1,"ya-instance-toolbar",0),o(2,"div",1)(3,"ya-panel"),u(4,"app-alarms-page-tabs"),o(5,"ya-filter-bar",2),u(6,"ya-select",3),d(7,Gn,4,1),d(8,Un,2,0,"ya-button"),l(),d(9,Oa,30,3,"table",4),o(10,"ya-toolbar",5)(11,"ya-button",6),r(12,"Load more"),l()()()()()),i&2&&(m(5),_("formGroup",a.filterForm),m(),_("options",a.intervalOptions),m(),p(a.filterForm.value.interval==="CUSTOM"?7:-1),m(),p(a.filterForm.value.interval!=="CUSTOM"?8:-1),m(),p(a.dataSource?9:-1),m(2),_("disabled",!0))},dependencies:[ge,R,E,L,N,P,F,j,W,re,ce,_e,se,me,ue,de,pe,Ce,fe,le,H,Ke,ve,K,Q,X,Z,Pt,Qe,ae,Pe,J,Ht,he],encapsulation:2,changeDetection:0});var rt=Ee;var ke=class ke extends ${constructor(){super();this.detailAlarm$=new Y(null);this.selection=new Xe((e,i)=>`${i.triggerTime}__${i.id.namespace}__${i.id.name}__${i.seqNum}`,!1,[]);this.setTitle("Pending alarms"),this.dataSource=new we(this.yamcs,!0),this.dataSource.loadAlarms(),this.alarmsSubscription=this.dataSource.alarms$.subscribe(e=>{this.selection.matchNewValues(e);let i=this.detailAlarm$.value;if(i){for(let a of e)if(this.isSameAlarm(a,i)){this.detailAlarm$.next(a);break}}})}isSameAlarm(e,i){return e.seqNum===i.seqNum&&e.id.namespace===i.id.namespace&&e.id.name===i.id.name&&e.triggerTime===i.triggerTime}mayControlAlarms(){return this.authService.getUser().hasSystemPrivilege("ControlAlarms")}ngOnDestroy(){this.alarmsSubscription?.unsubscribe()}};ke.\u0275fac=function(i){return new(i||ke)},ke.\u0275cmp=I({type:ke,selectors:[["ng-component"]],features:[V],decls:7,vars:3,consts:[["label","Alarms"],[1,"table-wrapper"],[2,"margin-top","16px"],["view","pending",3,"dataSource","selection","mayControl"]],template:function(i,a){i&1&&(o(0,"ya-instance-page"),u(1,"ya-instance-toolbar",0),o(2,"div",1)(3,"ya-panel"),u(4,"app-alarms-page-tabs")(5,"div",2)(6,"app-alarms-table",3),l()()()),i&2&&(m(6),_("dataSource",a.dataSource)("selection",a.selection)("mayControl",a.mayControlAlarms()))},dependencies:[R,be,E,K,Q,X],encapsulation:2,changeDetection:0});var mt=ke;var wl=[{path:"",canActivate:[qt,Ut],canActivateChild:[jt],runGuardsAndResolvers:"always",component:Wt,children:[{path:"",pathMatch:"full",component:lt},{path:"pending",component:mt},{path:"history",component:rt},{path:"log",component:et}]}];export{wl as ROUTES};
