import{a as Xo,b as ea,c as ta,d as ia,i as na,j as aa,k as ra}from"./chunk-TUNGK4K7.js";import{a as oa}from"./chunk-QKCIWDFA.js";import"./chunk-6X2UVTWO.js";import{a as De}from"./chunk-N6L73CWM.js";import{a as Wo,b as Ko}from"./chunk-7SRE5ACE.js";import{f as Zo}from"./chunk-LWQLZ5XB.js";import{a as Ni}from"./chunk-WGTQMYTO.js";import"./chunk-GVFSCYYF.js";import{a as _n,b as Jo}from"./chunk-L67MW52F.js";import{$ as si,$a as $n,$b as ao,A as li,Aa as M,Ac as fo,Ag as Ao,B as Rn,Bc as Ci,Bf as K,Bg as Po,C as tt,Ca as S,Cb as X,Cc as he,Cf as Do,Cg as Ri,D as H,De as go,Dg as de,Dh as Go,Ea as m,Eb as jn,Ee as bi,F as b,Fa as Ge,Fc as ge,Ff as Ve,Fg as Li,Fh as E,G as T,Ga as We,Gb as ue,Gh as Cn,Ha as ve,Hb as Un,Hg as Qe,Hh as fn,Ia as j,Ib as _e,If as R,Ja as F,Jb as Ce,Je as Ti,Jf as xt,K as pe,Ka as V,Kb as _i,Ke as yt,Kf as $,L as Ln,Lf as St,Lg as Oo,M as An,Me as vt,N as Pn,Na as L,Ng as Ai,O as cn,Oa as Pe,Og as No,P as ti,Pa as k,Pb as Gn,Pc as fi,Q as ii,Qa as ci,Qb as Wn,Qg as Ho,Ra as s,Rb as Kn,Rc as Se,Rf as Te,Rg as Fo,Sa as I,Sb as Jn,Sc as hi,Se as Ne,Sf as wo,Ta as D,Tb as Zn,Tc as gi,Tf as Eo,Ua as ot,Ub as Xn,Uc as Oe,Uf as Mo,Ug as Vo,V as l,Vb as eo,Vf as Io,Vg as Mt,W as it,Wa as Vn,Wb as to,Wc as ct,We as He,Wf as ko,Wg as $o,X as On,Xa as dn,Xb as io,Xc as dt,Xe as Di,Y as f,Ya as di,Yb as no,Yc as yi,Ye as te,Yf as Ii,Yg as Qo,Z as Nn,Za as Y,Zb as oo,Ze as ie,Zg as Pi,_ as w,_a as Ie,_e as ne,_g as Oi,a as sn,aa as Le,ac as ro,af as oe,b as mn,ba as mi,bb as h,bc as un,bf as ae,bg as bt,c as wn,ca as je,cb as v,cc as lo,cd as ho,cg as $e,da as C,db as ni,dd as vi,df as re,e as ri,ea as Hn,eb as pi,ef as le,eg as Ro,f as N,fa as nt,fc as so,ga as Fn,gb as ui,gf as se,gg as Tt,gh as Bo,h as En,hc as mo,hf as me,ib as U,ic as co,ig as ki,ja as Ae,jc as po,jf as ce,k as Mn,ka as u,kb as at,kf as be,kg as J,la as Me,lb as rt,lf as Fe,lg as Dt,lh as qo,ma as _,mb as Qn,mf as yo,mg as ye,n as In,na as B,ne as pt,nf as vo,oa as P,ob as Bn,oc as uo,oe as xi,og as wt,pa as O,pe as ut,pf as ke,pg as Z,qa as c,qc as lt,qe as _t,ra as o,rb as pn,rc as _o,re as Ct,rf as wi,rg as Lo,s as ze,sa as r,sb as G,sc as W,se as ft,sf as xo,sh as Yo,t as kn,ta as p,tc as fe,te as ht,tf as So,th as zo,u as Re,uc as st,ue as gt,uf as Ei,vc as Co,ve as Si,vf as Mi,wc as ee,xa as g,xb as qn,xc as xe,xh as jo,ya as y,yb as Yn,yc as mt,yf as bo,yg as Et,z as et,za as Ue,zb as zn,zf as To,zh as Uo}from"./chunk-OXOWQRWE.js";var la=(t,i)=>H(hn).canActivate(t,i);var Ke=class Ke{constructor(i,e){this.authService=i;this.router=e}canActivate(i,e){return this.authService.getUser().hasSystemPrivilege("ControlCommandQueue")?!0:(this.router.navigate(["/403"],{queryParams:{page:e.url}}),!1)}canActivateChild(i,e){return this.canActivate(i,e)}};Ke.\u0275fac=function(e){return new(e||Ke)(tt(St),tt(_e))},Ke.\u0275prov=et({token:Ke,factory:Ke.\u0275fac,providedIn:"root"});var hn=Ke;var ya=["*"],va=()=>({matrixParams:"exact",paths:"exact",queryParams:"ignored"}),sa=t=>({c:t}),It=class It{constructor(i){this.yamcs=i}};It.\u0275fac=function(e){return new(e||It)(f($))},It.\u0275cmp=w({type:It,selectors:[["app-clearances-page-tabs"]],ngContentSelectors:ya,decls:9,vars:12,consts:[["rla","routerLinkActive"],["rlb","routerLinkActive"],["routerLink","/commanding/clearances","routerLinkActive","",3,"routerLinkActiveOptions","queryParams"],["routerLink","/commanding/clearances/log","routerLinkActive","",3,"queryParams"],["actions",""]],template:function(e,n){if(e&1&&(Ge(),o(0,"ya-page-tabs")(1,"a",2,0),s(3," Clearances "),r(),o(4,"a",3,1),s(6," Action log "),r(),g(7,4),We(8),y(),r()),e&2){let a=L(2),d=L(5);l(),k("active",a.isActive),c("routerLinkActiveOptions",di(7,va))("queryParams",Y(8,sa,n.yamcs.context)),l(3),k("active",d.isActive),c("queryParams",Y(10,sa,n.yamcs.context))}},dependencies:[E,Ce,_i,Ri],styles:[".mat-mdc-tab-link[_ngcontent-%COMP%]{height:36px;min-width:0;font-size:13px}"],changeDetection:0});var kt=It;function xa(t,i){if(t&1){let e=M();p(0,"ya-date-time-input",13)(1,"ya-date-time-input",14),o(2,"ya-button",15),S("click",function(){b(e);let a=m();return T(a.applyCustomDates())}),s(3,"Apply"),r()}if(t&2){let e=m();l(2),c("disabled",e.filterForm.invalid)}}function Sa(t,i){if(t&1){let e=M();o(0,"ya-button",16),S("click",function(){b(e);let a=m();return T(a.jumpToNow())}),s(1,"Jump to now"),r()}}function ba(t,i){t&1&&(o(0,"th",17),s(1,"Time"),r())}function Ta(t,i){if(t&1&&(o(0,"td",18),s(1),h(2,"datetime"),r()),t&2){let e=i.$implicit;l(),I(v(2,1,e.time))}}function Da(t,i){t&1&&(o(0,"th",17),s(1,"User"),r())}function wa(t,i){if(t&1&&(o(0,"td",18),s(1),r()),t&2){let e=i.$implicit;l(),I(e.user||"-")}}function Ea(t,i){t&1&&(o(0,"th",17),s(1,"Action"),r())}function Ma(t,i){if(t&1&&(o(0,"td",18),p(1,"ya-action-log-summary",19),r()),t&2){let e=i.$implicit;l(),c("text",e.summary)}}function Ia(t,i){t&1&&p(0,"th",20)}function ka(t,i){t&1&&p(0,"td",18)}function Ra(t,i){t&1&&p(0,"tr",21)}function La(t,i){t&1&&p(0,"tr",22)}var Rt=class Rt{constructor(i,e,n,a,d){this.yamcs=i;this.messageService=e;this.router=n;this.route=a;this.interval=U();this.customStart=U();this.customStop=U();this.filterForm=new st({interval:new ee("NO_LIMIT"),customStart:new ee(null),customStop:new ee(null)});this.displayedColumns=["time","user","summary","actions"];this.intervalOptions=[{id:"PT1H",label:"Last hour"},{id:"PT6H",label:"Last 6 hours"},{id:"P1D",label:"Last 24 hours"},{id:"NO_LIMIT",label:"No limit"},{id:"CUSTOM",label:"Custom",group:!0}];this.dataSource=new be;d.setTitle("Clearances")}ngOnInit(){this.initializeOptions(),this.loadData(),this.filterForm.get("interval").valueChanges.forEach(i=>{if(i==="CUSTOM"){let e=new Date,n=this.validStart||e,a=this.validStop||e;this.filterForm.get("customStart").setValue(R.toISOString(n)),this.filterForm.get("customStop").setValue(R.toISOString(a))}else i==="NO_LIMIT"?(this.validStart=null,this.validStop=null,this.appliedInterval=i,this.loadData()):i&&(this.validStop=new Date,this.validStart=R.subtractDuration(this.validStop,i),this.appliedInterval=i,this.loadData())})}initializeOptions(){if(this.interval())if(this.appliedInterval=this.interval(),this.filterForm.get("interval").setValue(this.appliedInterval),this.appliedInterval==="CUSTOM"){let i=this.customStart();this.filterForm.get("customStart").setValue(i),this.validStart=R.toDate(i);let e=this.customStop();this.filterForm.get("customStop").setValue(e),this.validStop=R.toDate(e)}else this.appliedInterval==="NO_LIMIT"?(this.validStart=null,this.validStop=null):(this.validStop=new Date,this.validStart=R.subtractDuration(this.validStop,this.appliedInterval));else this.appliedInterval="NO_LIMIT",this.validStop=null,this.validStart=null}jumpToNow(){this.filterForm.get("interval").setValue("NO_LIMIT")}applyCustomDates(){let{controls:i}=this.filterForm;this.validStart=R.toDate(i.customStart.value),this.validStop=R.toDate(i.customStop.value),this.appliedInterval="CUSTOM",this.loadData()}loadData(){this.updateURL();let i={service:"ClearanceApi"};this.validStart&&(i.start=this.validStart.toISOString()),this.validStop&&(i.stop=this.validStop.toISOString()),this.yamcs.yamcsClient.getAuditRecords("_global",i).then(e=>this.dataSource.data=e.records||[]).catch(e=>this.messageService.showError(e))}updateURL(){let{controls:i}=this.filterForm;this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{interval:this.appliedInterval,customStart:this.appliedInterval==="CUSTOM"?i.customStart.value:null,customStop:this.appliedInterval==="CUSTOM"?i.customStop.value:null},queryParamsHandling:"merge"})}};Rt.\u0275fac=function(e){return new(e||Rt)(f($),f(Fe),f(_e),f(ue),f(X))},Rt.\u0275cmp=w({type:Rt,selectors:[["app-clearances-action-log-tab"]],inputs:{interval:[1,"interval"],customStart:[1,"customStart"],customStop:[1,"customStop"]},decls:23,vars:6,consts:[["label","Clearances"],[2,"margin-top","16px",3,"formGroup"],["icon","access_time","formControlName","interval",3,"options"],["mat-table","",1,"ya-data-table","expand",3,"dataSource"],["matColumnDef","time"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","user"],["matColumnDef","summary"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["formControlName","customStart"],["formControlName","customStop"],[3,"click","disabled"],[3,"click"],["mat-header-cell",""],["mat-cell",""],[3,"text"],["mat-header-cell","",1,"expand"],["mat-header-row",""],["mat-row",""]],template:function(e,n){e&1&&(o(0,"ya-instance-page"),p(1,"ya-instance-toolbar",0),o(2,"ya-panel"),p(3,"app-clearances-page-tabs"),o(4,"ya-filter-bar",1),p(5,"ya-select",2),u(6,xa,4,1)(7,Sa,2,0,"ya-button"),r(),o(8,"table",3),g(9,4),C(10,ba,2,0,"th",5)(11,Ta,3,3,"td",6),y(),g(12,7),C(13,Da,2,0,"th",5)(14,wa,2,1,"td",6),y(),g(15,8),C(16,Ea,2,0,"th",5)(17,Ma,2,1,"td",6),y(),g(18,9),C(19,Ia,1,0,"th",10)(20,ka,1,0,"td",6),y(),C(21,Ra,1,0,"tr",11)(22,La,1,0,"tr",12),r()()()),e&2&&(l(4),c("formGroup",n.filterForm),l(),c("options",n.intervalOptions),l(),_(n.filterForm.value.interval==="CUSTOM"?6:7),l(2),c("dataSource",n.dataSource),l(13),c("matHeaderRowDef",n.displayedColumns),l(),c("matRowDefColumns",n.displayedColumns))},dependencies:[kt,E,W,fe,he,ge,te,ne,le,oe,ie,se,ae,re,me,ce,wi,K,Te,$e,J,Z,de,Qe,ye],encapsulation:2,changeDetection:0});var Hi=Rt;var ma=(t,i)=>H(gn).canActivate(t,i);var Ze=class Ze{constructor(i,e){this.router=e;this.config=i.getConfig()}canActivate(i,e){return this.config.commandClearanceEnabled}canActivateChild(i,e){return this.canActivate(i,e)}};Ze.\u0275fac=function(e){return new(e||Ze)(tt(xt),tt(_e))},Ze.\u0275prov=et({token:Ze,factory:Ze.\u0275fac,providedIn:"root"});var gn=Ze;var Pt=class Pt{constructor(i,e,n){this.dialogRef=i;this.data=n;if(this.form=e.group({level:new xe(null,[lt.required])}),n.clearance){let a=n.clearance;this.form.setValue({level:a.level||"DISABLED"})}}confirm(){this.dialogRef.close({level:this.form.value.level==="DISABLED"?void 0:this.form.value.level})}};Pt.\u0275fac=function(e){return new(e||Pt)(f(pt),f(fi),f(xi))},Pt.\u0275cmp=w({type:Pt,selectors:[["app-change-level-dialog"]],decls:32,vars:22,consts:[["mat-dialog-title",""],[1,"ya-form",3,"formGroup"],[1,"radio-group"],[1,"radio"],["type","radio","formControlName","level","value","DISABLED"],["type","radio","formControlName","level","value","NONE"],["level","NONE",3,"grayscale"],["type","radio","formControlName","level","value","WATCH"],["level","WATCH",3,"grayscale"],["type","radio","formControlName","level","value","WARNING"],["level","WARNING",3,"grayscale"],["type","radio","formControlName","level","value","DISTRESS"],["level","DISTRESS",3,"grayscale"],["type","radio","formControlName","level","value","CRITICAL"],["level","CRITICAL",3,"grayscale"],["type","radio","formControlName","level","value","SEVERE"],["level","SEVERE",3,"grayscale"],["align","end"],["mat-dialog-close",""],["appearance","primary",3,"click","disabled"]],template:function(e,n){e&1&&(o(0,"h2",0),s(1,"Command clearance"),r(),o(2,"mat-dialog-content")(3,"form",1)(4,"ya-field")(5,"div",2)(6,"label",3),p(7,"input",4),s(8," No clearance "),r(),o(9,"label",3),p(10,"input",5)(11,"app-significance-level",6),r(),o(12,"label",3),p(13,"input",7)(14,"app-significance-level",8),r(),o(15,"label",3),p(16,"input",9)(17,"app-significance-level",10),r(),o(18,"label",3),p(19,"input",11)(20,"app-significance-level",12),r(),o(21,"label",3),p(22,"input",13)(23,"app-significance-level",14),r(),o(24,"label",3),p(25,"input",15)(26,"app-significance-level",16),r()()()()(),o(27,"mat-dialog-actions",17)(28,"ya-button",18),s(29,"CANCEL"),r(),o(30,"ya-button",19),S("click",function(){return n.confirm()}),s(31," SAVE CHANGES "),r()()),e&2&&(l(3),c("formGroup",n.form),l(3),k("checked",n.form.value.level==="DISABLED"),l(3),k("checked",n.form.value.level==="NONE"),l(2),c("grayscale",!0),l(),k("checked",n.form.value.level==="WATCH"),l(2),c("grayscale",!0),l(),k("checked",n.form.value.level==="WARNING"),l(2),c("grayscale",!0),l(),k("checked",n.form.value.level==="DISTRESS"),l(2),c("grayscale",!0),l(),k("checked",n.form.value.level==="CRITICAL"),l(2),c("grayscale",!0),l(),k("checked",n.form.value.level==="SEVERE"),l(2),c("grayscale",!0),l(4),c("disabled",!n.form.valid))},dependencies:[E,mt,uo,fo,W,fe,he,ge,_t,Ct,ht,ft,K,bt,De],styles:["[_ngcontent-%COMP%]:focus{outline:none}"]});var Fi=Pt;function Oa(t,i){t&1&&(s(0," Clearances "),o(1,"ya-help")(2,"p"),s(3," Clearances allow central control over the level of commands that users are able to send. "),r(),o(4,"p"),s(5," Clearance works in addition to regular permission checks. So if a user does anyway not have authorization to send certain commands, giving this user clearance will not change this fact. "),r()())}function Na(t,i){if(t&1){let e=M();o(0,"th",19),S("click",function(a){return b(e),L(2).toggle(),T(a.stopPropagation())}),p(1,"ya-table-checkbox",20,0),r()}if(t&2){let e=m(2);l(),c("dataSource",e.dataSource)("selection",e.selection)}}function Ha(t,i){if(t&1){let e=M();o(0,"td",21),S("click",function(a){return b(e),L(2).toggle(),T(a.stopPropagation())}),p(1,"ya-table-checkbox",22,0),r()}if(t&2){let e=i.$implicit,n=m(2);l(),c("dataSource",n.dataSource)("selection",n.selection)("item",e)}}function Fa(t,i){t&1&&(o(0,"th",23),s(1,"Username"),r())}function Va(t,i){if(t&1&&(o(0,"td",24),s(1),r()),t&2){let e=i.$implicit;l(),D(" ",e.username," ")}}function $a(t,i){t&1&&(o(0,"th",23),s(1,"May command"),r())}function Qa(t,i){if(t&1&&(o(0,"td",24),s(1),r()),t&2){let e=i.$implicit;l(),D(" ",e.hasCommandPrivileges?"Yes":"-"," ")}}function Ba(t,i){t&1&&(o(0,"th",23),s(1,"Clearance level"),r())}function qa(t,i){t&1&&s(0," No clearance ")}function Ya(t,i){if(t&1&&p(0,"app-significance-level",25),t&2){let e=m().$implicit;c("level",e.level)("grayscale",!0)}}function za(t,i){if(t&1&&(o(0,"td",24),u(1,qa,1,0)(2,Ya,1,2,"app-significance-level",25),r()),t&2){let e=i.$implicit;l(),_(e.level?2:1)}}function ja(t,i){t&1&&(o(0,"th",23),s(1,"Issued"),r())}function Ua(t,i){if(t&1&&s(0),t&2){let e=m().$implicit;D(" by ",e.issuedBy," ")}}function Ga(t,i){if(t&1&&(o(0,"td",24),s(1),h(2,"datetime"),u(3,Ua,1,1),r()),t&2){let e=i.$implicit;l(),D(" ",v(2,2,e.issueTime)||"-"," "),l(2),_(e.issuedBy?3:-1)}}function Wa(t,i){t&1&&p(0,"th",26)}function Ka(t,i){t&1&&p(0,"td",27)}function Ja(t,i){t&1&&p(0,"tr",28)}function Za(t,i){if(t&1){let e=M();o(0,"tr",29),S("click",function(){let a=b(e).$implicit,d=m(2);return T(d.toggleOne(a))}),r()}if(t&2){let e=i.$implicit,n=m(2);k("selected",n.selection.isSelected(e))}}function Xa(t,i){if(t&1&&(o(0,"table",3),g(1,5),C(2,Na,3,2,"th",6)(3,Ha,3,3,"td",7),y(),g(4,8),C(5,Fa,2,0,"th",9)(6,Va,2,1,"td",10),y(),g(7,11),C(8,$a,2,0,"th",9)(9,Qa,2,1,"td",10),y(),g(10,12),C(11,Ba,2,0,"th",9)(12,za,3,1,"td",10),y(),g(13,13),C(14,ja,2,0,"th",9)(15,Ga,4,4,"td",10),y(),g(16,14),C(17,Wa,1,0,"th",15)(18,Ka,1,0,"td",16),y(),C(19,Ja,1,0,"tr",17)(20,Za,1,2,"tr",18),r()),t&2){let e=m();c("dataSource",e.dataSource),l(19),c("matHeaderRowDef",e.displayedColumns),l(),c("matRowDefColumns",e.displayedColumns)}}var Ot=class Ot{constructor(i,e,n){this.yamcs=i;this.dialog=n;this.displayedColumns=["select","username","hasCommandPrivileges","level","issued","actions"];this.dataSource=new be;this.selection=new Si(!0,[]);e.setTitle("Clearances"),this.refresh()}ngAfterViewInit(){this.dataSource.sort=this.sort,this.dataSource.paginator=this.paginator}toggleOne(i){(!this.selection.isSelected(i)||this.selection.selected.length>1)&&this.selection.clear(),this.selection.toggle(i)}refresh(){this.selection.clear(),this.yamcs.yamcsClient.getClearances().then(i=>{this.dataSource.data=i.clearances||[]})}isGroupChangeLevelEnabled(){return!this.selection.isEmpty()}openChangeLevelDialog(){let i;this.selection.selected.length===1&&(i=this.selection.selected[0]),this.dialog.open(Fi,{data:{clearance:i},width:"400px"}).afterClosed().subscribe(n=>{if(n){let a=[];if(n.level)for(let d of this.selection.selected)a.push(this.yamcs.yamcsClient.changeClearance(d.username,{level:n.level}));else for(let d of this.selection.selected)a.push(this.yamcs.yamcsClient.deleteClearance(d.username));a.length&&Promise.all(a).then(()=>this.refresh())}})}};Ot.\u0275fac=function(e){return new(e||Ot)(f($),f(X),f(ut))},Ot.\u0275cmp=w({type:Ot,selectors:[["ng-component"]],viewQuery:function(e,n){if(e&1&&(j(He,5),j(Ne,5)),e&2){let a;F(a=V())&&(n.sort=a.first),F(a=V())&&(n.paginator=a.first)}},decls:9,vars:5,consts:[["cb",""],["ya-instance-toolbar-label",""],["icon","how_to_reg",3,"clicked","disabled"],["mat-table","","matSort","","matSortActive","username","matSortDirection","asc","matSortDisableClear","",1,"ya-data-table","expand",2,"margin-top","16px",3,"dataSource"],[3,"pageSize","hidePageSize","showFirstLastButtons"],["cdkColumnDef","select"],["mat-header-cell","","class","checkbox",3,"click",4,"cdkHeaderCellDef"],["mat-cell","","class","checkbox",3,"click",4,"cdkCellDef"],["matColumnDef","username"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","hasCommandPrivileges"],["matColumnDef","level"],["matColumnDef","issued"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","","class","expand",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"selected","click",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",1,"checkbox",3,"click"],[3,"dataSource","selection"],["mat-cell","",1,"checkbox",3,"click"],[3,"dataSource","selection","item"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[3,"level","grayscale"],["mat-header-cell",""],["mat-cell","",1,"expand"],["mat-header-row",""],["mat-row","",3,"click"]],template:function(e,n){e&1&&(o(0,"ya-instance-page")(1,"ya-instance-toolbar"),C(2,Oa,6,0,"ng-template",1),o(3,"ya-page-button",2),S("clicked",function(){return n.openChangeLevelDialog()}),s(4," Change level "),r()(),o(5,"ya-panel"),p(6,"app-clearances-page-tabs"),u(7,Xa,21,3,"table",3),p(8,"mat-paginator",4),r()()),e&2&&(l(3),c("disabled",!n.isGroupChangeLevelEnabled()),l(4),_(n.dataSource?7:-1),l(),c("pageSize",100)("hidePageSize",!0)("showFirstLastButtons",!0))},dependencies:[kt,E,Ti,yt,vt,Ne,He,Di,te,ne,le,oe,ie,se,ae,re,me,ce,Tt,J,Z,Dt,wt,de,Ai,De,ye],encapsulation:2,changeDetection:0});var Vi=Ot;var er=(t,i)=>i.name;function tr(t,i){if(t&1&&(o(0,"tr")(1,"td",1),s(2),r(),o(3,"td",2),p(4,"ya-value",3),r()()),t&2){let e=i.$implicit;l(2),I(e.name),l(2),c("value",e.value)}}var Nt=class Nt{constructor(){this.nomargin=!1}};Nt.\u0275fac=function(e){return new(e||Nt)},Nt.\u0275cmp=w({type:Nt,selectors:[["app-command-arguments"]],hostVars:2,hostBindings:function(e,n){e&2&&k("nomargin",n.nomargin)},inputs:{command:"command",nomargin:"nomargin"},decls:3,vars:0,consts:[[1,"args"],["width","1",1,"key"],[1,"value"],[3,"value"]],template:function(e,n){e&1&&(o(0,"table",0),P(1,tr,5,2,"tr",null,er),r()),e&2&&(l(),O(n.command.userAssignments))},dependencies:[E,$o],styles:[".args[_ngcontent-%COMP%]{margin:0 0 0 10px}.args[_ngcontent-%COMP%]   .key[_ngcontent-%COMP%]{min-width:80px;white-space:nowrap;vertical-align:top}.args[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:gray;padding-left:10px}.nomargin[_nghost-%COMP%]   .args[_ngcontent-%COMP%], .nomargin[_nghost-%COMP%]   .args[_ngcontent-%COMP%]   td.key[_ngcontent-%COMP%]:first-child{margin-left:0!important;padding-left:0!important}.nomargin[_nghost-%COMP%]   .args[_ngcontent-%COMP%]{border-spacing:0}"],changeDetection:0});var Ht=Nt;var ir=/yamcs<([^>]+)>_/g,Ft=class Ft{transform(i){if(!i||!i.startsWith("yamcs<"))return i;let e,n=[];for(;e=ir.exec(i);)n.push(e[1]);return n.length?n[n.length-1]:i}};Ft.\u0275fac=function(e){return new(e||Ft)},Ft.\u0275pipe=mi({name:"cascadingPrefix",type:Ft,pure:!0});var $i=Ft;var or=(t,i)=>i.key,ar=(t,i)=>i.name;function rr(t,i){if(t&1){let e=M();s(0," Unprocessed binary "),o(1,"ya-more",12)(2,"button",13),S("click",function(){b(e);let a=m(2);return T(a.copyHex(a.command.unprocessedBinary))}),s(3,"Copy hex"),r(),o(4,"button",13),S("click",function(){b(e);let a=m(2);return T(a.copyBinary(a.command.unprocessedBinary))}),s(5,"Copy binary"),r()()}}function lr(t,i){if(t&1&&(o(0,"ya-attr"),C(1,rr,6,0,"ng-template",10),p(2,"app-hex",11),r()),t&2){let e=m();l(2),c("base64String",e.command.unprocessedBinary)}}function sr(t,i){if(t&1){let e=M();s(0," Binary "),o(1,"ya-more",12)(2,"button",13),S("click",function(){b(e);let a=m(2);return T(a.copyHex(a.command.binary))}),s(3,"Copy hex"),r(),o(4,"button",13),S("click",function(){b(e);let a=m(2);return T(a.copyBinary(a.command.binary))}),s(5,"Copy binary"),r()()}}function mr(t,i){if(t&1&&(o(0,"ya-attr"),C(1,sr,6,0,"ng-template",10),p(2,"app-hex",11),r()),t&2){let e=m();l(2),c("base64String",e.command.binary)}}function cr(t,i){if(t&1&&s(0),t&2){let e=m();ot(" ",e.command.username,"@",e.command.origin," ")}}function dr(t,i){if(t&1&&s(0),t&2){let e=m();D(" ",e.command.username," ")}}function pr(t,i){if(t&1&&(o(0,"ya-attr",5),s(1),r()),t&2){let e=m();l(),D(" ",e.command.queue||"-"," ")}}function ur(t,i){if(t&1&&(p(0,"ya-attr-divider"),o(1,"ya-attr",14),s(2),r()),t&2){let e=m();l(2),D(" ",e.command.comment," ")}}function _r(t,i){if(t&1){let e=M();o(0,"ya-more",12)(1,"button",13),S("click",function(){b(e);let a=m(2).$implicit,d=m(2);return T(d.copyHex(a.value.binaryValue))}),s(2,"Copy hex"),r(),o(3,"button",13),S("click",function(){b(e);let a=m(2).$implicit,d=m(2);return T(d.copyBinary(a.value.binaryValue))}),s(4," Copy binary "),r()()}}function Cr(t,i){if(t&1&&(s(0),u(1,_r,5,0,"ya-more",12)),t&2){let e=m().$implicit;D(" ",e.name," "),l(),_(e.value.type==="BINARY"?1:-1)}}function fr(t,i){if(t&1&&p(0,"app-hex",11),t&2){let e=m().$implicit;c("base64String",e.value.binaryValue)}}function hr(t,i){if(t&1&&(s(0),h(1,"value")),t&2){let e=m().$implicit;D(" ",v(1,1,e.value)," ")}}function gr(t,i){if(t&1&&(o(0,"ya-attr"),C(1,Cr,2,2,"ng-template",10),u(2,fr,1,1,"app-hex",11)(3,hr,2,3),r()),t&2){let e,n=i.$implicit;l(2),_((e=n.value.type)==="BINARY"?2:3)}}function yr(t,i){if(t&1&&(p(0,"ya-attr-divider"),P(1,gr,4,1,"ya-attr",null,ar)),t&2){let e=m();l(),O(e.command.extra)}}function vr(t,i){if(t&1&&(o(0,"ya-attr",8),p(1,"app-extra-acknowledgments-table",7),r()),t&2){let e=m();l(),c("command",e.command)("showIcons",e.showIcons)}}function xr(t,i){if(t&1){let e=M();o(0,"ya-more",12)(1,"button",13),S("click",function(){b(e);let a=m(2),d=m();return T(d.copyHex(a.binaryValue))}),s(2,"Copy hex"),r(),o(3,"button",13),S("click",function(){b(e);let a=m(2),d=m();return T(d.copyBinary(a.binaryValue))}),s(4,"Copy binary"),r()()}}function Sr(t,i){if(t&1&&(s(0," Return value "),u(1,xr,5,0,"ya-more",12)),t&2){let e=m();l(),_(e.type==="BINARY"?1:-1)}}function br(t,i){if(t&1&&p(0,"app-hex",11),t&2){let e=m();c("base64String",e.binaryValue)}}function Tr(t,i){if(t&1&&(o(0,"pre",15),s(1),r()),t&2){let e=m();l(),I(e.stringValue)}}function Dr(t,i){if(t&1&&(s(0),h(1,"value")),t&2){let e=m();D(" ",v(1,1,e)," ")}}function wr(t,i){if(t&1&&(p(0,"ya-attr-divider"),o(1,"ya-attr"),C(2,Sr,2,1,"ng-template",10),u(3,br,1,1,"app-hex",11)(4,Tr,2,1,"pre",15)(5,Dr,2,3),r()),t&2){let e;l(3),_((e=i.type)==="BINARY"?3:e==="STRING"?4:5)}}function Er(t,i){t&1&&s(0," SUCCESS ")}function Mr(t,i){if(t&1&&s(0),t&2){let e=m();D(" FAILURE: ",e.command.completed==null?null:e.command.completed.message," ")}}function Ir(t,i){t&1&&s(0," - ")}function kr(t,i){if(t&1&&(s(0),h(1,"cascadingPrefix")),t&2){let e=m().$implicit;D("",v(1,1,e.key)," acknowledgments")}}function Rr(t,i){if(t&1&&(s(0),h(1,"cascadingPrefix")),t&2){let e=m(2).$implicit;D(" ",v(1,1,e.key)," extra acknowledgments ")}}function Lr(t,i){if(t&1&&(o(0,"ya-attr"),C(1,Rr,2,3,"ng-template",10),p(2,"app-extra-acknowledgments-table",7),r()),t&2){let e=m().$implicit,n=m();l(2),c("command",e.value)("showIcons",n.showIcons)}}function Ar(t,i){if(t&1&&(s(0),h(1,"cascadingPrefix")),t&2){let e=m().$implicit;D("",v(1,1,e.key)," completion")}}function Pr(t,i){t&1&&s(0," SUCCESS ")}function Or(t,i){if(t&1&&s(0),t&2){let e=m().$implicit;D(" FAILURE: ",e.value.completed==null?null:e.value.completed.message," ")}}function Nr(t,i){t&1&&s(0," - ")}function Hr(t,i){if(t&1&&(p(0,"ya-attr-divider"),o(1,"ya-attr"),C(2,kr,2,3,"ng-template",10),p(3,"app-yamcs-acknowledgments-table",7),r(),u(4,Lr,3,2,"ya-attr"),o(5,"ya-attr"),C(6,Ar,2,3,"ng-template",10),u(7,Pr,1,0)(8,Or,1,1)(9,Nr,1,0),r()),t&2){let e=i.$implicit,n=m();l(3),c("command",e.value)("showIcons",n.showIcons),l(),_(e.value.extraAcks.length?4:-1),l(3),_((e.value.completed==null?null:e.value.completed.status)==="OK"?7:(e.value.completed==null?null:e.value.completed.status)==="NOK"?8:9)}}var Vt=class Vt{constructor(i){this.clipboard=i;this.showIcons=!0}copyHex(i){let e=R.convertBase64ToHex(i);this.clipboard.copy(e)}copyBinary(i){let e=window.atob(i);this.clipboard.copy(e)}};Vt.\u0275fac=function(e){return new(e||Vt)(f(bi))},Vt.\u0275cmp=w({type:Vt,selectors:[["app-command-detail2"]],hostVars:2,hostBindings:function(e,n){e&2&&Pe("display","block")},inputs:{command:"command",showIcons:"showIcons"},decls:30,vars:19,consts:[["label","ID"],["label","Command"],[3,"command"],["label","Time"],["label","Issuer"],["label","Queue"],["label","Yamcs acknowledgments"],[3,"command","showIcons"],["label","Extra acknowledgments"],["label","Completion"],["ya-attr-label",""],[3,"base64String"],["icon","more_horiz","yaPrintZoneHide",""],["mat-menu-item","",3,"click"],["label","Comment"],[2,"margin","0","line-height","1em"]],template:function(e,n){if(e&1&&(o(0,"ya-attr-list")(1,"ya-attr",0),s(2),r(),o(3,"ya-attr",1),s(4),p(5,"app-command-arguments",2),r(),u(6,lr,3,1,"ya-attr"),u(7,mr,3,1,"ya-attr"),p(8,"ya-attr-divider"),o(9,"ya-attr",3),s(10),h(11,"datetime"),r(),o(12,"ya-attr",4),u(13,cr,1,2)(14,dr,1,1),r(),u(15,pr,2,1,"ya-attr",5),u(16,ur,3,1),u(17,yr,3,0),p(18,"ya-attr-divider"),o(19,"ya-attr",6),p(20,"app-yamcs-acknowledgments-table",7),r(),u(21,vr,2,2,"ya-attr",8),u(22,wr,6,1),o(23,"ya-attr",9),u(24,Er,1,0)(25,Mr,1,1)(26,Ir,1,0),r(),P(27,Hr,10,4,null,null,or),h(29,"keyvalue"),r()),e&2){let a;l(2),D(" ",n.command.id," "),l(2),D(" ",n.command.commandName," "),l(),c("command",n.command),l(),_(n.command.unprocessedBinary&&n.command.unprocessedBinary!==n.command.binary?6:-1),l(),_(n.command.binary?7:-1),l(3),D(" ",v(11,15,n.command.generationTime)," "),l(3),_(n.command.origin?13:14),l(2),_(n.command.queue?15:-1),l(),_(n.command.comment?16:-1),l(),_(n.command.extra.length?17:-1),l(3),c("command",n.command)("showIcons",n.showIcons),l(),_(n.command.extraAcks.length?21:-1),l(),_((a=n.command.completed==null?null:n.command.completed.returnValue)?22:-1,a),l(2),_((n.command.completed==null?null:n.command.completed.status)==="OK"?24:(n.command.completed==null?null:n.command.completed.status)==="NOK"?25:26),l(3),O(v(29,17,n.command.cascadedRecordsByPrefix))}},dependencies:[Ht,ea,Ni,E,So,jo,Oe,Mi,xo,Ei,Et,ia,$i,qn,ye,Mt],encapsulation:2,changeDetection:0});var Ee=Vt;function Fr(t,i){if(t&1&&p(0,"app-command-detail2",0),t&2){let e=i.$implicit;c("command",e)("showIcons",!1)}}var $t=class $t{};$t.\u0275fac=function(e){return new(e||$t)},$t.\u0275cmp=w({type:$t,selectors:[["app-command-history-printable"]],inputs:{pageTitle:"pageTitle",data:"data"},decls:2,vars:0,consts:[[2,"page-break-after","always","page-break-inside","avoid",3,"command","showIcons"]],template:function(e,n){e&1&&P(0,Fr,1,2,"app-command-detail2",0,B),e&2&&O(n.data)},dependencies:[Ee,E],encapsulation:2,changeDetection:0});var Qi=$t;var Qt=class Qt{constructor(i,e,n){this.dialogRef=i;this.yamcs=e;this.data=n;this.delimiterOptions=[{id:"COMMA",label:"Comma"},{id:"SEMICOLON",label:"Semicolon"},{id:"TAB",label:"Tab"}];this.downloadURL$=new N(null);this.form=new Co({start:new xe(null),stop:new xe(null),delimiter:new xe(null,lt.required)});this.form.setValue({start:n.start?R.toISOString(n.start):"",stop:n.stop?R.toISOString(n.stop):"",delimiter:"TAB"}),this.formChangeSubscription=this.form.valueChanges.subscribe(()=>{this.updateURL()}),this.updateURL()}closeDialog(){this.dialogRef.close(!0)}updateURL(){if(this.form.valid){let i={delimiter:this.form.value.delimiter};this.form.value.start&&(i.start=R.toISOString(this.form.value.start)),this.form.value.stop&&(i.stop=R.toISOString(this.form.value.stop));let e=this.yamcs.yamcsClient.getCommandsDownloadURL(this.yamcs.instance,i);this.downloadURL$.next(e)}else this.downloadURL$.next(null)}ngOnDestroy(){this.formChangeSubscription?.unsubscribe()}};Qt.\u0275fac=function(e){return new(e||Qt)(f(pt),f($),f(xi))},Qt.\u0275cmp=w({type:Qt,selectors:[["ng-component"]],decls:16,vars:6,consts:[["mat-dialog-title",""],[1,"ya-form"],[3,"formGroup"],["label","Start"],["formControlName","start"],["label","Stop"],["formControlName","stop"],["label","CSV column delimiter"],["formControlName","delimiter",3,"options"],["align","end"],["mat-dialog-close",""],["appearance","primary",3,"click","link","disabled"]],template:function(e,n){e&1&&(o(0,"h2",0),s(1,"Export commands"),r(),o(2,"mat-dialog-content",1)(3,"form",2)(4,"ya-field",3),p(5,"ya-date-time-input",4),r(),o(6,"ya-field",5),p(7,"ya-date-time-input",6),r(),o(8,"ya-field",7),p(9,"ya-select",8),r()()(),o(10,"mat-dialog-actions",9)(11,"ya-button",10),s(12,"CANCEL"),r(),o(13,"ya-download-button",11),h(14,"async"),S("click",function(){return n.closeDialog()}),s(15," DOWNLOAD "),r()()),e&2&&(l(3),c("formGroup",n.form),l(6),c("options",n.delimiterOptions),l(4),c("link",v(14,4,n.downloadURL$))("disabled",!n.form.valid))},dependencies:[E,mt,W,fe,he,ge,_t,Ct,ht,ft,K,Te,Io,bt,Qe,G],encapsulation:2});var Bi=Qt;var Bt=class Bt{constructor(i){this.yamcs=i}transform(i){if(!i)return null;let e=this.yamcs.instance;return this.yamcs.yamcsClient.getCommandDownloadURL(e,i.id)}};Bt.\u0275fac=function(e){return new(e||Bt)(f($,16))},Bt.\u0275pipe=mi({name:"commandDownloadLink",type:Bt,pure:!0});var qi=Bt;var Yi=class{constructor(i){this.watermarkObserver=i;this.dirty=!1;this.archiveRecords=[];this.bufferSize=500;this.bufferWatermark=400;this.pointer=0;this.alreadyWarned=!1;this.realtimeBuffer=Array(this.bufferSize).fill(void 0)}addArchiveData(i){this.archiveRecords=this.archiveRecords.concat(i),this.dirty=!0}addRealtimeCommand(i){this.pointer<this.bufferSize&&(this.realtimeBuffer[this.pointer]=i,this.pointer>=this.bufferWatermark&&this.watermarkObserver&&!this.alreadyWarned&&(this.alreadyWarned=!0,this.watermarkObserver()),this.pointer=this.pointer+1),this.dirty=!0}reset(){this.archiveRecords=[],this.realtimeBuffer.fill(void 0),this.pointer=0,this.alreadyWarned=!1,this.dirty=!0}snapshot(){let i=[...this.archiveRecords];return this.realtimeBuffer.map(e=>{if(!e)return;let n=i.findIndex(a=>a.id==e.id);n===-1?i.push(new ke(e)):i[n]=i[n].mergeEntry(e)}),i.sort((e,n)=>{let a=-e.generationTime.localeCompare(n.generationTime);return a===0&&(a=-e.origin.localeCompare(n.origin)),a!==0?a:n.sequenceNumber-e.sequenceNumber}),i}compact(i){let e=this.snapshot();e.length=Math.min(i,e.length),this.reset(),this.archiveRecords=e,this.dirty=!0}};var zi=class extends po{constructor(e,n){super();this.yamcs=e;this.pageSize=100;this.blockHasMore=!1;this.records$=new N([]);this.loading$=new N(!1);this.streaming$=new N(!1);this.namespaces$=new N([]);this.syncSubscription=n.sync(()=>{this.buffer.dirty&&!this.loading$.getValue()&&(this.emitCommands(),this.buffer.dirty=!1)}),this.buffer=new Yi(()=>{this.blockHasMore=!0,this.buffer.compact(500)})}connect(){return this.records$}emitCommands(){this.records$.next(this.buffer.snapshot())}loadEntries(e){return this.loading$.next(!0),this.loadPage(mn(sn({},e),{limit:this.pageSize})).then(n=>{this.buffer.reset(),this.blockHasMore=!1,this.buffer.addArchiveData(n.map(a=>new ke(a))),this.emitCommands()}).finally(()=>{this.loading$.next(!1)})}hasMore(){return!!this.continuationToken&&!this.blockHasMore}async loadPage(e){return this.yamcs.yamcsClient.getCommandHistoryEntries(this.yamcs.instance,e).then(n=>{this.continuationToken=n.continuationToken;var a=n.commands||[];for(let d of a)this.updateNamespaces(d);return a})}async loadMoreData(e){if(this.continuationToken)return this.loadPage(mn(sn({},e),{next:this.continuationToken,limit:this.pageSize})).then(n=>{let a=n.map(d=>new ke(d));this.buffer.addArchiveData(a),this.emitCommands()})}startStreaming(){this.streaming$.next(!0),this.realtimeSubscription=this.yamcs.yamcsClient.createCommandSubscription({instance:this.yamcs.instance,processor:this.yamcs.processor},e=>{this.loading$.getValue()||(this.updateNamespaces(e),this.buffer.addRealtimeCommand(e))})}updateNamespaces(e){let n=this.namespaces$.value;if(e.aliases)for(let a in e.aliases)n.indexOf(a)===-1&&(n.push(a),n.sort(),this.namespaces$.next([...n]))}stopStreaming(){this.realtimeSubscription?.cancel(),this.streaming$.next(!1)}disconnect(){this.syncSubscription?.unsubscribe(),this.records$.complete(),this.loading$.complete(),this.streaming$.complete(),this.namespaces$.complete()}isEmpty(){return!this.records$.getValue().length}};var pa=(t,i)=>({c:t,template:i}),$r=()=>["detail"],Qr=t=>["/commanding/history",t],Br=t=>({c:t});function qr(t,i){if(t&1){let e=M();o(0,"ya-page-button",9),S("clicked",function(){b(e);let a=m();return T(a.startStreaming())}),s(1," Start streaming "),r()}}function Yr(t,i){if(t&1){let e=M();o(0,"ya-page-button",10),S("clicked",function(){b(e);let a=m();return T(a.stopStreaming())}),s(1," Stop streaming "),r()}}function zr(t,i){if(t&1&&(p(0,"br")(1,"mat-divider")(2,"br"),o(3,"ya-button",13),s(4," Resend "),r()),t&2){let e=m(),n=m();l(3),c("routerLink","/commanding/send"+(e==null?null:e.commandName))("queryParams",Ie(2,pa,n.yamcs.context,e==null?null:e.id))}}function jr(t,i){if(t&1&&(o(0,"ya-detail-toolbar"),s(1,"Command detail"),r(),o(2,"div",11),p(3,"app-command-detail2",12),u(4,zr,5,5),o(5,"p"),s(6,"\xA0"),r()()),t&2){let e=m();l(3),c("command",i),l(),_(e.showResend()?4:-1)}}function Ur(t,i){t&1&&(o(0,"ya-detail-toolbar"),s(1,"Select a command"),r())}function Gr(t,i){if(t&1&&(o(0,"ya-button",18),h(1,"async"),s(2," Export "),r()),t&2){let e;m();let n=L(8),a=m();c("matMenuTriggerFor",n)("disabled",!((e=v(1,2,a.dataSource.records$))!=null&&e.length))}}function Wr(t,i){if(t&1&&p(0,"ya-option",24),t&2){let e=i.$implicit;c("id",e)("label",e)}}function Kr(t,i){if(t&1){let e=M();p(0,"ya-date-time-input",69)(1,"ya-date-time-input",70),o(2,"ya-button",68),S("click",function(){b(e);let a=m(2);return T(a.applyCustomDates())}),s(3," Apply "),r()}if(t&2){let e=m(2);l(2),c("disabled",e.filterForm.invalid)}}function Jr(t,i){t&1&&p(0,"ya-dots")}function Zr(t,i){t&1&&(o(0,"div",31),s(1," Listening for commands "),p(2,"ya-dots",71),r())}function Xr(t,i){t&1&&(o(0,"th",72),s(1,"ID"),r())}function el(t,i){if(t&1&&(o(0,"td",73)(1,"a",13),s(2),r()()),t&2){let e=i.$implicit,n=m(2);l(),c("routerLink",Y(3,Qr,e.id))("queryParams",Y(5,Br,n.yamcs.context)),l(),D(" ",e.id," ")}}function tl(t,i){t&1&&(o(0,"th",72),s(1,"Time"),r())}function il(t,i){if(t&1&&(o(0,"td",73),s(1),h(2,"datetime"),r()),t&2){let e=i.$implicit;l(),D(" ",v(2,1,e.generationTime)," ")}}function nl(t,i){t&1&&(o(0,"th",74)(1,"mat-icon",75),s(2,"comment"),r()())}function ol(t,i){if(t&1&&(o(0,"mat-icon",77),s(1,"comment"),r()),t&2){let e=m().$implicit;c("matTooltip",e.comment)}}function al(t,i){t&1&&s(0," - ")}function rl(t,i){if(t&1&&(o(0,"td",76),u(1,ol,2,1,"mat-icon",77),u(2,al,1,0),r()),t&2){let e=i.$implicit;l(),_(e.comment?1:-1),l(),_(e.comment?-1:2)}}function ll(t,i){t&1&&(o(0,"th",72),s(1,"Command"),r())}function sl(t,i){if(t&1&&(o(0,"td",73),p(1,"ya-highlight",78),r()),t&2){let e=i.$implicit,n=m(2);l(),c("text",e.commandName)("term",n.filterForm.value.filter)}}function ml(t,i){if(t&1&&(o(0,"th",72),s(1),r()),t&2){let e=m().$implicit;l(),D(" ",e.label," ")}}function cl(t,i){if(t&1&&p(0,"ya-highlight",78),t&2){let e=m(4);c("text",i)("term",e.filterForm.value.filter)}}function dl(t,i){t&1&&s(0," - ")}function pl(t,i){if(t&1&&(o(0,"td",73),u(1,cl,1,2,"ya-highlight",78),h(2,"alias"),Me(3,dl,1,0),r()),t&2){let e,n=i.$implicit,a=m().$implicit;l(),_((e=ni(2,1,n,a.id))?1:3,e)}}function ul(t,i){if(t&1&&(g(0,44),C(1,ml,2,1,"th",37)(2,pl,4,4,"td",38),y()),t&2){let e=i.$implicit;c("matColumnDef",e.id)}}function _l(t,i){t&1&&(o(0,"th",72),s(1,"Issuer"),r())}function Cl(t,i){if(t&1&&s(0),t&2){let e=m().$implicit;ot(" ",e.username,"@",e.origin," ")}}function fl(t,i){if(t&1&&s(0),t&2){let e=m().$implicit;D(" ",e.username," ")}}function hl(t,i){if(t&1&&(o(0,"td",73),u(1,Cl,1,2)(2,fl,1,1),r()),t&2){let e=i.$implicit;l(),_(e.origin?1:2)}}function gl(t,i){t&1&&(o(0,"th",72),s(1,"Queue"),r())}function yl(t,i){if(t&1&&(o(0,"td",73),s(1),r()),t&2){let e=i.$implicit;l(),D(" ",e.queue||"-"," ")}}function vl(t,i){t&1&&(o(0,"th",72),s(1,"Sequence number"),r())}function xl(t,i){if(t&1&&(o(0,"td",73),s(1),r()),t&2){let e=i.$implicit;l(),D(" ",e.sequenceNumber," ")}}function Sl(t,i){t&1&&(o(0,"th",79),s(1," Q "),r())}function bl(t,i){if(t&1&&(o(0,"td",80)(1,"div",81),p(2,"app-acknowledgment-icon",82),r()()),t&2){let e=i.$implicit;l(2),c("ack",e.queued)}}function Tl(t,i){t&1&&(o(0,"th",83),s(1," R "),r())}function Dl(t,i){if(t&1&&p(0,"app-transmission-constraints-icon",12),t&2){let e=m().$implicit;c("command",e)}}function wl(t,i){if(t&1&&p(0,"app-acknowledgment-icon",82),t&2){let e=m().$implicit;c("ack",e.released)}}function El(t,i){if(t&1&&(o(0,"td",80)(1,"div",81),u(2,Dl,1,1,"app-transmission-constraints-icon",12),u(3,wl,1,1,"app-acknowledgment-icon",82),r()()),t&2){let e=i.$implicit;l(2),_(e.released?-1:2),l(),_(e.released?3:-1)}}function Ml(t,i){t&1&&(o(0,"th",84),s(1," S "),r())}function Il(t,i){if(t&1&&(o(0,"td",80)(1,"div",81),p(2,"app-acknowledgment-icon",82),r()()),t&2){let e=i.$implicit;l(2),c("ack",e.sent)}}function kl(t,i){t&1&&(o(0,"th",85),s(1,"Acks"),r())}function Rl(t,i){if(t&1&&p(0,"app-acknowledgment-icon",82),t&2){let e=i.$implicit;c("ack",e)}}function Ll(t,i){t&1&&s(0," - ")}function Al(t,i){if(t&1&&(o(0,"td",86)(1,"div",81),P(2,Rl,1,1,"app-acknowledgment-icon",82,B),r(),u(4,Ll,1,0),r()),t&2){let e=i.$implicit;l(2),O(e.extraAcks),l(2),_(e.extraAcks.length?-1:4)}}function Pl(t,i){t&1&&(o(0,"th",87),s(1,"Completion"),r())}function Ol(t,i){t&1&&s(0," SUCCESS ")}function Nl(t,i){if(t&1&&(o(0,"span",89),s(1,"FAILURE"),r()),t&2){let e=m().$implicit;c("matTooltip",e.completed==null?null:e.completed.message)}}function Hl(t,i){t&1&&s(0," - ")}function Fl(t,i){if(t&1&&(o(0,"td",88),u(1,Ol,1,0),u(2,Nl,2,1,"span",89),u(3,Hl,1,0),r()),t&2){let e=i.$implicit;l(),_((e.completed==null?null:e.completed.status)==="OK"?1:-1),l(),_((e.completed==null?null:e.completed.status)==="NOK"?2:-1),l(),_(e.completed?-1:3)}}function Vl(t,i){t&1&&p(0,"th",90)}function $l(t,i){if(t&1&&(o(0,"button",92),s(1," Resend "),r(),p(2,"mat-divider")),t&2){let e=m().$implicit,n=m(2);c("routerLink","/commanding/send"+e.commandName)("queryParams",Ie(2,pa,n.yamcs.context,e.id))}}function Ql(t,i){if(t&1&&(p(0,"mat-divider"),o(1,"ya-download-menu-item",93),h(2,"commandDownloadLink"),s(3," Download "),r()),t&2){let e=m().$implicit;l(),c("link",v(2,1,e))}}function Bl(t,i){if(t&1){let e=M();o(0,"td",73)(1,"ya-more"),u(2,$l,3,5),o(3,"button",91),S("click",function(){let a=b(e).$implicit,d=m(2);return T(d.copyHex(a))}),s(4,"Copy hex"),r(),o(5,"button",91),S("click",function(){let a=b(e).$implicit,d=m(2);return T(d.copyBinary(a))}),s(6,"Copy binary"),r(),u(7,Ql,4,3),r()()}if(t&2){let e=m(2);l(2),_(e.showResend()?2:-1),l(5),_(e.showCommandExports()?7:-1)}}function ql(t,i){if(t&1&&p(0,"app-command-arguments",97),t&2){let e=m(2).$implicit;c("command",e)("nomargin",!0)}}function Yl(t,i){t&1&&s(0," - ")}function zl(t,i){if(t&1&&(o(0,"ya-attr-list",95)(1,"ya-attr",96),u(2,ql,1,2,"app-command-arguments",97)(3,Yl,1,0),r()()),t&2){let e=m().$implicit;l(2),_(e.userAssignments.length?2:3)}}function jl(t,i){if(t&1&&p(0,"app-hex",99),t&2){let e=m();c("base64String",e.binaryValue)}}function Ul(t,i){if(t&1&&(o(0,"pre",100),s(1),r()),t&2){let e=m();l(),I(e.stringValue)}}function Gl(t,i){if(t&1&&(s(0),h(1,"value")),t&2){let e=m();D(" ",v(1,1,e)," ")}}function Wl(t,i){if(t&1&&u(0,jl,1,1,"app-hex",99)(1,Ul,2,1,"pre",100)(2,Gl,2,3),t&2){let e;_((e=i.type)==="BINARY"?0:e==="STRING"?1:2)}}function Kl(t,i){t&1&&s(0," - ")}function Jl(t,i){if(t&1&&(o(0,"ya-attr-list")(1,"ya-attr",98),u(2,Wl,3,1)(3,Kl,1,0),r()()),t&2){let e,n=m().$implicit;l(2),_((e=n.completed==null?null:n.completed.returnValue)?2:3,e)}}function Zl(t,i){if(t&1&&(o(0,"td",73),h(1,"async"),o(2,"div",94),u(3,zl,4,1,"ya-attr-list",95),u(4,Jl,4,1,"ya-attr-list"),p(5,"div",17),r()()),t&2){let e;m();let n=L(4),a=L(31),d=L(34);Ae("colspan",(e=v(1,3,n.displayedColumns$))==null?null:e.length),l(3),_(a.checked?3:-1),l(),_(d.checked?4:-1)}}function Xl(t,i){t&1&&p(0,"tr",101)}function es(t,i){if(t&1){let e=M();o(0,"tr",102),h(1,"async"),S("click",function(){let a=b(e).$implicit,d=m(2);return T(d.selectRecord(a))}),r()}if(t&2){let e=i.$implicit;m();let n=L(31),a=L(34),d=m();k("expanded",n.checked||a.checked)("selected",v(1,8,d.selectedRecord$)===e)("success",(e.completed==null?null:e.completed.status)==="OK")("failed",(e.completed==null?null:e.completed.status)==="NOK")}}function ts(t,i){if(t&1){let e=M();o(0,"tr",103),S("click",function(){let a=b(e).$implicit,d=m(2);return T(d.selectRecord(a))}),r()}if(t&2){m();let e=L(31),n=L(34);k("expanded",e.checked||n.checked)}}function is(t,i){if(t&1){let e=M();o(0,"ya-panel")(1,"ya-filter-bar",14),p(2,"ya-search-filter",15)(3,"ya-column-chooser",16,0)(5,"div",17),u(6,Gr,3,4,"ya-button",18),o(7,"mat-menu",19,1)(9,"button",20),S("click",function(){b(e);let a=m();return T(a.printReport())}),s(10," Printer-friendly "),r(),o(11,"button",21),S("click",function(){b(e);let a=m();return T(a.exportCsv())}),s(12," CSV format "),r()()(),o(13,"ya-filter-bar",14)(14,"ya-select",22),p(15,"ya-option",23),P(16,Wr,1,2,"ya-option",24,B),r(),o(18,"ya-select",25),p(19,"ya-option",26)(20,"ya-option",27)(21,"ya-option",28)(22,"ya-option",29)(23,"ya-option",30),r(),u(24,Kr,4,1),u(25,Jr,1,0,"ya-dots"),h(26,"async"),u(27,Zr,3,0,"div",31),h(28,"async"),r(),o(29,"ya-table-window",32)(30,"ya-table-toggle",33,2),s(32,"Arguments"),r(),o(33,"ya-table-toggle",34,3),s(35,"Return value"),r()(),o(36,"table",35),g(37,36),C(38,Xr,2,0,"th",37)(39,el,3,7,"td",38),y(),g(40,39),C(41,tl,2,0,"th",37)(42,il,3,3,"td",38),y(),g(43,40),C(44,nl,3,0,"th",41)(45,rl,3,2,"td",42),y(),g(46,43),C(47,ll,2,0,"th",37)(48,sl,2,2,"td",38),y(),P(49,ul,3,1,"ng-container",44,B),h(51,"async"),g(52,45),C(53,_l,2,0,"th",37)(54,hl,3,1,"td",38),y(),g(55,46),C(56,gl,2,0,"th",37)(57,yl,2,1,"td",38),y(),g(58,47),C(59,vl,2,0,"th",37)(60,xl,2,1,"td",38),y(),g(61,48),C(62,Sl,2,0,"th",49)(63,bl,3,1,"td",50),y(),g(64,51),C(65,Tl,2,0,"th",52)(66,El,4,2,"td",50),y(),g(67,53),C(68,Ml,2,0,"th",54)(69,Il,3,1,"td",50),y(),g(70,55),C(71,kl,2,0,"th",56)(72,Al,5,1,"td",57),y(),g(73,58),C(74,Pl,2,0,"th",59)(75,Fl,4,3,"td",60),y(),g(76,61),C(77,Vl,1,0,"th",62)(78,Bl,8,2,"td",38),y(),g(79,63),C(80,Zl,6,5,"td",38),y(),C(81,Xl,1,0,"tr",64),h(82,"async"),C(83,es,2,10,"tr",65),h(84,"async"),C(85,ts,1,2,"tr",66),r(),o(86,"ya-toolbar",67)(87,"ya-button",68),S("click",function(){b(e);let a=m();return T(a.loadMoreData())}),s(88," Load more "),r()()()}if(t&2){let e=L(4),n=m();l(),c("formGroup",n.filterForm),l(2),c("columns",n.columns),l(3),_(n.showCommandExports()?6:-1),l(7),c("formGroup",n.filterForm),l(3),O(n.config.queueNames),l(8),_(n.filterForm.value.interval==="CUSTOM"?24:-1),l(),_(v(26,15,n.dataSource.loading$)?25:-1),l(2),_(v(28,17,n.dataSource.streaming$)?27:-1),l(2),c("duration",n.appliedInterval)("start",n.validStart)("stop",n.validStop),l(7),c("dataSource",n.dataSource),l(13),O(v(51,19,n.aliasColumns$)),l(32),c("matHeaderRowDef",v(82,21,e.displayedColumns$)),l(2),c("matRowDefColumns",v(84,23,e.displayedColumns$)),l(2),c("matRowDefColumns",di(25,$r)),l(2),c("disabled",!n.dataSource.hasMore())}}var ai="PT1H",qt=class qt extends vo{constructor(e,n,a,d,x,A){super();this.route=a;this.printService=d;this.clipboard=x;this.dialog=A;this.selectedRecord$=new N(null);this.filterForm=new st({filter:new ee(null),queue:new ee(null),interval:new ee(ai),customStart:new ee(null),customStop:new ee(null)});this.columns=[{id:"commandId",label:"ID",alwaysVisible:!0},{id:"generationTime",label:"Time",alwaysVisible:!0},{id:"comment",label:"Comment",visible:!0},{id:"command",label:"Command",alwaysVisible:!0},{id:"issuer",label:"Issuer"},{id:"queue",label:"Queue"},{id:"queued",label:"Queued",visible:!0},{id:"released",label:"Released",visible:!0},{id:"sent",label:"Sent",visible:!0},{id:"acknowledgments",label:"Extra acknowledgments",visible:!0},{id:"completion",label:"Completion",visible:!0},{id:"actions",label:"",alwaysVisible:!0}];this.aliasColumns$=new N([]);this.subscriptions=[];this.setTitle("Command history"),this.config=e.getConfig(),this.user=n.getUser(),this.dataSource=new zi(this.yamcs,this.synchronizer)}ngOnInit(){this.initializeOptions(),this.loadData(),this.filterForm.get("filter").valueChanges.pipe(In(400)).forEach(e=>{this.loadData()}),this.filterForm.get("queue").valueChanges.forEach(e=>{this.loadData()}),this.filterForm.get("interval").valueChanges.forEach(e=>{if(e==="CUSTOM"){let n=this.validStart||this.yamcs.getMissionTime(),a=this.validStop||this.yamcs.getMissionTime();this.filterForm.get("customStart").setValue(R.toISOString(n)),this.filterForm.get("customStop").setValue(R.toISOString(a))}else e==="NO_LIMIT"?(this.validStart=null,this.validStop=null,this.appliedInterval=e,this.loadData()):e&&(this.validStop=this.yamcs.getMissionTime(),this.validStart=R.subtractDuration(this.validStop,e),this.appliedInterval=e,this.loadData())})}ngAfterViewInit(){this.subscriptions.push(this.dataSource.namespaces$.subscribe(e=>{for(let d of this.aliasColumns$.value){let x=this.columns.indexOf(d);x!==-1&&this.columns.splice(x,1)}let n=[];for(let d of e){let x={id:d,label:d,alwaysVisible:!0};n.push(x)}let a=this.columns.findIndex(d=>d.id==="command");this.columns.splice(a+1,0,...n),this.aliasColumns$.next(n),this.columnChooser.recalculate(this.columns)}))}initializeOptions(){let e=this.route.snapshot.queryParamMap;if(e.has("filter")){let n=e.get("filter");this.filterForm.get("filter").setValue(n)}if(e.has("queue")){let n=e.get("queue");this.filterForm.get("queue").setValue(n)}if(e.has("interval"))if(this.appliedInterval=e.get("interval"),this.filterForm.get("interval").setValue(this.appliedInterval),this.appliedInterval==="CUSTOM"){let n=e.get("customStart");this.filterForm.get("customStart").setValue(n),this.validStart=new Date(n);let a=e.get("customStop");this.filterForm.get("customStop").setValue(a),this.validStop=new Date(a)}else this.appliedInterval==="NO_LIMIT"?(this.validStart=null,this.validStop=null):(this.validStop=this.yamcs.getMissionTime(),this.validStart=R.subtractDuration(this.validStop,this.appliedInterval));else this.appliedInterval=ai,this.validStop=this.yamcs.getMissionTime(),this.validStart=R.subtractDuration(this.validStop,ai)}jumpToNow(){let e=this.filterForm.value.interval;e==="NO_LIMIT"?this.filterForm.get("interval").setValue(ai):e==="CUSTOM"?this.filterForm.get("interval").setValue(ai):e&&(this.validStop=this.yamcs.getMissionTime(),this.validStart=R.subtractDuration(this.validStop,e),this.loadData())}startStreaming(){this.filterForm.get("interval").setValue("NO_LIMIT"),this.dataSource.startStreaming()}stopStreaming(){this.dataSource.stopStreaming()}applyCustomDates(){this.validStart=R.toDate(this.filterForm.value.customStart),this.validStop=R.toDate(this.filterForm.value.customStop),this.appliedInterval="CUSTOM",this.loadData()}loadData(){let{controls:e}=this.filterForm;this.updateURL();let n={};this.validStart&&(n.start=this.validStart.toISOString()),this.validStop&&(n.stop=this.validStop.toISOString());let a=e.filter.value;a&&(n.q=a);let d=e.queue.value;d&&(n.queue=d),this.dataSource.loadEntries(n).catch(x=>this.messageService.showError(x))}loadMoreData(){let{controls:e}=this.filterForm,n={};this.validStart&&(n.start=this.validStart.toISOString());let a=e.filter.value;a&&(n.q=a);let d=e.queue.value;d&&(n.queue=d),this.dataSource.loadMoreData(n).catch(x=>this.messageService.showError(x))}showResend(){return this.config.tc&&this.user.hasAnyObjectPrivilegeOfType("Command")}showCommandExports(){return this.config.commandExports}updateURL(){let{controls:e}=this.filterForm;this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{filter:e.filter.value||null,queue:e.queue.value||null,interval:this.appliedInterval,customStart:this.appliedInterval==="CUSTOM"?e.customStart.value:null,customStop:this.appliedInterval==="CUSTOM"?e.customStop.value:null},queryParamsHandling:"merge"})}copyHex(e){let n=R.convertBase64ToHex(e.binary);this.clipboard.copy(n)}copyBinary(e){let n=window.atob(e.binary);this.clipboard.copy(n)}selectRecord(e){this.selectedRecord$.next(e),this.openDetailPane()}printReport(){let e=this.dataSource.records$.value.slice().reverse();this.printService.printComponent(Qi,"Command Report",e)}exportCsv(){this.dialog.open(Bi,{width:"400px",data:{start:this.validStart,stop:this.validStop,q:this.filterForm.controls.filter.value}})}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}};qt.\u0275fac=function(n){return new(n||qt)(f(xt),f(St),f(ue),f(Uo),f(bi),f(ut))},qt.\u0275cmp=w({type:qt,selectors:[["ng-component"]],viewQuery:function(n,a){if(n&1&&j(Ve,5),n&2){let d;F(d=V())&&(a.columnChooser=d.first)}},features:[je],decls:14,vars:10,consts:[["columnChooser",""],["exportMenu","matMenu"],["args",""],["rv",""],["label","Command history"],["icon","play_arrow"],["matTooltip","Pause streaming commands","icon","pause"],["color","primary","icon","refresh",3,"clicked"],[1,"table-wrapper"],["icon","play_arrow",3,"clicked"],["matTooltip","Pause streaming commands","icon","pause",3,"clicked"],[2,"padding","0 16px"],[3,"command"],[3,"routerLink","queryParams"],[3,"formGroup"],["formControlName","filter","placeholder","Filter by text search"],["preferenceKey","cmdhist",3,"columns"],[2,"flex","1 1 auto"],["appearance","primary","dropdown","true","icon","download",3,"matMenuTriggerFor","disabled"],["overlapTrigger","false","xPosition","before",1,"ya-menu"],["mat-menu-item","","matTooltip","Print preview with one command per page","matTooltipPosition","right",3,"click"],["mat-menu-item","","matTooltip","Command table, one command per row","matTooltipPosition","right",3,"click"],["formControlName","queue"],["id","","label","Any queue"],[3,"id","label"],["icon","access_time","formControlName","interval"],["id","PT1H","label","Last hour"],["id","PT6H","label","Last 6 hours"],["id","P1D","label","Last 24 hours"],["id","NO_LIMIT","label","No limit"],["id","CUSTOM","label","Custom","group","true"],[2,"text-align","right","flex","1 1 150px"],[3,"duration","start","stop"],["preferenceKey","cmdhist.arguments"],["preferenceKey","cmdhist.returnValue"],["mat-table","","multiTemplateDataRows","",1,"ya-data-table","expand","nohover",3,"dataSource"],["matColumnDef","commandId"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","generationTime"],["matColumnDef","comment"],["mat-header-cell","","class","iconcol",4,"matHeaderCellDef"],["mat-cell","","class","iconcol",4,"matCellDef"],["matColumnDef","command"],[3,"matColumnDef"],["matColumnDef","issuer"],["matColumnDef","queue"],["matColumnDef","sequenceNumber"],["matColumnDef","queued"],["mat-header-cell","","class","iconcol dense","style","text-align: center","matTooltip","Command queued",4,"matHeaderCellDef"],["mat-cell","","class","iconcol dense","style","text-align: center",4,"matCellDef"],["matColumnDef","released"],["mat-header-cell","","class","iconcol dense","style","text-align: center","matTooltip","Command released",4,"matHeaderCellDef"],["matColumnDef","sent"],["mat-header-cell","","class","iconcol dense","style","text-align: center","matTooltip","Command sent",4,"matHeaderCellDef"],["matColumnDef","acknowledgments"],["mat-header-cell","","class","dense",4,"matHeaderCellDef"],["mat-cell","","class","dense",4,"matCellDef"],["matColumnDef","completion"],["mat-header-cell","","style","padding-left: 8px",4,"matHeaderCellDef"],["mat-cell","","class","completion","style","text-align: center; padding-left: 8px",4,"matCellDef"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["matColumnDef","detail"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","item-row",3,"expanded","selected","success","failed","click",4,"matRowDef","matRowDefColumns"],["mat-row","","class","item-detail",3,"expanded","click",4,"matRowDef","matRowDefColumns"],["appearance","bottom","align","center"],[3,"click","disabled"],["formControlName","customStart"],["formControlName","customStop"],["fontSize","16"],["mat-header-cell",""],["mat-cell",""],["mat-header-cell","",1,"iconcol"],["matTooltip","Comment",1,"icon16"],["mat-cell","",1,"iconcol"],[1,"icon16",3,"matTooltip"],[3,"text","term"],["mat-header-cell","","matTooltip","Command queued",1,"iconcol","dense",2,"text-align","center"],["mat-cell","",1,"iconcol","dense",2,"text-align","center"],[2,"display","flex","align-items","center"],[3,"ack"],["mat-header-cell","","matTooltip","Command released",1,"iconcol","dense",2,"text-align","center"],["mat-header-cell","","matTooltip","Command sent",1,"iconcol","dense",2,"text-align","center"],["mat-header-cell","",1,"dense"],["mat-cell","",1,"dense"],["mat-header-cell","",2,"padding-left","8px"],["mat-cell","",1,"completion",2,"text-align","center","padding-left","8px"],[3,"matTooltip"],["mat-header-cell","",1,"expand"],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"routerLink","queryParams"],[3,"link"],[2,"display","flex"],[2,"min-width","300px"],["label","Arguments"],[3,"command","nomargin"],["label","Return value"],[3,"base64String"],[2,"margin","0","margin-top","4px","line-height","1em"],["mat-header-row",""],["mat-row","",1,"item-row",3,"click"],["mat-row","",1,"item-detail",3,"click"]],template:function(n,a){if(n&1&&(o(0,"ya-instance-page")(1,"ya-instance-toolbar",4),u(2,qr,2,0,"ya-page-button",5),h(3,"async"),u(4,Yr,2,0,"ya-page-button",6),h(5,"async"),o(6,"ya-page-button",7),S("clicked",function(){return a.jumpToNow()}),s(7," Jump to now "),r()(),o(8,"ya-detail-pane"),u(9,jr,7,2),h(10,"async"),Me(11,Ur,2,0,"ya-detail-toolbar"),r(),o(12,"div",8),u(13,is,89,26,"ya-panel"),r()()),n&2){let d;l(2),_(v(3,4,a.dataSource.streaming$)?-1:2),l(2),_(v(5,6,a.dataSource.streaming$)?4:-1),l(5),_((d=v(10,8,a.selectedRecord$))?9:11,d),l(4),_(a.dataSource?13:-1)}},dependencies:[Xo,Ht,Ee,Ni,E,W,fe,he,ge,Ce,Se,gt,ct,Oe,dt,te,ne,le,oe,ie,se,ae,re,me,ce,gi,Mi,Ei,K,Ve,Te,wo,Eo,Mo,ko,$e,ki,J,Z,Et,Ao,wt,de,Li,Qe,No,Ho,Vo,ta,qi,G,Oi,ye,Mt],styles:[".table-wrapper[_ngcontent-%COMP%]{position:relative;overflow:auto;height:100%}.mat-mdc-row[_ngcontent-%COMP%]{cursor:pointer}tr.failed[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], tr.failed[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:red}tr.success[_ngcontent-%COMP%]   td.completion[_ngcontent-%COMP%]{background-color:#e6ffed;color:#00c752}tr.failed[_ngcontent-%COMP%]   td.completion[_ngcontent-%COMP%]{background-color:#ffeef0;color:red}th.dense[_ngcontent-%COMP%], td.dense[_ngcontent-%COMP%]{width:1px;white-space:nowrap;padding-left:12px;padding-right:12px}tr.item-row.expanded[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom:none}tr.item-detail[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-left:40px!important}tr.item-detail[_ngcontent-%COMP%]:not(.expanded){display:none}tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{cursor:pointer}"],changeDetection:0});var ji=qt;var ns=t=>({c:t});function os(t,i){if(t&1&&(p(0,"ya-page-icon-button",2),s(1)),t&2){let e=m(),n=m();c("queryParams",Y(2,ns,n.yamcs.context)),l(),D(" Command history / ",e.id," ")}}function as(t,i){t&1&&(o(0,"ya-instance-page")(1,"ya-instance-toolbar"),C(2,os,2,4,"ng-template",0),r(),o(3,"ya-panel"),p(4,"app-command-detail2",1),r()()),t&2&&(l(4),c("command",i))}var Yt=class Yt{constructor(i,e){this.yamcs=e;this.command$=new N(null);let n=i.snapshot.paramMap.get("commandId");e.yamcsClient.getCommandHistoryEntry(e.instance,n).then(a=>{this.mergeEntry(a),this.commandSubscription=e.yamcsClient.createCommandSubscription({instance:e.instance,processor:e.processor,ignorePastCommands:!1},d=>{d.id===n&&this.mergeEntry(d)})})}mergeEntry(i){let e=this.command$.value;if(e){let n=e.mergeEntry(i);this.command$.next(n)}else this.command$.next(new ke(i))}ngOnDestroy(){this.commandSubscription?.cancel()}};Yt.\u0275fac=function(e){return new(e||Yt)(f(ue),f($))},Yt.\u0275cmp=w({type:Yt,selectors:[["ng-component"]],decls:2,vars:3,consts:[["ya-instance-toolbar-label",""],[3,"command"],["routerLink","..","icon","arrow_back",3,"queryParams"]],template:function(e,n){if(e&1&&(u(0,as,5,1,"ya-instance-page"),h(1,"async")),e&2){let a;_((a=v(1,1,n.command$))?0:-1,a)}},dependencies:[Ee,E,Ce,J,Z,Dt,Po,de,G],encapsulation:2,changeDetection:0});var Ui=Yt;var zt=class zt{};zt.\u0275fac=function(e){return new(e||zt)},zt.\u0275cmp=w({type:zt,selectors:[["app-send-command-wizard-step"]],inputs:{step:"step"},decls:11,vars:6,consts:[[1,"sub"]],template:function(e,n){e&1&&(o(0,"mat-toolbar",0)(1,"mat-toolbar-row")(2,"span")(3,"span"),s(4,"1. Select command"),r(),s(5," \xA0\xA0\xA0\xA0\xA0\xA0\xA0 "),o(6,"span"),s(7,"2. Configure command"),r(),s(8," \xA0\xA0\xA0\xA0\xA0\xA0\xA0 "),o(9,"span"),s(10,"3. View report"),r()()()()),e&2&&(l(3),k("active",n.step==1),l(3),k("active",n.step==2),l(3),k("active",n.step==3))},dependencies:[E,vi,ho],styles:["span[_ngcontent-%COMP%]{cursor:default}span[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{opacity:.3}span[_ngcontent-%COMP%]   span.active[_ngcontent-%COMP%]{opacity:1}mat-toolbar.sub[_ngcontent-%COMP%]{border-bottom:1px solid #d3d3d3;background-color:#fff;font-size:12px}.mat-toolbar-row[_ngcontent-%COMP%]{height:32px;padding:0 24px}.mat-toolbar-multiple-rows[_ngcontent-%COMP%]{min-height:32px}"],changeDetection:0});var qe=zt;var ls=t=>({c:t}),ss=(t,i)=>({c:t,template:i});function ms(t,i){if(t&1&&(o(0,"ya-panel"),p(1,"app-command-detail2",2),g(2),p(3,"br")(4,"mat-divider")(5,"br"),o(6,"ya-button",3),s(7," Send another command "),r(),s(8," \xA0\xA0 "),o(9,"ya-button",4),s(10," Resend this command "),r(),y(),r()),t&2){let e=i,n=m();l(),c("command",e),l(5),c("queryParams",Y(4,ls,n.yamcs.context)),l(3),c("routerLink","/commanding/send"+e.commandName)("queryParams",Ie(6,ss,n.yamcs.context,e.id))}}var jt=class jt{constructor(i,e){this.yamcs=i;this.title=e;this.qualifiedName=U.required({alias:"command"});this.commandId=U.required();this.command$=new N(null)}ngOnInit(){this.title.setTitle(this.qualifiedName());let i=this.commandId();this.commandSubscription=this.yamcs.yamcsClient.createCommandSubscription({instance:this.yamcs.instance,processor:this.yamcs.processor,ignorePastCommands:!1},e=>{e.id===i&&this.mergeEntry(e,!1)}),this.commandSubscription.addReplyListener(()=>{this.yamcs.yamcsClient.getCommandHistoryEntry(this.yamcs.instance,i).then(e=>{this.mergeEntry(e,!0)})})}mergeEntry(i,e){let n=this.command$.value;if(n){let a=n.mergeEntry(i,e);this.command$.next(a)}else this.command$.next(new ke(i))}ngOnDestroy(){this.commandSubscription?.cancel()}};jt.\u0275fac=function(e){return new(e||jt)(f($),f(X))},jt.\u0275cmp=w({type:jt,selectors:[["ng-component"]],inputs:{qualifiedName:[1,"command","qualifiedName"],commandId:[1,"commandId"]},decls:5,vars:3,consts:[["label","Send a command"],["step","3"],[3,"command"],["routerLink","/commanding/send",3,"queryParams"],[3,"routerLink","queryParams"]],template:function(e,n){if(e&1&&(o(0,"ya-instance-page"),p(1,"ya-instance-toolbar",0)(2,"app-send-command-wizard-step",1),u(3,ms,11,9,"ya-panel"),h(4,"async"),r()),e&2){let a;l(3),_((a=v(4,1,n.command$))?3:-1,a)}},dependencies:[Ee,qe,E,Ce,gt,K,J,Z,de,G],encapsulation:2,changeDetection:0});var Gi=jt;var ds=["*"];function ps(t,i){t&1&&We(0)}var xn=(()=>{class t{_elementRef=H(ti);constructor(){}focus(){this._elementRef.nativeElement.focus()}static \u0275fac=function(n){return new(n||t)};static \u0275dir=Le({type:t,selectors:[["","cdkStepHeader",""]],hostAttrs:["role","tab"]})}return t})(),Sn=(()=>{class t{template=H(it);constructor(){}static \u0275fac=function(n){return new(n||t)};static \u0275dir=Le({type:t,selectors:[["","cdkStepLabel",""]]})}return t})();var Xe={NUMBER:"number",EDIT:"edit",DONE:"done",ERROR:"error"},us=new Rn("STEPPER_GLOBAL_OPTIONS"),Wi=(()=>{class t{_stepperOptions;_stepper=H(Ki);_displayDefaultIndicatorType;stepLabel;_childForms;content;stepControl;get interacted(){return this._interacted()}set interacted(e){this._interacted.set(e)}_interacted=pe(!1);interactedStream=new nt;label;errorMessage;ariaLabel;ariaLabelledby;get state(){return this._state()}set state(e){this._state.set(e)}_state=pe(void 0);get editable(){return this._editable()}set editable(e){this._editable.set(e)}_editable=pe(!0);optional=!1;get completed(){let e=this._completedOverride(),n=this._interacted();return e??(n&&(!this.stepControl||this.stepControl.valid))}set completed(e){this._completedOverride.set(e)}_completedOverride=pe(null);index=pe(-1);isSelected=ui(()=>this._stepper.selectedIndex===this.index());indicatorType=ui(()=>{let e=this.isSelected(),n=this.completed,a=this._state()??Xe.NUMBER,d=this._editable();return this._showError()&&this.hasError&&!e?Xe.ERROR:this._displayDefaultIndicatorType?!n||e?Xe.NUMBER:d?Xe.EDIT:Xe.DONE:n&&!e?Xe.DONE:n&&e?a:d&&e?Xe.EDIT:a});isNavigable=ui(()=>{let e=this.isSelected();return this.completed||e||!this._stepper.linear});get hasError(){let e=this._customError();return e??this._getDefaultError()}set hasError(e){this._customError.set(e)}_customError=pe(null);_getDefaultError(){return this.interacted&&!!this.stepControl?.invalid}constructor(){let e=H(us,{optional:!0});this._stepperOptions=e||{},this._displayDefaultIndicatorType=this._stepperOptions.displayDefaultIndicatorType!==!1}select(){this._stepper.selected=this}reset(){this._interacted.set(!1),this._completedOverride()!=null&&this._completedOverride.set(!1),this._customError()!=null&&this._customError.set(!1),this.stepControl&&(this._childForms?.forEach(e=>e.resetForm?.()),this.stepControl.reset())}ngOnChanges(){this._stepper._stateChanged()}_markAsInteracted(){this._interacted()||(this._interacted.set(!0),this.interactedStream.emit(this))}_showError(){return this._stepperOptions.showError??this._customError()!=null}static \u0275fac=function(n){return new(n||t)};static \u0275cmp=w({type:t,selectors:[["cdk-step"]],contentQueries:function(n,a,d){if(n&1&&(ve(d,Sn,5),ve(d,_o,5)),n&2){let x;F(x=V())&&(a.stepLabel=x.first),F(x=V())&&(a._childForms=x)}},viewQuery:function(n,a){if(n&1&&j(it,7),n&2){let d;F(d=V())&&(a.content=d.first)}},inputs:{stepControl:"stepControl",label:"label",errorMessage:"errorMessage",ariaLabel:[0,"aria-label","ariaLabel"],ariaLabelledby:[0,"aria-labelledby","ariaLabelledby"],state:"state",editable:[2,"editable","editable",rt],optional:[2,"optional","optional",rt],completed:[2,"completed","completed",rt],hasError:[2,"hasError","hasError",rt]},outputs:{interactedStream:"interacted"},exportAs:["cdkStep"],features:[Pn],ngContentSelectors:ds,decls:1,vars:0,template:function(n,a){n&1&&(Ge(),Hn(0,ps,1,0,"ng-template"))},encapsulation:2,changeDetection:0})}return t})(),Ki=(()=>{class t{_dir=H(ao,{optional:!0});_changeDetectorRef=H(at);_elementRef=H(ti);_destroyed=new ri;_keyManager;_steps;steps=new ii;_stepHeader;_sortedHeaders=new ii;linear=!1;get selectedIndex(){return this._selectedIndex()}set selectedIndex(e){this._steps?(this._isValidIndex(e),this.selectedIndex!==e&&(this.selected?._markAsInteracted(),!this._anyControlsInvalidOrPending(e)&&(e>=this.selectedIndex||this.steps.toArray()[e].editable)&&this._updateSelectedItemIndex(e))):this._selectedIndex.set(e)}_selectedIndex=pe(0);get selected(){return this.steps?this.steps.toArray()[this.selectedIndex]:void 0}set selected(e){this.selectedIndex=e&&this.steps?this.steps.toArray().indexOf(e):-1}selectionChange=new nt;selectedIndexChange=new nt;_groupId=H(Xn).getId("cdk-stepper-");get orientation(){return this._orientation}set orientation(e){this._orientation=e,this._keyManager&&this._keyManager.withVerticalOrientation(e==="vertical")}_orientation="horizontal";constructor(){}ngAfterContentInit(){this._steps.changes.pipe(ze(this._steps),Re(this._destroyed)).subscribe(e=>{this.steps.reset(e.filter(n=>n._stepper===this)),this.steps.forEach((n,a)=>n.index.set(a)),this.steps.notifyOnChanges()})}ngAfterViewInit(){if(this._stepHeader.changes.pipe(ze(this._stepHeader),Re(this._destroyed)).subscribe(e=>{this._sortedHeaders.reset(e.toArray().sort((n,a)=>n._elementRef.nativeElement.compareDocumentPosition(a._elementRef.nativeElement)&Node.DOCUMENT_POSITION_FOLLOWING?-1:1)),this._sortedHeaders.notifyOnChanges()}),this._keyManager=new to(this._sortedHeaders).withWrap().withHomeAndEnd().withVerticalOrientation(this._orientation==="vertical"),this._keyManager.updateActiveItem(this.selectedIndex),(this._dir?this._dir.change:En()).pipe(ze(this._layoutDirection()),Re(this._destroyed)).subscribe(e=>this._keyManager?.withHorizontalOrientation(e)),this._keyManager.updateActiveItem(this.selectedIndex),this.steps.changes.subscribe(()=>{this.selected||this._selectedIndex.set(Math.max(this.selectedIndex-1,0))}),this._isValidIndex(this.selectedIndex)||this._selectedIndex.set(0),this.linear&&this.selectedIndex>0){let e=this.steps.toArray().slice(0,this._selectedIndex());for(let n of e)n._markAsInteracted()}}ngOnDestroy(){this._keyManager?.destroy(),this.steps.destroy(),this._sortedHeaders.destroy(),this._destroyed.next(),this._destroyed.complete()}next(){this.selectedIndex=Math.min(this._selectedIndex()+1,this.steps.length-1)}previous(){this.selectedIndex=Math.max(this._selectedIndex()-1,0)}reset(){this._updateSelectedItemIndex(0),this.steps.forEach(e=>e.reset()),this._stateChanged()}_getStepLabelId(e){return`${this._groupId}-label-${e}`}_getStepContentId(e){return`${this._groupId}-content-${e}`}_stateChanged(){this._changeDetectorRef.markForCheck()}_getAnimationDirection(e){let n=e-this._selectedIndex();return n<0?this._layoutDirection()==="rtl"?"next":"previous":n>0?this._layoutDirection()==="rtl"?"previous":"next":"current"}_getFocusIndex(){return this._keyManager?this._keyManager.activeItemIndex:this._selectedIndex()}_updateSelectedItemIndex(e){let n=this.steps.toArray(),a=this._selectedIndex();this.selectionChange.emit({selectedIndex:e,previouslySelectedIndex:a,selectedStep:n[e],previouslySelectedStep:n[a]}),this._keyManager&&(this._containsFocus()?this._keyManager.setActiveItem(e):this._keyManager.updateActiveItem(e)),this._selectedIndex.set(e),this.selectedIndexChange.emit(e),this._stateChanged()}_onKeydown(e){let n=eo(e),a=e.keyCode,d=this._keyManager;d?.activeItemIndex!=null&&!n&&(a===32||a===13)?(this.selectedIndex=d.activeItemIndex,e.preventDefault()):d?.setFocusOrigin("keyboard").onKeydown(e)}_anyControlsInvalidOrPending(e){return this.linear&&e>=0?this.steps.toArray().slice(0,e).some(n=>{let a=n.stepControl;return(a?a.invalid||a.pending||!n.interacted:!n.completed)&&!n.optional&&!n._completedOverride()}):!1}_layoutDirection(){return this._dir&&this._dir.value==="rtl"?"rtl":"ltr"}_containsFocus(){let e=this._elementRef.nativeElement,n=Gn();return e===n||e.contains(n)}_isValidIndex(e){return e>-1&&(!this.steps||e<this.steps.length)}static \u0275fac=function(n){return new(n||t)};static \u0275dir=Le({type:t,selectors:[["","cdkStepper",""]],contentQueries:function(n,a,d){if(n&1&&(ve(d,Wi,5),ve(d,xn,5)),n&2){let x;F(x=V())&&(a._steps=x),F(x=V())&&(a._stepHeader=x)}},inputs:{linear:[2,"linear","linear",rt],selectedIndex:[2,"selectedIndex","selectedIndex",Qn],selected:"selected",orientation:"orientation"},outputs:{selectionChange:"selectionChange",selectedIndexChange:"selectedIndexChange"},exportAs:["cdkStepper"]})}return t})();var ua=(()=>{class t{static \u0275fac=function(n){return new(n||t)};static \u0275mod=si({type:t});static \u0275inj=li({imports:[ro]})}return t})();var _s=(t,i,e)=>({index:t,active:i,optional:e});function Cs(t,i){if(t&1&&Ue(0,2),t&2){let e=m();c("ngTemplateOutlet",e.iconOverrides[e.state])("ngTemplateOutletContext",$n(2,_s,e.index,e.active,e.optional))}}function fs(t,i){if(t&1&&(o(0,"span",7),s(1),r()),t&2){let e=m(2);l(),I(e._getDefaultTextForState(e.state))}}function hs(t,i){if(t&1&&(o(0,"span",8),s(1),r()),t&2){let e=m(3);l(),I(e._intl.completedLabel)}}function gs(t,i){if(t&1&&(o(0,"span",8),s(1),r()),t&2){let e=m(3);l(),I(e._intl.editableLabel)}}function ys(t,i){if(t&1&&(u(0,hs,2,1,"span",8)(1,gs,2,1,"span",8),o(2,"mat-icon",7),s(3),r()),t&2){let e=m(2);_(e.state==="done"?0:e.state==="edit"?1:-1),l(3),I(e._getDefaultTextForState(e.state))}}function vs(t,i){if(t&1&&u(0,fs,2,1,"span",7)(1,ys,4,2),t&2){let e,n=m();_((e=n.state)==="number"?0:1)}}function xs(t,i){t&1&&(o(0,"div",4),Ue(1,9),r()),t&2&&(l(),c("ngTemplateOutlet",i.template))}function Ss(t,i){if(t&1&&(o(0,"div",4),s(1),r()),t&2){let e=m();l(),I(e.label)}}function bs(t,i){if(t&1&&(o(0,"div",5),s(1),r()),t&2){let e=m();l(),I(e._intl.optionalLabel)}}function Ts(t,i){if(t&1&&(o(0,"div",6),s(1),r()),t&2){let e=m();l(),I(e.errorMessage)}}var _a=["*"];function Ds(t,i){}function ws(t,i){if(t&1&&(We(0),C(1,Ds,0,0,"ng-template",0)),t&2){let e=m();l(),c("cdkPortalOutlet",e._portal)}}var Es=["animatedContainer"],Ca=t=>({step:t});function Ms(t,i){t&1&&We(0)}function Is(t,i){t&1&&p(0,"div",7)}function ks(t,i){if(t&1&&(Ue(0,6),u(1,Is,1,0,"div",7)),t&2){let e=i.$implicit,n=i.$index,a=i.$count;m(2);let d=L(4);c("ngTemplateOutlet",d)("ngTemplateOutletContext",Y(3,Ca,e)),l(),_(n!==a-1?1:-1)}}function Rs(t,i){if(t&1&&(o(0,"div",8,1),Ue(2,9),r()),t&2){let e=i.$implicit,n=i.$index,a=m(2);ci("mat-horizontal-stepper-content-"+a._getAnimationDirection(n)),c("id",a._getStepContentId(n)),Ae("aria-labelledby",a._getStepLabelId(n))("inert",a.selectedIndex===n?null:""),l(2),c("ngTemplateOutlet",e.content)}}function Ls(t,i){if(t&1&&(o(0,"div",2)(1,"div",3),P(2,ks,2,5,null,null,B),r(),o(4,"div",4),P(5,Rs,3,6,"div",5,B),r()()),t&2){let e=m();l(2),O(e.steps),l(3),O(e.steps)}}function As(t,i){if(t&1&&(o(0,"div",10),Ue(1,6),o(2,"div",11,1)(4,"div",12)(5,"div",13),Ue(6,9),r()()()()),t&2){let e=i.$implicit,n=i.$index,a=i.$index,d=i.$count,x=m(2),A=L(4);l(),c("ngTemplateOutlet",A)("ngTemplateOutletContext",Y(10,Ca,e)),l(),k("mat-stepper-vertical-line",a!==d-1)("mat-vertical-content-container-active",x.selectedIndex===n),Ae("inert",x.selectedIndex===n?null:""),l(2),c("id",x._getStepContentId(n)),Ae("aria-labelledby",x._getStepLabelId(n)),l(2),c("ngTemplateOutlet",e.content)}}function Ps(t,i){if(t&1&&P(0,As,7,12,"div",10,B),t&2){let e=m();O(e.steps)}}function Os(t,i){if(t&1){let e=M();o(0,"mat-step-header",14),S("click",function(){let a=b(e).step;return T(a.select())})("keydown",function(a){b(e);let d=m();return T(d._onKeydown(a))}),r()}if(t&2){let e=i.step,n=m();k("mat-horizontal-stepper-header",n.orientation==="horizontal")("mat-vertical-stepper-header",n.orientation==="vertical"),c("tabIndex",n._getFocusIndex()===e.index()?0:-1)("id",n._getStepLabelId(e.index()))("index",e.index())("state",e.indicatorType())("label",e.stepLabel||e.label)("selected",e.isSelected())("active",e.isNavigable())("optional",e.optional)("errorMessage",e.errorMessage)("iconOverrides",n._iconOverrides)("disableRipple",n.disableRipple||!e.isNavigable())("color",e.color||n.color),Ae("aria-posinset",e.index()+1)("aria-setsize",n.steps.length)("aria-controls",n._getStepContentId(e.index()))("aria-selected",e.isSelected())("aria-label",e.ariaLabel||null)("aria-labelledby",!e.ariaLabel&&e.ariaLabelledby?e.ariaLabelledby:null)("aria-disabled",e.isNavigable()?null:!0)}}var bn=(()=>{class t extends Sn{static \u0275fac=(()=>{let e;return function(a){return(e||(e=cn(t)))(a||t)}})();static \u0275dir=Le({type:t,selectors:[["","matStepLabel",""]],features:[je]})}return t})(),Ji=(()=>{class t{changes=new ri;optionalLabel="Optional";completedLabel="Completed";editableLabel="Editable";static \u0275fac=function(n){return new(n||t)};static \u0275prov=et({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function Ns(t){return t||new Ji}var Hs={provide:Ji,deps:[[new Ln,new An,Ji]],useFactory:Ns},Tn=(()=>{class t extends xn{_intl=H(Ji);_focusMonitor=H(Kn);_intlSubscription;state;label;errorMessage;iconOverrides;index;selected;active;optional;disableRipple;color;constructor(){super();let e=H(Jn);e.load(oo),e.load(Zn);let n=H(at);this._intlSubscription=this._intl.changes.subscribe(()=>n.markForCheck())}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._intlSubscription.unsubscribe(),this._focusMonitor.stopMonitoring(this._elementRef)}focus(e,n){e?this._focusMonitor.focusVia(this._elementRef,e,n):this._elementRef.nativeElement.focus(n)}_stringLabel(){return this.label instanceof bn?null:this.label}_templateLabel(){return this.label instanceof bn?this.label:null}_getHostElement(){return this._elementRef.nativeElement}_getDefaultTextForState(e){return e=="number"?`${this.index+1}`:e=="edit"?"create":e=="error"?"warning":e}static \u0275fac=function(n){return new(n||t)};static \u0275cmp=w({type:t,selectors:[["mat-step-header"]],hostAttrs:["role","tab",1,"mat-step-header"],hostVars:2,hostBindings:function(n,a){n&2&&ci("mat-"+(a.color||"primary"))},inputs:{state:"state",label:"label",errorMessage:"errorMessage",iconOverrides:"iconOverrides",index:"index",selected:"selected",active:"active",optional:"optional",disableRipple:"disableRipple",color:"color"},features:[je],decls:10,vars:17,consts:[["matRipple","",1,"mat-step-header-ripple","mat-focus-indicator",3,"matRippleTrigger","matRippleDisabled"],[1,"mat-step-icon-content"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"mat-step-label"],[1,"mat-step-text-label"],[1,"mat-step-optional"],[1,"mat-step-sub-label-error"],["aria-hidden","true"],[1,"cdk-visually-hidden"],[3,"ngTemplateOutlet"]],template:function(n,a){if(n&1&&(p(0,"div",0),o(1,"div")(2,"div",1),u(3,Cs,1,6,"ng-container",2)(4,vs,2,1),r()(),o(5,"div",3),u(6,xs,2,1,"div",4)(7,Ss,2,1,"div",4),u(8,bs,2,1,"div",5),u(9,Ts,2,1,"div",6),r()),n&2){let d;c("matRippleTrigger",a._getHostElement())("matRippleDisabled",a.disableRipple),l(),ci(Vn("mat-step-icon-state-",a.state," mat-step-icon")),k("mat-step-icon-selected",a.selected),l(2),_(a.iconOverrides&&a.iconOverrides[a.state]?3:4),l(2),k("mat-step-label-active",a.active)("mat-step-label-selected",a.selected)("mat-step-label-error",a.state=="error"),l(),_((d=a._templateLabel())?6:a._stringLabel()?7:-1,d),l(2),_(a.optional&&a.state!="error"?8:-1),l(),_(a.state==="error"?9:-1)}},dependencies:[no,pn,Se],styles:[`.mat-step-header{overflow:hidden;outline:none;cursor:pointer;position:relative;box-sizing:content-box;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-step-header:focus .mat-focus-indicator::before{content:""}.mat-step-header:hover[aria-disabled=true]{cursor:default}.mat-step-header:hover:not([aria-disabled]),.mat-step-header:hover[aria-disabled=false]{background-color:var(--mat-stepper-header-hover-state-layer-color, color-mix(in srgb, var(--mat-sys-on-surface) calc(var(--mat-sys-hover-state-layer-opacity) * 100%), transparent));border-radius:var(--mat-stepper-header-hover-state-layer-shape, var(--mat-sys-corner-medium))}.mat-step-header.cdk-keyboard-focused,.mat-step-header.cdk-program-focused{background-color:var(--mat-stepper-header-focus-state-layer-color, color-mix(in srgb, var(--mat-sys-on-surface) calc(var(--mat-sys-focus-state-layer-opacity) * 100%), transparent));border-radius:var(--mat-stepper-header-focus-state-layer-shape, var(--mat-sys-corner-medium))}@media(hover: none){.mat-step-header:hover{background:none}}@media(forced-colors: active){.mat-step-header{outline:solid 1px}.mat-step-header[aria-selected=true] .mat-step-label{text-decoration:underline}.mat-step-header[aria-disabled=true]{outline-color:GrayText}.mat-step-header[aria-disabled=true] .mat-step-label,.mat-step-header[aria-disabled=true] .mat-step-icon,.mat-step-header[aria-disabled=true] .mat-step-optional{color:GrayText}}.mat-step-optional{font-size:12px;color:var(--mat-stepper-header-optional-label-text-color, var(--mat-sys-on-surface-variant))}.mat-step-sub-label-error{font-size:12px;font-weight:normal}.mat-step-icon{border-radius:50%;height:24px;width:24px;flex-shrink:0;position:relative;color:var(--mat-stepper-header-icon-foreground-color, var(--mat-sys-surface));background-color:var(--mat-stepper-header-icon-background-color, var(--mat-sys-on-surface-variant))}.mat-step-icon-content{position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);display:flex}.mat-step-icon .mat-icon{font-size:16px;height:16px;width:16px}.mat-step-icon-state-error{background-color:var(--mat-stepper-header-error-state-icon-background-color, transparent);color:var(--mat-stepper-header-error-state-icon-foreground-color, var(--mat-sys-error))}.mat-step-icon-state-error .mat-icon{font-size:24px;height:24px;width:24px}.mat-step-label{display:inline-block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;min-width:50px;vertical-align:middle;font-family:var(--mat-stepper-header-label-text-font, var(--mat-sys-title-small-font));font-size:var(--mat-stepper-header-label-text-size, var(--mat-sys-title-small-size));font-weight:var(--mat-stepper-header-label-text-weight, var(--mat-sys-title-small-weight));color:var(--mat-stepper-header-label-text-color, var(--mat-sys-on-surface-variant))}.mat-step-label.mat-step-label-active{color:var(--mat-stepper-header-selected-state-label-text-color, var(--mat-sys-on-surface-variant))}.mat-step-label.mat-step-label-error{color:var(--mat-stepper-header-error-state-label-text-color, var(--mat-sys-error));font-size:var(--mat-stepper-header-error-state-label-text-size, var(--mat-sys-title-small-size))}.mat-step-label.mat-step-label-selected{font-size:var(--mat-stepper-header-selected-state-label-text-size, var(--mat-sys-title-small-size));font-weight:var(--mat-stepper-header-selected-state-label-text-weight, var(--mat-sys-title-small-weight))}.mat-step-text-label{text-overflow:ellipsis;overflow:hidden}.mat-step-header .mat-step-header-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}.mat-step-icon-selected{background-color:var(--mat-stepper-header-selected-state-icon-background-color, var(--mat-sys-primary));color:var(--mat-stepper-header-selected-state-icon-foreground-color, var(--mat-sys-on-primary))}.mat-step-icon-state-done{background-color:var(--mat-stepper-header-done-state-icon-background-color, var(--mat-sys-primary));color:var(--mat-stepper-header-done-state-icon-foreground-color, var(--mat-sys-on-primary))}.mat-step-icon-state-edit{background-color:var(--mat-stepper-header-edit-state-icon-background-color, var(--mat-sys-primary));color:var(--mat-stepper-header-edit-state-icon-foreground-color, var(--mat-sys-on-primary))}
`],encapsulation:2,changeDetection:0})}return t})(),Fs=(()=>{class t{templateRef=H(it);name;constructor(){}static \u0275fac=function(n){return new(n||t)};static \u0275dir=Le({type:t,selectors:[["ng-template","matStepperIcon",""]],inputs:{name:[0,"matStepperIcon","name"]}})}return t})(),Vs=(()=>{class t{_template=H(it);constructor(){}static \u0275fac=function(n){return new(n||t)};static \u0275dir=Le({type:t,selectors:[["ng-template","matStepContent",""]]})}return t})(),$s=(()=>{class t extends Wi{_errorStateMatcher=H(yi,{skipSelf:!0});_viewContainerRef=H(Nn);_isSelected=wn.EMPTY;stepLabel=void 0;color;_lazyContent;_portal;ngAfterContentInit(){this._isSelected=this._stepper.steps.changes.pipe(kn(()=>this._stepper.selectionChange.pipe(Mn(e=>e.selectedStep===this),ze(this._stepper.selected===this)))).subscribe(e=>{e&&this._lazyContent&&!this._portal&&(this._portal=new so(this._lazyContent._template,this._viewContainerRef))})}ngOnDestroy(){this._isSelected.unsubscribe()}isErrorState(e,n){let a=this._errorStateMatcher.isErrorState(e,n),d=!!(e&&e.invalid&&this.interacted);return a||d}static \u0275fac=(()=>{let e;return function(a){return(e||(e=cn(t)))(a||t)}})();static \u0275cmp=w({type:t,selectors:[["mat-step"]],contentQueries:function(n,a,d){if(n&1&&(ve(d,bn,5),ve(d,Vs,5)),n&2){let x;F(x=V())&&(a.stepLabel=x.first),F(x=V())&&(a._lazyContent=x.first)}},hostAttrs:["hidden",""],inputs:{color:"color"},exportAs:["matStep"],features:[dn([{provide:yi,useExisting:t},{provide:Wi,useExisting:t}]),je],ngContentSelectors:_a,decls:1,vars:0,consts:[[3,"cdkPortalOutlet"]],template:function(n,a){n&1&&(Ge(),C(0,ws,2,1,"ng-template"))},dependencies:[mo],encapsulation:2,changeDetection:0})}return t})(),Qs=(()=>{class t extends Ki{_ngZone=H(Fn);_renderer=H(On);_animationsDisabled=io();_cleanupTransition;_isAnimating=pe(!1);_stepHeader=void 0;_animatedContainers;_steps=void 0;steps=new ii;_icons;animationDone=new nt;disableRipple;color;labelPosition="end";headerPosition="top";_iconOverrides={};get animationDuration(){return this._animationDuration}set animationDuration(e){this._animationDuration=/^\d+$/.test(e)?e+"ms":e}_animationDuration="";_isServer=!H(Wn).isBrowser;constructor(){super();let n=H(ti).nativeElement.nodeName.toLowerCase();this.orientation=n==="mat-vertical-stepper"?"vertical":"horizontal"}ngAfterContentInit(){super.ngAfterContentInit(),this._icons.forEach(({name:e,templateRef:n})=>this._iconOverrides[e]=n),this.steps.changes.pipe(Re(this._destroyed)).subscribe(()=>this._stateChanged()),this.selectedIndexChange.pipe(Re(this._destroyed)).subscribe(()=>{let e=this._getAnimationDuration();e==="0ms"||e==="0s"?this._onAnimationDone():this._isAnimating.set(!0)}),this._ngZone.runOutsideAngular(()=>{this._animationsDisabled||setTimeout(()=>{this._elementRef.nativeElement.classList.add("mat-stepper-animations-enabled"),this._cleanupTransition=this._renderer.listen(this._elementRef.nativeElement,"transitionend",this._handleTransitionend)},200)})}ngAfterViewInit(){if(super.ngAfterViewInit(),typeof queueMicrotask=="function"){let e=!1;this._animatedContainers.changes.pipe(ze(null),Re(this._destroyed)).subscribe(()=>queueMicrotask(()=>{e||(e=!0,this.animationDone.emit()),this._stateChanged()}))}}ngOnDestroy(){super.ngOnDestroy(),this._cleanupTransition?.()}_getAnimationDuration(){return this._animationsDisabled?"0ms":this.animationDuration?this.animationDuration:this.orientation==="horizontal"?"500ms":"225ms"}_handleTransitionend=e=>{let n=e.target;if(!n)return;let a=this.orientation==="horizontal"&&e.propertyName==="transform"&&n.classList.contains("mat-horizontal-stepper-content-current"),d=this.orientation==="vertical"&&e.propertyName==="grid-template-rows"&&n.classList.contains("mat-vertical-content-container-active");(a||d)&&this._animatedContainers.find(A=>A.nativeElement===n)&&this._onAnimationDone()};_onAnimationDone(){this._isAnimating.set(!1),this.animationDone.emit()}static \u0275fac=function(n){return new(n||t)};static \u0275cmp=w({type:t,selectors:[["mat-stepper"],["mat-vertical-stepper"],["mat-horizontal-stepper"],["","matStepper",""]],contentQueries:function(n,a,d){if(n&1&&(ve(d,$s,5),ve(d,Fs,5)),n&2){let x;F(x=V())&&(a._steps=x),F(x=V())&&(a._icons=x)}},viewQuery:function(n,a){if(n&1&&(j(Tn,5),j(Es,5)),n&2){let d;F(d=V())&&(a._stepHeader=d),F(d=V())&&(a._animatedContainers=d)}},hostAttrs:["role","tablist"],hostVars:15,hostBindings:function(n,a){n&2&&(Ae("aria-orientation",a.orientation),Pe("--mat-stepper-animation-duration",a._getAnimationDuration()),k("mat-stepper-horizontal",a.orientation==="horizontal")("mat-stepper-vertical",a.orientation==="vertical")("mat-stepper-label-position-end",a.orientation==="horizontal"&&a.labelPosition=="end")("mat-stepper-label-position-bottom",a.orientation==="horizontal"&&a.labelPosition=="bottom")("mat-stepper-header-position-bottom",a.headerPosition==="bottom")("mat-stepper-animating",a._isAnimating()))},inputs:{disableRipple:"disableRipple",color:"color",labelPosition:"labelPosition",headerPosition:"headerPosition",animationDuration:"animationDuration"},outputs:{animationDone:"animationDone"},exportAs:["matStepper","matVerticalStepper","matHorizontalStepper"],features:[dn([{provide:Ki,useExisting:t}]),je],ngContentSelectors:_a,decls:5,vars:2,consts:[["stepTemplate",""],["animatedContainer",""],[1,"mat-horizontal-stepper-wrapper"],[1,"mat-horizontal-stepper-header-container"],[1,"mat-horizontal-content-container"],["role","tabpanel",1,"mat-horizontal-stepper-content",3,"id","class"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"mat-stepper-horizontal-line"],["role","tabpanel",1,"mat-horizontal-stepper-content",3,"id"],[3,"ngTemplateOutlet"],[1,"mat-step"],[1,"mat-vertical-content-container"],["role","tabpanel",1,"mat-vertical-stepper-content",3,"id"],[1,"mat-vertical-content"],[3,"click","keydown","tabIndex","id","index","state","label","selected","active","optional","errorMessage","iconOverrides","disableRipple","color"]],template:function(n,a){if(n&1&&(Ge(),u(0,Ms,1,0),u(1,Ls,7,0,"div",2)(2,Ps,2,0),C(3,Os,1,23,"ng-template",null,0,pi)),n&2){let d;_(a._isServer?0:-1),l(),_((d=a.orientation)==="horizontal"?1:d==="vertical"?2:-1)}},dependencies:[pn,Tn],styles:[`.mat-stepper-vertical,.mat-stepper-horizontal{display:block;font-family:var(--mat-stepper-container-text-font, var(--mat-sys-body-medium-font));background:var(--mat-stepper-container-color, var(--mat-sys-surface))}.mat-horizontal-stepper-header-container{white-space:nowrap;display:flex;align-items:center}.mat-stepper-label-position-bottom .mat-horizontal-stepper-header-container{align-items:flex-start}.mat-stepper-header-position-bottom .mat-horizontal-stepper-header-container{order:1}.mat-stepper-horizontal-line{border-top-width:1px;border-top-style:solid;flex:auto;height:0;margin:0 -16px;min-width:32px;border-top-color:var(--mat-stepper-line-color, var(--mat-sys-outline))}.mat-stepper-label-position-bottom .mat-stepper-horizontal-line{margin:0;min-width:0;position:relative;top:calc(calc((var(--mat-stepper-header-height, 72px) - 24px) / 2) + 12px)}.mat-stepper-label-position-bottom .mat-horizontal-stepper-header:not(:first-child)::before,[dir=rtl] .mat-stepper-label-position-bottom .mat-horizontal-stepper-header:not(:last-child)::before,.mat-stepper-label-position-bottom .mat-horizontal-stepper-header:not(:last-child)::after,[dir=rtl] .mat-stepper-label-position-bottom .mat-horizontal-stepper-header:not(:first-child)::after{border-top-width:1px;border-top-style:solid;content:"";display:inline-block;height:0;position:absolute;width:calc(50% - 20px)}.mat-horizontal-stepper-header{display:flex;overflow:hidden;align-items:center;padding:0 24px;height:var(--mat-stepper-header-height, 72px)}.mat-horizontal-stepper-header .mat-step-icon{margin-right:8px;flex:none}[dir=rtl] .mat-horizontal-stepper-header .mat-step-icon{margin-right:0;margin-left:8px}.mat-horizontal-stepper-header::before,.mat-horizontal-stepper-header::after{border-top-color:var(--mat-stepper-line-color, var(--mat-sys-outline))}.mat-stepper-label-position-bottom .mat-horizontal-stepper-header{padding:calc((var(--mat-stepper-header-height, 72px) - 24px) / 2) 24px}.mat-stepper-label-position-bottom .mat-horizontal-stepper-header::before,.mat-stepper-label-position-bottom .mat-horizontal-stepper-header::after{top:calc(calc((var(--mat-stepper-header-height, 72px) - 24px) / 2) + 12px)}.mat-stepper-label-position-bottom .mat-horizontal-stepper-header{box-sizing:border-box;flex-direction:column;height:auto}.mat-stepper-label-position-bottom .mat-horizontal-stepper-header:not(:last-child)::after,[dir=rtl] .mat-stepper-label-position-bottom .mat-horizontal-stepper-header:not(:first-child)::after{right:0}.mat-stepper-label-position-bottom .mat-horizontal-stepper-header:not(:first-child)::before,[dir=rtl] .mat-stepper-label-position-bottom .mat-horizontal-stepper-header:not(:last-child)::before{left:0}[dir=rtl] .mat-stepper-label-position-bottom .mat-horizontal-stepper-header:last-child::before,[dir=rtl] .mat-stepper-label-position-bottom .mat-horizontal-stepper-header:first-child::after{display:none}.mat-stepper-label-position-bottom .mat-horizontal-stepper-header .mat-step-icon{margin-right:0;margin-left:0}.mat-stepper-label-position-bottom .mat-horizontal-stepper-header .mat-step-label{padding:16px 0 0 0;text-align:center;width:100%}.mat-vertical-stepper-header{display:flex;align-items:center;height:24px;padding:calc((var(--mat-stepper-header-height, 72px) - 24px) / 2) 24px}.mat-vertical-stepper-header .mat-step-icon{margin-right:12px}[dir=rtl] .mat-vertical-stepper-header .mat-step-icon{margin-right:0;margin-left:12px}.mat-horizontal-stepper-wrapper{display:flex;flex-direction:column}.mat-horizontal-stepper-content{visibility:hidden;overflow:hidden;outline:0;height:0}.mat-stepper-animations-enabled .mat-horizontal-stepper-content{transition:transform var(--mat-stepper-animation-duration, 0) cubic-bezier(0.35, 0, 0.25, 1)}.mat-horizontal-stepper-content.mat-horizontal-stepper-content-previous{transform:translate3d(-100%, 0, 0)}.mat-horizontal-stepper-content.mat-horizontal-stepper-content-next{transform:translate3d(100%, 0, 0)}.mat-horizontal-stepper-content.mat-horizontal-stepper-content-current{visibility:visible;transform:none;height:auto}.mat-stepper-horizontal:not(.mat-stepper-animating) .mat-horizontal-stepper-content.mat-horizontal-stepper-content-current{overflow:visible}.mat-horizontal-content-container{overflow:hidden;padding:0 24px 24px 24px}@media(forced-colors: active){.mat-horizontal-content-container{outline:solid 1px}}.mat-stepper-header-position-bottom .mat-horizontal-content-container{padding:24px 24px 0 24px}.mat-vertical-content-container{display:grid;grid-template-rows:0fr;grid-template-columns:100%;margin-left:36px;border:0;position:relative}.mat-stepper-animations-enabled .mat-vertical-content-container{transition:grid-template-rows var(--mat-stepper-animation-duration, 0) cubic-bezier(0.4, 0, 0.2, 1)}.mat-vertical-content-container.mat-vertical-content-container-active{grid-template-rows:1fr}.mat-step:last-child .mat-vertical-content-container{border:none}@media(forced-colors: active){.mat-vertical-content-container{outline:solid 1px}}[dir=rtl] .mat-vertical-content-container{margin-left:0;margin-right:36px}@supports not (grid-template-rows: 0fr){.mat-vertical-content-container{height:0}.mat-vertical-content-container.mat-vertical-content-container-active{height:auto}}.mat-stepper-vertical-line::before{content:"";position:absolute;left:0;border-left-width:1px;border-left-style:solid;border-left-color:var(--mat-stepper-line-color, var(--mat-sys-outline));top:calc(8px - calc((var(--mat-stepper-header-height, 72px) - 24px) / 2));bottom:calc(8px - calc((var(--mat-stepper-header-height, 72px) - 24px) / 2))}[dir=rtl] .mat-stepper-vertical-line::before{left:auto;right:0}.mat-vertical-stepper-content{overflow:hidden;outline:0;visibility:hidden}.mat-stepper-animations-enabled .mat-vertical-stepper-content{transition:visibility var(--mat-stepper-animation-duration, 0) linear}.mat-vertical-content-container-active>.mat-vertical-stepper-content{visibility:visible}.mat-vertical-content{padding:0 24px 24px 24px}
`],encapsulation:2,changeDetection:0})}return t})();var fa=(()=>{class t{static \u0275fac=function(n){return new(n||t)};static \u0275mod=si({type:t});static \u0275inj=li({providers:[Hs,yi],imports:[un,co,ua,hi,lo,Qs,Tn,un]})}return t})();var Ut=class Ut{constructor(i,e){this.dialogRef=i;this.form=e.group({executionTime:["",[lt.required]],tags:[[],[]]})}schedule(){this.dialogRef.close(this.form.value)}};Ut.\u0275fac=function(e){return new(e||Ut)(f(pt),f(fi))},Ut.\u0275cmp=w({type:Ut,selectors:[["app-schedule-command-dialog"]],decls:19,vars:4,consts:[["mat-dialog-title",""],[1,"hint"],[1,"ya-form",3,"formGroup"],["label","Execution time"],["formControlName","executionTime",3,"showMillis","showNow"],["label","Timeline tags","hint","(optional)"],["dialogTitle","Timeline Tags"],["formControlName","tags"],["align","end"],[2,"flex","1 1 auto"],["mat-dialog-close",""],["appearance","primary",3,"click","disabled"]],template:function(e,n){e&1&&(o(0,"h2",0),s(1,"Send later"),r(),o(2,"mat-dialog-content")(3,"div",1)(4,"p"),s(5,"This command will be submitted to the Yamcs Timeline, for execution at a later time."),r()(),o(6,"form",2)(7,"ya-field",3),p(8,"ya-date-time-input",4),r(),o(9,"ya-field",5)(10,"ya-help",6),s(11," Tags allow to categorise items per band. Bands only show items for which one of the tags is matching. "),r(),p(12,"ya-tag-select",7),r()()(),o(13,"mat-dialog-actions",8),p(14,"div",9),o(15,"ya-button",10),s(16,"CANCEL"),r(),o(17,"ya-button",11),S("click",function(){return n.schedule()}),s(18,"SCHEDULE"),r()()),e&2&&(l(6),c("formGroup",n.form),l(2),c("showMillis",!0)("showNow",!0),l(9),c("disabled",!n.form.valid))},dependencies:[E,mt,W,fe,he,ge,_t,Ct,ht,ft,K,Te,bt,Tt,Fo],encapsulation:2,changeDetection:0});var Zi=Ut;function Bs(t,i){t&1&&(o(0,"span",5),s(1,"satisfied"),r())}function qs(t,i){t&1&&(o(0,"span",6),s(1,"not satisfied"),r())}function Ys(t,i){if(t&1&&(o(0,"tr")(1,"td"),p(2,"app-expression",3),r(),o(3,"td",4),s(4),h(5,"millisDuration"),r(),o(6,"td",4),u(7,Bs,2,0,"span",5),u(8,qs,2,0,"span",6),p(9,"app-live-expression",7,0),r()()),t&2){let e=i.$implicit,n=L(10),a=m(2);l(2),c("expression",e.expression)("relto",a.relto()),l(2),I(v(5,8,e.timeout)||"-"),l(3),_(n.result()===!0?7:-1),l(),_(n.result()===!1?8:-1),l(),Pe("display","none"),c("expression",e.expression)}}function zs(t,i){t&1&&(o(0,"p"),s(1," Constraints are evaluated after the command is released from the assigned queue. The following is an indication of the current constraint state. "),r(),o(2,"table",1)(3,"tr")(4,"th",2),s(5,"Constraint"),r(),o(6,"th"),s(7,"Timeout"),r(),o(8,"th"),s(9,"Live evaluation"),r()(),P(10,Ys,11,10,"tr",null,B),r()),t&2&&(l(10),O(i.constraint))}var Gt=class Gt{constructor(){this.command=U(null);this.relto=U(null)}};Gt.\u0275fac=function(e){return new(e||Gt)},Gt.\u0275cmp=w({type:Gt,selectors:[["app-command-constraints"]],inputs:{command:[1,"command"],relto:[1,"relto"]},decls:1,vars:1,consts:[["expr",""],["yaDataTable",""],[1,"expand"],[3,"expression","relto"],[2,"white-space","nowrap"],[1,"evaluation","valid"],[1,"evaluation","invalid"],[3,"expression"]],template:function(e,n){if(e&1&&u(0,zs,12,0),e&2){let a;_((a=n.command())?0:-1,a)}},dependencies:[oa,aa,E,Pi,qo],styles:[".evaluation[_ngcontent-%COMP%]{font-family:Roboto Mono,monospace;background-color:#ffeef0;color:red;padding-left:2px;padding-right:2px}.evaluation.valid[_ngcontent-%COMP%]{background-color:#e6ffed;color:#00c752}th[_ngcontent-%COMP%]{white-space:nowrap}p[_ngcontent-%COMP%]{color:#000000a7}"],changeDetection:0});var Xi=Gt;var en=class{constructor(i){this.entry=i}getAssignment(i){if(this.entry.assignments){for(let e of this.entry.assignments)if(e.name===i)return e.value}}getOption(i,e){for(let n of this.entry.attr||[])if(n.name===i)switch(e){case"BOOLEAN":return this.getBooleanOption(n.value);case"NUMBER":return this.getNumberOption(n.value);case"STRING":return this.getStringOption(n.value);case"TIMESTAMP":return this.getTimestampOption(n.value)}}getBooleanOption(i){if(i.type==="BOOLEAN")return i}getNumberOption(i){switch(i.type){case"SINT32":case"UINT32":case"SINT64":case"UINT64":return i}}getStringOption(i){if(i.type==="STRING")return i}getTimestampOption(i){if(i.type==="TIMESTAMP")return i}getComment(){}getStream(){}getAdvancementParams(){}};var js=["commandForm"];function Us(t,i){if(t&1&&(o(0,"dt"),s(1),r(),o(2,"dd"),s(3),r()),t&2){let e=i.$implicit;l(),I(e.namespace),l(2),I(e.name)}}function Gs(t,i){if(t&1&&(o(0,"dt"),s(1,"Description"),r(),o(2,"dd"),p(3,"app-markdown",13),r()),t&2){let e=m(2);l(3),c("text",e.longDescription)}}function Ws(t,i){if(t&1&&(o(0,"dt"),s(1,"Description"),r(),o(2,"dd"),s(3),r()),t&2){let e=m(2);l(3),D(" ",e.shortDescription||"-"," ")}}function Ks(t,i){if(t&1&&(u(0,Gs,4,1),u(1,Ws,4,1)),t&2){let e=m();_(e.longDescription?0:-1),l(),_(e.longDescription?-1:1)}}function Js(t,i){if(t&1&&(p(0,"app-significance-level",14),s(1)),t&2){let e=i;c("level",e.consequenceLevel),l(),D(" \xA0\xA0",e.reasonForWarning," ")}}function Zs(t,i){t&1&&s(0," - ")}function Xs(t,i){if(t&1&&(o(0,"dl",5)(1,"dt"),s(2,"Command"),r(),o(3,"dd"),s(4),h(5,"shortName"),r(),o(6,"dt"),s(7,"System"),r(),o(8,"dd"),s(9),h(10,"spaceSystemName"),r(),P(11,Us,4,2,null,null,B),u(13,Ks,2,2),o(14,"dt"),s(15,"Significance"),r(),o(16,"dd"),u(17,Js,2,2)(18,Zs,1,0),r()()),t&2){let e,n=i;l(4),I(v(5,4,n.qualifiedName)),l(5),I(v(10,6,n.qualifiedName)||"-"),l(2),O(n.alias),l(2),_(n.longDescription||n.shortDescription?13:-1),l(4),_((e=n==null?null:n.effectiveSignificance)?17:18,e)}}function em(t,i){t&1&&(o(0,"ya-warning-message"),s(1,"You're not cleared to send this command"),r())}function tm(t,i){if(t&1&&(o(0,"mat-slide-toggle",15),s(1,"Arm"),r(),p(2,"div",16)),t&2){let e=m();c("formControl",e.armControl)}}function im(t,i){if(t&1){let e=M();s(0," \xA0 "),p(1,"ya-icon-action",17),h(2,"async"),h(3,"async"),o(4,"mat-menu",18,1)(6,"button",19),S("click",function(){b(e);let a=m();return T(a.sendCommand())}),s(7,"Send now"),r(),o(8,"button",19),S("click",function(){b(e);let a=m();return T(a.openScheduleCommandDialog())}),s(9,"Send later..."),r()()}if(t&2){let e=L(5),n=m(),a=L(8);l(),c("matMenuTriggerFor",n.config.twoStageCommanding&&!n.armControl.value||!v(2,4,n.cleared$)||!a.form.valid?null:e)("padding",!1)("disabled",n.config.twoStageCommanding&&!n.armControl.value||!v(3,6,n.cleared$)||!a.form.valid),l(3),c("overlapTrigger",!1)}}var Wt=class Wt{constructor(i,e,n,a,d,x,A,Ye,Dn){this.route=i;this.router=e;this.title=n;this.messageService=a;this.yamcs=d;this.location=x;this.authService=Ye;this.dialog=Dn;this.qualifiedName=U.required({alias:"command"});this.command=pe(null);this.templateProvider$=new N(null);this.cleared$=new N(!0);this.armControl=new xe;this.config=A.getConfig()}ngOnInit(){this.title.setTitle(`Send a command: ${this.qualifiedName()}`);let i=[this.yamcs.yamcsClient.getCommand(this.yamcs.instance,this.qualifiedName())],e=this.route.snapshot.queryParamMap.get("template");if(e){let n=this.yamcs.yamcsClient.getCommandHistoryEntry(this.yamcs.instance,e);i.push(n)}Promise.all(i).then(n=>{let a=n[0],d;n.length>1&&(d=n[1]),this.command.set(a),d?this.templateProvider$.next(new en(d)):this.templateProvider$.next(null),this.config.commandClearanceEnabled&&(this.connectionInfoSubscription=this.yamcs.clearance$.subscribe(x=>{let A=a.effectiveSignificance;this.cleared$.next(this.isCleared(x,A?.consequenceLevel))}))})}ngAfterViewInit(){this.config.twoStageCommanding&&(this.commandForm.form.valueChanges.subscribe(()=>{this.armControl.setValue(!1)}),this.commandForm.form.statusChanges.subscribe(()=>{this.commandForm.form.valid?this.armControl.enable():this.armControl.disable()}))}goBack(){this.location.back()}sendCommand(){this.armControl.setValue(!1);let i=this.qualifiedName(),e=this.commandForm.getResult();this.yamcs.yamcsClient.issueCommand(this.yamcs.instance,this.yamcs.processor,i,{args:e.args,stream:e.stream,comment:e.comment,extra:e.extra}).then(n=>{this.router.navigate(["/commanding/send"+i,"-","report",n.id],{queryParams:{c:this.yamcs.context}})}).catch(n=>{this.messageService.showError(n)})}showSchedule(){let i=this.yamcs.connectionInfo$.value?.instance?.capabilities||[];return i.indexOf("timeline")!==-1&&i.indexOf("activities")!==-1&&this.authService.getUser().hasSystemPrivilege("ControlTimeline")}openScheduleCommandDialog(){this.dialog.open(Zi,{width:"600px"}).afterClosed().subscribe(i=>{if(i){this.armControl.setValue(!1);let e=this.qualifiedName(),n=this.commandForm.getResult(!0),a={type:"ACTIVITY",duration:"0s",name:e,start:i.executionTime,tags:i.tags,activityDefinition:{type:"COMMAND",args:{processor:this.yamcs.processor,command:e,args:n.args,extra:n.extra,stream:n.stream}}};this.yamcs.yamcsClient.createTimelineItem(this.yamcs.instance,a).then(()=>{this.messageService.showInfo("Command scheduled"),this.router.navigateByUrl(`/commanding/send?c=${this.yamcs.context}`)}).catch(d=>this.messageService.showError(d))}})}isCleared(i,e){if(!i)return!1;switch(i.level){case"SEVERE":if(e==="SEVERE")return!0;case"CRITICAL":if(e==="CRITICAL")return!0;case"DISTRESS":if(e==="DISTRESS")return!0;case"WARNING":if(e==="WARNING")return!0;case"WATCH":if(e==="WATCH")return!0;case"NONE":if(e==="NONE"||!e)return!0}return!1}ngOnDestroy(){this.connectionInfoSubscription?.unsubscribe()}};Wt.\u0275fac=function(e){return new(e||Wt)(f(ue),f(_e),f(X),f(Fe),f($),f(Bn),f(xt),f(St),f(ut))},Wt.\u0275cmp=w({type:Wt,selectors:[["ng-component"]],viewQuery:function(e,n){if(e&1&&j(js,5),e&2){let a;F(a=V())&&(n.commandForm=a.first)}},inputs:{qualifiedName:[1,"command","qualifiedName"]},decls:25,vars:19,consts:[["commandForm",""],["sendMenu","matMenu"],["label","Send a command"],["step","2"],[1,"form-content"],[1,"dl-horizontal","no-lead"],[3,"command","templateProvider"],["head",""],["label","Constraints",3,"expanded","visible"],[3,"command","relto"],[3,"click"],[2,"flex","1 1 auto"],["appearance","primary","icon","send",3,"click","disabled"],[3,"text"],[3,"level"],["color","primary",3,"formControl"],[2,"width","20px"],["icon","arrow_drop_down",2,"line-height","12px",3,"matMenuTriggerFor","padding","disabled"],[1,"ya-menu",3,"overlapTrigger"],["mat-menu-item","",3,"click"]],template:function(e,n){if(e&1){let a=M();o(0,"ya-instance-page"),p(1,"ya-instance-toolbar",2)(2,"app-send-command-wizard-step",3),o(3,"div",4),u(4,Xs,19,8,"dl",5),u(5,em,2,0,"ya-warning-message"),h(6,"async"),o(7,"app-command-form",6,0),h(9,"async"),g(10,7),o(11,"ya-stepper-step",8),p(12,"app-command-constraints",9),h(13,"spaceSystemName"),r(),y(),r(),o(14,"p"),s(15,"\xA0"),r(),o(16,"mat-toolbar")(17,"ya-button",10),S("click",function(){return b(a),T(n.goBack())}),s(18,"Cancel"),r(),p(19,"span",11),u(20,tm,3,1),o(21,"ya-button",12),h(22,"async"),S("click",function(){return b(a),T(n.sendCommand())}),s(23," Send "),r(),u(24,im,10,8),r()()()}if(e&2){let a,d,x,A=L(8);l(4),_((a=n.command())?4:-1,a),l(),_(v(6,11,n.cleared$)?-1:5),l(2),c("command",n.command())("templateProvider",v(9,13,n.templateProvider$)),l(4),c("expanded",!0)("visible",!!((d=n.command())!=null&&d.constraint)),l(),c("command",n.command())("relto",v(13,15,(x=n.command())==null?null:x.qualifiedName)),l(8),_(n.config.twoStageCommanding?20:-1),l(),c("disabled",n.config.twoStageCommanding&&!n.armControl.value||!v(22,17,n.cleared$)||!A.form.valid),l(3),_(n.showSchedule()?24:-1)}},dependencies:[Xi,na,Zo,hi,fa,qe,De,E,W,Ci,ct,Oe,dt,go,vi,K,Do,J,Z,Oo,Qo,G,Yo,zo],encapsulation:2,changeDetection:0});var tn=Wt;var nm=["top"],ha=t=>({c:t}),om=(t,i)=>({c:t,system:i});function am(t,i){if(t&1&&p(0,"ya-breadcrumb",10),t&2){let e=i.$implicit;c("link",e.route)("queryParams",e.queryParams)("label",e.name)}}function rm(t,i){if(t&1&&(o(0,"ya-filter-bar")(1,"ya-breadcrumb-trail"),p(2,"ya-breadcrumb",9),P(3,am,1,3,"ya-breadcrumb",10,B),r()()),t&2){let e=m(),n=m(2);l(2),c("queryParams",Y(1,ha,n.yamcs.context)),l(),O(e)}}function lm(t,i){t&1&&u(0,rm,5,3,"ya-filter-bar"),t&2&&_(i.length?0:-1)}function sm(t,i){t&1&&(o(0,"th",24),s(1,"Significance"),r())}function mm(t,i){t&1&&p(0,"app-significance-level",26),t&2&&c("level",i.consequenceLevel)}function cm(t,i){t&1&&s(0," - ")}function dm(t,i){if(t&1&&(o(0,"td",25),u(1,mm,1,1,"app-significance-level",26)(2,cm,1,0),r()),t&2){let e,n=i.$implicit;l(),_((e=n.command==null?null:n.command.effectiveSignificance)?1:2,e)}}function pm(t,i){t&1&&(o(0,"th",24),s(1,"Name"),r())}function um(t,i){if(t&1&&(o(0,"mat-icon",28),s(1,"folder"),r(),o(2,"a",29),s(3),h(4,"filename"),r()),t&2){let e=m().$implicit,n=m(3);l(2),c("queryParams",Ie(4,om,n.yamcs.context,e.name)),l(),D(" ",v(4,2,e.name),"/ ")}}function _m(t,i){if(t&1&&p(0,"ya-highlight",31),t&2){let e=m(2).$implicit,n=m(3);c("text",e.command.qualifiedName)("term",n.filterControl.value)}}function Cm(t,i){if(t&1&&(p(0,"ya-highlight",31),h(1,"slice")),t&2){let e=m(2).$implicit,n=m(3);c("text",ni(1,2,e.command.qualifiedName,n.system.length+1))("term",n.filterControl.value)}}function fm(t,i){if(t&1&&(o(0,"mat-icon",28),s(1,"rss_feed"),r(),o(2,"a",30),u(3,_m,1,2,"ya-highlight",31),u(4,Cm,2,5,"ya-highlight",31),r()),t&2){let e=m().$implicit,n=m(3);l(2),c("routerLink","/commanding/send"+e.command.qualifiedName)("queryParams",Y(4,ha,n.yamcs.context)),l(),_(n.system?-1:3),l(),_(n.system?4:-1)}}function hm(t,i){if(t&1&&(o(0,"td",27),u(1,um,5,7),u(2,fm,5,6),r()),t&2){let e=i.$implicit;l(),_(e.system?1:-1),l(),_(e.command?2:-1)}}function gm(t,i){t&1&&(o(0,"th",24),s(1,"Description"),r())}function ym(t,i){if(t&1&&s(0),t&2){let e=m().$implicit;D(" ",e.system.shortDescription||"-"," ")}}function vm(t,i){if(t&1&&p(0,"ya-highlight",31),t&2){let e=m(5);c("text",i)("term",e.filterControl.value)}}function xm(t,i){t&1&&s(0," - ")}function Sm(t,i){if(t&1&&u(0,vm,1,2,"ya-highlight",31)(1,xm,1,0),t&2){let e,n=m().$implicit;_((e=n.command==null?null:n.command.shortDescription)?0:1,e)}}function bm(t,i){if(t&1&&(o(0,"td",32),u(1,ym,1,1),u(2,Sm,2,1),r()),t&2){let e=i.$implicit;l(),_(e.system?1:-1),l(),_(e.command?2:-1)}}function Tm(t,i){if(t&1&&(o(0,"th",24),s(1),r()),t&2){let e=m().$implicit;l(),D(" ",e.label," ")}}function Dm(t,i){if(t&1&&p(0,"ya-highlight",31),t&2){let e=m(5);c("text",i)("term",e.filterControl.value)}}function wm(t,i){t&1&&s(0," - ")}function Em(t,i){if(t&1&&(o(0,"td",25),u(1,Dm,1,2,"ya-highlight",31),h(2,"alias"),Me(3,wm,1,0),r()),t&2){let e,n=i.$implicit,a=m().$implicit;l(),_((e=ni(2,1,n.command,a.id))?1:3,e)}}function Mm(t,i){if(t&1&&(g(0,19),C(1,Tm,2,1,"th",12)(2,Em,4,4,"td",13),y()),t&2){let e=i.$implicit;c("matColumnDef",e.id)}}function Im(t,i){t&1&&p(0,"th",33)}function km(t,i){t&1&&p(0,"td",25)}function Rm(t,i){t&1&&p(0,"tr",34)}function Lm(t,i){if(t&1&&p(0,"tr",35),t&2){let e=i.$implicit,n=m(3);k("selected",n.selection.isSelected(e))}}function Am(t,i){if(t&1&&(o(0,"table",6),g(1,11),C(2,sm,2,0,"th",12)(3,dm,3,1,"td",13),y(),g(4,14),C(5,pm,2,0,"th",15)(6,hm,3,2,"td",16),y(),g(7,17),C(8,gm,2,0,"th",12)(9,bm,3,2,"td",18),y(),P(10,Mm,3,1,"ng-container",19,B),h(12,"async"),g(13,20),C(14,Im,1,0,"th",21)(15,km,1,0,"td",13),y(),C(16,Rm,1,0,"tr",22),h(17,"async"),C(18,Lm,1,2,"tr",23),h(19,"async"),r()),t&2){m();let e=L(7),n=m();c("dataSource",n.dataSource),l(10),O(v(12,3,n.aliasColumns$)),l(6),c("matHeaderRowDef",v(17,5,e.displayedColumns$)),l(2),c("matRowDefColumns",v(19,7,e.displayedColumns$))}}function Pm(t,i){t&1&&s(0," replay ")}function Om(t,i){if(t&1&&(o(0,"ya-empty-message",8)(1,"p"),s(2," You are connected to the "),u(3,Pm,1,0),s(4," processor "),o(5,"strong"),s(6),r(),s(7," . "),r(),o(8,"p"),s(9,"This processor does not support commanding."),r()()),t&2){let e=m();l(3),_(e.processor!=null&&e.processor.replay?3:-1),l(3),I(e.processor==null?null:e.processor.name)}}function Nm(t,i){if(t&1){let e=M();o(0,"ya-panel")(1,"div"),u(2,lm,1,1),h(3,"async"),o(4,"ya-filter-bar")(5,"ya-search-filter",4),S("onArrowDown",function(){b(e);let a=m();return T(a.selectNext())})("onArrowUp",function(){b(e);let a=m();return T(a.selectPrevious())})("onEnter",function(){b(e);let a=m();return T(a.applySelection())}),r(),p(6,"ya-column-chooser",5,1),r(),u(8,Am,20,9,"table",6),p(9,"mat-paginator",7),h(10,"async"),r(),u(11,Om,10,2,"ya-empty-message",8),r()}if(t&2){let e,n=i,a=m();l(),k("noDisplay",!(n.processor!=null&&n.processor.hasCommanding)),l(),_((e=v(3,11,a.breadcrumb$))?2:-1,e),l(3),c("formControl",a.filterControl),l(),c("columns",a.columns),l(2),_(a.dataSource?8:-1),l(),c("pageSize",a.pageSize)("hidePageSize",!0)("showFirstLastButtons",!0)("length",v(10,13,a.dataSource.totalSize$)),l(2),_(n.processor!=null&&n.processor.hasCommanding?-1:11)}}var Kt=class Kt{constructor(i,e,n,a){this.yamcs=e;this.route=n;this.router=a;this.pageSize=100;this.system=null;this.breadcrumb$=new N([]);this.filterControl=new xe;this.columns=[{id:"name",label:"Name",alwaysVisible:!0},{id:"significance",label:"Significance",visible:!0},{id:"shortDescription",label:"Description"},{id:"actions",label:"",alwaysVisible:!0}];this.aliasColumns$=new N([]);this.selection=new Si(!1);i.setTitle("Send a command"),this.connectionInfo$=e.connectionInfo$,this.dataSource=new ra(e)}ngAfterViewInit(){this.filterControl.setValue(this.route.snapshot.queryParamMap.get("filter")),this.changeSystem(this.route.snapshot.queryParamMap),this.queryParamMapSubscription=this.route.queryParamMap.subscribe(i=>{i.get("system")!==this.system&&this.changeSystem(i)}),this.filterControl.valueChanges.subscribe(()=>{this.paginator.pageIndex=0,this.updateDataSource()}),this.paginator.page.subscribe(()=>{this.updateDataSource(),this.top.nativeElement.scrollIntoView()})}changeSystem(i){this.system=i.get("system"),this.updateBrowsePath(),i.has("page")?this.paginator.pageIndex=Number(i.get("page")):this.paginator.pageIndex=0,this.updateDataSource()}updateDataSource(){this.updateURL();let i={system:this.system||"/",noAbstract:!0,details:!0,pos:this.paginator.pageIndex*this.pageSize,limit:this.pageSize,fields:["name","qualifiedName","alias","effectiveSignificance","shortDescription"]},e=this.filterControl.value;e&&(i.q=e.toLowerCase()),this.dataSource.loadCommands(i).then(()=>{this.selection.clear(),this.updateBrowsePath();for(let a of this.aliasColumns$.value){let d=this.columns.indexOf(a);d!==-1&&this.columns.splice(d,1)}let n=[];for(let a of this.dataSource.getAliasNamespaces()){let d={id:a,label:a,alwaysVisible:!0};n.push(d)}this.columns.splice(1,0,...n),this.aliasColumns$.next(n),this.columnChooser.recalculate(this.columns)})}updateURL(){let i=this.filterControl.value;this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{page:this.paginator.pageIndex||null,filter:i||null,system:this.system||null},queryParamsHandling:"merge"})}updateBrowsePath(){let i=[],e="";if(this.system)for(let n of this.system.slice(1).split("/"))e+="/"+n,i.push({name:n,route:"/commanding/send",queryParams:{system:e,c:this.yamcs.context}});this.breadcrumb$.next(i)}selectNext(){let i=this.dataSource.items$.value,e=0;if(this.selection.hasValue()){let n=this.selection.selected[0];i.indexOf(n)!==-1&&(e=Math.min(i.indexOf(n)+1,i.length-1))}this.selection.select(i[e])}selectPrevious(){let i=this.dataSource.items$.value,e=0;if(this.selection.hasValue()){let n=this.selection.selected[0];i.indexOf(n)!==-1&&(e=Math.max(i.indexOf(n)-1,0))}this.selection.select(i[e])}applySelection(){if(this.selection.hasValue()){let i=this.selection.selected[0],e=this.dataSource.items$.value;i.command&&e.indexOf(i)!==-1&&this.router.navigate(["/commanding/send"+i.command?.qualifiedName],{queryParams:{c:this.yamcs.context}})}}ngOnDestroy(){this.queryParamMapSubscription?.unsubscribe()}};Kt.\u0275fac=function(e){return new(e||Kt)(f(X),f($),f(ue),f(_e))},Kt.\u0275cmp=w({type:Kt,selectors:[["ng-component"]],viewQuery:function(e,n){if(e&1&&(j(nm,7),j(Ne,5),j(Ve,5)),e&2){let a;F(a=V())&&(n.top=a.first),F(a=V())&&(n.paginator=a.first),F(a=V())&&(n.columnChooser=a.first)}},decls:7,vars:3,consts:[["top",""],["columnChooser",""],["label","Send a command"],["step","1"],["placeholder","Search by name","icon","search",3,"onArrowDown","onArrowUp","onEnter","formControl"],["preferenceKey","sendCommand",3,"columns"],["mat-table","",1,"ya-data-table","expand",3,"dataSource"],[3,"pageSize","hidePageSize","showFirstLastButtons","length"],["headerTitle","Send a command"],["link","/commanding/send","icon","account_tree",3,"queryParams"],[3,"link","queryParams","label"],["matColumnDef","significance"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["cdkColumnDef","name"],["mat-header-cell","",4,"cdkHeaderCellDef"],["mat-cell","","class","primary-td",4,"matCellDef"],["matColumnDef","shortDescription"],["mat-cell","","class","wrap400",4,"matCellDef"],[3,"matColumnDef"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"selected",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],[3,"level"],["mat-cell","",1,"primary-td"],[1,"icon12",2,"vertical-align","middle"],["routerLink","/commanding/send",3,"queryParams"],[3,"routerLink","queryParams"],[3,"text","term"],["mat-cell","",1,"wrap400"],["mat-header-cell","",1,"expand"],["mat-header-row",""],["mat-row",""]],template:function(e,n){if(e&1&&(o(0,"ya-instance-page"),p(1,"ya-instance-toolbar",2)(2,"span",null,0)(4,"app-send-command-wizard-step",3),u(5,Nm,12,15,"ya-panel"),h(6,"async"),r()),e&2){let a;l(5),_((a=v(6,1,n.connectionInfo$))?5:-1,a)}},dependencies:[qe,E,W,Ci,Ce,yt,vt,Se,Ne,te,ne,le,oe,ie,se,ae,re,me,ce,To,bo,Ve,Ii,$e,ki,J,Z,de,Li,De,G,zn,Oi,Bo],styles:[".pullRight[_ngcontent-%COMP%]{float:right}.primary-td[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{margin-right:7px}"],changeDetection:0});var nn=Kt;function Hm(t,i){t&1&&(o(0,"th",17),s(1,"Time"),r())}function Fm(t,i){if(t&1&&(o(0,"td",18),s(1),h(2,"datetime"),r()),t&2){let e=i.$implicit;l(),D(" ",v(2,1,e.generationTime)," ")}}function Vm(t,i){t&1&&(o(0,"th",19)(1,"mat-icon",20),s(2,"comment"),r()())}function $m(t,i){if(t&1&&(o(0,"mat-icon",22),s(1,"comment"),r()),t&2){let e=m().$implicit;c("matTooltip",e.comment)}}function Qm(t,i){t&1&&s(0," - ")}function Bm(t,i){if(t&1&&(o(0,"td",21),u(1,$m,2,1,"mat-icon",22),u(2,Qm,1,0),r()),t&2){let e=i.$implicit;l(),_(e.comment?1:-1),l(),_(e.comment?-1:2)}}function qm(t,i){t&1&&(o(0,"th",17),s(1,"Command"),r())}function Ym(t,i){if(t&1&&(o(0,"td",18),s(1),r()),t&2){let e=i.$implicit;l(),D(" ",e.commandName||"-"," ")}}function zm(t,i){t&1&&(o(0,"th",17),s(1,"Queue"),r())}function jm(t,i){if(t&1&&(o(0,"td",18),s(1),r()),t&2){let e=i.$implicit;l(),D(" ",e.queueName||"-"," ")}}function Um(t,i){t&1&&(o(0,"th",17),s(1,"Issuer"),r())}function Gm(t,i){if(t&1&&s(0),t&2){let e=m().$implicit;ot(" ",e.username,"@",e.origin," ")}}function Wm(t,i){if(t&1&&s(0),t&2){let e=m().$implicit;D(" ",e.username," ")}}function Km(t,i){if(t&1&&(o(0,"td",18),u(1,Gm,1,2)(2,Wm,1,1),r()),t&2){let e=i.$implicit;l(),_(e.origin?1:2)}}function Jm(t,i){t&1&&(o(0,"th",17),s(1,"Source"),r())}function Zm(t,i){if(t&1&&(o(0,"td",18),s(1),r()),t&2){let e=i.$implicit;l(),D(" ",e.origin||"-"," ")}}function Xm(t,i){t&1&&(o(0,"th",23),s(1,"Command"),r())}function ec(t,i){if(t&1&&(o(0,"tr")(1,"td",25),s(2),r(),o(3,"td",26),s(4),h(5,"value"),r()()),t&2){let e=m().$implicit;l(2),I(e.name),l(2),I(v(5,2,e.value))}}function tc(t,i){if(t&1&&u(0,ec,6,4,"tr"),t&2){let e=i.$implicit;_(e.userInput?0:-1)}}function ic(t,i){if(t&1&&(o(0,"td",18),s(1),o(2,"table",24),P(3,tc,1,1,null,null,B),r()()),t&2){let e=i.$implicit;l(),D(" ",e.commandName," "),l(2),O(e.assignments)}}function nc(t,i){t&1&&(o(0,"th",27),s(1,"Actions"),r())}function oc(t,i){t&1&&(o(0,"span",28)(1,"mat-icon",29),s(2,"cached"),r(),s(3," Checking transmission constraints "),r())}function ac(t,i){if(t&1){let e=M();o(0,"ya-text-action",30),S("click",function(){b(e);let a=m().$implicit,d=m(2);return T(d.acceptEntry(a))}),s(1," ACCEPT "),r(),o(2,"ya-text-action",31),S("click",function(){b(e);let a=m().$implicit,d=m(2);return T(d.rejectEntry(a))}),s(3," REJECT "),r()}if(t&2){let e=m().$implicit;c("disabled",e.pendingTransmissionConstraints),l(2),c("disabled",e.pendingTransmissionConstraints)}}function rc(t,i){if(t&1&&(o(0,"td",18),u(1,oc,4,0,"span",28),u(2,ac,4,2),r()),t&2){let e=i.$implicit;l(),_(e.pendingTransmissionConstraints?1:-1),l(),_(e.pendingTransmissionConstraints?-1:2)}}function lc(t,i){t&1&&p(0,"tr",32)}function sc(t,i){t&1&&p(0,"tr",33)}function mc(t,i){if(t&1&&(o(0,"table",0),g(1,1),C(2,Hm,2,0,"th",2)(3,Fm,3,3,"td",3),y(),g(4,4),C(5,Vm,3,0,"th",5)(6,Bm,3,2,"td",6),y(),g(7,7),C(8,qm,2,0,"th",2)(9,Ym,2,1,"td",3),y(),g(10,8),C(11,zm,2,0,"th",2)(12,jm,2,1,"td",3),y(),g(13,9),C(14,Um,2,0,"th",2)(15,Km,3,1,"td",3),y(),g(16,10),C(17,Jm,2,0,"th",2)(18,Zm,2,1,"td",3),y(),g(19,11),C(20,Xm,2,0,"th",12)(21,ic,5,1,"td",3),y(),g(22,13),C(23,nc,2,0,"th",14)(24,rc,3,2,"td",3),y(),C(25,lc,1,0,"tr",15)(26,sc,1,0,"tr",16),r()),t&2){let e=m();c("dataSource",e.dataSource),l(25),c("matHeaderRowDef",e.displayedColumns),l(),c("matRowDefColumns",e.displayedColumns)}}var Jt=class Jt{constructor(i){this.yamcs=i;this.dataSource=new be;this.displayedColumns=["generationTime","comment","source","queueName","issuer","actions"]}ngAfterViewInit(){this.dataSource.sort=this.sort,this.cqueues$.subscribe(i=>{let e=[];for(let n of i)n.entries&&e.push(...n.entries);this.dataSource.data=e})}acceptEntry(i){confirm(`Are you sure you want to accept this command?

 ${i.commandName}`)&&this.yamcs.yamcsClient.acceptCommand(i.instance,i.processorName,i.queueName,i.id)}rejectEntry(i){confirm(`Are you sure you want to reject this command?

 ${i.commandName}`)&&this.yamcs.yamcsClient.rejectCommand(i.instance,i.processorName,i.queueName,i.id)}};Jt.\u0275fac=function(e){return new(e||Jt)(f($))},Jt.\u0275cmp=w({type:Jt,selectors:[["app-queued-commands-table"]],viewQuery:function(e,n){if(e&1&&j(He,5),e&2){let a;F(a=V())&&(n.sort=a.first)}},inputs:{cqueues$:"cqueues$"},decls:1,vars:1,consts:[["mat-table","","matSort","","matSortActive","generationTime","matSortDirection","asc","matSortDisableClear","",1,"ya-data-table","expand",3,"dataSource"],["matColumnDef","generationTime"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","comment"],["mat-header-cell","","style","text-align: center",4,"matHeaderCellDef"],["mat-cell","","style","text-align: center",4,"matCellDef"],["matColumnDef","commandName"],["matColumnDef","queueName"],["matColumnDef","issuer"],["matColumnDef","origin"],["matColumnDef","source"],["mat-header-cell","","mat-sort-header","","style","width: 350px",4,"matHeaderCellDef"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell","",2,"text-align","center"],["matTooltip","Comment"],["mat-cell","",2,"text-align","center"],[3,"matTooltip"],["mat-header-cell","","mat-sort-header","",2,"width","350px"],[1,"args"],["width","1",1,"key"],[1,"value"],["mat-header-cell","",1,"expand"],[2,"color","#999"],[1,"icon16","spin",2,"vertical-align","middle"],["icon","check",3,"click","disabled"],["icon","close",3,"click","disabled"],["mat-header-row",""],["mat-row",""]],template:function(e,n){e&1&&u(0,mc,27,3,"table",0),e&2&&_(n.dataSource?0:-1)},dependencies:[E,Se,He,Di,te,ne,le,oe,ie,se,ae,re,me,ce,gi,Ro,ye,Mt],styles:[".args[_ngcontent-%COMP%]{margin:0 0 0 10px}.args[_ngcontent-%COMP%]   .key[_ngcontent-%COMP%]{min-width:120px;white-space:nowrap}.args[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:gray;padding-left:10px}.args[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .args[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border:none;font-size:10px;line-height:12px;font-family:Roboto Mono,monospace}.spin[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_yspin 2s infinite linear}@keyframes _ngcontent-%COMP%_yspin{0%{-webkit-transform:rotate(0deg) scaleX(-1);transform:rotate(0) scaleX(-1)}to{-webkit-transform:rotate(359deg) scaleX(-1);transform:rotate(359deg) scaleX(-1)}}"],changeDetection:0});var on=Jt;function cc(t,i){if(t&1&&p(0,"app-queued-commands-table",1),t&2){let e=m();c("cqueues$",e.cqueues$)}}function dc(t,i){t&1&&s(0,` All queues are empty.
`)}function pc(t,i){t&1&&s(0,"All queues are empty.")}var Zt=class Zt{constructor(i){this.cqueues$=new N([]);this.hasEntries$=new N(!1);this.cqueueByName={};i.yamcsClient.getCommandQueues(i.instance,i.processor).then(e=>{for(let n of e)this.cqueueByName[n.name]=n;this.emitChange()}),this.queueEventSubscription=i.yamcsClient.createQueueEventsSubscription({instance:i.instance,processor:i.processor},e=>{let n=this.cqueueByName[e.data.queueName];if(n){if(e.type==="COMMAND_ADDED")n.entries=n.entries||[],n.entries.push(e.data);else if(e.type==="COMMAND_UPDATED"){let a=(n.entries||[]).findIndex(d=>d.id===e.data.id);a!==-1&&(n.entries[a]=e.data)}else if(e.type==="COMMAND_REJECTED")n.entries=n.entries||[],n.entries=n.entries.filter(a=>a.id!==e.data.id);else if(e.type==="COMMAND_SENT")n.entries=n.entries||[],n.entries=n.entries.filter(a=>a.id!==e.data.id);else throw new Error(`Unexpected queue event ${e.type}`);this.emitChange()}else console.warn("Received an event for an unknown queue",e)})}emitChange(){this.cqueues$.next(Object.values(this.cqueueByName));let i=!1;for(let e of this.cqueues$.getValue())if(e.entries&&e.entries.length){i=!0;break}this.hasEntries$.next(i)}ngOnDestroy(){this.queueEventSubscription?.cancel()}};Zt.\u0275fac=function(e){return new(e||Zt)(f($))},Zt.\u0275cmp=w({type:Zt,selectors:[["ng-component"]],decls:5,vars:3,consts:[["empty",""],[3,"cqueues$"]],template:function(e,n){e&1&&(u(0,cc,1,1,"app-queued-commands-table",1),h(1,"async"),Me(2,dc,1,0),C(3,pc,1,0,"ng-template",null,0,pi)),e&2&&_(v(1,1,n.hasEntries$)?0:2)},dependencies:[E,on,G],encapsulation:2,changeDetection:0});var an=Zt;function uc(t,i){if(t&1){let e=M();p(0,"ya-date-time-input",12)(1,"ya-date-time-input",13),o(2,"ya-button",14),S("click",function(){b(e);let a=m();return T(a.applyCustomDates())}),s(3,"Apply"),r()}if(t&2){let e=m();l(2),c("disabled",e.filterForm.invalid)}}function _c(t,i){if(t&1){let e=M();o(0,"ya-button",15),S("click",function(){b(e);let a=m();return T(a.jumpToNow())}),s(1,"Jump to now"),r()}}function Cc(t,i){t&1&&(o(0,"th",16),s(1,"Time"),r())}function fc(t,i){if(t&1&&(o(0,"td",17),s(1),h(2,"datetime"),r()),t&2){let e=i.$implicit;l(),I(v(2,1,e.time))}}function hc(t,i){t&1&&(o(0,"th",16),s(1,"User"),r())}function gc(t,i){if(t&1&&(o(0,"td",17),s(1),r()),t&2){let e=i.$implicit;l(),I(e.user||"-")}}function yc(t,i){t&1&&(o(0,"th",16),s(1,"Action"),r())}function vc(t,i){if(t&1&&(o(0,"td",17),p(1,"ya-action-log-summary",18),r()),t&2){let e=i.$implicit;l(),c("text",e.summary)}}function xc(t,i){t&1&&p(0,"th",19)}function Sc(t,i){t&1&&p(0,"td",17)}function bc(t,i){t&1&&p(0,"tr",20)}function Tc(t,i){t&1&&p(0,"tr",21)}var Xt=class Xt{constructor(i,e,n,a,d){this.yamcs=e;this.messageService=n;this.router=a;this.route=d;this.interval=U();this.customStart=U();this.customStop=U();this.filterForm=new st({interval:new ee("NO_LIMIT"),customStart:new ee(null),customStop:new ee(null)});this.displayedColumns=["time","user","summary","actions"];this.intervalOptions=[{id:"PT1H",label:"Last hour"},{id:"PT6H",label:"Last 6 hours"},{id:"P1D",label:"Last 24 hours"},{id:"NO_LIMIT",label:"No limit"},{id:"CUSTOM",label:"Custom",group:!0}];this.dataSource=new be;i.setTitle("Queues")}ngOnInit(){this.initializeOptions(),this.loadData(),this.filterForm.get("interval").valueChanges.forEach(i=>{if(i==="CUSTOM"){let e=new Date,n=this.validStart||e,a=this.validStop||e;this.filterForm.get("customStart").setValue(R.toISOString(n)),this.filterForm.get("customStop").setValue(R.toISOString(a))}else i==="NO_LIMIT"?(this.validStart=null,this.validStop=null,this.appliedInterval=i,this.loadData()):i&&(this.validStop=new Date,this.validStart=R.subtractDuration(this.validStop,i),this.appliedInterval=i,this.loadData())})}initializeOptions(){if(this.interval())if(this.appliedInterval=this.interval(),this.filterForm.get("interval").setValue(this.appliedInterval),this.appliedInterval==="CUSTOM"){let i=this.customStart();this.filterForm.get("customStart").setValue(i),this.validStart=R.toDate(i);let e=this.customStop();this.filterForm.get("customStop").setValue(e),this.validStop=R.toDate(e)}else this.appliedInterval==="NO_LIMIT"?(this.validStart=null,this.validStop=null):(this.validStop=new Date,this.validStart=R.subtractDuration(this.validStop,this.appliedInterval));else this.appliedInterval="NO_LIMIT",this.validStop=null,this.validStart=null}jumpToNow(){this.filterForm.get("interval").setValue("NO_LIMIT")}applyCustomDates(){let{controls:i}=this.filterForm;this.validStart=R.toDate(i.customStart.value),this.validStop=R.toDate(i.customStop.value),this.appliedInterval="CUSTOM",this.loadData()}loadData(){this.updateURL();let i={service:"QueuesApi"};this.validStart&&(i.start=this.validStart.toISOString()),this.validStop&&(i.stop=this.validStop.toISOString()),this.yamcs.yamcsClient.getAuditRecords(this.yamcs.instance,i).then(e=>this.dataSource.data=e.records||[]).catch(e=>this.messageService.showError(e))}updateURL(){let{controls:i}=this.filterForm;this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{interval:this.appliedInterval,customStart:this.appliedInterval==="CUSTOM"?i.customStart.value:null,customStop:this.appliedInterval==="CUSTOM"?i.customStop.value:null},queryParamsHandling:"merge"})}};Xt.\u0275fac=function(e){return new(e||Xt)(f(X),f($),f(Fe),f(_e),f(ue))},Xt.\u0275cmp=w({type:Xt,selectors:[["app-queues-action-log-tab"]],inputs:{interval:[1,"interval"],customStart:[1,"customStart"],customStop:[1,"customStop"]},decls:19,vars:7,consts:[[3,"formGroup"],["icon","access_time","formControlName","interval",3,"options"],["mat-table","",1,"ya-data-table","expand",3,"dataSource"],["matColumnDef","time"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","user"],["matColumnDef","summary"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["formControlName","customStart"],["formControlName","customStop"],[3,"click","disabled"],[3,"click"],["mat-header-cell",""],["mat-cell",""],[3,"text"],["mat-header-cell","",1,"expand"],["mat-header-row",""],["mat-row",""]],template:function(e,n){e&1&&(o(0,"ya-filter-bar",0),p(1,"ya-select",1),u(2,uc,4,1),u(3,_c,2,0,"ya-button"),r(),o(4,"table",2),g(5,3),C(6,Cc,2,0,"th",4)(7,fc,3,3,"td",5),y(),g(8,6),C(9,hc,2,0,"th",4)(10,gc,2,1,"td",5),y(),g(11,7),C(12,yc,2,0,"th",4)(13,vc,2,1,"td",5),y(),g(14,8),C(15,xc,1,0,"th",9)(16,Sc,1,0,"td",5),y(),C(17,bc,1,0,"tr",10)(18,Tc,1,0,"tr",11),r()),e&2&&(c("formGroup",n.filterForm),l(),c("options",n.intervalOptions),l(),_(n.filterForm.value.interval==="CUSTOM"?2:-1),l(),_(n.filterForm.value.interval!=="CUSTOM"?3:-1),l(),c("dataSource",n.dataSource),l(13),c("matHeaderRowDef",n.displayedColumns),l(),c("matRowDefColumns",n.displayedColumns))},dependencies:[E,W,fe,he,ge,te,ne,le,oe,ie,se,ae,re,me,ce,wi,K,Te,$e,Qe,ye],encapsulation:2,changeDetection:0});var rn=Xt;var ga=t=>({c:t}),Dc=(t,i)=>({c:t,queue:i});function wc(t,i){t&1&&(s(0," Queues "),o(1,"ya-help")(2,"p"),s(3," A queue is a temporary holding location for issued commands that are waiting to enter the next stage of processing. "),r(),o(4,"p"),s(5,"Queues are an ordered list. Issued commands are offered to the first matching queue."),r(),o(6,"p"),s(7,"A queue can perform these actions:"),r(),o(8,"table",8)(9,"tr")(10,"th",9),s(11,"ACCEPT"),r(),o(12,"td"),s(13,"The queue accepts and releases commands."),r()(),o(14,"tr")(15,"th"),s(16,"HOLD"),r(),o(17,"td"),s(18," The queue accepts commands but does not release them. These commands may be released manually, or automatically as soon as the queue action changes to ACCEPT. "),r()(),o(19,"tr")(20,"th"),s(21,"REJECT"),r(),o(22,"td"),s(23,"The queue does not accept commands. Matching commands fail immediately."),r()()()())}function Ec(t,i){if(t&1){let e=M();o(0,"th",31),S("click",function(a){return b(e),L(2).toggle(),T(a.stopPropagation())}),p(1,"ya-table-checkbox",32,3),r()}if(t&2){let e=m(3);l(),c("dataSource",e.dataSource)("selection",e.selection)}}function Mc(t,i){if(t&1){let e=M();o(0,"td",33),S("click",function(a){return b(e),L(2).toggle(),T(a.stopPropagation())}),p(1,"ya-table-checkbox",34,3),r()}if(t&2){let e=i.$implicit,n=m(3);l(),c("dataSource",n.dataSource)("selection",n.selection)("item",e)}}function Ic(t,i){t&1&&(o(0,"th",35),s(1,"#"),r())}function kc(t,i){if(t&1&&(o(0,"td",36),s(1),r()),t&2){let e=i.$implicit;l(),D(" ",e.order," ")}}function Rc(t,i){t&1&&(o(0,"th",35),s(1,"Queue"),r())}function Lc(t,i){if(t&1&&(o(0,"td",36),s(1),r()),t&2){let e=i.$implicit;l(),D(" ",e.name," ")}}function Ac(t,i){t&1&&(o(0,"th",35),s(1,"Issuer"),r())}function Pc(t,i){if(t&1&&(o(0,"ya-label",37),s(1),r()),t&2){let e=i.$implicit;l(),I(e)}}function Oc(t,i){if(t&1&&(o(0,"ya-label",38),s(1),r()),t&2){let e=i.$implicit;l(),I(e)}}function Nc(t,i){t&1&&s(0," any ")}function Hc(t,i){if(t&1&&(o(0,"td",36),P(1,Pc,2,1,"ya-label",37,B),P(3,Oc,2,1,"ya-label",38,B),u(5,Nc,1,0),r()),t&2){let e=i.$implicit;l(),O(e.groups),l(2),O(e.users),l(2),_(!e.groups&&!e.users?5:-1)}}function Fc(t,i){t&1&&(o(0,"th",35),s(1,"Min.\xA0level"),r())}function Vc(t,i){if(t&1&&(o(0,"td",36),p(1,"app-significance-level",39),r()),t&2){let e=i.$implicit;l(),c("level",e.minLevel)("grayscale",!0)}}function $c(t,i){t&1&&(o(0,"th",35),s(1,"Name\xA0patterns"),r())}function Qc(t,i){t&1&&s(0," any ")}function Bc(t,i){if(t&1&&(s(0),p(1,"br")),t&2){let e=i.$implicit;D(" ",e," ")}}function qc(t,i){if(t&1&&(o(0,"td",36),u(1,Qc,1,0),P(2,Bc,2,1,null,null,B),r()),t&2){let e=i.$implicit;l(),_(e.tcPatterns?-1:1),l(),O(e.tcPatterns)}}function Yc(t,i){t&1&&(o(0,"th",35),s(1,"Action"),r())}function zc(t,i){t&1&&(o(0,"span"),s(1,"ACCEPT"),r())}function jc(t,i){if(t&1&&(o(0,"span"),h(1,"async"),s(2,"HOLD"),r()),t&2){let e=m(4);Pe("visibility",v(1,2,e.visibility$)?"visible":"hidden")}}function Uc(t,i){t&1&&(o(0,"span"),s(1,"REJECT"),r())}function Gc(t,i){if(t&1&&(o(0,"td",36),u(1,zc,2,0,"span"),u(2,jc,3,4,"span",40),u(3,Uc,2,0,"span"),r()),t&2){let e=i.$implicit;l(),_(e.state==="ENABLED"?1:-1),l(),_(e.state==="BLOCKED"?2:-1),l(),_(e.state==="DISABLED"?3:-1)}}function Wc(t,i){t&1&&(o(0,"th",35),s(1,"Pending"),r())}function Kc(t,i){if(t&1&&(o(0,"td",41),s(1),h(2,"number"),r()),t&2){let e=i.$implicit;l(),D(" ",v(2,1,(e.entries==null?null:e.entries.length)||0)," ")}}function Jc(t,i){t&1&&p(0,"th",42)}function Zc(t,i){if(t&1){let e=M();o(0,"td",36)(1,"ya-more")(2,"button",7),S("click",function(){let a=b(e).$implicit,d=m(3);return T(d.enableQueue(a))}),o(3,"mat-icon"),s(4,"check"),r(),s(5," Accept mode "),r(),o(6,"button",7),S("click",function(){let a=b(e).$implicit,d=m(3);return T(d.blockQueue(a))}),o(7,"mat-icon"),s(8,"pause"),r(),s(9," Hold mode "),r(),o(10,"button",7),S("click",function(){let a=b(e).$implicit,d=m(3);return T(d.disableQueue(a))}),o(11,"mat-icon"),s(12,"close"),r(),s(13," Reject mode "),r(),p(14,"mat-divider"),o(15,"a",43),s(16," View command history "),r()()()}if(t&2){let e=i.$implicit,n=m(3);l(15),c("queryParams",Ie(1,Dc,n.yamcs.context,e.name))}}function Xc(t,i){t&1&&p(0,"tr",44)}function ed(t,i){if(t&1){let e=M();o(0,"tr",45),S("click",function(){let a=b(e).$implicit,d=m(3);return T(d.toggleOne(a))}),r()}if(t&2){let e=i.$implicit,n=m(3);k("selected",n.selection.isSelected(e))}}function td(t,i){if(t&1&&(o(0,"table",10),g(1,14),C(2,Ec,3,2,"th",15)(3,Mc,3,3,"td",16),y(),g(4,17),C(5,Ic,2,0,"th",18)(6,kc,2,1,"td",19),y(),g(7,20),C(8,Rc,2,0,"th",18)(9,Lc,2,1,"td",19),y(),g(10,21),C(11,Ac,2,0,"th",18)(12,Hc,6,1,"td",19),y(),g(13,22),C(14,Fc,2,0,"th",18)(15,Vc,2,2,"td",19),y(),g(16,23),C(17,$c,2,0,"th",18)(18,qc,4,1,"td",19),y(),g(19,24),C(20,Yc,2,0,"th",18)(21,Gc,4,3,"td",19),y(),g(22,25),C(23,Wc,2,0,"th",18)(24,Kc,3,3,"td",26),y(),g(25,27),C(26,Jc,1,0,"th",28)(27,Zc,17,4,"td",19),y(),C(28,Xc,1,0,"tr",29)(29,ed,1,2,"tr",30),r()),t&2){let e=m(2);c("dataSource",e.dataSource)("trackBy",e.tableTrackerFn),l(28),c("matHeaderRowDef",e.displayedColumns),l(),c("matRowDefColumns",e.displayedColumns)}}function id(t,i){if(t&1&&(u(0,td,30,4,"table",10),o(1,"p"),s(2,"\xA0"),r(),o(3,"ya-page-tabs")(4,"a",11,1),s(6," Pending "),r(),o(7,"a",12,2),s(9," Action log "),r()(),o(10,"div",13),p(11,"router-outlet"),r()),t&2){let e=L(5),n=L(8),a=m();_(a.dataSource?0:-1),l(4),k("active",e.isActive),c("queryParams",Y(7,ga,a.yamcs.context)),l(3),k("active",n.isActive),c("queryParams",Y(9,ga,a.yamcs.context))}}function nd(t,i){t&1&&s(0," replay ")}function od(t,i){if(t&1&&(o(0,"ya-empty-message",46)(1,"p"),s(2," You are connected to the "),u(3,nd,1,0),s(4," processor "),o(5,"strong"),s(6),r(),s(7," . "),r(),o(8,"p"),s(9,"This processor does not support commanding."),r()()),t&2){let e=i;l(3),_(e.processor!=null&&e.processor.replay?3:-1),l(3),I(e.processor==null?null:e.processor.name)}}function ad(t,i){if(t&1&&(u(0,od,10,2,"ya-empty-message",46),h(1,"async")),t&2){let e,n=m();_((e=v(1,1,n.connectionInfo$))?0:-1,e)}}var ei=class ei{constructor(i,e,n,a,d){this.yamcs=i;this.changeDetection=a;this.cqueues$=new N([]);this.dataSource=new be;this.selection=new Go((i,e)=>e.name,!0,[]);this.tableTrackerFn=(i,e)=>e.name;this.displayedColumns=["select","order","name","issuer","level","patterns","action","pending","actions"];this.visibility$=new N(!0);this.cqueueByName={};e.setTitle("Queues"),this.connectionInfo$=i.connectionInfo$,i.yamcsClient.getCommandQueues(i.instance,i.processor).then(x=>{for(let A of x)this.cqueueByName[A.name]=A;this.emitChange()}).catch(x=>n.showError(x)),this.syncSubscription=d.syncFast(()=>{this.visibility$.next(!this.visibility$.value)}),this.queueSubscription=i.yamcsClient.createQueueStatisticsSubscription({instance:i.instance,processor:i.processor},x=>{let A=this.cqueueByName[x.name];A&&(x.entries=A.entries,this.cqueueByName[x.name]=x,this.emitChange())}),this.queueEventSubscription=i.yamcsClient.createQueueEventsSubscription({instance:i.instance,processor:i.processor},x=>{let A=this.cqueueByName[x.data.queueName];if(A){if(x.type==="COMMAND_ADDED")A.entries=A.entries||[],A.entries.push(x.data);else if(x.type==="COMMAND_UPDATED"){let Ye=(A.entries||[]).findIndex(Dn=>Dn.id===x.data.id);Ye!==-1&&(A.entries[Ye]=x.data)}else if(x.type==="COMMAND_REJECTED")A.entries=A.entries||[],A.entries=A.entries.filter(Ye=>Ye.id!==x.data.id);else if(x.type==="COMMAND_SENT")A.entries=A.entries||[],A.entries=A.entries.filter(Ye=>Ye.id!==x.data.id);else throw new Error(`Unexpected queue event ${x.type}`);this.emitChange()}else console.warn("Received an event for an unknown queue",x)})}ngAfterViewInit(){this.cqueues$.subscribe(i=>{this.dataSource.data=i,this.selection.matchNewValues(i),this.changeDetection.detectChanges()})}toggleOne(i){(!this.selection.isSelected(i)||this.selection.selected.length>1)&&this.selection.clear(),this.selection.toggle(i)}enableSelectedQueues(){for(let i of this.selection.selected)this.enableQueue(i)}enableQueue(i){let e=i.entries?.length||0,n=`Are you sure you want to change the '${i.name}' queue's action to ACCEPT?

`;e===1?n+=`There is ${e} queued command that will be accepted immediately.`:n+=`There are ${e} queued commands that will be accepted immediately.`,!(e&&!confirm(n))&&this.yamcs.yamcsClient.enableCommandQueue(i.instance,i.processorName,i.name)}disableSelectedQueues(){for(let i of this.selection.selected)this.disableQueue(i)}disableQueue(i){let e=i.entries?.length||0,n=`Are you sure you want to change the '${i.name}' queue's action to REJECT?

`;e===1?n+=`There is ${e} queued command that will be rejected immediately.`:n+=`There are ${e} queued commands that will be rejected immediately.`,!(e&&!confirm(n))&&this.yamcs.yamcsClient.disableCommandQueue(i.instance,i.processorName,i.name)}blockSelectedQueues(){for(let i of this.selection.selected)this.blockQueue(i)}blockQueue(i){this.yamcs.yamcsClient.blockCommandQueue(i.instance,i.processorName,i.name)}emitChange(){this.cqueues$.next(Object.values(this.cqueueByName))}ngOnDestroy(){this.syncSubscription?.unsubscribe(),this.queueSubscription?.cancel(),this.queueEventSubscription?.cancel()}};ei.\u0275fac=function(e){return new(e||ei)(f($),f(X),f(Fe),f(at),f(yo))},ei.\u0275cmp=w({type:ei,selectors:[["ng-component"]],decls:23,vars:5,consts:[["actionMenu","matMenu"],["rla","routerLinkActive"],["rlb","routerLinkActive"],["cb",""],["ya-instance-toolbar-label",""],["dropdown","true",3,"matMenuTriggerFor","disabled"],[1,"ya-menu"],["mat-menu-item","",3,"click"],["yaDataTable",""],["width","1"],["mat-table","",1,"ya-data-table","expand",3,"dataSource","trackBy"],["routerLink","/commanding/queues/pending","routerLinkActive","",3,"queryParams"],["routerLink","/commanding/queues/log","routerLinkActive","",3,"queryParams"],[2,"margin-top","16px"],["cdkColumnDef","select"],["mat-header-cell","","class","checkbox",3,"click",4,"cdkHeaderCellDef"],["mat-cell","","class","checkbox",3,"click",4,"cdkCellDef"],["matColumnDef","order"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["matColumnDef","issuer"],["matColumnDef","level"],["matColumnDef","patterns"],["matColumnDef","action"],["matColumnDef","pending"],["mat-cell","","style","text-align: center",4,"matCellDef"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"selected","click",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",1,"checkbox",3,"click"],[3,"dataSource","selection"],["mat-cell","",1,"checkbox",3,"click"],[3,"dataSource","selection","item"],["mat-header-cell",""],["mat-cell",""],["icon","people"],["icon","person"],[3,"level","grayscale"],[3,"visibility"],["mat-cell","",2,"text-align","center"],["mat-header-cell","",1,"expand"],["mat-menu-item","","routerLink","/commanding/history",3,"queryParams"],["mat-header-row",""],["mat-row","",3,"click"],["headerTitle","Queues"]],template:function(e,n){if(e&1){let a=M();o(0,"ya-instance-page")(1,"ya-instance-toolbar"),C(2,wc,24,0,"ng-template",4),o(3,"ya-page-button",5),s(4," Change action "),r(),o(5,"mat-menu",6,0)(7,"button",7),S("click",function(){return b(a),T(n.enableSelectedQueues())}),o(8,"mat-icon"),s(9,"check"),r(),s(10," ACCEPT "),r(),o(11,"button",7),S("click",function(){return b(a),T(n.blockSelectedQueues())}),o(12,"mat-icon"),s(13,"pause"),r(),s(14," HOLD "),r(),o(15,"button",7),S("click",function(){return b(a),T(n.disableSelectedQueues())}),o(16,"mat-icon"),s(17,"close"),r(),s(18," REJECT "),r()()(),o(19,"ya-panel"),u(20,id,12,11),h(21,"async"),Me(22,ad,2,3),r()()}if(e&2){let a,d=L(6);l(3),c("matMenuTriggerFor",d)("disabled",n.selection.isEmpty()),l(17),_(!((a=v(21,3,n.connectionInfo$))==null||a.processor==null)&&a.processor.hasCommanding?20:22)}},dependencies:[E,Un,Ce,_i,Pi,Ti,yt,vt,Se,gt,ct,Oe,dt,te,ne,le,oe,ie,se,ae,re,me,ce,Ii,Tt,J,Z,Dt,Lo,Et,wt,Ri,de,Ai,De,G,Yn],encapsulation:2,changeDetection:0});var ln=ei;var rd=t=>{let i=t,e=t.findIndex(a=>a.path==="-");e!==-1&&(i=t.slice(0,e));let n="/"+i.map(a=>a.path).join("/");return{consumed:i,posParams:{command:new jn(n,{})}}},UC=[{path:"",canActivate:[Cn,_n],canActivateChild:[fn],runGuardsAndResolvers:"always",component:Jo,children:[{path:"clearances",canActivate:[ma],children:[{path:"",pathMatch:"full",component:Vi},{path:"log",component:Hi}]},{path:"send",children:[{path:"",pathMatch:"full",component:nn},{matcher:rd,children:[{path:"",pathMatch:"full",component:tn},{path:"-/report/:commandId",component:Gi}]}]},{path:"history",children:[{path:"",pathMatch:"full",component:ji},{path:":commandId",component:Ui}]},{path:"queues",component:ln,canActivate:[la],children:[{path:"",pathMatch:"full",redirectTo:"pending"},{path:"pending",component:an},{path:"log",component:rn}]},{path:"ext",canActivate:[Cn,_n],canActivateChild:[fn],runGuardsAndResolvers:"always",children:[{matcher:Ko,component:Wo}]}]}];export{UC as ROUTES};
