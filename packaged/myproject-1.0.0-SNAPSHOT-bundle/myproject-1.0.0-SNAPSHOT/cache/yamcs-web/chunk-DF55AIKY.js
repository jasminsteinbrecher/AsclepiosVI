import{a as hi,b as vi}from"./chunk-L67MW52F.js";import{Aa as F,Bf as ye,Ca as v,Cb as ze,Cc as ue,Cg as ui,D as Mt,Dg as st,Ea as c,Ef as ri,Eg as ct,F as S,Fc as _e,Fh as I,G as y,Gb as Ye,Gc as Yt,Gh as Ci,Hc as Ht,Hg as mt,Hh as gi,Ia as bt,Ib as He,Ic as Gt,If as O,Ja as Tt,Jb as Nt,Je as Ce,K as Re,Ka as Ft,Kb as Lt,Ke as Qe,Kf as A,Le as Jt,Lf as li,Me as ge,N as $e,Na as J,Ne as Je,Oa as kt,Oe as Zt,Pa as M,Pc as Wt,Pe as ve,Ra as s,Rc as z,Rf as at,Sa as $,T as Pt,Ta as C,Tc as qe,Ua as Ae,Uc as he,Uf as si,V as l,Wc as Xe,Xa as Be,Xc as Ke,Y as w,Ya as k,Ye as Y,Yf as ci,Za as Ve,Ze,_ as P,_a as wt,_b as Rt,_e as et,a as Pe,af as tt,b as Ne,bb as _,bf as te,cb as h,cf as ei,cg as ot,da as u,db as Dt,df as H,ef as it,eg as mi,f as E,fa as ke,gb as je,gf as nt,gh as dt,hf as ie,hh as ae,ib as j,if as ti,ja as oe,jc as $t,jf as G,ka as p,kb as Ue,kf as ne,kg as rt,lc as At,lf as Se,ma as f,mc as Ge,mf as ii,mg as W,na as N,nc as Bt,ne as qt,oa as L,oc as Vt,oe as Xt,og as di,pa as R,pb as de,pe as Kt,pg as lt,qa as m,qb as It,qc as Et,qe as Qt,ra as o,rf as ni,sa as r,sb as Z,sc as pe,ta as T,tc as fe,uc as jt,uh as _i,vc as Ut,wc as We,xa as x,xc as ee,y as Le,ya as b,yc as zt,yf as ai,yg as pi,zf as oi,zg as fi}from"./chunk-OXOWQRWE.js";var Pi=()=>({matrixParams:"exact",paths:"exact",queryParams:"ignored"}),Si=(i,t)=>({c:i,service:t}),xe=class xe{constructor(t){this.yamcs=t;this.service=j()}};xe.\u0275fac=function(e){return new(e||xe)(w(A))},xe.\u0275cmp=P({type:xe,selectors:[["app-file-transfer-tabs"]],inputs:{service:[1,"service"]},decls:7,vars:14,consts:[["rla","routerLinkActive"],["rlb","routerLinkActive"],["routerLink","/file-transfer","routerLinkActive","",3,"routerLinkActiveOptions","queryParams"],["routerLink","/file-transfer/log","routerLinkActive","",3,"queryParams"]],template:function(e,n){if(e&1&&(o(0,"ya-page-tabs")(1,"a",2,0),s(3," Transfers "),r(),o(4,"a",3,1),s(6," Action log "),r()()),e&2){let a,d,D=J(2),B=J(5);l(),M("active",D.isActive),m("routerLinkActiveOptions",k(7,Pi))("queryParams",wt(8,Si,n.yamcs.context,(a=n.service())==null?null:a.name)),l(3),M("active",B.isActive),m("queryParams",wt(11,Si,n.yamcs.context,(d=n.service())==null?null:d.name))}},dependencies:[I,Nt,Lt,ui],styles:[".mat-mdc-tab-link[_ngcontent-%COMP%]{height:36px;min-width:0;font-size:13px}"],changeDetection:0});var be=xe;function Ii(i,t){if(i&1){let e=F();T(0,"ya-date-time-input",13)(1,"ya-date-time-input",14),o(2,"ya-button",15),v("click",function(){S(e);let a=c();return y(a.applyCustomDates())}),s(3,"Apply"),r()}if(i&2){let e=c();l(2),m("disabled",e.filterForm.invalid)}}function Ni(i,t){if(i&1){let e=F();o(0,"ya-button",16),v("click",function(){S(e);let a=c();return y(a.jumpToNow())}),s(1,"Jump to now"),r()}}function Li(i,t){i&1&&(o(0,"th",17),s(1,"Time"),r())}function Ri(i,t){if(i&1&&(o(0,"td",18),s(1),_(2,"datetime"),r()),i&2){let e=t.$implicit;l(),$(h(2,1,e.time))}}function $i(i,t){i&1&&(o(0,"th",17),s(1,"User"),r())}function Ai(i,t){if(i&1&&(o(0,"td",18),s(1),r()),i&2){let e=t.$implicit;l(),$(e.user||"-")}}function Bi(i,t){i&1&&(o(0,"th",17),s(1,"Action"),r())}function Vi(i,t){if(i&1&&(o(0,"td",18),T(1,"ya-action-log-summary",19),r()),i&2){let e=t.$implicit;l(),m("text",e.summary)}}function ji(i,t){i&1&&T(0,"th",20)}function Ui(i,t){i&1&&T(0,"td",18)}function zi(i,t){i&1&&T(0,"tr",21)}function Yi(i,t){i&1&&T(0,"tr",22)}var we=class we{constructor(t,e,n,a,d){this.yamcs=t;this.messageService=e;this.router=n;this.route=a;this.interval=j();this.customStart=j();this.customStop=j();this.filterForm=new jt({interval:new We("NO_LIMIT"),customStart:new We(null),customStop:new We(null)});this.displayedColumns=["time","user","summary","actions"];this.intervalOptions=[{id:"PT1H",label:"Last hour"},{id:"PT6H",label:"Last 6 hours"},{id:"P1D",label:"Last 24 hours"},{id:"NO_LIMIT",label:"No limit"},{id:"CUSTOM",label:"Custom",group:!0}];this.dataSource=new ne;d.setTitle("File transfer")}ngOnInit(){this.initializeOptions(),this.loadData(),this.filterForm.get("interval").valueChanges.forEach(t=>{if(t==="CUSTOM"){let e=new Date,n=this.validStart||e,a=this.validStop||e;this.filterForm.get("customStart").setValue(O.toISOString(n)),this.filterForm.get("customStop").setValue(O.toISOString(a))}else t==="NO_LIMIT"?(this.validStart=null,this.validStop=null,this.appliedInterval=t,this.loadData()):t&&(this.validStop=new Date,this.validStart=O.subtractDuration(this.validStop,t),this.appliedInterval=t,this.loadData())})}initializeOptions(){if(this.interval())if(this.appliedInterval=this.interval(),this.filterForm.get("interval").setValue(this.appliedInterval),this.appliedInterval==="CUSTOM"){let t=this.customStart();this.filterForm.get("customStart").setValue(t),this.validStart=O.toDate(t);let e=this.customStop();this.filterForm.get("customStop").setValue(e),this.validStop=O.toDate(e)}else this.appliedInterval==="NO_LIMIT"?(this.validStart=null,this.validStop=null):(this.validStop=new Date,this.validStart=O.subtractDuration(this.validStop,this.appliedInterval));else this.appliedInterval="NO_LIMIT",this.validStop=null,this.validStart=null}jumpToNow(){this.filterForm.get("interval").setValue("NO_LIMIT")}applyCustomDates(){let{controls:t}=this.filterForm;this.validStart=O.toDate(t.customStart.value),this.validStop=O.toDate(t.customStop.value),this.appliedInterval="CUSTOM",this.loadData()}loadData(){this.updateURL();let t={service:"FileTransferApi"};this.validStart&&(t.start=this.validStart.toISOString()),this.validStop&&(t.stop=this.validStop.toISOString()),this.yamcs.yamcsClient.getAuditRecords(this.yamcs.instance,t).then(e=>this.dataSource.data=e.records||[]).catch(e=>this.messageService.showError(e))}updateURL(){let{controls:t}=this.filterForm;this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{interval:this.appliedInterval,customStart:this.appliedInterval==="CUSTOM"?t.customStart.value:null,customStop:this.appliedInterval==="CUSTOM"?t.customStop.value:null},queryParamsHandling:"merge"})}};we.\u0275fac=function(e){return new(e||we)(w(A),w(Se),w(He),w(Ye),w(ze))},we.\u0275cmp=P({type:we,selectors:[["app-file-transfer-action-log-tab"]],inputs:{interval:[1,"interval"],customStart:[1,"customStart"],customStop:[1,"customStop"]},decls:23,vars:6,consts:[["label","File transfer"],[2,"margin-top","16px",3,"formGroup"],["icon","access_time","formControlName","interval",3,"options"],["mat-table","",1,"ya-data-table","expand",3,"dataSource"],["matColumnDef","time"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","user"],["matColumnDef","summary"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["formControlName","customStart"],["formControlName","customStop"],[3,"click","disabled"],[3,"click"],["mat-header-cell",""],["mat-cell",""],[3,"text"],["mat-header-cell","",1,"expand"],["mat-header-row",""],["mat-row",""]],template:function(e,n){e&1&&(o(0,"ya-instance-page"),T(1,"ya-instance-toolbar",0),o(2,"ya-panel"),T(3,"app-file-transfer-tabs"),o(4,"ya-filter-bar",1),T(5,"ya-select",2),p(6,Ii,4,1)(7,Ni,2,0,"ya-button"),r(),o(8,"table",3),x(9,4),u(10,Li,2,0,"th",5)(11,Ri,3,3,"td",6),b(),x(12,7),u(13,$i,2,0,"th",5)(14,Ai,2,1,"td",6),b(),x(15,8),u(16,Bi,2,0,"th",5)(17,Vi,2,1,"td",6),b(),x(18,9),u(19,ji,1,0,"th",10)(20,Ui,1,0,"td",6),b(),u(21,zi,1,0,"tr",11)(22,Yi,1,0,"tr",12),r()()()),e&2&&(l(4),m("formGroup",n.filterForm),l(),m("options",n.intervalOptions),l(),f(n.filterForm.value.interval==="CUSTOM"?6:7),l(2),m("dataSource",n.dataSource),l(13),m("matHeaderRowDef",n.displayedColumns),l(),m("matRowDefColumns",n.displayedColumns))},dependencies:[be,I,pe,fe,ue,_e,Y,et,it,tt,Ze,nt,te,H,ie,G,ni,ye,at,ot,rt,lt,st,mt,W],encapsulation:2,changeDetection:0});var pt=we;var Hi=()=>["parent"];function Gi(i,t){i&1&&(o(0,"th",14),s(1,"Name"),r())}function Wi(i,t){if(i&1&&(o(0,"mat-icon",16),s(1,"folder"),r(),s(2),_(3,"filename")),i&2){let e=c().$implicit;l(2),C(" ",h(3,1,e.name)," ")}}function qi(i,t){if(i&1&&(o(0,"mat-icon",16),s(1,"description"),r(),o(2,"span",17),s(3),_(4,"filename"),r()),i&2){let e=c().$implicit,n=c(2);l(2),m("ngClass",n.foldersOnly?"disabled":""),l(),$(h(4,2,e.name))}}function Xi(i,t){if(i&1&&(o(0,"td",15),p(1,Wi,4,3)(2,qi,5,4),r()),i&2){let e=t.$implicit;l(),f(e.folder?1:2)}}function Ki(i,t){i&1&&(o(0,"th",18),s(1,"Date modified"),r())}function Qi(i,t){if(i&1&&(o(0,"td",15)(1,"span",17),s(2),_(3,"datetime"),r()()),i&2){let e=t.$implicit,n=c(2);l(),m("ngClass",!e.folder&&n.foldersOnly?"disabled":""),l(),C(" ",h(3,2,e.modified)||"-"," ")}}function Ji(i,t){i&1&&(o(0,"th",19),s(1,"Size"),r())}function Zi(i,t){if(i&1&&(o(0,"td",15)(1,"span",17),s(2),_(3,"formatBytes"),r()()),i&2){let e=t.$implicit,n=c(2);l(),m("ngClass",!e.folder&&n.foldersOnly?"disabled":""),l(),C(" ",h(3,2,e.size)||"-"," ")}}function en(i,t){if(i&1&&(o(0,"td",20)(1,"mat-icon",21),s(2," description "),r(),s(3," .. "),r()),i&2){let e=c(2);oe("colspan",e.displayedColumns.length)}}function tn(i,t){if(i&1){let e=F();o(0,"tr",22),v("click",function(){S(e);let a=c(2);return y(a.clearSelection())}),r()}}function nn(i,t){if(i&1){let e=F();o(0,"tr",23),_(1,"async"),v("click",function(){S(e);let a=c(2);return y(a.selectParent())}),r()}if(i&2){let e=c(2);M("hide",!h(1,2,e.currentPrefix$))}}function an(i,t){if(i&1){let e=F();o(0,"tr",24),v("click",function(a){let d=S(e).$implicit,D=c(2);return y(D.selectFile(a,d))}),r()}if(i&2){let e=t.$implicit,n=c(2);M("selected",n.isSelected(e))}}function on(i,t){if(i&1&&(o(0,"table",1),x(1,2),u(2,Gi,2,0,"th",3)(3,Xi,3,1,"td",4),b(),x(4,5),u(5,Ki,2,0,"th",6)(6,Qi,4,4,"td",4),b(),x(7,7),u(8,Ji,2,0,"th",8)(9,Zi,4,4,"td",4),b(),x(10,9),u(11,en,4,1,"td",10),b(),u(12,tn,1,0,"tr",11)(13,nn,2,4,"tr",12)(14,an,1,2,"tr",13),r()),i&2){let e=c();M("no-frame",e.noFrame)("no-select",e.noSelect),m("dataSource",e.dataSource),l(12),m("cdkHeaderRowDef",e.displayedColumns),l(),m("cdkHeaderRowDef",k(8,Hi)),l(),m("cdkRowDefColumns",e.displayedColumns)}}var re=class re{constructor(t,e){this.changeDetection=e;this.noFrame=!1;this.noSelect=!1;this.allowFolderSelection=!1;this.prefixChange=new ke;this.displayedColumns=["name","size","modified"];this.dataSource=new ne([]);this.currentPrefix$=new E(null);this.selectedFileNames=new Set;this.onChange=t=>{};this.onTouched=()=>{};this.storageClient=t.createStorageClient()}ngOnChanges(){this.bucket&&this.loadCurrentFolder()}changePrefix(t){this.loadCurrentFolder(t)}loadCurrentFolder(t){let e={delimiter:"/"};t&&(e.prefix=t),this.storageClient.listObjects(this.bucket.name,e).then(n=>{this.changedir(n);let a=t||null;a!==this.currentPrefix$.value&&(this.currentPrefix$.next(a),this.prefixChange.emit(a))})}changedir(t){this.selectedFileNames.clear(),this.updateFileNames();let e=[];for(let n of t.prefixes||[])e.push({folder:!0,name:n});for(let n of t.objects||[])n.name.endsWith("/")||e.push({folder:!1,name:n.name,modified:n.created,size:n.size,objectUrl:this.storageClient.getObjectURL(this.bucket.name,n.name)});this.dataSource.data=e,this.changeDetection.detectChanges()}selectFile(t,e){if(e.folder)this.allowFolderSelection&&t.ctrlKey&&t.shiftKey?this.flipRowSelection(e):this.loadCurrentFolder(e.name);else if(!this.foldersOnly){if(this.isMultiSelect&&t.ctrlKey)this.flipRowSelection(e);else if(this.isMultiSelect&&t.shiftKey)if(this.selectedFileNames.size==0||!this.lastSelected||this.lastSelected.name===e.name)this.flipRowSelection(e);else{let n=!1;for(let a of this.dataSource.data)(a.name===e.name||a.name===this.lastSelected.name)&&(n=!n),n&&this.selectedFileNames.add(a.name);this.selectedFileNames.add(e.name)}else this.selectedFileNames.size==1&&this.selectedFileNames.has(e.name)?this.selectedFileNames.clear():(this.selectedFileNames.clear(),this.selectedFileNames.add(e.name));this.selectedFileNames.has(e.name)&&(this.lastSelected=e)}this.updateFileNames()}flipRowSelection(t){this.selectedFileNames.has(t.name)?this.selectedFileNames.delete(t.name):this.selectedFileNames.add(t.name)}updateFileNames(){this.onChange(Array.from(this.selectedFileNames).join("|"))}isSelected(t){return this.selectedFileNames.has(t.name)}selectParent(){let t=this.currentPrefix$.value;if(t){let e=t.slice(0,-1),n=e.lastIndexOf("/");if(n){let a=e.substring(0,n+1);this.selectedFileNames.clear(),this.updateFileNames(),this.loadCurrentFolder(a)}}}writeValue(t){this.path=t}clearSelection(){this.selectedFileNames.clear(),this.updateFileNames(),this.changeDetection.detectChanges()}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}ngOnDestroy(){this.selectionSubscription&&this.selectionSubscription.unsubscribe()}};re.\u0275fac=function(e){return new(e||re)(w(A),w(Ue))},re.\u0275cmp=P({type:re,selectors:[["app-object-selector"]],inputs:{bucket:"bucket",isMultiSelect:"isMultiSelect",foldersOnly:"foldersOnly",noFrame:"noFrame",path:"path",noSelect:"noSelect",allowFolderSelection:"allowFolderSelection"},outputs:{prefixChange:"prefixChange"},features:[Be([{provide:Ge,useExisting:Le(()=>re),multi:!0}]),$e],decls:1,vars:1,consts:[["mat-table","",1,"ya-data-table","expand",3,"dataSource","no-frame","no-select"],["mat-table","",1,"ya-data-table","expand",3,"dataSource"],["cdkColumnDef","name"],["mat-header-cell","","style","width: 400px",4,"cdkHeaderCellDef"],["mat-cell","",4,"cdkCellDef"],["cdkColumnDef","modified"],["mat-header-cell","","style","width: 200px",4,"cdkHeaderCellDef"],["cdkColumnDef","size"],["mat-header-cell","","style","width: 70px",4,"cdkHeaderCellDef"],["cdkColumnDef","parent"],["mat-header-cell","",4,"cdkHeaderCellDef"],["mat-header-row","",3,"click",4,"cdkHeaderRowDef"],["mat-row","","class","parent-row",3,"hide","click",4,"cdkHeaderRowDef"],["mat-row","",3,"selected","click",4,"cdkRowDef","cdkRowDefColumns"],["mat-header-cell","",2,"width","400px"],["mat-cell",""],[1,"icon12",2,"vertical-align","middle"],[3,"ngClass"],["mat-header-cell","",2,"width","200px"],["mat-header-cell","",2,"width","70px"],["mat-header-cell",""],[1,"icon12",2,"vertical-align","middle","visibility","hidden"],["mat-header-row","",3,"click"],["mat-row","",1,"parent-row",3,"click"],["mat-row","",3,"click"]],template:function(e,n){e&1&&p(0,on,15,9,"table",0),e&2&&f(n.dataSource?0:-1)},dependencies:[I,de,ve,Ce,Qe,ge,Je,z,Y,te,H,ie,G,Z,W,dt,ae],styles:["table[_ngcontent-%COMP%]{cursor:pointer}.folder[_ngcontent-%COMP%]:hover{text-decoration:underline}  .parent-row td{font-size:12px;line-height:16px;color:#000000a7;padding:7px 8px 8px 0;border-bottom:1px solid rgba(0,0,0,.12)}.hide[_ngcontent-%COMP%]{display:none}.disabled[_ngcontent-%COMP%]{color:#d3d3d3}.no-select[_ngcontent-%COMP%]{user-select:none;-webkit-user-select:none}"],changeDetection:0});var ut=re;var rn=()=>["parent"],ln=()=>["progress"];function sn(i,t){i&1&&T(0,"th",21)}function cn(i,t){if(i&1&&(o(0,"mat-icon"),s(1," check "),r()),i&2){let e=c().$implicit;kt("visibility",e.checked?"visible":"hidden")}}function mn(i,t){if(i&1){let e=F();o(0,"button",25),v("click",function(){let a=S(e).$implicit,d=c().$implicit,D=c(2);return y(D.runFileAction(d.name,a))}),p(1,cn,2,2,"mat-icon",26),s(2),r()}if(i&2){let e=t.$implicit;m("disabled",!e.enabled),l(),f(e.style==="CHECK_BOX"?1:-1),l(),C(" ",e.label," ")}}function dn(i,t){if(i&1&&(o(0,"td",22)(1,"ya-more",23),L(2,mn,3,3,"button",24,N),r()()),i&2){let e=c(2);l(),m("padding",!1),l(),R(e.fileActions)}}function pn(i,t){i&1&&(o(0,"th",27),s(1,"Name"),r())}function fn(i,t){if(i&1&&(o(0,"mat-icon",29),s(1,"folder"),r(),s(2),_(3,"filename")),i&2){let e=c().$implicit;l(2),C(" ",e.displayName??h(3,1,e.name),"/ ")}}function un(i,t){if(i&1&&(o(0,"mat-icon",29),s(1,"description"),r(),o(2,"span",30),s(3),_(4,"filename"),r()),i&2){let e=c().$implicit,n=c(2);l(2),m("ngClass",n.foldersOnly?"disabled":""),l(),C(" ",e.displayName??h(4,2,e.name)," ")}}function _n(i,t){if(i&1&&(o(0,"td",28),p(1,fn,4,3)(2,un,5,4),r()),i&2){let e=t.$implicit;l(),f(e.folder?1:2)}}function hn(i,t){i&1&&(o(0,"th",31),s(1,"Date modified"),r())}function Cn(i,t){if(i&1&&(o(0,"td",28)(1,"span",30),s(2),_(3,"datetime"),r()()),i&2){let e=t.$implicit,n=c(2);l(),m("ngClass",!e.folder&&n.foldersOnly?"disabled":""),l(),C(" ",h(3,2,e.modified)||"-"," ")}}function gn(i,t){i&1&&(o(0,"th",32),s(1,"Size"),r())}function vn(i,t){if(i&1&&(o(0,"td",28)(1,"span",30),s(2),_(3,"formatBytes"),r()()),i&2){let e=t.$implicit,n=c(2);l(),m("ngClass",!e.folder&&n.foldersOnly?"disabled":""),l(),C(" ",h(3,2,e.size)||"-"," ")}}function Sn(i,t){if(i&1&&(o(0,"td",33),_(1,"async"),o(2,"mat-icon",34),s(3," description "),r(),s(4," .. "),r()),i&2){let e,n=c(2);oe("colspan",(e=h(1,1,n.displayedColumns$))==null?null:e.length)}}function yn(i,t){if(i&1&&(o(0,"td",35),_(1,"async"),s(2),T(3,"ya-dots",36),r()),i&2){let e,n=c(2);oe("colspan",(e=h(1,2,n.displayedColumns$))==null?null:e.length),l(2),C(" ",n.progressMessage()," ")}}function xn(i,t){if(i&1&&(o(0,"th",38),s(1),r()),i&2){let e=c().$implicit;l(),$(e.label)}}function bn(i,t){if(i&1&&s(0),i&2){let e=c().$implicit,n=c().$implicit;C(" ",e.extra[n.id]??"-"," ")}}function Tn(i,t){i&1&&s(0," - ")}function Fn(i,t){if(i&1&&(o(0,"td",28),p(1,bn,1,1)(2,Tn,1,0),r()),i&2){let e=t.$implicit;l(),f(e.extra?1:2)}}function wn(i,t){if(i&1&&(x(0,16),u(1,xn,2,1,"th",37)(2,Fn,3,1,"td",7),b()),i&2){let e=t.$implicit;m("cdkColumnDef",e.id)}}function Dn(i,t){if(i&1){let e=F();o(0,"tr",39),v("click",function(){S(e);let a=c(2);return y(a.clearSelection())}),r()}}function En(i,t){if(i&1){let e=F();o(0,"tr",40),_(1,"async"),v("click",function(){S(e);let a=c(2);return y(a.selectParent())}),r()}if(i&2){let e=c(2);M("hide",!h(1,2,e.currentPrefix$))}}function On(i,t){if(i&1){let e=F();o(0,"tr",41),v("click",function(a){let d=S(e).$implicit,D=c(2);return y(D.selectFile(a,d))}),r()}if(i&2){let e=t.$implicit,n=c(2);M("selected",n.isSelected(e))}}function Mn(i,t){if(i&1&&T(0,"tr",42),i&2){let e=c(2);M("hide",!e.progressMessage())}}function Pn(i,t){if(i&1&&(o(0,"table",1),x(1,2),u(2,sn,1,0,"th",3)(3,dn,4,1,"td",4),b(),x(4,5),u(5,pn,2,0,"th",6)(6,_n,3,1,"td",7),b(),x(7,8),u(8,hn,2,0,"th",9)(9,Cn,4,4,"td",7),b(),x(10,10),u(11,gn,2,0,"th",11)(12,vn,4,4,"td",7),b(),x(13,12),u(14,Sn,5,3,"td",13),b(),x(15,14),u(16,yn,4,4,"td",15),b(),L(17,wn,3,1,"ng-container",16,N),_(19,"async"),u(20,Dn,1,0,"tr",17),_(21,"async"),u(22,En,2,4,"tr",18)(23,On,1,2,"tr",19),_(24,"async"),u(25,Mn,1,2,"tr",20),r()),i&2){let e=c();M("no-select",e.noSelect),m("dataSource",e.dataSource),l(17),R(h(19,7,e.extraColumns$)),l(3),m("cdkHeaderRowDef",h(21,9,e.displayedColumns$)),l(2),m("cdkHeaderRowDef",k(13,rn)),l(),m("cdkRowDefColumns",h(24,11,e.displayedColumns$)),l(2),m("cdkFooterRowDef",k(14,ln))}}var le=class le{constructor(t){this.changeDetection=t;this.noSelect=!1;this.allowFolderSelection=!1;this.fileListExtraColumns=[];this.fileActions=[];this.prefixChange=new ke;this.onAction=new ke;this.displayedColumns$=new E(["name","size","modified"]);this.extraColumns$=new E([]);this.dataSource=new ne([]);this.progressMessage=Re(null);this.currentPrefix$=new E(null);this.selectedFileNames=new Set;this.onChange=t=>{};this.onTouched=()=>{}}ngOnChanges(){this.loadCurrentFolder();let t=[];this.fileActions.length&&t.push("actions"),t.push("name");for(let e of this.fileListExtraColumns)t.push(e.id);t.push("size"),t.push("modified"),this.extraColumns$.next(this.fileListExtraColumns),this.displayedColumns$.next(t)}changePrefix(t){this.loadCurrentFolder(t)}loadCurrentFolder(t){if((t||null)!==this.currentPrefix$.value){let n={files:[],destination:"",remotePath:"",listTime:""};this.setFolderContent(t,n)}}setFolderContent(t,e){this.changeDir(e);let n=t||null;n!==this.currentPrefix$.value&&(this.currentPrefix$.next(n),this.prefixChange.emit(n))}changeDir(t){this.selectedFileNames.clear(),this.updateFileNames();let e=[],n=t.remotePath?t.remotePath+"/":"";for(let a of t.files||[]){let d=n+a.name;e.push({folder:a.isDirectory,name:d,displayName:a.displayName??a.name,modified:a.modified,size:a.size,extra:a.extra||{}})}this.progressMessage.set(t.progressMessage||null),this.dataSource.data=e,this.changeDetection.detectChanges()}selectFile(t,e){if(e.folder)this.allowFolderSelection&&t.ctrlKey&&t.shiftKey?this.flipRowSelection(e):this.loadCurrentFolder(e.name);else if(!this.foldersOnly){if(this.isMultiSelect&&t.ctrlKey)this.flipRowSelection(e);else if(this.isMultiSelect&&t.shiftKey)if(this.selectedFileNames.size==0||!this.lastSelected||this.lastSelected.name===e.name)this.flipRowSelection(e);else{let n=!1;for(let a of this.dataSource.data)(a.name===e.name||a.name===this.lastSelected.name)&&(n=!n),n&&this.selectedFileNames.add(a.name);this.selectedFileNames.add(e.name)}else this.selectedFileNames.size==1&&this.selectedFileNames.has(e.name)?this.selectedFileNames.clear():(this.selectedFileNames.clear(),this.selectedFileNames.add(e.name));this.selectedFileNames.has(e.name)&&(this.lastSelected=e)}this.updateFileNames()}flipRowSelection(t){this.selectedFileNames.has(t.name)?this.selectedFileNames.delete(t.name):this.selectedFileNames.add(t.name)}updateFileNames(){this.onChange(Array.from(this.selectedFileNames).join("|"))}runFileAction(t,e){this.onAction.emit({file:t,action:e})}isSelected(t){return this.selectedFileNames.has(t.name)}selectParent(){let t=this.currentPrefix$.value;if(t){let e=t.slice(0,-1),n=e.lastIndexOf("/"),a=n!=-1?e.substring(0,n+1):void 0;this.selectedFileNames.clear(),this.updateFileNames(),this.loadCurrentFolder(a)}}clearSelection(){this.selectedFileNames.clear(),this.updateFileNames(),this.changeDetection.detectChanges()}writeValue(t){this.path=t}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}ngOnDestroy(){this.selectionSubscription?.unsubscribe()}};le.\u0275fac=function(e){return new(e||le)(w(Ue))},le.\u0275cmp=P({type:le,selectors:[["app-remote-file-selector"]],inputs:{isMultiSelect:"isMultiSelect",foldersOnly:"foldersOnly",path:"path",noSelect:"noSelect",allowFolderSelection:"allowFolderSelection",fileListExtraColumns:"fileListExtraColumns",fileActions:"fileActions"},outputs:{prefixChange:"prefixChange",onAction:"onAction"},features:[Be([{provide:Ge,useExisting:Le(()=>le),multi:!0}]),$e],decls:1,vars:1,consts:[["mat-table","",1,"ya-data-table","expand","no-frame",3,"dataSource","no-select"],["mat-table","",1,"ya-data-table","expand","no-frame",3,"dataSource"],["cdkColumnDef","actions"],["mat-header-cell","","class","status","width","1",4,"cdkHeaderCellDef"],["mat-cell","","class","status",4,"cdkCellDef"],["cdkColumnDef","name"],["mat-header-cell","","style","width: 400px",4,"cdkHeaderCellDef"],["mat-cell","",4,"cdkCellDef"],["cdkColumnDef","modified"],["mat-header-cell","","style","width: 200px",4,"cdkHeaderCellDef"],["cdkColumnDef","size"],["mat-header-cell","","style","width: 70px",4,"cdkHeaderCellDef"],["cdkColumnDef","parent"],["mat-header-cell","",4,"cdkHeaderCellDef"],["cdkColumnDef","progress"],["mat-footer-cell","",4,"cdkFooterCellDef"],[3,"cdkColumnDef"],["mat-header-row","",3,"click",4,"cdkHeaderRowDef"],["mat-row","","class","parent-row",3,"hide","click",4,"cdkHeaderRowDef"],["mat-row","",3,"selected","click",4,"cdkRowDef","cdkRowDefColumns"],["mat-footer-row","","class","progress-row",3,"hide",4,"cdkFooterRowDef"],["mat-header-cell","","width","1",1,"status"],["mat-cell","",1,"status"],[3,"padding"],["mat-menu-item","",3,"disabled"],["mat-menu-item","",3,"click","disabled"],[3,"visibility"],["mat-header-cell","",2,"width","400px"],["mat-cell",""],[1,"icon12",2,"vertical-align","middle"],[3,"ngClass"],["mat-header-cell","",2,"width","200px"],["mat-header-cell","",2,"width","70px"],["mat-header-cell",""],[1,"icon12",2,"vertical-align","middle","visibility","hidden"],["mat-footer-cell",""],[2,"vertical-align","middle"],["mat-header-cell","","width","1",4,"cdkHeaderCellDef"],["mat-header-cell","","width","1"],["mat-header-row","",3,"click"],["mat-row","",1,"parent-row",3,"click"],["mat-row","",3,"click"],["mat-footer-row","",1,"progress-row"]],template:function(e,n){e&1&&p(0,Pn,26,15,"table",0),e&2&&f(n.dataSource?0:-1)},dependencies:[I,de,ve,Ce,Qe,Jt,ge,Je,Zt,z,he,Y,te,H,ei,ie,G,ti,si,pi,Z,W,dt,ae],styles:["table[_ngcontent-%COMP%]{cursor:pointer}.folder[_ngcontent-%COMP%]:hover{text-decoration:underline}  .parent-row td{font-size:12px;line-height:16px;color:#000000a7;padding:7px 8px 8px 0;border-bottom:1px solid rgba(0,0,0,.12)}.hide[_ngcontent-%COMP%]{display:none}.disabled[_ngcontent-%COMP%]{color:#d3d3d3}td.status[_ngcontent-%COMP%]{padding:0;padding-left:0!important;padding-right:0!important}.ya-data-table[_ngcontent-%COMP%]   td.status[_ngcontent-%COMP%] + td[_ngcontent-%COMP%], .ya-data-table[_ngcontent-%COMP%]   th.status[_ngcontent-%COMP%] + th[_ngcontent-%COMP%]{padding-left:2px!important}.no-select[_ngcontent-%COMP%]{user-select:none;-webkit-user-select:none}"],changeDetection:0});var ht=le;var Nn=["objectSelector"],Ln=["remoteSelector"],wi=()=>({visibility:"hidden"}),Di=i=>({"no-filelist":i}),Rn=i=>({selected:i}),Fi=()=>[];function $n(i,t){if(i&1&&(o(0,"span"),s(1),_(2,"formatBytes"),_(3,"formatBytes"),r()),i&2){let e=c().$implicit;l(),Ae("",h(2,2,e.size),"/",h(3,4,e.maxSize))}}function An(i,t){if(i&1&&T(0,"ya-progress",33),i&2){let e=c().$implicit;m("value",e.size)("total",e.maxSize)}}function Bn(i,t){if(i&1&&(o(0,"td",31),_(1,"formatBytes"),o(2,"span")(3,"mat-icon",32),s(4,"shopping_basket"),r(),s(5),r(),p(6,$n,4,6,"span"),p(7,An,1,2,"ya-progress",33),r()),i&2){let e=t.$implicit,n=c();m("title",h(1,4,e.maxSize-e.size)+" available"),l(5),C(" \xA0 ",e.name," "),l(),f(n.showBucketSize$.value?6:-1),l(),f(n.showBucketSize$.value?7:-1)}}function Vn(i,t){if(i&1){let e=F();o(0,"tr",34),_(1,"async"),v("click",function(){let a=S(e).$implicit,d=c();return y(d.selectBucket(a))}),r()}if(i&2){let e=t.$implicit,n=c();m("ngClass",Ve(3,Rn,e===h(1,1,n.selectedBucket$)))}}function jn(i,t){if(i&1&&(o(0,"option",17),s(1),r()),i&2){let e=t.$implicit;m("value",e.name),l(),Ae("",e.name," [id=",e.id,"]")}}function Un(i,t){if(i&1){let e=F();o(0,"ya-breadcrumb",37),v("click",function(){let a=S(e).$implicit,d=c(2);return y(d.changeLocalPrefix(a.prefix))}),r()}if(i&2){let e=t.$implicit;m("label",e.name)("action",!0)}}function zn(i,t){if(i&1){let e=F();o(0,"ya-breadcrumb-trail",18)(1,"ya-breadcrumb",35),v("click",function(){S(e);let a=c();return y(a.changeLocalPrefix(""))}),r(),L(2,Un,1,2,"ya-breadcrumb",36,N),r()}i&2&&(m("showMargin",!1),l(),m("action",!0),l(),R(t))}function Yn(i,t){if(i&1){let e=F();o(0,"app-object-selector",38,0),v("prefixChange",function(a){S(e);let d=c();return y(d.updateLocalBreadcrumb(a))}),r()}i&2&&m("bucket",t)("isMultiSelect",!0)("foldersOnly",!1)("noSelect",!0)("noFrame",!0)("allowFolderSelection",!0)}function Hn(i,t){if(i&1){let e=F();o(0,"ya-button",39),v("click",function(){S(e);let a=c();return y(a.startUpload())}),s(1," UPLOAD "),r()}if(i&2){let e=c();m("disabled",!e.isUploadEnabled)}}function Gn(i,t){if(i&1&&(o(0,"option",17),s(1),r()),i&2){let e=t.$implicit;m("value",e.name),l(),Ae("",e.name," [id=",e.id,"]")}}function Wn(i,t){if(i&1){let e=F();o(0,"ya-breadcrumb",37),v("click",function(){let a=S(e).$implicit,d=c(3);return y(d.changeRemotePrefix(a.prefix))}),r()}if(i&2){let e=t.$implicit;m("label",e.name)("action",!0)}}function qn(i,t){if(i&1){let e=F();o(0,"ya-breadcrumb-trail",18)(1,"ya-breadcrumb",35),v("click",function(){S(e);let a=c(2);return y(a.changeRemotePrefix(""))}),r(),L(2,Wn,1,2,"ya-breadcrumb",36,N),r()}i&2&&(m("showMargin",!1),l(),m("action",!0),l(),R(t))}function Xn(i,t){i&1&&s(0),i&2&&C(" (",t,") ")}function Kn(i,t){if(i&1){let e=F();o(0,"a",41),s(1),_(2,"async"),_(3,"datetime"),p(4,Xn,1,1),_(5,"async"),s(6," \u25BE "),r(),o(7,"mat-menu",42,1)(9,"button",43),v("click",function(){S(e);let a=c(2);return y(a.requestFileList())}),s(10,"Refresh file list"),r()()}if(i&2){let e,n=J(8),a=c(2);m("matMenuTriggerFor",n),l(),C(" ",h(3,5,h(2,3,a.lastFileListTime$))||"No file list received"," "),l(3),f((e=h(5,7,a.lastFileListState$))?4:-1,e)}}function Qn(i,t){if(i&1&&(o(0,"div",24)(1,"label",8),s(2),o(3,"select",40),L(4,Gn,2,3,"option",17,N),r()(),p(6,qn,4,2,"ya-breadcrumb-trail",18),_(7,"async"),p(8,Kn,11,9),r()),i&2){let e,n=c();m("ngClass",Ve(7,Di,!n.service.capabilities.fileList)),l(2),C(" Remote ",n.service.remoteEntities&&n.service.remoteEntities.length?"entity":""," "),l(),m("ngStyle",!(n.service.remoteEntities&&n.service.remoteEntities.length)&&k(9,wi)),l(),R(n.service.remoteEntities),l(2),f((e=h(7,5,n.remoteBreadcrumb$))?6:-1,e),l(2),f(n.service.capabilities.fileList?8:-1)}}function Jn(i,t){if(i&1){let e=F();o(0,"div",44),v("click",function(a){S(e);let d=J(2),D=c();return y(D.clearSelection(a,d))}),o(1,"app-remote-file-selector",45,2),v("prefixChange",function(a){S(e);let d=c();return y(d.updateRemoteBreadcrumb(a))})("onAction",function(a){S(e);let d=c();return y(d.onActionRequest(a))}),r()()}if(i&2){let e=c();l(),m("isMultiSelect",!0)("foldersOnly",!1)("noSelect",!0)("allowFolderSelection",!0)("fileListExtraColumns",e.service.capabilities.fileListExtraColumns||k(6,Fi))("fileActions",e.service.capabilities.fileActions||k(7,Fi))}}function Zn(i,t){if(i&1){let e=F();o(0,"ya-button",46),v("click",function(){S(e);let a=c();return y(a.startDownload())}),s(1," DOWNLOAD "),r()}if(i&2){let e=c();m("disabled",!e.isDownloadEnabled)}}function ea(i,t){if(i&1&&T(0,"input",28),i&2){let e,n=c();m("value",(e=n.form.get("remoteFilenames"))==null?null:e.value)}}function ta(i,t){if(i&1&&(o(0,"label",47),T(1,"input",51),s(2),r()),i&2){let e=c(),n=e.$implicit,a=e.$index,d=c();l(),m("formControlName",d.getControlName(n,a)),l(),C(" ",n.associatedText," ")}}function ia(i,t){if(i&1&&(o(0,"option",17),s(1,"Custom"),r()),i&2){let e=c(3);m("value",e.CUSTOM_OPTION_VALUE)}}function na(i,t){if(i&1&&(o(0,"option",17),s(1),r()),i&2){let e=t.$implicit;m("value",e.value),l(),C(" ",e.verboseName!=null?e.verboseName:e.value," ")}}function aa(i,t){if(i&1&&(o(0,"select",49),p(1,ia,2,1,"option",17),L(2,na,2,2,"option",17,N),r()),i&2){let e=c(),n=e.$implicit,a=e.$index,d=c();m("formControlName",d.getControlName(n,a)+d.DROPDOWN_SUFFIX),l(),f(n.allowCustomOption?1:-1),l(),R(n.values)}}function oa(i,t){if(i&1&&T(0,"input",50),i&2){let e=c(),n=e.$implicit,a=e.$index,d=c();m("formControlName",d.getControlName(n,a))("type",n.type==="DOUBLE"?"number":"text")("placeholder",n.associatedText||"")}}function ra(i,t){if(i&1&&(o(0,"div",30)(1,"label"),s(2),r(),p(3,ta,3,2,"label",47),o(4,"div",48),p(5,aa,4,2,"select",49),p(6,oa,1,3,"input",50),r()()),i&2){let e,n=t.$implicit,a=t.$index,d=c();m("title",n.description||""),l(2),$(n.title||n.name),l(),f(n.type==="BOOLEAN"?3:-1),l(2),f((n.type==="DOUBLE"||n.type==="STRING")&&n.values?5:-1),l(),f((n.type==="DOUBLE"||n.type==="STRING")&&(n.allowCustomOption&&((e=d.form.get(d.getControlName(n,a)+d.DROPDOWN_SUFFIX))==null?null:e.value)===d.CUSTOM_OPTION_VALUE||!n.values)?6:-1)}}var De=class De{constructor(t,e,n,a,d,D,B){this.dialogRef=t;this.yamcs=e;this.messageService=a;this.preferenceStore=d;this.snackBar=D;this.data=B;this.isDownloadEnabled=!1;this.isUploadEnabled=!1;this.dataSource=new ne;this.displayedColumns=["name"];this.prefPrefix="filetransfer.";this.selectedBucket$=new E(null);this.breadcrumb$=new E([]);this.remoteBreadcrumb$=new E([]);this.lastFileListTime$=new E("");this.lastFileListState$=new E(void 0);this.optionsMapping=new Map;this.DROPDOWN_SUFFIX="_Dropdown";this.CUSTOM_OPTION_VALUE="_CUSTOM_OPTION_";this.service=B.service,this.prefPrefix+=this.service.name+".",this.showBucketSize$=this.addPreference$("showBucketSize",!1),this.localDirectory$=this.addPreference$("localDirectory","");let q=this.service.localEntities&&this.service.localEntities.length?this.service.localEntities[0].name:"",se=this.service.remoteEntities&&this.service.remoteEntities.length?this.service.remoteEntities[0].name:"",Me=this.addPreference$("localEntity",q),ce=this.addPreference$("remoteEntity",se);this.storageClient=e.createStorageClient(),this.storageClient.getBuckets().then(g=>{if(this.dataSource.data=g||[],g){let K=this.addPreference$("selectedBucket",g[0].name),U=g.find(V=>V.name===K.value);this.selectBucket(U||g[0])}}),this.fileListSubscription=this.yamcs.yamcsClient.createRemoteFileListSubscription({instance:this.yamcs.instance,serviceName:this.service.name},g=>{if(g.destination==this.form.get("remoteEntity").value){let K=this.remoteSelector.currentPrefix$.value||"";g.remotePath==K&&(this.remoteSelector.setFolderContent(K,g),this.lastFileListTime$.next(g.listTime),this.lastFileListState$.next(g.state))}});let Q={};this.service.transferOptions?.forEach((g,K)=>{let U=this.getControlName(g,K);if(this.optionsMapping.set(g,U),g.type==="BOOLEAN"){let V=this.addPreference$("options."+g.name,g.default?.toLowerCase()==="true");Q[U]=[V.value,[]]}else{let V=this.addPreference$("options."+g.name,g.default||""),me=g.values&&g.values.find(Mi=>Mi.value===V.value);Q[U]=[me==null?V.value:"",[]],Q[U+this.DROPDOWN_SUFFIX]=[me!=null?V.value:this.CUSTOM_OPTION_VALUE,[]]}}),this.form=n.group(Pe({localFilenames:["",[]],remoteFilenames:["",[]],localEntity:[Me.value,this.service.localEntities&&this.service.localEntities.length&&Et.required],remoteEntity:[ce.value,this.service.remoteEntities&&this.service.remoteEntities.length&&Et.required]},Q)),this.form.get("localFilenames")?.valueChanges.subscribe(g=>{this.updateButtonStates(g,this.form.get("remoteFilenames")?.value,this.form.get("remoteFilenames")?.value)}),this.form.get("remoteFilenames")?.valueChanges.subscribe(g=>{this.updateButtonStates(this.form.get("localFilenames")?.value,g,this.form.get("remoteFilenames")?.value)}),this.form.get("localEntity")?.valueChanges.subscribe(g=>{this.setPreferenceValue("localEntity",g)}),this.form.get("remoteEntity")?.valueChanges.subscribe(g=>{this.setPreferenceValue("remoteEntity",g),this.getFileList(g,"")}),this.form.valueChanges.subscribe(async g=>{this.optionsMapping.forEach((K,U)=>{let V=this.form.get(K+this.DROPDOWN_SUFFIX)?.value,me=V==null||V===this.CUSTOM_OPTION_VALUE?this.form.get(K)?.value:V;switch(U.type){case"BOOLEAN":this.setPreferenceValue("options."+U.name,String(me)==="true");break;case"DOUBLE":case"STRING":this.setPreferenceValue("options."+U.name,me??"")}})});let X=this.addPreference$("remoteDirectory","");this.getFileList(ce.value,X.value||"")}set content(t){if(!this.objectSelector){if(!t)return;this.objectSelector=t}this.changeLocalPrefix(this.localDirectory$.value)}getControlName(t,e){return"option"+e+t.name.replace(/\s/g,"")}selectBucket(t){this.selectedBucket$.next(t),this.setPreferenceValue("selectedBucket",t.name)}updateButtonStates(t,e,n){this.isDownloadEnabled=this.service.capabilities.download&&this.selectedBucket$.value&&e!=""&&this.form.valid,this.isUploadEnabled=this.service.capabilities.upload&&t!=""&&this.form.valid}getSelectedRemoteFolderPath(){let t=this.remoteBreadcrumb$.value;return t.length!=0?t[t.length-1].prefix+"/":""}getSelectedLocalFolderPath(){let t=this.breadcrumb$.value;return t.length!=0?t[t.length-1].prefix+"/":""}async startDownload(){return this.startTransfer(this.form.get("remoteEntity")?.value,this.form.get("localEntity")?.value,this.form.get("remoteFilenames")?.value,this.form.get("localFilenames")?.value,this.getSelectedRemoteFolderPath(),this.getSelectedLocalFolderPath(),"DOWNLOAD")}async startUpload(){return this.startTransfer(this.form.get("localEntity")?.value,this.form.get("remoteEntity")?.value,this.form.get("localFilenames")?.value,this.form.get("remoteFilenames")?.value,this.getSelectedLocalFolderPath(),this.getSelectedRemoteFolderPath(),"UPLOAD")}async startTransfer(t,e,n,a,d,D,B){let q=n.trim().split("|");if(!q[0])return;let se=q.map(Q=>{let X;try{X=this.getTransferPaths(Q,a,d,D,B)}catch(g){throw this.messageService.showError(g),g}return B=="DOWNLOAD"&&(X=X.reverse()),this.yamcs.yamcsClient.createFileTransfer(this.yamcs.instance,this.service.name,{direction:B,bucket:this.selectedBucket$.value.name,objectName:X[0],remotePath:X[1],source:t,destination:e,options:this.getTransferOptions()})}),Me,ce=0;for(let Q of se)try{await Q}catch(X){Me=X,ce++}Me&&(ce===1?this.messageService.showError(Me):ce===se.length?this.messageService.showError("Failed to start any of the selected transfers. See server log."):this.messageService.showError("Some of the transfers failed to start. See server log.")),this.dialogRef.close()}getTransferPaths(t,e,n,a,d){t=t.trim(),t=t.startsWith(n)?t.replace(n,""):t;let D=n+t,B=t;if(d==="UPLOAD"&&this.service.capabilities.remotePath||d==="DOWNLOAD"){if(e=e.trim(),e.includes("|"))throw console.error(`Cannot ${d.toLowerCase()} file "${D}" to multiple destination filenames: ${e}`),new Error(`Cannot ${d.toLowerCase()} file "${D}" to multiple destination filenames: ${e}`);let q=e.startsWith(a)?e.replace(a,""):e;B=a+(q||t)}return[D,B]}requestFileList(){let t=this.remoteSelector.currentPrefix$.value||"";this.yamcs.yamcsClient.requestFileList(this.yamcs.instance,this.service.name,{source:this.form.value.localEntity,destination:this.form.value.remoteEntity,remotePath:t,options:this.getTransferOptions()})}getFileList(t,e){this.service.capabilities.fileList&&this.yamcs.yamcsClient.getFileList(this.yamcs.instance,this.service.name,{source:this.form.value.localEntity,destination:t,remotePath:e,options:this.getTransferOptions()}).then(n=>{this.remoteSelector.setFolderContent(e,n),this.setPreferenceValue("remoteDirectory",e),this.lastFileListTime$.next(n.listTime),this.lastFileListState$.next(n.state)})}getTransferOptions(){return this.service.transferOptions?.reduce((t,e)=>{let n=this.optionsMapping.get(e);if(!n)return t;let a=this.form.get(n+this.DROPDOWN_SUFFIX)?.value,d=a==null||a===this.CUSTOM_OPTION_VALUE?this.form.get(n)?.value:a;return e.type==="BOOLEAN"&&typeof d!="boolean"?d=String(d).toLowerCase()==="true":e.type==="DOUBLE"&&typeof d!="number"?d=Number(d):e.type==="STRING"&&typeof d!="string"&&(d=String(d)),Ne(Pe({},t),{[e.name]:d})},{})}updateLocalBreadcrumb(t){if(!t){this.breadcrumb$.next([]),this.setPreferenceValue("localDirectory","");return}t.endsWith("/")&&(t=t.substring(0,t.length-1));let e=[],n=t.split("/");for(let a=0;a<n.length;a++)e.push({name:n[a],prefix:n.slice(0,a+1).join("/")});this.breadcrumb$.next(e),this.setPreferenceValue("localDirectory",t)}changeLocalPrefix(t){t&&(t=t+"/"),this.objectSelector.changePrefix(t)}updateRemoteBreadcrumb(t){if(!t){this.remoteBreadcrumb$.next([]),this.getFileList(this.form.value.remoteEntity,"");return}let e=t.endsWith("/")?t.slice(0,-1):t,n=[],a=e.split("/");for(let d=0;d<a.length;d++)n.push({name:a[d],prefix:a.slice(0,d+1).join("/")});this.remoteBreadcrumb$.next(n),this.getFileList(this.form.value.remoteEntity,t)}changeRemotePrefix(t){t&&(t=t+"/"),this.remoteSelector.changePrefix(t)}clearSelection(t,e){t.currentTarget===t.target&&e.clearSelection()}onActionRequest(t){this.snackBar.open(`Running '${t.action.label}' ...`,void 0,{horizontalPosition:"end"});let e=this.form.value.remoteEntity;this.yamcs.yamcsClient.runFileAction(this.yamcs.instance,this.service.name,{remoteEntity:e,file:t.file,action:t.action.id}).then(()=>{this.snackBar.open(`'${t.action.label}' successful`,void 0,{duration:3e3,horizontalPosition:"end"})}).catch(n=>{this.messageService.showError(n),this.snackBar.open(`'${t.action.label}' failed`,void 0,{duration:3e3,horizontalPosition:"end"})})}toggleBucketSize(){this.setPreferenceValue("showBucketSize",!this.showBucketSize$.value)}addPreference$(t,e){return this.preferenceStore.addPreference$(this.prefPrefix+t,e)}setPreferenceValue(t,e){this.preferenceStore.setValue(this.prefPrefix+t,e)}ngOnDestroy(){this.fileListSubscription?.cancel()}};De.\u0275fac=function(e){return new(e||De)(w(qt),w(A),w(Wt),w(Se),w(ri),w(At),w(Xt))},De.\u0275cmp=P({type:De,selectors:[["app-transfer-file-dialog"]],viewQuery:function(e,n){if(e&1&&(bt(Nn,5),bt(Ln,5)),e&2){let a;Tt(a=Ft())&&(n.content=a.first),Tt(a=Ft())&&(n.remoteSelector=a.first)}},decls:40,vars:23,consts:[["objectSelector",""],["remoteMenu","matMenu"],["remoteSelector",""],[1,"transfer-files"],[1,"ya-form",3,"formGroup"],["mat-icon-button","","mat-dialog-close","",1,"close-button"],[1,"grid-container"],[1,"buckets-column","header"],[1,"table-caption"],[1,"column-action",3,"click"],[1,"buckets-column","table-wrapper"],["mat-table","",1,"ya-data-table","no-frame",3,"dataSource"],["cdkColumnDef","name"],["mat-cell","",3,"title",4,"cdkCellDef"],["mat-row","",3,"ngClass","click",4,"cdkRowDef","cdkRowDefColumns"],[1,"local-column","header"],["formControlName","localEntity",3,"ngStyle"],[3,"value"],[3,"showMargin"],[1,"local-column","table-wrapper",3,"click","ngClass"],["formControlName","localFilenames",3,"bucket","isMultiSelect","foldersOnly","noSelect","noFrame","allowFolderSelection"],[1,"local-column","footer"],["type","text","formControlName","localFilenames","placeholder","Local filename",3,"value"],["appearance","primary","icon","chevron_right",3,"disabled"],[1,"remote-column","header",3,"ngClass"],[1,"remote-column","table-wrapper"],[1,"remote-column","footer"],["appearance","primary","icon","chevron_left",3,"disabled"],["type","text","formControlName","remoteFilenames","placeholder","Remote filename",3,"value"],[1,"options-footer"],[3,"title"],["mat-cell","",3,"title"],[2,"vertical-align","middle"],[3,"value","total"],["mat-row","",3,"click","ngClass"],["icon","account_tree",3,"click","action"],[3,"label","action"],[3,"click","label","action"],["formControlName","localFilenames",3,"prefixChange","bucket","isMultiSelect","foldersOnly","noSelect","noFrame","allowFolderSelection"],["appearance","primary","icon","chevron_right",3,"click","disabled"],["formControlName","remoteEntity",3,"ngStyle"],["matTooltip","Last refresh. Click for actions",1,"lastFileListTime","column-action",3,"matMenuTriggerFor"],["overlapTrigger","false","xPosition","before","yPosition","below",1,"ya-menu"],["mat-menu-item","",3,"click"],[1,"remote-column","table-wrapper",3,"click"],["formControlName","remoteFilenames",3,"prefixChange","onAction","isMultiSelect","foldersOnly","noSelect","allowFolderSelection","fileListExtraColumns","fileActions"],["appearance","primary","icon","chevron_left",3,"click","disabled"],[1,"checkbox-label"],[2,"display","flex","column-gap","8px","flex-wrap","wrap"],[3,"formControlName"],[2,"width","120px",3,"formControlName","type","placeholder"],["type","checkbox",3,"formControlName"]],template:function(e,n){if(e&1&&(o(0,"div",3)(1,"form",4)(2,"h2")(3,"button",5)(4,"mat-icon"),s(5,"close"),r()(),s(6),r(),o(7,"div",6)(8,"div",7)(9,"label",8),s(10," Buckets "),o(11,"a",9),v("click",function(){return n.toggleBucketSize()}),s(12),r()()(),o(13,"div",10)(14,"table",11),x(15,12),u(16,Bn,8,6,"td",13),b(),u(17,Vn,2,5,"tr",14),r()(),o(18,"div",15)(19,"label",8),s(20),o(21,"select",16),L(22,jn,2,3,"option",17,N),r()(),p(24,zn,4,2,"ya-breadcrumb-trail",18),_(25,"async"),r(),o(26,"div",19),v("click",function(d){return n.clearSelection(d,n.objectSelector)}),p(27,Yn,2,6,"app-object-selector",20),_(28,"async"),r(),o(29,"div",21),T(30,"input",22),p(31,Hn,2,1,"ya-button",23),r(),p(32,Qn,9,10,"div",24),p(33,Jn,3,8,"div",25),o(34,"div",26),p(35,Zn,2,1,"ya-button",27),p(36,ea,1,1,"input",28),r(),o(37,"div",29),L(38,ra,7,5,"div",30,N),r()()()()),e&2){let a,d,D;l(),m("formGroup",n.form),l(5),C(" New ",n.service.capabilities.download&&n.service.capabilities.upload?"transfer":n.service.capabilities.upload?"upload":"download"," "),l(6),C(" ",n.showBucketSize$.value?"hide":"show"," size "),l(2),m("dataSource",n.dataSource),l(3),m("cdkRowDefColumns",n.displayedColumns),l(3),C(" Local ",n.service.localEntities&&n.service.localEntities.length?"entity":""," "),l(),m("ngStyle",!(n.service.localEntities&&n.service.localEntities.length)&&k(20,wi)),l(),R(n.service.localEntities),l(2),f((a=h(25,16,n.breadcrumb$))?24:-1,a),l(2),m("ngClass",Ve(21,Di,!n.service.capabilities.fileList)),l(),f((d=h(28,18,n.selectedBucket$))?27:-1,d),l(3),m("value",(D=n.form.get("localFilenames"))==null?null:D.value),l(),f(n.service.capabilities.upload?31:-1),l(),f(n.service.remoteEntities&&n.service.remoteEntities.length||n.service.capabilities.fileList?32:-1),l(),f(n.service.capabilities.fileList?33:-1),l(2),f(n.service.capabilities.download?35:-1),l(),f(n.service.capabilities.download||n.service.capabilities.remotePath?36:-1),l(2),R(n.service.transferOptions)}},dependencies:[ut,I,de,It,zt,Ht,Gt,Vt,Bt,Yt,pe,fe,ue,_e,ve,Ce,ge,Rt,Qt,z,Xe,he,Ke,Y,H,G,qe,oi,ai,ye,ct,ht,Z,W,ae],styles:[".mat-mdc-dialog-container{border-radius:0;position:relative}.transfer-files[_ngcontent-%COMP%]{height:100%}.close-button[_ngcontent-%COMP%]{float:right}.ya-form[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}.grid-container[_ngcontent-%COMP%]{display:grid;grid-auto-flow:column;grid-template-rows:[header] min-content [tables] auto [footer] min-content [options-footer] min-content;grid-template-columns:[buckets] 140px [local] auto [remote] auto;column-gap:8px;flex:1;min-height:0}.header[_ngcontent-%COMP%]{grid-row:header;position:relative;overflow:hidden;font-family:Roboto,sans-serif}.table-wrapper[_ngcontent-%COMP%]{grid-row:tables;overflow:auto;border:1px solid #d3d3d3}.footer[_ngcontent-%COMP%]{grid-row:footer;margin-top:8px;display:flex;flex-wrap:wrap;align-items:flex-start;justify-content:stretch;gap:8px;height:fit-content;font-family:Roboto,sans-serif}.options-footer[_ngcontent-%COMP%]{grid-row:options-footer;grid-column:local / span 2;margin-top:8px;display:flex;flex-wrap:wrap;align-items:flex-start;justify-content:stretch;gap:8px;height:fit-content;font-family:Roboto,sans-serif}.buckets-column[_ngcontent-%COMP%]{grid-column:buckets}.local-column[_ngcontent-%COMP%]{grid-column:local}.remote-column[_ngcontent-%COMP%]{grid-column:remote}label[_ngcontent-%COMP%]{margin:-3px 0 20px;font-weight:500;font-size:11px;letter-spacing:.02em;line-height:12px;color:#000;text-transform:inherit;cursor:default;position:relative;font-family:Roboto,sans-serif}label[_ngcontent-%COMP%], label[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%], label[_ngcontent-%COMP%]   input[type=number][_ngcontent-%COMP%], label[_ngcontent-%COMP%]   input[type=password][_ngcontent-%COMP%], label[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%], label[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], label[_ngcontent-%COMP%]   .date-time-input[_ngcontent-%COMP%]{margin:5px 0 0;display:block;width:100%}.buckets-column.header[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{position:absolute;bottom:0;line-height:24px}.buckets-column.header[_ngcontent-%COMP%] > label[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]{float:right}.buckets-column[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none;display:flex;column-gap:10px;flex-wrap:wrap;justify-content:space-between}a.column-action[_ngcontent-%COMP%]{font-weight:400;font-size:11px;color:#707070;-webkit-user-select:none;user-select:none;cursor:pointer}a.column-action[_ngcontent-%COMP%]:hover{text-decoration:underline}.local-column.table-wrapper.no-filelist[_ngcontent-%COMP%]{grid-column:local / span 2}.local-column.footer[_ngcontent-%COMP%]{flex-wrap:wrap-reverse;align-items:flex-end}.remote-column.header.no-filelist[_ngcontent-%COMP%] > ya-breadcrumb-trail[_ngcontent-%COMP%]{visibility:hidden}label.table-caption[_ngcontent-%COMP%]{margin:0;bottom:0}label.table-caption[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{display:inline-block;width:auto;margin:0 4px}ya-breadcrumb-trail[_ngcontent-%COMP%]{display:inline-block}.lastFileListTime[_ngcontent-%COMP%]{min-width:0;line-height:24px;float:right}.footer[_ngcontent-%COMP%] > button[_ngcontent-%COMP%], .footer[_ngcontent-%COMP%] > input[_ngcontent-%COMP%]{flex-shrink:1}.footer[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{flex-grow:1}.footer[_ngcontent-%COMP%] > input[_ngcontent-%COMP%]{flex-grow:5}table.ya-data-table[_ngcontent-%COMP%]{width:100%}.ya-data-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:none}.checkbox-label[_ngcontent-%COMP%]{font-weight:unset;font-size:unset;letter-spacing:unset;line-height:unset;color:unset;text-transform:unset;cursor:unset;position:unset;display:inline-block;margin:3px 0 0;-webkit-user-select:none;user-select:none}.checkbox-label[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin:0 3px 0 4px}"]});var Ct=De;function la(i,t){if(i&1&&(o(0,"mat-icon",0),s(1,"check_circle"),r()),i&2){let e=c();m("matTooltip",e.state)}}function sa(i,t){if(i&1&&(o(0,"mat-icon",1),s(1,"cached"),r()),i&2){let e=c();m("matTooltip",e.state)}}function ca(i,t){if(i&1&&(o(0,"mat-icon",2),s(1,"highlight_off"),r()),i&2){let e=c();m("matTooltip",e.state)}}function ma(i,t){if(i&1&&(o(0,"mat-icon",3),s(1,"cached"),r()),i&2){let e=c();m("matTooltip",e.state)}}function da(i,t){if(i&1&&(o(0,"mat-icon",4),s(1,"pause_circle"),r()),i&2){let e=c();m("matTooltip",e.state)}}function pa(i,t){if(i&1&&(o(0,"mat-icon",5),s(1,"pending"),r()),i&2){let e=c();m("matTooltip",e.state)}}function fa(i,t){if(i&1&&p(0,la,2,1,"mat-icon",0)(1,sa,2,1,"mat-icon",1)(2,ca,2,1,"mat-icon",2)(3,ma,2,1,"mat-icon",3)(4,da,2,1,"mat-icon",4)(5,pa,2,1,"mat-icon",5),i&2){let e=t;f(e.state==="COMPLETED"?0:e.state==="RUNNING"?1:e.state==="FAILED"?2:e.state==="CANCELLING"?3:e.state==="PAUSED"?4:e.state==="QUEUED"?5:-1)}}var Ee=class Ee{constructor(){this.transfer=j.required()}};Ee.\u0275fac=function(e){return new(e||Ee)},Ee.\u0275cmp=P({type:Ee,selectors:[["app-file-transfer-icon"]],inputs:{transfer:[1,"transfer"]},decls:1,vars:1,consts:[[1,"completed",3,"matTooltip"],[1,"running",3,"matTooltip"],[1,"failed",3,"matTooltip"],[1,"cancelling",3,"matTooltip"],[1,"paused",3,"matTooltip"],[3,"matTooltip"]],template:function(e,n){if(e&1&&p(0,fa,6,1),e&2){let a;f((a=n.transfer())?0:-1,a)}},dependencies:[I,z,qe],styles:[".completed[_ngcontent-%COMP%]{color:#00c752}.running[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_yspin 2s infinite linear}.cancelling[_ngcontent-%COMP%]{color:var(--y-warning-color);animation:_ngcontent-%COMP%_yspin 2s infinite linear}.failed[_ngcontent-%COMP%]{color:var(--y-error-color)}.paused[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_yblink 1s linear infinite}@keyframes _ngcontent-%COMP%_yblink{50%{opacity:0}}@keyframes _ngcontent-%COMP%_yspin{0%{-webkit-transform:rotate(0deg) scaleX(-1);transform:rotate(0) scaleX(-1)}to{-webkit-transform:rotate(359deg) scaleX(-1);transform:rotate(359deg) scaleX(-1)}}"],changeDetection:0});var gt=Ee;var vt=class{constructor(t){this.watermarkObserver=t;this.dirty=!1;this.archiveTransfers=[];this.bufferSize=500;this.bufferWatermark=400;this.pointer=0;this.alreadyWarned=!1;this.realtimeBuffer=Array(this.bufferSize).fill(void 0)}addArchiveData(t){this.archiveTransfers=this.archiveTransfers.concat(t),this.dirty=!0}addRealtimeTransfer(t){this.pointer<this.bufferSize&&(this.realtimeBuffer[this.pointer]=t,this.pointer>=this.bufferWatermark&&this.watermarkObserver&&!this.alreadyWarned&&(this.alreadyWarned=!0,this.watermarkObserver()),this.pointer=this.pointer+1),this.dirty=!0}reset(){this.archiveTransfers=[],this.realtimeBuffer.fill(void 0),this.pointer=0,this.alreadyWarned=!1,this.dirty=!0}snapshot(){let t=[...this.archiveTransfers];return this.realtimeBuffer.map(e=>{if(!e)return;let n=t.findIndex(a=>a.id===e.id);n===-1?t.push(e):t[n]=e}),t.sort((e,n)=>{let a=e.creationTime||e.startTime||"";return(n.creationTime||n.startTime||"").localeCompare(a)}),t}compact(t){let e=this.snapshot();e.length=Math.min(t,e.length),this.reset(),this.archiveTransfers=e,this.dirty=!0}};var St=class{constructor(t,e){this.transfer=t;this.objectUrl=e}get id(){return this.transfer.id}get creationTime(){return this.transfer.creationTime}get startTime(){return this.transfer.startTime}get direction(){return this.transfer.direction}get localEntity(){return this.transfer.localEntity}get remoteEntity(){return this.transfer.remoteEntity}get state(){return this.transfer.state}get bucket(){return this.transfer.bucket}get objectName(){return this.transfer.objectName}get remotePath(){return this.transfer.remotePath}get totalSize(){return this.transfer.totalSize}get sizeTransferred(){return this.transfer.sizeTransferred}get failureReason(){return this.transfer.failureReason}get transferType(){return this.transfer.transferType}};var yt=class extends $t{constructor(e,n,a){super();this.yamcs=e;this.storageClient=a;this.pageSize=100;this.transfers$=new E([]);this.loading$=new E(!1);this.streaming$=new E(!1);this.syncSubscription=n.sync(()=>{this.buffer.dirty&&!this.loading$.getValue()&&(this.emitTransfers(),this.buffer.dirty=!1)}),this.buffer=new vt(()=>{this.buffer.compact(500)})}connect(e){return this.transfers$}emitTransfers(){let e=this.buffer.snapshot();this.transfers$.next(e)}loadTransfers(e,n){return this.loading$.next(!0),Promise.all([this.loadPage(e,Ne(Pe({},n),{limit:this.pageSize}))]).then(a=>{let d=a[0].map(D=>this.toItem(D));return this.loading$.next(!1),this.buffer.reset(),this.buffer.addArchiveData(d),this.emitTransfers(),d})}loadPage(e,n){return this.options=n,this.yamcs.yamcsClient.getFileTransfers(this.yamcs.instance,e.name,n).then(a=>a.transfers||[])}startStreaming(e){this.streaming$.next(!0),this.realtimeSubscription=this.yamcs.yamcsClient.createTransferSubscription({instance:this.yamcs.instance,serviceName:e.name,ongoingOnly:!0},n=>{!this.loading$.getValue()&&this.matchesFilter(n)&&this.buffer.addRealtimeTransfer(this.toItem(n))})}toItem(e){let n=e.objectName?this.storageClient.getObjectURL(e.bucket,e.objectName):"";return new St(e,n)}matchesFilter(e){return!(this.options&&(this.options.direction&&e.direction!==this.options.direction||this.options.localEntityId&&e.localEntity.id!==this.options.localEntityId||this.options.remoteEntityId&&e.remoteEntity.id!==this.options.remoteEntityId||this.options.state?.length&&this.options.state.indexOf(e.state)===-1))}stopStreaming(){this.realtimeSubscription?.cancel(),this.streaming$.next(!1)}disconnect(e){this.stopStreaming(),this.syncSubscription?.unsubscribe(),this.transfers$.complete(),this.loading$.complete(),this.streaming$.complete()}};var ua=()=>["detail"];function _a(i,t){if(i&1){let e=F();o(0,"button",37),v("click",function(){let a=S(e).$implicit,d=c(2);return y(d.switchService(a))}),s(1),r()}if(i&2){let e=t.$implicit;l(),C(" ",e.name," ")}}function ha(i,t){if(i&1&&(o(0,"ya-page-button",34),s(1),r(),o(2,"mat-menu",35,0),L(4,_a,2,1,"button",36,N),r()),i&2){let e,n=J(3),a=c();m("matMenuTriggerFor",n),l(),C(" ",((e=a.service())==null?null:e.name)||"select service"," "),l(3),R(a.services())}}function Ca(i,t){if(i&1){let e=F();o(0,"ya-page-button",39),v("clicked",function(){S(e);let a=c(),d=c();return y(d.showCreateTransferDialog(a))}),s(1),r()}if(i&2){let e=c();m("icon",e.capabilities.download&&e.capabilities.upload?"cloud":e.capabilities.upload?"cloud_upload":"cloud_download"),l(),C(" New ",e.capabilities.download&&e.capabilities.upload?"transfer":e.capabilities.upload?"upload":"download"," ")}}function ga(i,t){if(i&1&&p(0,Ca,2,2,"ya-page-button",38),i&2){let e=t,n=c();f(n.mayControlFileTransfers()&&(e.capabilities.download||e.capabilities.upload)?0:-1)}}function va(i,t){if(i&1){let e=F();T(0,"ya-date-time-input",40)(1,"ya-date-time-input",41),o(2,"ya-button",42),v("click",function(){S(e);let a=c();return y(a.applyCustomDates())}),s(3,"Apply"),r()}if(i&2){let e=c();l(2),m("disabled",e.filterForm.invalid)}}function Sa(i,t){if(i&1){let e=F();o(0,"ya-button",43),v("click",function(){S(e);let a=c();return y(a.jumpToNow())}),s(1,"Jump to now"),r()}}function ya(i,t){i&1&&(o(0,"th",44),s(1,"Started"),r())}function xa(i,t){if(i&1&&(o(0,"td",45),s(1),_(2,"datetime"),r()),i&2){let e=t.$implicit;l(),C(" ",h(2,1,e.startTime)," ")}}function ba(i,t){i&1&&(o(0,"th",44),s(1,"Local entity"),r())}function Ta(i,t){if(i&1&&(o(0,"td",46),s(1),r()),i&2){let e=t.$implicit;l(),C(" ",(e.localEntity==null?null:e.localEntity.name)??(e.localEntity==null?null:e.localEntity.id)??"-"," ")}}function Fa(i,t){i&1&&(o(0,"th",44),s(1,"Local file"),r())}function wa(i,t){if(i&1&&(o(0,"span"),s(1),_(2,"storageUrl"),r()),i&2){let e=c().$implicit;l(),C(" ",Dt(2,1,e.objectName,e.bucket)||"-"," ")}}function Da(i,t){if(i&1&&(o(0,"a",48),s(1),_(2,"storageUrl"),r()),i&2){let e=c().$implicit;m("href",e.objectUrl,Pt),l(),C(" ",Dt(2,2,e.objectName,e.bucket)||"-"," ")}}function Ea(i,t){if(i&1&&(o(0,"td",47),p(1,wa,3,4,"span")(2,Da,3,5,"a",48),r()),i&2){let e=t.$implicit;l(),f(e.direction==="DOWNLOAD"&&e.state!=="COMPLETED"||!e.objectUrl?1:2)}}function Oa(i,t){i&1&&(o(0,"th",44),s(1,"Direction"),r())}function Ma(i,t){i&1&&(o(0,"mat-icon"),s(1,"west"),r())}function Pa(i,t){i&1&&(o(0,"mat-icon",50),s(1,"east"),r())}function ka(i,t){if(i&1&&(o(0,"td",49),p(1,Ma,2,0,"mat-icon"),p(2,Pa,2,0,"mat-icon",50),r()),i&2){let e=t.$implicit;l(),f(e.direction==="DOWNLOAD"?1:-1),l(),f(e.direction==="UPLOAD"?2:-1)}}function Ia(i,t){i&1&&(o(0,"th",44),s(1,"Remote entity"),r())}function Na(i,t){if(i&1&&(o(0,"td",46),s(1),r()),i&2){let e=t.$implicit;l(),C(" ",(e.remoteEntity==null?null:e.remoteEntity.name)??(e.remoteEntity==null?null:e.remoteEntity.id)??"-"," ")}}function La(i,t){i&1&&(o(0,"th",44),s(1,"Remote file"),r())}function Ra(i,t){if(i&1&&(o(0,"td",47),s(1),r()),i&2){let e=t.$implicit;l(),C(" ",e.remotePath||"-"," ")}}function $a(i,t){i&1&&(o(0,"th",44),s(1,"Size"),r())}function Aa(i,t){if(i&1&&(o(0,"td",46),s(1),_(2,"formatBytes"),r()),i&2){let e=t.$implicit;l(),C(" ",h(2,1,e.totalSize)??"-"," ")}}function Ba(i,t){i&1&&T(0,"th",51)}function Va(i,t){if(i&1&&(o(0,"td",52),T(1,"app-file-transfer-icon",53),r()),i&2){let e=t.$implicit;l(),m("transfer",e)}}function ja(i,t){i&1&&(o(0,"th",44),s(1,"Transferred"),r())}function Ua(i,t){if(i&1&&(o(0,"td",46),s(1),_(2,"formatBytes"),r()),i&2){let e=t.$implicit;l(),C(" ",h(2,1,e.sizeTransferred)??"-"," ")}}function za(i,t){i&1&&(o(0,"th",44),s(1,"Transfer type"),r())}function Ya(i,t){if(i&1&&(o(0,"td",46),s(1),r()),i&2){let e=t.$implicit;l(),$(e.transferType||"-")}}function Ha(i,t){i&1&&T(0,"th",54)}function Ga(i,t){if(i&1){let e=F();o(0,"ya-text-action",58),v("click",function(){S(e);let a=c(2).$implicit,d=c();return y(d.pauseTransfer(a))}),s(1," PAUSE "),r()}}function Wa(i,t){if(i&1){let e=F();o(0,"ya-text-action",59),v("click",function(){S(e);let a=c(2).$implicit,d=c();return y(d.resumeTransfer(a))}),s(1," RESUME "),r()}}function qa(i,t){if(i&1&&(p(0,Ga,2,0,"ya-text-action",56),p(1,Wa,2,0,"ya-text-action",57)),i&2){let e=c().$implicit;f(e.state==="RUNNING"?0:-1),l(),f(e.state==="PAUSED"?1:-1)}}function Xa(i,t){if(i&1){let e=F();o(0,"ya-text-action",60),v("click",function(){S(e);let a=c().$implicit,d=c();return y(d.cancelTransfer(a))}),s(1," CANCEL "),r()}}function Ka(i,t){if(i&1&&(o(0,"td",46),p(1,qa,2,2),p(2,Xa,2,0,"ya-text-action",55),r()),i&2){let e,n=t.$implicit,a=c();l(),f(!((e=a.service())==null||e.capabilities==null)&&e.capabilities.pauseResume?1:-1),l(),f(n.state!=="COMPLETED"&&n.state!=="FAILED"?2:-1)}}function Qa(i,t){if(i&1&&T(0,"ya-progress",62),i&2){let e=c().$implicit,n=c();m("value",n.transferPercent(e))("total",1)}}function Ja(i,t){if(i&1&&(o(0,"span",63),s(1),r()),i&2){let e=c().$implicit;l(),C(" ",e.failureReason," ")}}function Za(i,t){if(i&1&&(o(0,"td",46),_(1,"async"),o(2,"div",61),p(3,Qa,1,2,"ya-progress",62),o(4,"span"),s(5),_(6,"formatBytes"),r(),p(7,Ja,2,1,"span",63),r()()),i&2){let e=t.$implicit,n=c();oe("colspan",h(1,4,n.displayedColumns$).length),l(3),f(e.state==="RUNNING"||e.state==="PAUSED"||e.state==="CANCELLING"?3:-1),l(2),$(h(6,6,e.sizeTransferred)),l(2),f(e.failureReason?7:-1)}}function eo(i,t){i&1&&T(0,"tr",64)}function to(i,t){if(i&1&&T(0,"tr",65),i&2){let e=t.$implicit;M("upload",e.direction==="UPLOAD")("nodetail",e.state==="COMPLETED")}}function io(i,t){if(i&1&&T(0,"tr",66),i&2){let e=t.$implicit;M("upload",e.direction==="UPLOAD")}}function no(i,t){i&1&&(o(0,"ya-empty-message",33)(1,"p"),s(2,"This instance has no file transfer services configured."),r()())}var Ei="NO_LIMIT",Oe=class Oe{constructor(t,e,n,a,d,D,B,q){this.yamcs=e;this.router=n;this.route=a;this.messageService=d;this.authService=D;this.dialog=B;this.services=j.required();this.requestedServiceName=j(null,{alias:"service"});this.requestedService=je(()=>{let t=null,e=this.services();for(let n of e)if(this.requestedServiceName()===n.name){t=n;break}return!t&&!this.requestedServiceName()&&(t=e.length?e[0]:null),t});this.service=Re(null);this.localEntityOptions=je(()=>{let t=[{id:"ANY",label:"Any local entity"}];for(let e of this.service()?.localEntities||[])t.push({id:String(e.id),label:e.name});return t});this.remoteEntityOptions=je(()=>{let t=[{id:"ANY",label:"Any remote entity"}];for(let e of this.service()?.remoteEntities||[])t.push({id:String(e.id),label:e.name});return t});this.isIncomplete=(t,e)=>e.state!=="COMPLETED";this.filterForm=new Ut({interval:new ee(Ei),customStart:new ee(null),customStop:new ee(null),direction:new ee("ANY"),state:new ee([]),localEntityId:new ee("ANY"),remoteEntityId:new ee("ANY")});this.intervalOptions=[{id:"PT1H",label:"Last hour"},{id:"PT6H",label:"Last 6 hours"},{id:"P1D",label:"Last 24 hours"},{id:"NO_LIMIT",label:"No limit"},{id:"CUSTOM",label:"Custom",group:!0}];this.directionOptions=[{id:"ANY",label:"Any direction"},{id:"DOWNLOAD",label:"Download"},{id:"UPLOAD",label:"Upload"}];this.stateOptions=[{id:"QUEUED",label:"Queued"},{id:"RUNNING",label:"Running"},{id:"PAUSED",label:"Paused"},{id:"CANCELLING",label:"Cancelling"},{id:"FAILED",label:"Failed"},{id:"COMPLETED",label:"Completed"}];this.defaultColumns=["status","startTime","localEntity","localFile","direction","remoteEntity","remoteFile","size","actions"];this.displayedColumns$=new E([]);this.state=[];t.setTitle("File transfer");let se=e.createStorageClient();this.dataSource=new yt(e,q,se)}ngOnInit(){let t=this.requestedService();this.switchService(t)}switchService(t){this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{service:t?.name||null},queryParamsHandling:"merge"}),this.dataSource.stopStreaming(),this.service.set(t),t&&this.dataSource.startStreaming(t);let e=[...this.defaultColumns];t?.capabilities?.hasTransferType&&e.splice(e.length-1,0,"transferType"),this.displayedColumns$.next(e),this.initializeOptions(),this.loadData(),this.filterForm.get("direction").valueChanges.forEach(n=>{this.direction=n!=="ANY"?n:null,this.loadData()}),this.filterForm.get("state").valueChanges.forEach(n=>{this.state=n,this.loadData()}),this.filterForm.get("localEntityId").valueChanges.forEach(n=>{this.localEntityId=n!=="ANY"?n:null,this.loadData()}),this.filterForm.get("remoteEntityId").valueChanges.forEach(n=>{this.remoteEntityId=n!=="ANY"?n:null,this.loadData()}),this.filterForm.get("interval").valueChanges.forEach(n=>{if(n==="CUSTOM"){let a=this.validStart||this.yamcs.getMissionTime(),d=this.validStop||this.yamcs.getMissionTime();this.filterForm.get("customStart").setValue(O.toISOString(a)),this.filterForm.get("customStop").setValue(O.toISOString(d))}else n==="NO_LIMIT"?(this.validStart=null,this.validStop=null,this.appliedInterval=n,this.loadData()):(this.validStop=this.yamcs.getMissionTime(),this.validStart=O.subtractDuration(this.validStop,n),this.appliedInterval=n,this.loadData())})}initializeOptions(){let t=this.route.snapshot.queryParamMap;if(t.has("direction")&&(this.direction=t.get("direction"),this.filterForm.get("direction").setValue(this.direction)),t.has("state")&&(this.state=t.getAll("state"),this.filterForm.get("state").setValue(this.state)),t.has("localEntityId")&&(this.localEntityId=t.get("localEntityId"),this.filterForm.get("localEntityId").setValue(this.localEntityId)),t.has("remoteEntityId")&&(this.remoteEntityId=t.get("remoteEntityId"),this.filterForm.get("remoteEntityId").setValue(this.remoteEntityId)),t.has("interval"))if(this.appliedInterval=t.get("interval"),this.filterForm.get("interval").setValue(this.appliedInterval),this.appliedInterval==="CUSTOM"){let e=t.get("customStart");this.filterForm.get("customStart").setValue(e),this.validStart=O.toDate(e);let n=t.get("customStop");this.filterForm.get("customStop").setValue(n),this.validStop=O.toDate(n)}else this.appliedInterval==="NO_LIMIT"?(this.validStart=null,this.validStop=null):(this.validStop=this.yamcs.getMissionTime(),this.validStart=O.subtractDuration(this.validStop,this.appliedInterval));else this.appliedInterval=Ei,this.validStop=null,this.validStart=null}mayControlFileTransfers(){return this.authService.getUser().hasSystemPrivilege("ControlFileTransfers")}showCreateTransferDialog(t){this.dialog.open(Ct,{width:"70%",height:"100%",autoFocus:!1,position:{right:"0"},panelClass:"dialog-full-size",data:{service:t}})}jumpToNow(){this.filterForm.get("interval").setValue("NO_LIMIT")}applyCustomDates(){this.validStart=O.toDate(this.filterForm.value.customStart),this.validStop=O.toDate(this.filterForm.value.customStop),this.appliedInterval="CUSTOM",this.loadData()}loadData(){this.updateURL();let t={};this.validStart&&(t.start=this.validStart.toISOString()),this.validStop&&(t.stop=this.validStop.toISOString()),this.direction&&(t.direction=this.direction),this.localEntityId&&(t.localEntityId=this.localEntityId),this.remoteEntityId&&(t.remoteEntityId=this.remoteEntityId),this.state.length&&(t.state=this.state);let e=this.service();e&&this.dataSource.loadTransfers(e,t).catch(n=>this.messageService.showError(n))}updateURL(){this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{direction:this.direction||null,state:this.state.length?this.state:null,localEntityId:this.localEntityId||null,remoteEntityId:this.remoteEntityId||null,interval:this.appliedInterval,customStart:this.appliedInterval==="CUSTOM"?this.filterForm.value.customStart:null,customStop:this.appliedInterval==="CUSTOM"?this.filterForm.value.customStop:null},queryParamsHandling:"merge"})}transferPercent(t){return t.totalSize!=0?t.sizeTransferred/t.totalSize:0}pauseTransfer(t){let e=t.id,n=this.service().name;this.yamcs.yamcsClient.pauseFileTransfer(this.yamcs.instance,n,e).catch(a=>{this.messageService.showError(a)})}resumeTransfer(t){let e=t.id,n=this.service().name;this.yamcs.yamcsClient.resumeFileTransfer(this.yamcs.instance,n,e).catch(a=>{this.messageService.showError(a)})}cancelTransfer(t){let e=t.id,n=this.service().name;this.yamcs.yamcsClient.cancelFileTransfer(this.yamcs.instance,n,e).catch(a=>{this.messageService.showError(a)})}};Oe.\u0275fac=function(e){return new(e||Oe)(w(ze),w(A),w(He),w(Ye),w(Se),w(li),w(Kt),w(ii))},Oe.\u0275cmp=P({type:Oe,selectors:[["app-file-transfer-list"]],inputs:{services:[1,"services"],requestedServiceName:[1,"service","requestedServiceName"]},decls:57,vars:20,consts:[["serviceMenu","matMenu"],["label","File transfer"],[1,"table-wrapper"],[2,"margin-top","16px",3,"formGroup"],["formControlName","direction",3,"options"],["formControlName","state","emptyOption","Any status",3,"options"],["formControlName","localEntityId",3,"options"],["formControlName","remoteEntityId",3,"options"],["icon","access_time","formControlName","interval",3,"options"],["mat-table","","multiTemplateDataRows","",1,"ya-data-table","expand",3,"dataSource"],["matColumnDef","startTime"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","","style","white-space: nowrap",4,"matCellDef"],["matColumnDef","localEntity"],["mat-cell","",4,"matCellDef"],["matColumnDef","localFile"],["mat-cell","","class","file-column",4,"matCellDef"],["matColumnDef","direction"],["mat-cell","","style","text-align: center",4,"matCellDef"],["matColumnDef","remoteEntity"],["matColumnDef","remoteFile"],["matColumnDef","size"],["matColumnDef","status"],["mat-header-cell","","class","status",4,"matHeaderCellDef"],["mat-cell","","class","status",4,"matCellDef"],["matColumnDef","transferred"],["matColumnDef","transferType"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["matColumnDef","detail"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","item-row",3,"upload","nodetail",4,"matRowDef","matRowDefColumns"],["mat-row","","class","item-detail",3,"upload",4,"matRowDef","matRowDefColumns","matRowDefWhen"],["headerTitle","File Transfer"],["primary","true","dropdown","true","icon","file_copy",3,"matMenuTriggerFor"],[1,"ya-menu"],["mat-menu-item",""],["mat-menu-item","",3,"click"],[3,"icon"],[3,"clicked","icon"],["formControlName","customStart"],["formControlName","customStop"],[3,"click","disabled"],[3,"click"],["mat-header-cell",""],["mat-cell","",2,"white-space","nowrap"],["mat-cell",""],["mat-cell","",1,"file-column"],["download","",3,"href"],["mat-cell","",2,"text-align","center"],[1,"upload"],["mat-header-cell","",1,"status"],["mat-cell","",1,"status"],[3,"transfer"],["mat-header-cell","",1,"expand"],["icon","not_interested"],["icon","pause_circle_outline"],["icon","play_circle_outline"],["icon","pause_circle_outline",3,"click"],["icon","play_circle_outline",3,"click"],["icon","not_interested",3,"click"],[1,"detail-layout"],["width","200px",3,"value","total"],[1,"error"],["mat-header-row",""],["mat-row","",1,"item-row"],["mat-row","",1,"item-detail"]],template:function(e,n){if(e&1&&(o(0,"ya-instance-page")(1,"ya-instance-toolbar",1),p(2,ha,6,2),p(3,ga,1,1),r(),o(4,"div",2)(5,"ya-panel"),T(6,"app-file-transfer-tabs"),o(7,"ya-filter-bar",3),T(8,"ya-select",4)(9,"ya-multi-select",5)(10,"ya-select",6)(11,"ya-select",7)(12,"ya-select",8),p(13,va,4,1)(14,Sa,2,0,"ya-button"),r(),o(15,"table",9),x(16,10),u(17,ya,2,0,"th",11)(18,xa,3,3,"td",12),b(),x(19,13),u(20,ba,2,0,"th",11)(21,Ta,2,1,"td",14),b(),x(22,15),u(23,Fa,2,0,"th",11)(24,Ea,3,1,"td",16),b(),x(25,17),u(26,Oa,2,0,"th",11)(27,ka,3,2,"td",18),b(),x(28,19),u(29,Ia,2,0,"th",11)(30,Na,2,1,"td",14),b(),x(31,20),u(32,La,2,0,"th",11)(33,Ra,2,1,"td",16),b(),x(34,21),u(35,$a,2,0,"th",11)(36,Aa,3,3,"td",14),b(),x(37,22),u(38,Ba,1,0,"th",23)(39,Va,2,1,"td",24),b(),x(40,25),u(41,ja,2,0,"th",11)(42,Ua,3,3,"td",14),b(),x(43,26),u(44,za,2,0,"th",11)(45,Ya,2,1,"td",14),b(),x(46,27),u(47,Ha,1,0,"th",28)(48,Ka,3,2,"td",14),b(),x(49,29),u(50,Za,8,8,"td",14),b(),u(51,eo,1,0,"tr",30),_(52,"async"),u(53,to,1,4,"tr",31),_(54,"async"),u(55,io,1,2,"tr",32),r(),p(56,no,3,0,"ya-empty-message",33),r()()()),e&2){let a;l(2),f(n.services().length?2:-1),l(),f((a=n.service())?3:-1,a),l(4),m("formGroup",n.filterForm),l(),m("options",n.directionOptions),l(),m("options",n.stateOptions),l(),m("options",n.localEntityOptions()),l(),m("options",n.remoteEntityOptions()),l(),m("options",n.intervalOptions),l(),f(n.filterForm.value.interval==="CUSTOM"?13:14),l(2),m("dataSource",n.dataSource),l(36),m("matHeaderRowDef",h(52,15,n.displayedColumns$)),l(2),m("matRowDefColumns",h(54,17,n.displayedColumns$)),l(2),m("matRowDefColumns",k(19,ua))("matRowDefWhen",n.isIncomplete),l(),f(n.services().length?-1:56)}},dependencies:[gt,be,I,pe,fe,ue,_e,z,Xe,he,Ke,Y,et,it,tt,Ze,nt,te,H,ie,G,ye,at,ci,ot,rt,lt,fi,di,st,ct,mt,mi,Z,W,ae,_i],styles:["tr.item-row[_ngcontent-%COMP%]:not(.nodetail)   td[_ngcontent-%COMP%]{border-bottom-width:0}tr.item-detail[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-left:40px!important}.detail-layout[_ngcontent-%COMP%]{display:flex;align-items:center}.detail-layout[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-left:20px}.error[_ngcontent-%COMP%]{color:var(--y-error-color)}.file-column[_ngcontent-%COMP%]{white-space:normal!important;min-width:250px!important;max-width:250px!important;overflow-wrap:break-word}tr.upload[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:#f7f7f7}"],changeDetection:0});var xt=Oe;var Oi=(i,t)=>{let e=Mt(A);return e.yamcsClient.getFileTransferServices(e.instance).then(n=>n.services)};var Ol=[{path:"",canActivate:[Ci,hi],canActivateChild:[gi],runGuardsAndResolvers:"always",component:vi,children:[{path:"",pathMatch:"full",component:xt,resolve:{services:Oi}},{path:"log",component:pt}]}];export{Ol as ROUTES};
