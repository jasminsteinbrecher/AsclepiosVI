import{a as De,b as Ie}from"./chunk-N32YITM6.js";import{e as Pe,f as ke}from"./chunk-LWQLZ5XB.js";import{a as be,b as we}from"./chunk-L67MW52F.js";import{Aa as P,Bf as mt,Ca as A,Cb as it,Cc as Ft,Cg as _e,Dg as B,Ea as s,Eb as kt,F as x,Fc as Vt,Fg as ue,Fh as I,G as y,Gb as nt,Gh as Ae,Hb as Mt,Hg as he,Hh as Ee,Ia as G,Ib as at,Ja as Q,Jb as $,Ka as W,Kb as Nt,Kf as N,Lf as ne,Na as bt,Pa as K,Ra as o,Rc as ot,Sa as C,Se as rt,Ta as g,Tg as Ce,V as l,Wg as ge,Y as f,Ya as J,Yd as Rt,Ye as Ut,Yf as ae,Za as E,Ze as Ht,Zg as pt,_ as D,_a as F,_e as Gt,af as Qt,bb as u,bf as Wt,cb as h,cg as oe,da as k,db as q,df as Kt,eb as Dt,ef as Jt,eg as re,f as S,gd as Et,gf as Xt,gg as le,gh as fe,hf as Zt,ib as V,id as X,ie as Yt,ig as me,jc as qt,jd as Bt,jf as te,ka as c,kg as st,la as Tt,lf as lt,lg as se,ma as d,mg as ct,mh as xe,na as v,nh as ye,oa as T,pa as b,pg as dt,ph as Se,qa as _,ra as a,rh as ve,sa as n,sb as M,sc as $t,sh as _t,ta as p,tc as Ot,tg as ce,th as Te,ue as zt,ug as de,vc as Lt,ve as jt,vg as pe,xa as O,xc as At,ya as L,yb as Pt,yf as ee,zb as It,zf as ie}from"./chunk-OXOWQRWE.js";var ut=class extends qt{constructor(t){super();this.yamcs=t;this.items$=new S([]);this.totalSize$=new S(0);this.loading$=new S(!1)}connect(){return this.items$}loadAlgorithms(t){return this.loading$.next(!0),this.yamcs.yamcsClient.getAlgorithms(this.yamcs.instance,t).then(r=>{this.loading$.next(!1),this.totalSize$.next(r.totalSize);let m=[];for(let w of r.systems||[])m.push({name:w.qualifiedName,system:w});for(let w of r.algorithms||[])m.push({name:w.qualifiedName,algorithm:w});this.items$.next(m)})}disconnect(){this.items$.complete(),this.totalSize$.complete(),this.loading$.complete()}};var Fe=["top"],Me=e=>({c:e}),Ve=()=>["/algorithms"],Be=(e,i)=>({c:e,system:i});function Re(e,i){if(e&1&&p(0,"ya-breadcrumb",9),e&2){let t=i.$implicit;_("link",t.route)("queryParams",t.queryParams)("label",t.name)}}function Ye(e,i){if(e&1&&(a(0,"ya-filter-bar")(1,"ya-breadcrumb-trail"),p(2,"ya-breadcrumb",8),T(3,Re,1,3,"ya-breadcrumb",9,v),n()()),e&2){let t=s(),r=s();l(2),_("queryParams",E(1,Me,r.yamcs.context)),l(),b(t)}}function ze(e,i){e&1&&c(0,Ye,5,3,"ya-filter-bar"),e&2&&d(i.length?0:-1)}function je(e,i){e&1&&(a(0,"th",23),o(1,"Name"),n())}function Ue(e,i){if(e&1&&(a(0,"mat-icon",25),o(1,"folder"),n(),a(2,"a",26),o(3),u(4,"filename"),n()),e&2){let t=s().$implicit,r=s(2);l(2),_("routerLink",J(5,Ve))("queryParams",F(6,Be,r.yamcs.context,t.name)),l(),g(" ",h(4,3,t.name),"/ ")}}function He(e,i){if(e&1&&p(0,"ya-highlight",27),e&2){let t=s(2).$implicit,r=s(2);_("text",t.algorithm.qualifiedName)("term",r.filterForm.value.filter)}}function Ge(e,i){if(e&1&&(p(0,"ya-highlight",27),u(1,"slice")),e&2){let t=s(2).$implicit,r=s(2);_("text",q(1,2,t.algorithm.qualifiedName,r.system.length+1))("term",r.filterForm.value.filter)}}function Qe(e,i){if(e&1&&(a(0,"mat-icon",25),o(1,"transform"),n(),a(2,"a",26),c(3,He,1,2,"ya-highlight",27),c(4,Ge,2,5,"ya-highlight",27),n()),e&2){let t=s().$implicit,r=s(2);l(2),_("routerLink","/algorithms"+t.algorithm.qualifiedName)("queryParams",E(4,Me,r.yamcs.context)),l(),d(r.system?-1:3),l(),d(r.system?4:-1)}}function We(e,i){if(e&1&&(a(0,"td",24),c(1,Ue,5,9),c(2,Qe,5,6),n()),e&2){let t=i.$implicit;l(),d(t.system?1:-1),l(),d(t.algorithm?2:-1)}}function Ke(e,i){e&1&&(a(0,"th",23),o(1,"Type"),n())}function Je(e,i){if(e&1&&(a(0,"td",28),o(1),n()),e&2){let t=i.$implicit;l(),C((t.algorithm==null?null:t.algorithm.type)||"-")}}function Xe(e,i){e&1&&(a(0,"th",23),o(1,"Language"),n())}function Ze(e,i){if(e&1&&(a(0,"td",28),o(1),n()),e&2){let t=i.$implicit;l(),C((t.algorithm==null?null:t.algorithm.language)||"-")}}function ti(e,i){e&1&&(a(0,"th",23),o(1,"Scope"),n())}function ei(e,i){if(e&1&&(a(0,"td",28),o(1),n()),e&2){let t=i.$implicit;l(),C((t.algorithm==null?null:t.algorithm.scope)||"-")}}function ii(e,i){e&1&&(a(0,"th",23),o(1,"Description"),n())}function ni(e,i){if(e&1&&o(0),e&2){let t=s().$implicit;g(" ",t.system.shortDescription||"-"," ")}}function ai(e,i){if(e&1&&o(0),e&2){let t=s().$implicit;g(" ",t.algorithm.shortDescription||"-"," ")}}function oi(e,i){if(e&1&&(a(0,"td",29),c(1,ni,1,1),c(2,ai,1,1),n()),e&2){let t=i.$implicit;l(),d(t.system?1:-1),l(),d(t.algorithm?2:-1)}}function ri(e,i){e&1&&p(0,"th",30)}function li(e,i){e&1&&p(0,"td",28)}function mi(e,i){e&1&&p(0,"tr",31)}function si(e,i){if(e&1&&p(0,"tr",32),e&2){let t=i.$implicit,r=s(2);K("selected",r.selection.isSelected(t))}}function ci(e,i){if(e&1&&(a(0,"table",6),O(1,10),k(2,je,2,0,"th",11)(3,We,3,2,"td",12),L(),O(4,13),k(5,Ke,2,0,"th",11)(6,Je,2,1,"td",14),L(),O(7,15),k(8,Xe,2,0,"th",11)(9,Ze,2,1,"td",14),L(),O(10,16),k(11,ti,2,0,"th",11)(12,ei,2,1,"td",14),L(),O(13,17),k(14,ii,2,0,"th",11)(15,oi,3,2,"td",18),L(),O(16,19),k(17,ri,1,0,"th",20)(18,li,1,0,"td",14),L(),k(19,mi,1,0,"tr",21)(20,si,1,2,"tr",22),n()),e&2){let t=s();_("dataSource",t.dataSource),l(19),_("matHeaderRowDef",t.displayedColumns),l(),_("matRowDefColumns",t.displayedColumns)}}function di(e,i){if(e&1&&(a(0,"ya-panel"),o(1," The Mission Database for "),a(2,"i"),o(3),n(),o(4," does not define any algorithms. "),n()),e&2){let t=s();l(3),C(t.yamcs.instance)}}var R=class R{constructor(i,t,r,m){this.yamcs=i;this.route=r;this.router=m;this.filterForm=new Lt({filter:new At,scope:new At("ANY")});this.shortName=!1;this.pageSize=100;this.system=null;this.breadcrumb$=new S([]);this.displayedColumns=["name","type","language","scope","shortDescription","actions"];this.scopeOptions=[{id:"ANY",label:"Any scope"},{id:"GLOBAL",label:"Global"},{id:"COMMAND_VERIFICATION",label:"Command Verification"},{id:"CONTAINER_PROCESSING",label:"Container Processing"}];this.selection=new jt(!1);t.setTitle("Algorithms"),this.dataSource=new ut(i)}ngAfterViewInit(){let i=this.route.snapshot.queryParamMap;i.has("filter")&&(this.filter=i.get("filter")||"",this.filterForm.get("filter").setValue(this.filter)),i.has("scope")&&(this.scope=i.get("scope"),this.filterForm.get("scope").setValue(this.scope)),this.filterForm.get("filter").valueChanges.subscribe(t=>{this.paginator.pageIndex=0,this.filter=t,this.updateDataSource()}),this.filterForm.get("scope").valueChanges.forEach(t=>{this.scope=t!=="ANY"?t:null,this.updateDataSource()}),this.changeSystem(this.route.snapshot.queryParamMap),this.queryParamMapSubscription=this.route.queryParamMap.subscribe(t=>{t.get("system")!==this.system&&this.changeSystem(t)}),this.paginator.page.subscribe(()=>{this.updateDataSource(),this.top.nativeElement.scrollIntoView()})}changeSystem(i){this.system=i.get("system"),this.updateBrowsePath(),i.has("page")?this.paginator.pageIndex=Number(i.get("page")):this.paginator.pageIndex=0,this.updateDataSource()}updateDataSource(){this.updateURL();let i={system:this.system||"/",pos:this.paginator.pageIndex*this.pageSize,limit:this.pageSize};this.filter&&(i.q=this.filter),this.scope&&(i.scope=this.scope),this.dataSource.loadAlgorithms(i).then(()=>{this.selection.clear(),this.updateBrowsePath()})}updateURL(){this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{page:this.paginator.pageIndex||null,filter:this.filter||null,scope:this.scope||null,system:this.system||null},queryParamsHandling:"merge"})}updateBrowsePath(){let i=[],t="";if(this.system)for(let r of this.system.slice(1).split("/"))t+="/"+r,i.push({name:r,route:"/algorithms",queryParams:{system:t,c:this.yamcs.context}});this.breadcrumb$.next(i)}selectNext(){let i=this.dataSource.items$.value,t=0;if(this.selection.hasValue()){let r=this.selection.selected[0];i.indexOf(r)!==-1&&(t=Math.min(i.indexOf(r)+1,i.length-1))}this.selection.select(i[t])}selectPrevious(){let i=this.dataSource.items$.value,t=0;if(this.selection.hasValue()){let r=this.selection.selected[0];i.indexOf(r)!==-1&&(t=Math.max(i.indexOf(r)-1,0))}this.selection.select(i[t])}applySelection(){if(this.selection.hasValue()){let i=this.selection.selected[0];this.dataSource.items$.value.indexOf(i)!==-1&&this.router.navigate(["/algorithms"+i.algorithm?.qualifiedName],{queryParams:{c:this.yamcs.context}})}}ngOnDestroy(){this.queryParamMapSubscription?.unsubscribe(),this.dataSource.disconnect()}};R.\u0275fac=function(t){return new(t||R)(f(N),f(it),f(nt),f(at))},R.\u0275cmp=D({type:R,selectors:[["ng-component"]],viewQuery:function(t,r){if(t&1&&(G(Fe,7),G(rt,7)),t&2){let m;Q(m=W())&&(r.top=m.first),Q(m=W())&&(r.paginator=m.first)}},decls:15,vars:12,consts:[["top",""],["empty",""],["label","Algorithms"],[3,"formGroup"],["formControlName","filter","placeholder","Search by name","icon","search",3,"onArrowDown","onArrowUp","onEnter"],["formControlName","scope",3,"options"],["mat-table","",1,"ya-data-table","expand",3,"dataSource"],[3,"pageSize","hidePageSize","showFirstLastButtons","length"],["link","/algorithms","icon","account_tree",3,"queryParams"],[3,"link","queryParams","label"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","","class","primary-td",4,"matCellDef"],["matColumnDef","type"],["mat-cell","",4,"matCellDef"],["matColumnDef","language"],["matColumnDef","scope"],["matColumnDef","shortDescription"],["mat-cell","","class","wrap200",4,"matCellDef"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"selected",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell","",1,"primary-td"],[1,"icon12",2,"vertical-align","middle"],[3,"routerLink","queryParams"],[3,"text","term"],["mat-cell",""],["mat-cell","",1,"wrap200"],["mat-header-cell","",1,"expand"],["mat-header-row",""],["mat-row",""]],template:function(t,r){if(t&1){let m=P();a(0,"ya-instance-page"),p(1,"ya-instance-toolbar",2)(2,"span",null,0),a(4,"ya-panel"),c(5,ze,1,1),u(6,"async"),a(7,"ya-filter-bar",3)(8,"ya-search-filter",4),A("onArrowDown",function(){return x(m),y(r.selectNext())})("onArrowUp",function(){return x(m),y(r.selectPrevious())})("onEnter",function(){return x(m),y(r.applySelection())}),n(),p(9,"ya-select",5),n(),c(10,ci,21,3,"table",6),p(11,"mat-paginator",7),u(12,"async"),n(),k(13,di,5,1,"ng-template",null,1,Dt),n()}if(t&2){let m;l(5),d((m=h(6,8,r.breadcrumb$))?5:-1,m),l(2),_("formGroup",r.filterForm),l(2),_("options",r.scopeOptions),l(),d(r.dataSource?10:-1),l(),_("pageSize",r.pageSize)("hidePageSize",!0)("showFirstLastButtons",!0)("length",h(12,10,r.dataSource.totalSize$))}},dependencies:[I,$t,Ot,Ft,Vt,$,ot,rt,Ut,Gt,Jt,Qt,Ht,Xt,Wt,Kt,Zt,te,ie,ee,oe,me,st,dt,B,ue,he,M,It,fe],styles:[".primary-td[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{margin-right:7px}"],changeDetection:0});var ht=R;function pi(e,i){if(e&1&&p(0,"ya-led",0),e&2){let t=s();_("color",t.onColor)("fade",!1)("width",t.size)("height",t.size)}}function _i(e,i){if(e&1&&p(0,"ya-led",1),e&2){let t=s();_("fade",!1)("width",t.size)("height",t.size)}}var Y=class Y{constructor(){this.size=14;this.onColor=ce;this.offColor=de}};Y.\u0275fac=function(t){return new(t||Y)},Y.\u0275cmp=D({type:Y,selectors:[["app-algorithm-status"]],inputs:{status:"status",size:"size"},decls:2,vars:2,consts:[[3,"color","fade","width","height"],["color","red",3,"fade","width","height"]],template:function(t,r){t&1&&(c(0,pi,1,4,"ya-led",0),c(1,_i,1,3,"ya-led",1)),t&2&&(d(r.status.errorMessage?-1:0),l(),d(r.status.errorMessage?1:-1))},dependencies:[I,pe],styles:["[_nghost-%COMP%]{line-height:0;font-size:0}"],changeDetection:0});var gt=Y;var ui=["text"],hi=(e,i)=>({c:e,system:i}),Ci=e=>["/mdb/parameters/",e],xt=e=>({c:e});function gi(e,i){if(e&1&&(a(0,"a",2),o(1),n()),e&2){let t=i,r=s();_("queryParams",F(2,hi,r.yamcs.context,t)),l(),g(" ",t," ")}}function fi(e,i){if(e&1&&(a(0,"dt"),o(1),n(),a(2,"dd"),o(3),n()),e&2){let t=i.$implicit;l(),C(t.namespace),l(2),C(t.name)}}function xi(e,i){if(e&1&&(a(0,"dt"),o(1,"Description"),n(),a(2,"dd"),p(3,"app-markdown",5),n()),e&2){let t=s();l(3),_("text",t.algorithm.longDescription)}}function yi(e,i){if(e&1&&(a(0,"dt"),o(1,"Description"),n(),a(2,"dd"),o(3),n()),e&2){let t=s();l(3),g(" ",t.algorithm.shortDescription||"-"," ")}}function Si(e,i){if(e&1&&o(0),e&2){let t=s(2);g(" ",t.status.errorMessage," ")}}function vi(e,i){e&1&&o(0," OK ")}function Ti(e,i){if(e&1&&(a(0,"span"),o(1),u(2,"nanosDuration"),n()),e&2){let t=s(2);l(),g(" ",h(2,1,t.status.execTimeNs/t.status.runCount)," ")}}function bi(e,i){e&1&&(a(0,"span"),o(1,"-"),n())}function Ai(e,i){if(e&1&&(p(0,"mat-divider"),a(1,"dl",3)(2,"dt"),o(3,"Status"),n(),a(4,"dd",6),p(5,"app-algorithm-status",7),o(6," \xA0 "),c(7,Si,1,1)(8,vi,1,0),n(),a(9,"dt"),o(10,"Run count"),n(),a(11,"dd"),o(12),u(13,"number"),n(),a(14,"dt"),o(15,"Total run time"),n(),a(16,"dd"),o(17),u(18,"nanosDuration"),n(),a(19,"dt"),o(20,"Average run time"),n(),a(21,"dd"),c(22,Ti,3,3,"span")(23,bi,2,0,"span"),n(),a(24,"dt"),o(25,"Last run"),n(),a(26,"dd"),o(27),u(28,"datetime"),n()()),e&2){let t=s();l(5),_("status",t.status),l(2),d(t.status.errorMessage?7:8),l(5),C(h(13,6,t.status.runCount)||"-"),l(5),g(" ",h(18,8,t.status.execTimeNs)||"-"," "),l(5),d(t.status.runCount?22:23),l(5),C(h(28,10,t.status.lastRun)||"-")}}function Ei(e,i){e&1&&(a(0,"ya-help"),o(1," You may override the MDB algorithm text. Such a change is scoped to the current processor only and will not persist across server restarts. "),n())}function wi(e,i){e&1&&(a(0,"span",8),o(1,"MDB Override"),n())}function Di(e,i){if(e&1){let t=P();a(0,"div",9)(1,"ya-button",11),u(2,"async"),A("click",function(){x(t);let m=s(2);return y(m.saveTextChanges())}),o(3," Save "),n(),a(4,"ya-button",12),u(5,"async"),A("click",function(){x(t);let m=s(2);return y(m.revertText())}),o(6," Restore MDB text "),n()()}if(e&2){let t,r=s(2);l(),_("disabled",!h(2,2,r.dirty$)),l(3),_("disabled",!((t=h(5,4,r.overrides$))!=null&&t.textOverride))}}function Pi(e,i){if(e&1&&(p(0,"mat-divider"),a(1,"dl",3)(2,"dt"),o(3," Text "),c(4,Ei,2,0,"ya-help"),p(5,"br"),c(6,wi,2,0,"span",8),u(7,"async"),n(),a(8,"dd"),c(9,Di,7,6,"div",9),p(10,"div",10,0),n()()),e&2){let t,r=s();l(4),d(r.isChangeMissionDatabaseEnabled()?4:-1),l(2),d((t=h(7,3,r.overrides$))!=null&&t.textOverride?6:-1),l(3),d(r.isChangeMissionDatabaseEnabled()?9:-1)}}function Ii(e,i){if(e&1&&(a(0,"td"),o(1,"Operand"),n(),a(2,"td"),o(3),n()),e&2){let t=s().$implicit;l(3),C(t.value)}}function ki(e,i){if(e&1&&(a(0,"td"),o(1,"Operator"),n(),a(2,"td"),o(3),n()),e&2){let t=s().$implicit;l(3),C(t.operator)}}function Mi(e,i){e&1&&(a(0,"td"),o(1,"Operand"),n(),a(2,"td"),o(3,"this"),n())}function Ni(e,i){if(e&1&&(a(0,"td"),o(1,"Operand"),n(),a(2,"td")(3,"a",13),o(4),n()()),e&2){let t=s().$implicit,r=s(2);l(3),_("routerLink",E(3,Ci,t.parameter.qualifiedName))("queryParams",E(5,xt,r.yamcs.context)),l(),g(" ",t.parameter.qualifiedName," ")}}function qi(e,i){if(e&1&&(a(0,"tr"),c(1,Ii,4,1)(2,ki,4,1)(3,Mi,4,0)(4,Ni,5,7),n()),e&2){let t,r=i.$implicit;l(),d((t=r.type)==="VALUE_OPERAND"?1:t==="OPERATOR"?2:t==="THIS_PARAMETER_OPERAND"?3:t==="PARAMETER"?4:-1)}}function $i(e,i){if(e&1&&(p(0,"mat-divider"),a(1,"dl",3)(2,"dt"),o(3,"Postfix Expression"),n(),a(4,"dd")(5,"table",4)(6,"tr")(7,"th"),o(8,"Type"),n(),a(9,"th"),o(10,"Value"),n()(),T(11,qi,5,1,"tr",null,v),n()()()),e&2){let t=s();l(11),b(t.algorithm.mathElements)}}function Oi(e,i){e&1&&o(0," Parameter ")}function Li(e,i){e&1&&o(0," Argument ")}function Fi(e,i){e&1&&o(0," Unknown ")}function Vi(e,i){if(e&1&&(a(0,"a",14),o(1),u(2,"spaceSystemName"),u(3,"relativize"),n()),e&2){let t=s().$implicit,r=s(2);_("routerLink","/telemetry/parameters"+t.parameter.qualifiedName)("queryParams",E(8,xt,r.yamcs.context)),l(),g(" ",q(3,5,t.parameter.qualifiedName,h(2,3,r.algorithm.qualifiedName))," ")}}function Bi(e,i){if(e&1&&o(0),e&2){let t=s().$implicit;g(" ",t.argument.name," ")}}function Ri(e,i){e&1&&o(0," - ")}function Yi(e,i){if(e&1&&(a(0,"tr")(1,"td"),o(2),n(),a(3,"td"),c(4,Oi,1,0)(5,Li,1,0)(6,Fi,1,0),n(),a(7,"td"),c(8,Vi,4,10,"a",14)(9,Bi,1,1)(10,Ri,1,0),n(),a(11,"td",15),o(12),n(),a(13,"td",15),o(14),n()()),e&2){let t=i.$implicit;l(2),C(t.inputName||"-"),l(2),d(t.parameter?4:t.argument?5:6),l(4),d(t.parameter?8:t.argument?9:10),l(4),g(" ",t.parameterInstance??"-"," "),l(2),g(" ",t.mandatory?"Yes":"No"," ")}}function zi(e,i){if(e&1&&(a(0,"table",4)(1,"tr")(2,"th"),o(3,"Input name"),n(),a(4,"th"),o(5,"Type"),n(),a(6,"th"),o(7,"Ref"),n(),a(8,"th"),o(9,"Instance"),n(),a(10,"th"),o(11,"Mandatory"),n()(),T(12,Yi,15,5,"tr",null,v),n()),e&2){let t=s();l(12),b(t.algorithm.inputParameter)}}function ji(e,i){e&1&&(a(0,"span"),o(1,"-"),n())}function Ui(e,i){if(e&1&&(a(0,"tr")(1,"td"),o(2),n(),a(3,"td")(4,"a",14),o(5),u(6,"spaceSystemName"),u(7,"relativize"),n()()()),e&2){let t=i.$implicit,r=s(2);l(2),C(t.outputName||"-"),l(2),_("routerLink","/telemetry/parameters"+t.parameter.qualifiedName)("queryParams",E(9,xt,r.yamcs.context)),l(),g(" ",q(7,6,t.parameter.qualifiedName,h(6,4,r.algorithm.qualifiedName))," ")}}function Hi(e,i){if(e&1&&(a(0,"table",4)(1,"tr")(2,"th"),o(3,"Output name"),n(),a(4,"th"),o(5,"Parameter"),n()(),T(6,Ui,8,11,"tr",null,v),n()),e&2){let t=s();l(6),b(t.algorithm.outputParameter)}}function Gi(e,i){e&1&&(a(0,"span"),o(1,"-"),n())}function Qi(e,i){if(e&1&&(a(0,"tr")(1,"td"),o(2,"OnParameterUpdate"),n(),a(3,"td")(4,"a",14),o(5),u(6,"spaceSystemName"),u(7,"relativize"),n()()()),e&2){let t=i.$implicit,r=s(2);l(4),_("routerLink","/telemetry/parameters"+t.qualifiedName)("queryParams",E(8,xt,r.yamcs.context)),l(),g(" ",q(7,5,t.qualifiedName,h(6,3,r.algorithm.qualifiedName))," ")}}function Wi(e,i){if(e&1&&(a(0,"tr")(1,"td"),o(2,"OnPeriodicRate"),n(),a(3,"td"),o(4),n()()),e&2){let t=s(2);l(4),g("",t.algorithm.onPeriodicRate," ms")}}function Ki(e,i){if(e&1&&(a(0,"table",4)(1,"tr")(2,"th"),o(3,"Type"),n(),a(4,"th"),o(5,"Value"),n()(),T(6,Qi,8,10,"tr",null,v),c(8,Wi,5,1,"tr"),n()),e&2){let t=s();l(6),b(t.algorithm.onParameterUpdate),l(2),d(t.algorithm.onPeriodicRate?8:-1)}}function Ji(e,i){e&1&&o(0," - ")}var z=class z{constructor(i,t,r){this.yamcs=i;this.messageService=t;this.authService=r;this.overrides$=new S(null);this.dirty$=new S(!1)}ngAfterViewInit(){this.algorithm.text&&(this.initializeEditor(),this.refreshOverrides())}isChangeMissionDatabaseEnabled(){return this.authService.getUser().hasSystemPrivilege("ChangeMissionDatabase")}initializeEditor(){let i=[Yt,Bt.of([Rt]),X.lineWrapping];this.isChangeMissionDatabaseEnabled()?i.push(X.updateListener.of(m=>{m.docChanged&&this.dirty$.next(!0)})):i.push(Et.readOnly.of(!0));let t=X.theme({"&":{height:"300px",fontSize:"12px"},".cm-scroller":{overflow:"auto",fontFamily:"'Roboto Mono', monospace"}},{dark:!1});switch(i.push(t),this.algorithm.language.toLowerCase()){case"java-expression":i.push(De());break;case"javascript":i.push(Pe());break;case"python":i.push(Ie());break;default:console.warn(`Unexpected language ${this.algorithm.language}`)}let r=Et.create({doc:this.algorithm.text,extensions:i});this.editorView=new X({state:r,parent:this.textContainer.nativeElement})}refreshOverrides(){let i=this.algorithm.qualifiedName,t=this.yamcs.instance,r=this.yamcs.processor;this.yamcs.yamcsClient.getAlgorithmOverrides(t,r,i).then(m=>{this.overrides$.next(m),m.textOverride?this.updateEditorValue(m.textOverride.text):this.updateEditorValue(this.algorithm.text)}).catch(m=>this.messageService.showError(m))}updateEditorValue(i){this.editorView.dispatch({changes:{from:0,to:this.editorView.state.doc.length,insert:i}}),this.dirty$.next(!1)}saveTextChanges(){let i=this.editorView.state.doc.toString(),t=this.yamcs.instance,r=this.yamcs.processor;this.yamcs.yamcsClient.updateAlgorithmText(t,r,this.algorithm.qualifiedName,i).then(()=>this.refreshOverrides()).catch(m=>this.messageService.showError(m))}revertText(){let i=this.yamcs.instance,t=this.yamcs.processor;this.yamcs.yamcsClient.revertAlgorithmText(i,t,this.algorithm.qualifiedName).then(()=>this.refreshOverrides()).catch(r=>this.messageService.showError(r))}};z.\u0275fac=function(t){return new(t||z)(f(N),f(lt),f(ne))},z.\u0275cmp=D({type:z,selectors:[["app-algorithm-detail"]],viewQuery:function(t,r){if(t&1&&G(ui,5),t&2){let m;Q(m=W())&&(r.textContainer=m.first)}},inputs:{algorithm:"algorithm",status:"status"},decls:53,vars:16,consts:[["text",""],[1,"dl-horizontal","no-lead"],["routerLink","/algorithms",1,"ya-link",3,"queryParams"],[1,"dl-horizontal"],["yaDataTable",""],[3,"text"],[2,"display","flex","align-items","center"],[3,"status"],[1,"override-annotation"],[2,"padding-bottom","5px"],[1,"algorithm-text"],["icon","save",2,"margin-right","5px",3,"click","disabled"],["icon","undo",3,"click","disabled"],[1,"ya-link",3,"routerLink","queryParams"],[3,"routerLink","queryParams"],[2,"text-align","center"]],template:function(t,r){if(t&1&&(a(0,"dl",1)(1,"dt"),o(2,"Algorithm"),n(),a(3,"dd"),o(4),u(5,"shortName"),n(),a(6,"dt"),o(7,"System"),n(),a(8,"dd"),c(9,gi,2,5,"a",2),u(10,"spaceSystemName"),n(),T(11,fi,4,2,null,null,v),c(13,xi,4,1)(14,yi,4,1),n(),p(15,"mat-divider"),a(16,"dl",3)(17,"dt"),o(18,"Scope"),n(),a(19,"dd"),o(20),n(),a(21,"dt"),o(22,"Type"),n(),a(23,"dd"),o(24),n(),a(25,"dt"),o(26,"Language"),n(),a(27,"dd"),o(28),n()(),c(29,Ai,29,12),c(30,Pi,12,5),c(31,$i,13,0),p(32,"mat-divider"),a(33,"dl",3)(34,"dt"),o(35,"Input parameters"),n(),a(36,"dd"),c(37,zi,14,0,"table",4)(38,ji,2,0,"span"),n()(),p(39,"mat-divider"),a(40,"dl",3)(41,"dt"),o(42,"Output parameters"),n(),a(43,"dd"),c(44,Hi,8,0,"table",4)(45,Gi,2,0,"span"),n()(),p(46,"mat-divider"),a(47,"dl",3)(48,"dt"),o(49,"Triggers"),n(),a(50,"dd"),c(51,Ki,9,1,"table",4)(52,Ji,1,0),n()()),t&2){let m;l(4),C(h(5,12,r.algorithm.qualifiedName)),l(5),d((m=h(10,14,r.algorithm.qualifiedName))?9:-1,m),l(2),b(r.algorithm.alias),l(2),d(r.algorithm.longDescription?13:14),l(7),C(r.algorithm.scope||"-"),l(4),C(r.algorithm.type||"-"),l(4),C(r.algorithm.language||"-"),l(),d(r.status&&r.algorithm.scope==="GLOBAL"?29:-1),l(),d(r.algorithm.text?30:-1),l(),d(r.algorithm.mathElements?31:-1),l(6),d(r.algorithm.inputParameter?37:38),l(7),d(r.algorithm.outputParameter?44:45),l(7),d(r.algorithm.onParameterUpdate||r.algorithm.onPeriodicRate?51:52)}},dependencies:[gt,ke,I,$,pt,zt,mt,le,M,Pt,ct,xe,ve,_t,Te],styles:["code[_ngcontent-%COMP%]{display:block;background-color:#fafafa;padding:1em;font-size:10px;border:1px solid #d3d3d3;white-space:pre}.algorithm-text[_ngcontent-%COMP%]{border:1px solid rgba(0,0,0,.12)}.override-annotation[_ngcontent-%COMP%]{font-style:italic;font-weight:300}"],changeDetection:0});var ft=z;function Xi(e,i){if(e&1&&(p(0,"app-algorithm-detail",0),u(1,"async")),e&2){let t=s();_("algorithm",i)("status",h(1,2,t.status$))}}var j=class j{constructor(i){this.yamcs=i;this.qualifiedName=V.required({alias:"algorithm"});this.status$=new S(null)}ngOnInit(){let i=this.yamcs.instance;this.algorithm$=this.yamcs.yamcsClient.getAlgorithm(i,this.qualifiedName()),this.yamcs.processor&&(this.algorithmStatusSubscription=this.yamcs.yamcsClient.createAlgorithmStatusSubscription({instance:this.yamcs.instance,processor:this.yamcs.processor,name:this.qualifiedName()},t=>this.status$.next(t)))}ngOnDestroy(){this.algorithmStatusSubscription?.cancel()}};j.\u0275fac=function(t){return new(t||j)(f(N))},j.\u0275cmp=D({type:j,selectors:[["ng-component"]],inputs:{qualifiedName:[1,"algorithm","qualifiedName"]},decls:3,vars:3,consts:[[3,"algorithm","status"]],template:function(t,r){if(t&1&&(a(0,"ya-panel"),c(1,Xi,2,4,"app-algorithm-detail",0),u(2,"async"),n()),t&2){let m;l(),d((m=h(2,1,r.algorithm$))?1:-1,m)}},dependencies:[ft,I,B,M],encapsulation:2,changeDetection:0});var yt=j;var Ne=()=>[],qe=e=>({c:e});function Zi(e,i){if(e&1){let t=P();p(0,"span",4),a(1,"ya-text-action",5),A("click",function(){x(t);let m=s(4);return y(m.switchToSection("runs"))}),o(2," Runs "),n(),o(3," \xA0\xA0 "),a(4,"ya-text-action",6),A("click",function(){x(t);let m=s(4);return y(m.switchToSection("logs"))}),o(5," Logs "),n()}if(e&2){let t=i;l(),_("active",t==="runs"),l(3),_("active",t==="logs")}}function tn(e,i){e&1&&(a(0,"mat-icon",9),o(1,"error"),n())}function en(e,i){e&1&&(a(0,"mat-icon",10),o(1,"check_circle"),n())}function nn(e,i){e&1&&p(0,"br")}function an(e,i){if(e&1&&(a(0,"a",13),o(1),n(),o(2," : "),p(3,"ya-value",14),c(4,nn,1,0,"br")),e&2){let t=i.$implicit,r=i.$index,m=i.$count,w=s(8);_("routerLink","/telemetry/parameters"+t.id.name)("queryParams",E(5,qe,w.yamcs.context)),l(),g(" ",t.id.name," "),l(2),_("value",t.engValue),l(),d(r!==m-1?4:-1)}}function on(e,i){e&1&&o(0," - ")}function rn(e,i){e&1&&p(0,"br")}function ln(e,i){if(e&1&&(a(0,"a",13),o(1),n(),o(2," : "),p(3,"ya-value",14),c(4,rn,1,0,"br")),e&2){let t=i.$implicit,r=i.$index,m=i.$count,w=s(8);_("routerLink","/telemetry/parameters"+t.id.name)("queryParams",E(5,qe,w.yamcs.context)),l(),g(" ",t.id.name," "),l(2),_("value",t.engValue),l(),d(r!==m-1?4:-1)}}function mn(e,i){e&1&&o(0," - ")}function sn(e,i){if(e&1&&(a(0,"tr")(1,"td",8),c(2,tn,2,0,"mat-icon",9)(3,en,2,0,"mat-icon",10),n(),a(4,"td",11),o(5),u(6,"datetime"),n(),a(7,"td",12),T(8,an,5,7,null,null,v),c(10,on,1,0),n(),a(11,"td",12),T(12,ln,5,7,null,null,v),c(14,mn,1,0),n(),a(15,"td",11),o(16),u(17,"nvl"),n(),a(18,"td",11),o(19),n(),p(20,"td"),n()),e&2){let t=i.$implicit;l(2),d(t.error?2:3),l(3),C(h(6,6,t.time)),l(3),b(t.inputs||J(11,Ne)),l(2),d(t.inputs!=null&&t.inputs.length?-1:10),l(2),b(t.outputs||J(12,Ne)),l(2),d(t.outputs!=null&&t.outputs.length?-1:14),l(2),C(q(17,8,t.returnValue,"-")),l(3),C(t.error||"-")}}function cn(e,i){if(e&1&&(a(0,"table",7)(1,"tr"),p(2,"th",8),a(3,"th"),o(4,"Started"),n(),a(5,"th"),o(6,"Inputs"),n(),a(7,"th"),o(8,"Outputs"),n(),a(9,"th"),o(10,"Return value"),n(),a(11,"th"),o(12,"Error"),n(),p(13,"th"),n(),T(14,sn,21,13,"tr",null,v),n()),e&2){let t=s();l(14),b(t.runs)}}function dn(e,i){if(e&1){let t=P();a(0,"ya-empty-message")(1,"p"),o(2,"Tracing has started."),n(),a(3,"p"),o(4," This page does "),a(5,"strong"),o(6,"not"),n(),o(7," update automatically. "),n(),a(8,"p"),o(9," Hit refresh, or check back at a later time when you think there should be trace entries. "),n(),a(10,"p")(11,"ya-button",15),A("click",function(){x(t);let m=s(6);return y(m.refreshData())}),o(12,"Refresh"),n()()()}}function pn(e,i){if(e&1&&c(0,cn,16,0,"table",7)(1,dn,13,0,"ya-empty-message"),e&2){let t=i;d(t.runs!=null&&t.runs.length?0:1)}}function _n(e,i){if(e&1){let t=P();a(0,"ya-empty-message")(1,"p"),o(2,"Tracing has started."),n(),a(3,"p"),o(4," This page does "),a(5,"strong"),o(6,"not"),n(),o(7," update automatically. "),n(),a(8,"p"),o(9," Hit refresh, or check back at a later time when you think there should be trace entries. "),n(),a(10,"p")(11,"ya-button",15),A("click",function(){x(t);let m=s(5);return y(m.refreshData())}),o(12,"Refresh"),n()()()}}function un(e,i){if(e&1&&(c(0,pn,2,1),u(1,"async"),Tt(2,_n,13,0,"ya-empty-message")),e&2){let t,r=s(4);d((t=h(1,1,r.trace$))?0:2,t)}}function hn(e,i){if(e&1&&(a(0,"tr")(1,"td",17),o(2),u(3,"datetime"),n(),a(4,"td",18),o(5),n()()),e&2){let t=i.$implicit;l(2),g(" [",h(3,2,t.time),"] "),l(3),C(t.msg)}}function Cn(e,i){if(e&1&&(a(0,"table",16),T(1,hn,6,4,"tr",null,v),n()),e&2){let t=s();l(),b(t.logs)}}function gn(e,i){if(e&1){let t=P();a(0,"ya-empty-message")(1,"p"),o(2,"Tracing has started."),n(),a(3,"p"),o(4," This page does "),a(5,"strong"),o(6,"not"),n(),o(7," update automatically. "),n(),a(8,"p"),o(9," Hit refresh, or check back at a later time when you think there should be trace entries. "),n(),a(10,"p")(11,"ya-button",15),A("click",function(){x(t);let m=s(6);return y(m.refreshData())}),o(12,"Refresh"),n()()()}}function fn(e,i){if(e&1&&c(0,Cn,3,0,"table",16)(1,gn,13,0,"ya-empty-message"),e&2){let t=i;d(t.logs!=null&&t.logs.length?0:1)}}function xn(e,i){if(e&1){let t=P();a(0,"ya-empty-message")(1,"p"),o(2,"Tracing has started."),n(),a(3,"p"),o(4," This page does "),a(5,"strong"),o(6,"not"),n(),o(7," update automatically. "),n(),a(8,"p"),o(9," Hit refresh, or check back at a later time when you think there should be trace entries. "),n(),a(10,"p")(11,"ya-button",15),A("click",function(){x(t);let m=s(5);return y(m.refreshData())}),o(12,"Refresh"),n()()()}}function yn(e,i){if(e&1&&(c(0,fn,2,1),u(1,"async"),Tt(2,xn,13,0,"ya-empty-message")),e&2){let t,r=s(4);d((t=h(1,1,r.trace$))?0:2,t)}}function Sn(e,i){if(e&1){let t=P();a(0,"div",1)(1,"div",2)(2,"ya-button",3),A("click",function(){x(t);let m=s(3);return y(m.stopTrace())}),o(3,"Stop trace"),n(),o(4," \xA0 "),a(5,"ya-button",3),A("click",function(){x(t);let m=s(3);return y(m.refreshData())}),o(6,"Refresh"),n(),o(7," \xA0 "),c(8,Zi,6,2),u(9,"async"),n()(),a(10,"ya-panel"),c(11,un,3,3),u(12,"async"),c(13,yn,3,3),u(14,"async"),n()}if(e&2){let t,r=s(3);l(8),d((t=h(9,3,r.section$))?8:-1,t),l(3),d(h(12,5,r.section$)==="runs"?11:-1),l(2),d(h(14,7,r.section$)==="logs"?13:-1)}}function vn(e,i){if(e&1){let t=P();a(0,"ya-empty-message",0)(1,"p"),o(2,"The trace tool captures runs, inputs, outputs and log messages of this algorithm."),n(),a(3,"p")(4,"ya-button",15),A("click",function(){x(t);let m=s(3);return y(m.startTrace())}),o(5,"Start trace"),n()()()}}function Tn(e,i){e&1&&c(0,Sn,15,9)(1,vn,6,0,"ya-empty-message",0),e&2&&d(i.traceEnabled?0:1)}function bn(e,i){if(e&1&&(c(0,Tn,2,1),u(1,"async")),e&2){let t,r=s();d((t=h(1,1,r.status$))?0:-1,t)}}var U=class U{constructor(i,t,r,m){this.route=i;this.router=t;this.yamcs=r;this.messageService=m;this.qualifiedName=V.required({alias:"algorithm"});this.status$=new S(null);this.trace$=new S(null);this.section$=new S("runs")}ngOnInit(){this.algorithm$=this.yamcs.yamcsClient.getAlgorithm(this.yamcs.instance,this.qualifiedName()),this.refreshData()}ngAfterViewInit(){let i=this.route.snapshot.queryParamMap;i.has("section")&&this.switchToSection(i.get("section"))}switchToSection(i){this.section$.next(i),this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{section:i},queryParamsHandling:"merge"})}refreshData(){this.yamcs.processor?(this.yamcs.yamcsClient.getAlgorithmStatus(this.yamcs.instance,this.yamcs.processor,this.qualifiedName()).then(i=>{this.status$.next(i)}).catch(i=>{this.messageService.showError(i)}),this.yamcs.yamcsClient.getAlgorithmTrace(this.yamcs.instance,this.yamcs.processor,this.qualifiedName()).then(i=>{this.trace$.next(i)}).catch(i=>{this.messageService.showError(i)})):(this.status$.next(null),this.trace$.next(null))}startTrace(){this.yamcs.yamcsClient.startAlgorithmTrace(this.yamcs.instance,this.yamcs.processor,this.qualifiedName()).then(()=>{this.refreshData()}).catch(i=>this.messageService.showError(i))}stopTrace(){this.yamcs.yamcsClient.stopAlgorithmTrace(this.yamcs.instance,this.yamcs.processor,this.qualifiedName()).then(()=>{this.refreshData(),this.switchToSection("runs"),this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{section:null},queryParamsHandling:"merge"})}).catch(i=>this.messageService.showError(i))}};U.\u0275fac=function(t){return new(t||U)(f(nt),f(at),f(N),f(lt))},U.\u0275cmp=D({type:U,selectors:[["ng-component"]],inputs:{qualifiedName:[1,"algorithm","qualifiedName"]},decls:2,vars:3,consts:[["headerTitle","Trace"],[1,"extra-bar-container"],[1,"extra-bar"],[3,"click"],[1,"separator",2,"margin-left","10px","margin-right","10px"],["icon","directions_run",3,"click","active"],["icon","menu_book",3,"click","active"],["yaDataTable","",1,"expand"],[1,"status"],[1,"error"],[1,"ok"],[2,"width","200px"],[2,"width","400px"],[1,"secundary",3,"routerLink","queryParams"],[3,"value"],["appearance","primary",3,"click"],[1,"logs","mono",2,"width","100%"],["width","1",1,"time",2,"white-space","nowrap"],[1,"msg",2,"white-space","pre"]],template:function(t,r){if(t&1&&(c(0,bn,2,3),u(1,"async")),t&2){let m;d((m=h(1,1,r.algorithm$))?0:-1,m)}},dependencies:[I,$,pt,ot,mt,ae,B,re,ge,M,ct,ye],styles:[".extra-bar-container[_ngcontent-%COMP%]{padding:12px;border-bottom:1.1px solid rgba(0,0,0,.08)}.extra-bar[_ngcontent-%COMP%]{height:24px;line-height:24px}.separator[_ngcontent-%COMP%]{border-right:1px solid rgba(0,0,0,.12)}table.logs[_ngcontent-%COMP%]{line-height:12px}table.logs[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-size:12px;color:#000000a7}table.logs[_ngcontent-%COMP%]   td.time[_ngcontent-%COMP%]{color:#00000059}.status[_ngcontent-%COMP%]   .ok[_ngcontent-%COMP%]{color:#00c752}.status[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]{color:var(--y-error-color)}"],changeDetection:0});var St=U;var $e=e=>({c:e}),An=(e,i)=>({c:e,system:i});function En(e,i){if(e&1&&(a(0,"a",7),o(1),n()),e&2){let t=s().$implicit,r=s(3);_("queryParams",F(2,An,r.yamcs.context,t.path)),l(),g(" ",t.name," ")}}function wn(e,i){if(e&1&&(c(0,En,2,5,"a",7),o(1," / ")),e&2){let t=i.$index;d(t!==0?0:-1)}}function Dn(e,i){if(e&1&&(T(0,wn,2,1,null,null,v),u(2,"parents"),a(3,"span"),o(4),u(5,"shortName"),n(),p(6,"ya-title-copy",6)),e&2){let t=s();b(h(2,2,t.qualifiedName)),l(4),C(h(5,4,t.qualifiedName)),l(2),_("text",t.qualifiedName)}}function Pn(e,i){if(e&1&&(a(0,"ya-instance-page")(1,"ya-instance-toolbar"),k(2,Dn,7,6,"ng-template",2),n(),a(3,"ya-page-tabs")(4,"a",3,0),o(6," Summary "),n(),a(7,"a",4,1),o(9," Trace "),n()(),a(10,"div",5),p(11,"router-outlet"),n()()),e&2){let t=bt(5),r=bt(8),m=s();l(4),K("active",t.isActive),_("queryParams",E(8,$e,m.yamcs.context)),l(3),K("active",r.isActive)("disabled",i.scope!=="GLOBAL"),_("queryParams",E(10,$e,m.yamcs.context))}}var H=class H{constructor(i,t){this.yamcs=i;this.title=t;this.qualifiedName=V.required({alias:"algorithm"})}ngOnInit(){this.algorithm$=this.yamcs.yamcsClient.getAlgorithm(this.yamcs.instance,this.qualifiedName()),this.algorithm$.then(i=>{this.title.setTitle(i.name)})}};H.\u0275fac=function(t){return new(t||H)(f(N),f(it))},H.\u0275cmp=D({type:H,selectors:[["ng-component"]],inputs:{qualifiedName:[1,"algorithm","qualifiedName"]},decls:2,vars:3,consts:[["rla","routerLinkActive"],["rlb","routerLinkActive"],["ya-instance-toolbar-label",""],["routerLink","-/summary","routerLinkActive","",3,"queryParams"],["routerLink","-/trace","routerLinkActive","",3,"queryParams"],[1,"tab-content-wrapper"],[3,"text"],["routerLink","/algorithms",1,"ya-link","ya-header-link",3,"queryParams"]],template:function(t,r){if(t&1&&(c(0,Pn,12,12,"ya-instance-page"),u(1,"async")),t&2){let m;d((m=h(1,1,r.algorithm$))?0:-1,m)}},dependencies:[I,Mt,$,Nt,st,dt,se,_e,Ce,M,Se,_t],styles:[".tab-content-wrapper[_ngcontent-%COMP%]{position:absolute;inset:37px 0 0;overflow:auto}.tab-content-wrapper.noscroll[_ngcontent-%COMP%]{overflow:hidden}"],changeDetection:0});var vt=H;var In=e=>{let i=e,t=e.findIndex(m=>m.path==="-");t!==-1&&(i=e.slice(0,t));let r="/"+i.map(m=>m.path).join("/");return{consumed:i,posParams:{algorithm:new kt(r,{})}}},ro=[{path:"",canActivate:[Ae,be],canActivateChild:[Ee],runGuardsAndResolvers:"always",component:we,children:[{path:"",pathMatch:"full",component:ht},{matcher:In,component:vt,children:[{path:"",pathMatch:"full",redirectTo:"-/summary"},{path:"-/summary",component:yt},{path:"-/trace",component:St}]}]}];export{ro as ROUTES};
